import{a as Nt,b as Ot}from"./chunk-GVO3AHEU.js";import{b as vt}from"./chunk-ZJEYRZXI.js";import{a as Vt,b as Rt}from"./chunk-ELWEMSC7.js";import"./chunk-LD55VJOR.js";import"./chunk-ISADC5UE.js";import"./chunk-EH24ARRV.js";import{A as Ct,Aa as wt,B as Ie,C as Ce,Ga as be,Ha as Bt,Ja as Pt,Ka as kt,La as he,Q as bt,R as ht,Xa as Mt,ba as Et,fa as At,ha as ie,i as Le,ia as ne,ja as oe,k as ee,ka as re,m as Se,n as ue,na as Tt,o as ut,p as te,pa as ae,qa as Lt,r as ge,ra as St,t as ye,ta as yt,ua as Ft,v as Fe,va as we,w as fe,wa as It,y as gt,z as ft,za as Dt}from"./chunk-JIMEKKLT.js";import{j as Z,k as _t,m as De,n as xt}from"./chunk-CM3ZXFC4.js";import{A as pe,D as rt,E as de,I as at,J as Ye,K as x,L as T,M as L,N as J,O as w,P as lt,R as Q,S as st,aa as X,ba as Ne,da as mt,e as Re,ea as Ae,fa as S,ga as Oe,ha as xe,ia as ct,ja as Te,k as P,ka as $e,o as q,r as O,ra as _e,s as j,sa as pt,u as Y,v as $,va as dt,wa as He,x as ot,ya as H,z as ce}from"./chunk-4W4WMVPF.js";import{Aa as A,Ba as v,Ca as o,E as Pe,H as d,J as k,Ja as qe,K as ke,La as p,Ma as z,Mb as Me,Na as f,O as b,Oa as le,Ob as Ve,P as h,Pa as et,Qa as M,Ra as V,Rb as je,Sa as R,Wa as K,Xa as tt,_ as r,eb as D,fb as ve,gb as N,ja as _,ka as U,la as c,oa as W,pa as G,qa as g,ra as y,sa as F,ta as I,tb as it,ua as s,va as m,w as se,wa as u,yb as me,zb as nt}from"./chunk-EUOB27Q6.js";var Zt=e=>({enabled:e});function ei(e,i){if(e&1&&(s(0,"div",13)(1,"h1"),p(2),m()()),e&2){let t=o();r(2),z(t.BreadcrumbEnum.AGREEMENTS)}}function ti(e,i){if(e&1&&(s(0,"th",14),p(1),u(2,"p-sortIcon",16),m()),e&2){let t=i.$implicit;c("pSortableColumn",t.field),r(),f(" ",t.header," "),r(),c("field",t.field)}}function ii(e,i){if(e&1&&(s(0,"tr"),F(1,ti,3,3,"th",14,y),s(3,"th",15),p(4),m()()),e&2){let t=i.$implicit,n=o();r(),I(t),r(3),f(" ",n.TableEnum.ACTIONS," ")}}function ni(e,i){if(e&1&&p(0),e&2){let t=o(2).$implicit,n=o().$implicit;f(" ",n[t.field].unit.name," ")}}function oi(e,i){if(e&1&&p(0),e&2){let t=o(2).$implicit,n=o().$implicit;f(" ",n[t.field].state.name," ")}}function ri(e,i){if(e&1&&_(0,ni,1,1)(1,oi,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="administrator"?0:t==="agreementState"?1:-1)}}function ai(e,i){if(e&1&&(p(0),D(1,"customFormatDate")),e&2){let t=o(4).$implicit;f(" ",ve(1,1,t.subscribedAt)," ")}}function li(e,i){if(e&1&&_(0,ai,2,3),e&2){let t=o(3).$implicit;g(0,t.subscribedAt?0:-1)}}function si(e,i){if(e&1&&(p(0),D(1,"customFormatDate")),e&2){let t=o(4).$implicit;f(" ",ve(1,1,t.endedAt)," ")}}function mi(e,i){e&1&&p(0," Indefinido ")}function ci(e,i){if(e&1&&_(0,si,2,3)(1,mi,1,0),e&2){let t=o(3).$implicit;g(0,t.endedAt?0:1)}}function pi(e,i){if(e&1&&(p(0),D(1,"yesNo")),e&2){let t=o(3).$implicit;f(" ",ve(1,1,t.isFinancing)," ")}}function di(e,i){e&1&&u(0,"p-tag",19)}function _i(e,i){e&1&&u(0,"p-tag",20)}function ui(e,i){if(e&1&&_(0,di,1,0,"p-tag",19)(1,_i,1,0),e&2){let t=o(3).$implicit;g(0,t.enabled?0:1)}}function gi(e,i){if(e&1&&p(0),e&2){let t=o(2).$implicit,n=o().$implicit;f(" ",n[t.field]," ")}}function fi(e,i){if(e&1&&_(0,li,1,1)(1,ci,2,1)(2,pi,2,3)(3,ui,2,1)(4,gi,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="subscribedAt"?0:t==="endedAt"?1:t==="isFinancing"?2:t==="enabled"?3:4)}}function Ci(e,i){if(e&1&&(s(0,"td"),_(1,ri,2,1)(2,fi,5,1),m()),e&2){let t=i.$implicit,n=o().$implicit;r(),g(1,n[t.field]!=null&&n[t.field].id?1:-1),r(),g(2,n[t.field]!=null&&n[t.field].id?-1:2)}}function bi(e,i){if(e&1){let t=A();s(0,"tr",17),F(1,Ci,3,2,"td",null,y),s(3,"td",15)(4,"p-button",18),v("click",function(){let l=b(t).$implicit,a=o();return h(a.selectItem(l))}),m()()()}if(e&2){let t=i.$implicit,n=i.columns,l=i.rowIndex,a=o();c("pSelectableRow",t)("pSelectableRowIndex",l)("ngClass",tt(4,Zt,!t.enabled)),r(),I(n),r(3),c("icon",a.PrimeIcons.ELLIPSIS_V)}}function hi(e,i){if(e&1&&(s(0,"tr")(1,"td"),p(2),m()()),e&2){let t=i.$implicit,n=o();r(),U("colspan",t.length),r(),f(" ",n.messageService.paginatorNoRecordsFound," ")}}function vi(e,i){}function xi(e,i){if(e&1&&u(0,"app-view",12),e&2){let t=o();c("id",t.selectedItem.id)}}var $t=(()=>{let i=class i{constructor(){this.authService=d(H),this.coreService=d(O),this.agreementsHttpService=d($e),this.agreementsService=d(ot),this.router=d(Ve),this.breadcrumbService=d(Y),this.PrimeIcons=P,this.IconButtonActionEnum=L,this.SeverityButtonActionEnum=J,this.LabelButtonActionEnum=T,this.BreadcrumbEnum=w,this.TableEnum=Q,this.messageService=d(j),this.messageDialogService=d($),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new te(""),this.items=[],this.isVisibleAgreementView=!1,this.breadcrumbService.setItems([{label:w.AGREEMENTS}]),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(se(500)).subscribe(n=>{this.findAgreements()})}ngOnInit(){this.findAgreements()}findAgreements(){this.authService.role.code===Ye.NATIONAL_SUPERVISOR&&this.agreementsHttpService.findNationalAgreementsByOrigin().subscribe(n=>{this.items=n}),this.authService.role.code===Ye.INTERNATIONAL_SUPERVISOR&&this.agreementsHttpService.findInternationalAgreementsByOrigin().subscribe(n=>{this.items=n})}buildColumns(){this.columns=[{field:"number",header:X.number},{field:"internalNumber",header:X.internalNumber},{field:"name",header:X.name},{field:"administrator",header:mt.header},{field:"agreementState",header:Ne.state},{field:"subscribedAt",header:X.subscribedAt},{field:"endedAt",header:X.endedAt},{field:"isFinancing",header:X.isFinancing},{field:"enabled",header:X.enabled}]}buildButtonActions(){this.buttonActions=[{id:x.COMPLETE,label:T.COMPLETE,icon:L.COMPLETE,command:()=>{this.selectedItem?.id&&this.redirectCompleteForm(this.selectedItem)}},{id:x.AGREEMENT,label:T.AGREEMENT,icon:L.AGREEMENT,command:()=>{this.selectedItem?.id&&this.redirectEditForm(this.selectedItem.id)}},{id:x.AGREEMENT_LOG,label:T.AGREEMENT_LOG,icon:L.AGREEMENT_LOG,command:()=>{this.selectedItem?.id&&this.redirectAgreementLogForm(this.selectedItem.id)}},{id:x.AGREEMENT_TRACKING_PERIOD,label:T.AGREEMENT_TRACKING_PERIOD,icon:L.AGREEMENT_TRACKING_PERIOD,command:()=>{this.selectedItem?.id&&this.redirectTrackingLogList(this.selectedItem.id)}},{id:x.AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,label:T.AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,icon:L.AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,command:()=>{this.selectedItem?.id&&this.redirectAgreementTerminationList(this.selectedItem.id)}}]}validateButtonActions(n){this.buildButtonActions(),n.enabled&&this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===x.COMPLETE),1),n.enabled||(this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===x.VIEW),1),this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===x.EDIT),1),this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===x.AGREEMENT_LOG),1))}redirectCreateForm(){this.agreementsService.clearAgreement(),this.router.navigate(["/core/agreements","register"])}redirectCompleteForm(n){this.router.navigate(["/core/agreements","register"])}redirectEditForm(n){this.router.navigate(["/core/agreements/update",n])}redirectViewAgreement(){this.isVisibleAgreementView=!0}redirectAgreementLogForm(n){this.router.navigate(["/core/agreements/log",n])}redirectTrackingLogList(n){this.router.navigate([`/core/${this.authService.role.code}/period-list`,n])}remove(n){}paginate(n){}selectItem(n){this.agreementsHttpService.findOne(n.id).subscribe(l=>{this.isButtonActions=!0,this.selectedItem=n,this.validateButtonActions(n),this.agreementsService.agreement=l})}redirectAgreementTerminationList(n){this.router.navigate([`/core/${this.authService.role.code}/agreement-termination-list`,n],{queryParams:{type:"closing"}})}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=k({type:i,selectors:[["app-agreement-list"]],decls:14,vars:14,consts:[["dt",""],[1,"p-toolbar-group-left"],[3,"click","icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Convenio",3,"visibleChange","visible","modal"],[3,"id"],[1,"flex"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex","ngClass"],[3,"click","icon"],["severity","info","value","Registrado"],["severity","danger","value","En Proceso"]],template:function(l,a){if(l&1){let E=A();s(0,"p-toolbar")(1,"div",1)(2,"p-button",2),v("click",function(){return b(E),h(a.redirectCreateForm())}),m()(),u(3,"div",3),m(),s(4,"p-table",4,0),_(6,ei,3,1,"ng-template",5)(7,ii,5,1,"ng-template",6)(8,bi,5,6,"ng-template",7)(9,hi,3,2,"ng-template",8)(10,vi,0,0,"ng-template",9),m(),s(11,"app-button-action",10),v("isHide",function(C){return b(E),h(a.isButtonActions=!C)}),m(),s(12,"p-dialog",11),R("visibleChange",function(C){return b(E),V(a.isVisibleAgreementView,C)||(a.isVisibleAgreementView=C),h(C)}),_(13,xi,1,1,"app-view",12),m()}l&2&&(r(2),c("icon",a.IconButtonActionEnum.CREATE)("label",a.LabelButtonActionEnum.CREATE_AGREEMENT)("loading",a.coreService.isLoading)("severity",a.SeverityButtonActionEnum.CREATE),r(2),c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading),r(7),c("buttonActions",a.buttonActions)("enabled",a.isButtonActions),r(),M("visible",a.isVisibleAgreementView),c("modal",!0),r(),g(13,a.selectedItem&&a.isVisibleAgreementView?13:-1))},dependencies:[it,he,q,ae,Z,ie,ne,re,oe,Dt,be,Vt,dt,He],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let e=i;return e})();function Ei(e,i){if(e&1&&(s(0,"div",10)(1,"h2"),p(2),D(3,"customFormatDate"),D(4,"customFormatDate"),m()()),e&2){let t=o();r(2),et(" ",t.period.name,": ",ve(3,3,t.period.startedAt)," - ",ve(4,5,t.period.endedAt)," ")}}function Ai(e,i){if(e&1&&(s(0,"th",11),p(1),u(2,"p-sortIcon",12),m()),e&2){let t=i.$implicit;c("pSortableColumn",t.field),r(),f(" ",t.header," "),r(),c("field",t.field)}}function Ti(e,i){if(e&1&&(s(0,"tr"),F(1,Ai,3,3,"th",11,y),m()),e&2){let t=i.$implicit;r(),I(t)}}function Li(e,i){if(e&1&&(u(0,"br"),s(1,"b"),p(2,"Comentario: "),m(),p(3)),e&2){let t=o(4).$implicit;r(3),f("",t.observation," ")}}function Si(e,i){if(e&1&&(p(0),_(1,Li,4,1)),e&2){let t=o(3).$implicit;le(" ",t.user.name," ",t.user.lastname," "),r(),g(1,t.observation?1:-1)}}function yi(e,i){if(e&1&&p(0),e&2){let t=o(3).$implicit;f(" ",t.state.name," ")}}function Fi(e,i){if(e&1&&_(0,Si,2,3)(1,yi,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="user"?0:t==="state"?1:-1)}}function Ii(e,i){if(e&1&&(p(0),D(1,"date")),e&2){let t=o(4).$implicit;f(" ",N(1,1,t.registeredAt,"dd/MM/yy - HH:mm")," ")}}function Di(e,i){if(e&1&&_(0,Ii,2,4),e&2){let t=o(3).$implicit;g(0,t.registeredAt?0:-1)}}function wi(e,i){if(e&1&&p(0),e&2){let t=o(2).$implicit,n=o().$implicit;f(" ",n[t.field]," ")}}function Bi(e,i){if(e&1&&_(0,Di,1,1)(1,wi,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="registeredAt"?0:1)}}function Pi(e,i){if(e&1&&(s(0,"td"),_(1,Fi,2,1)(2,Bi,2,1),m()),e&2){let t=i.$implicit,n=o().$implicit;r(),g(1,n[t.field]!=null&&n[t.field].id?1:-1),r(),g(2,n[t.field]!=null&&n[t.field].id?-1:2)}}function ki(e,i){if(e&1&&(s(0,"tr",13),F(1,Pi,3,2,"td",null,y),m()),e&2){let t=i.$implicit,n=i.columns,l=i.rowIndex;c("pSelectableRow",t)("pSelectableRowIndex",l),r(),I(n)}}function Mi(e,i){if(e&1&&(s(0,"tr")(1,"td"),p(2),m()()),e&2){let t=i.$implicit,n=o();r(),U("colspan",t.length),r(),f(" ",n.messageService.paginatorNoRecordsFound," ")}}function Vi(e,i){}var Be=(()=>{let i=class i{constructor(){this.authService=d(H),this.coreService=d(O),this.router=d(Ve),this.trackingLogsHttpService=d(_e),this.PrimeIcons=P,this.IconButtonActionEnum=L,this.SeverityButtonActionEnum=J,this.LabelButtonActionEnum=T,this.BreadcrumbEnum=w,this.TableEnum=Q,this.messageService=d(j),this.messageDialogService=d($),this.buttonActions=[],this.columns=[],this.search=new te(""),this.items=[],this.isVisibleAgreementView=!1,this.buildColumns()}ngOnInit(){this.items=this.period.trackingLogs}buildColumns(){this.columns=[{field:"state",header:Oe.state},{field:"registeredAt",header:Oe.registeredAt},{field:"user",header:Oe.user}]}redirectAgreementLogForm(n){this.router.navigate(["/core/agreements/log",n])}downloadLog(){this.trackingLogsHttpService.downloadLog(this.period.id,this.trackingLogType)}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=k({type:i,selectors:[["app-tracking-log-list"]],inputs:{period:"period",trackingLogType:"trackingLogType"},decls:11,vars:9,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"ml-2",3,"click","icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[1,"flex"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"]],template:function(l,a){if(l&1){let E=A();s(0,"p-toolbar")(1,"div",1)(2,"p-button",2),v("click",function(){return b(E),h(a.downloadLog())}),m()(),u(3,"div",3),m(),s(4,"p-table",4,0),_(6,Ei,5,7,"ng-template",5)(7,Ti,3,0,"ng-template",6)(8,ki,3,2,"ng-template",7)(9,Mi,3,2,"ng-template",8)(10,Vi,0,0,"ng-template",9),m()}l&2&&(r(2),c("icon",a.IconButtonActionEnum.DOWNLOAD)("label",a.LabelButtonActionEnum.DOWNLOAD)("loading",a.coreService.isLoading)("severity",a.SeverityButtonActionEnum.SYNC),r(2),c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading))},dependencies:[q,ae,Z,ie,ne,re,oe,me,He],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let e=i;return e})();var Ri=()=>({width:"50rem"});function Ni(e,i){if(e&1&&(s(0,"div",15)(1,"h2"),p(2),m()()),e&2){let t=o();r(2),z(t.BreadcrumbEnum.ADDITIONAL_DOCUMENTS)}}function Oi(e,i){if(e&1&&(s(0,"th",16),p(1),u(2,"p-sortIcon",17),m()),e&2){let t=i.$implicit;c("pSortableColumn",t.field),r(),f(" ",t.header," "),r(),c("field",t.field)}}function $i(e,i){if(e&1&&(s(0,"tr"),F(1,Oi,3,3,"th",16,y),m()),e&2){let t=i.$implicit;r(),I(t)}}function Hi(e,i){if(e&1&&p(0),e&2){let t=o(4).$implicit;le(" ",t.user.name," ",t.user.lastname," ")}}function Gi(e,i){if(e&1&&_(0,Hi,1,2),e&2){let t=o(3).$implicit;g(0,t!=null&&t.user?0:-1)}}function Ui(e,i){if(e&1&&_(0,Gi,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="user"?0:-1)}}function Wi(e,i){if(e&1){let t=A();s(0,"span"),p(1),m(),s(2,"p-button",19),v("click",function(){let l=b(t).$implicit,a=o(5);return h(a.downloadFile(l))}),m(),u(3,"p-divider")}if(e&2){let t=i.$implicit,n=o(5);r(),f("",t.type.name,": "),r(),c("icon",n.IconButtonActionEnum.DOWNLOAD)("label",t.name)("text",!0)("severity",n.SeverityButtonActionEnum.DOWNLOAD)}}function zi(e,i){if(e&1&&F(0,Wi,4,5,null,null,y),e&2){let t=o(3).$implicit;I(t==null?null:t.additionalDocuments)}}function Ki(e,i){if(e&1&&p(0),e&2){let t=o(3).$implicit;le(" ",t.name," ",t.sequence," ")}}function qi(e,i){if(e&1&&(p(0),D(1,"date")),e&2){let t=o(3).$implicit;f(" ",N(1,1,t.uploadedAt,"dd/MM/y - HH:mm")," ")}}function ji(e,i){if(e&1&&p(0),e&2){let t=o(2).$implicit,n=o().$implicit;f(" ",n[t.field]," ")}}function Yi(e,i){if(e&1&&_(0,zi,2,0)(1,Ki,1,2)(2,qi,2,4)(3,ji,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="additionalDocuments"?0:t==="name"?1:t==="uploadedAt"?2:3)}}function Ji(e,i){if(e&1&&(s(0,"td"),_(1,Ui,1,1)(2,Yi,4,1),m()),e&2){let t=i.$implicit,n=o().$implicit;r(),g(1,n[t.field]!=null&&n[t.field].id?1:-1),r(),g(2,n[t.field]!=null&&n[t.field].id?-1:2)}}function Qi(e,i){if(e&1&&(s(0,"tr",18),F(1,Ji,3,2,"td",null,y),m()),e&2){let t=i.$implicit,n=i.columns,l=i.rowIndex;c("pSelectableRow",t)("pSelectableRowIndex",l),r(),I(n)}}function Xi(e,i){if(e&1&&(s(0,"tr")(1,"td"),p(2),m()()),e&2){let t=i.$implicit,n=o();r(),U("colspan",t.length),r(),f(" ",n.messageService.paginatorNoRecordsFound," ")}}function Zi(e,i){}function en(e,i){if(e&1&&(u(0,"i"),s(1,"div",32),p(2),m()),e&2){let t=o(3);G(t.PrimeIcons.FILE_PDF),r(2),z(t.reportFileField.value==null?null:t.reportFileField.value.name)}}function tn(e,i){e&1&&(s(0,"div",25)(1,"p-messages",30),_(2,en,3,3,"ng-template",31),m()())}function nn(e,i){if(e&1&&(u(0,"i"),s(1,"div",32),p(2),m()),e&2){let t=o(3);G(t.PrimeIcons.FILE_PDF),r(2),z(t.evidenceFileField.value==null?null:t.evidenceFileField.value.name)}}function on(e,i){e&1&&(s(0,"div",25)(1,"p-messages",30),_(2,nn,3,3,"ng-template",31),m()())}function rn(e,i){if(e&1){let t=A();s(0,"form",20)(1,"div",21),u(2,"label",22),s(3,"p-fileUpload",23,1),v("uploadHandler",function(l){b(t);let a=qe(4),E=o();return h(E.uploadReportFile(l,a))}),m(),u(5,"small",24),m(),_(6,tn,3,0,"div",25),s(7,"div",21),u(8,"label",26),s(9,"p-fileUpload",27,1),v("uploadHandler",function(l){b(t);let a=qe(4),E=o();return h(E.uploadEvidenceFile(l,a))}),m(),u(11,"small",24),m(),_(12,on,3,0,"div",25),s(13,"div",25),u(14,"label",28)(15,"textarea",29)(16,"small",24),m()()}if(e&2){let t=o();c("formGroup",t.form),r(2),c("label",t.AdditionalDocumentEnum.reportFile)("required",t.reportFileField),r(),c("chooseIcon",t.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",t.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",t.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),r(2),c("errors",t.reportFileField.errors)("touched",t.reportFileField.touched)("dirty",t.reportFileField.dirty),r(),g(6,t.reportFileField.value?6:-1),r(2),c("label",t.AdditionalDocumentEnum.evidenceFile)("required",t.evidenceFileField),r(),c("chooseIcon",t.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",t.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",t.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),r(2),c("errors",t.evidenceFileField.errors)("touched",t.evidenceFileField.touched)("dirty",t.evidenceFileField.dirty),r(),g(12,t.evidenceFileField.value?12:-1),r(2),c("label",t.AdditionalDocumentEnum.detail)("required",t.detailField),r(2),c("errors",t.detailField.errors)("touched",t.detailField.touched)("dirty",t.detailField.dirty)}}function an(e,i){if(e&1){let t=A();s(0,"p-button",33),v("click",function(){b(t);let l=o();return h(l.isVisibleFilesModal=!1)}),m(),s(1,"p-button",34),v("click",function(){b(t);let l=o();return h(l.onUpload())}),m()}if(e&2){let t=o();c("label",t.LabelButtonActionEnum.CANCEL)("icon",t.IconButtonActionEnum.CANCEL)("text",!0)("severity",t.SeverityButtonActionEnum.CANCEL),r(),c("icon",t.IconButtonActionEnum.REPORT)("label",t.LabelButtonActionEnum.REPORT)("severity",t.SeverityButtonActionEnum.REPORT)}}var zt=(()=>{let i=class i{constructor(){this.authService=d(H),this.coreService=d(O),this.formBuilder=d(fe),this.cataloguesHttpService=d(ce),this.trackingLogsHttpService=d(_e),this.filesHttpService=d(Te),this.confirmationService=d(Re),this.breadcrumbService=d(Y),this.PrimeIcons=P,this.IconButtonActionEnum=L,this.SeverityButtonActionEnum=J,this.LabelButtonActionEnum=T,this.BreadcrumbEnum=w,this.TableEnum=Q,this.messageService=d(j),this.messageDialogService=d($),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new te(""),this.items=[],this.formErrors=[],this.types=[],this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Ae,this.CatalogueTrackingLogsStateEnum=de,this.AdditionalDocumentEnum=xe,this.FileEnum=st,this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(se(500)).subscribe(n=>{this.findAdditionalDocumentsByAgreement()})}ngOnInit(){this.findAdditionalDocumentsByAgreement(),this.loadTypes()}buildForm(){this.form=this.formBuilder.group({reportFile:[null],evidenceFile:[null],detail:[null,ee.required]})}findAdditionalDocumentsByAgreement(){this.trackingLogsHttpService.findExecutionAdditionalDocumentsByAgreement(this.agreementId).subscribe(n=>{this.items=n})}loadTypes(){this.types=this.cataloguesHttpService.findByType(pe.PERIODS_TRACKING_LOG)}buildColumns(){this.columns=[{field:"name",header:xe.name},{field:"detail",header:xe.detail},{field:"additionalDocuments",header:xe.additionalDocuments},{field:"uploadedAt",header:xe.uploadedAt},{field:"user",header:xe.user}]}buildButtonActions(){this.buttonActions=[{id:x.TRACKING_LOG,label:T.TRACKING_LOG,icon:L.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}]}validateButtonActions(n){this.buildButtonActions()}remove(n){this.confirmationService.confirm({key:"confirmDialog",message:"No se podr\xE1 recuperar la informaci\xF3n",header:"\xBFEst\xE1 seguro de eliminar?",icon:P.TRASH,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.trackingLogsHttpService.deleteAdditionalDocument(n).subscribe(l=>{this.findAdditionalDocumentsByAgreement()})}})}selectItem(n){this.isButtonActions=!0,this.selectedItem=n,this.validateButtonActions(n)}showFilesModal(){this.isVisibleFilesModal=!0}downloadFile(n){this.filesHttpService.downloadFile(n)}onUpload(){if(this.validateFilesForm()){let n=new FormData;n.append("report",this.reportFileField.value),n.append("evidence",this.evidenceFileField.value),n.append("detail",this.detailField.value),this.trackingLogsHttpService.createExecutionAdditionalDocument(this.agreementId,n).subscribe(l=>{this.findAdditionalDocumentsByAgreement(),this.isVisibleFilesModal=!1})}else this.messageDialogService.fieldErrors(this.formErrors)}validateFilesForm(){return this.formErrors=[],this.reportFileField.invalid&&this.formErrors.push(S.reportFile),this.evidenceFileField.invalid&&this.formErrors.push(S.evidenceFile),this.formErrors.length===0}uploadReportFile(n,l){this.reportFileField.patchValue(n.files[0]),l.clear()}uploadEvidenceFile(n,l){this.evidenceFileField.patchValue(n.files[0]),l.clear()}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}get detailField(){return this.form.controls.detail}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=k({type:i,selectors:[["app-additional-document-list"]],inputs:{agreementId:"agreementId"},decls:15,vars:12,consts:[["dt",""],["uploadFiles",""],[1,"p-toolbar-group-left"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Subir archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["key","confirmDialog"],[1,"flex"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[1,"ml-2",3,"click","icon","label","text","severity"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","report",3,"label","required"],["id","report","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appErrorMessage","",3,"errors","touched","dirty"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","evidence",3,"label","required"],["id","evidence","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appLabel","","for","detail",3,"label","required"],["pInputTextarea","","id","detail","formControlName","detail"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(l,a){if(l&1){let E=A();s(0,"p-toolbar"),u(1,"div",2)(2,"div",3),m(),s(3,"p-table",4,0),_(5,Ni,3,1,"ng-template",5)(6,$i,3,0,"ng-template",6)(7,Qi,3,2,"ng-template",7)(8,Xi,3,2,"ng-template",8)(9,Zi,0,0,"ng-template",9),m(),s(10,"app-button-action",10),v("isHide",function(C){return b(E),h(a.isButtonActions=!C)}),m(),s(11,"p-dialog",11),R("visibleChange",function(C){return b(E),V(a.isVisibleFilesModal,C)||(a.isVisibleFilesModal=C),h(C)}),_(12,rn,17,28,"ng-template",12)(13,an,2,7,"ng-template",13),m(),u(14,"p-confirmDialog",14)}l&2&&(r(3),c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading),r(7),c("buttonActions",a.buttonActions)("enabled",a.isButtonActions),r(),W(K(11,Ri)),M("visible",a.isVisibleFilesModal),c("modal",!0))},dependencies:[Ie,Ce,he,q,ae,Z,ge,Le,Se,ue,ie,ne,re,oe,ye,Fe,be,yt,St,De,we,Pt,me],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let e=i;return e})();var sn=()=>({width:"100%"}),Kt=()=>({width:"35rem"});function mn(e,i){if(e&1&&(s(0,"div",20)(1,"h1"),p(2),m()()),e&2){let t=o();r(2),z(t.BreadcrumbEnum.PERIODS_SUPERVISOR)}}function cn(e,i){if(e&1&&(s(0,"th",21),p(1),u(2,"p-sortIcon",23),m()),e&2){let t=i.$implicit;c("pSortableColumn",t.field),r(),f(" ",t.header," "),r(),c("field",t.field)}}function pn(e,i){if(e&1&&(s(0,"tr"),F(1,cn,3,3,"th",21,y),s(3,"th",22),p(4),m()()),e&2){let t=i.$implicit,n=o();r(),I(t),r(3),f(" ",n.TableEnum.ACTIONS," ")}}function dn(e,i){if(e&1&&p(0),e&2){let t=o(2).$implicit,n=o().$implicit;f(" ",n[t.field].unit.name," ")}}function _n(e,i){if(e&1&&_(0,dn,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="administrator"?0:-1)}}function un(e,i){if(e&1){let t=A();s(0,"span"),p(1),m(),s(2,"p-button",26),v("click",function(){let l=b(t).$implicit,a=o(5);return h(a.downloadFile(l))}),m(),u(3,"p-divider")}if(e&2){let t=i.$implicit,n=o(5);r(),f("",t.type.name,": "),r(),c("icon",n.IconButtonActionEnum.DOWNLOAD)("label",t.name)("text",!0)("severity",n.SeverityButtonActionEnum.DOWNLOAD)}}function gn(e,i){if(e&1&&F(0,un,4,5,null,null,y),e&2){let t=o(3).$implicit;I(t==null?null:t.trackingLogDocuments)}}function fn(e,i){if(e&1&&u(0,"i",28),e&2){let t=o(6);G(t.PrimeIcons.CIRCLE_FILL)}}function Cn(e,i){if(e&1&&u(0,"i",29),e&2){let t=o(6);G(t.PrimeIcons.CIRCLE_FILL)}}function bn(e,i){if(e&1&&_(0,fn,1,2,"i",27)(1,Cn,1,2),e&2){let t=o(4).$implicit;g(0,t.trackingLog.state.code==="REPORTED"||t.trackingLog.state.code==="ACCEPTED"?0:1)}}function hn(e,i){if(e&1&&u(0,"i",29),e&2){let t=o(5);G(t.PrimeIcons.CIRCLE_FILL)}}function vn(e,i){if(e&1&&_(0,bn,2,1)(1,hn,1,2),e&2){let t=o(3).$implicit;g(0,t.trackingLog?0:1)}}function xn(e,i){if(e&1&&(p(0),u(1,"br"),p(2),D(3,"date"),u(4,"br"),p(5),D(6,"date")),e&2){let t=o(3).$implicit;f(" ",t.name," "),r(2),f(" ",N(3,3,t.startedAt,"d MMMM y")," - "),r(3),f(" ",N(6,6,t.endedAt,"d MMMM y")," ")}}function En(e,i){if(e&1&&(p(0),D(1,"date")),e&2){let t=o(3).$implicit;f(" ",N(1,1,t.uploadedAt,"dd/MM/y - HH:mm")," ")}}function An(e,i){if(e&1&&p(0),e&2){let t=o(3).$implicit;f(" ",t.trackingLog==null||t.trackingLog.state==null?null:t.trackingLog.state.name," ")}}function Tn(e,i){if(e&1&&p(0),e&2){let t=o(4).$implicit;le(" ",t.trackingLog.user.name," ",t.trackingLog.user.lastname," ")}}function Ln(e,i){if(e&1&&_(0,Tn,1,2),e&2){let t=o(3).$implicit;g(0,t.trackingLog!=null&&t.trackingLog.user?0:-1)}}function Sn(e,i){if(e&1&&p(0),e&2){let t=o(2).$implicit,n=o().$implicit;f(" ",n[t.field]," ")}}function yn(e,i){if(e&1&&_(0,gn,2,0)(1,vn,2,1)(2,xn,7,9)(3,En,2,4)(4,An,1,1)(5,Ln,1,1)(6,Sn,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="files"?0:t==="trafficLight"?1:t==="name"?2:t==="uploadedAt"?3:t==="state"?4:t==="user"?5:6)}}function Fn(e,i){if(e&1&&(s(0,"td"),_(1,_n,1,1)(2,yn,7,1),m()),e&2){let t=i.$implicit,n=o().$implicit;r(),g(1,n[t.field]!=null&&n[t.field].id?1:-1),r(),g(2,n[t.field]!=null&&n[t.field].id?-1:2)}}function In(e,i){if(e&1){let t=A();s(0,"tr",24),F(1,Fn,3,2,"td",null,y),s(3,"td",22)(4,"p-button",25),v("click",function(){let l=b(t).$implicit,a=o();return h(a.selectItem(l))}),m()()()}if(e&2){let t=i.$implicit,n=i.columns,l=i.rowIndex,a=o();c("pSelectableRow",t)("pSelectableRowIndex",l),r(),I(n),r(3),c("icon",a.PrimeIcons.ELLIPSIS_V)}}function Dn(e,i){if(e&1&&(s(0,"tr")(1,"td"),p(2),m()()),e&2){let t=i.$implicit,n=o();r(),U("colspan",t.length),r(),f(" ",n.messageService.paginatorNoRecordsFound," ")}}function wn(e,i){}function Bn(e,i){if(e&1&&u(0,"app-tracking-log-list",12),e&2){let t=o();c("period",t.selectedItem)}}function Pn(e,i){e&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de rechazar, no podr\xE1 modificar su elecci\xF3n?"),m())}function kn(e,i){if(e&1){let t=A();s(0,"p-button",30),v("click",function(){b(t);let l=o();return h(l.isVisibleRefusedModal=!1)}),m(),s(1,"p-button",31),v("click",function(){b(t);let l=o();return h(l.refuseTrackingLogDocuments())}),m()}if(e&2){let t=o();c("label",t.LabelButtonActionEnum.CANCEL)("icon",t.IconButtonActionEnum.CANCEL)("text",!0)("severity",t.SeverityButtonActionEnum.CANCEL),r(),c("label",t.LabelButtonActionEnum.REFUSED)("icon",t.IconButtonActionEnum.REFUSED)("severity",t.SeverityButtonActionEnum.REFUSED)}}function Mn(e,i){e&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de aceptar, no podr\xE1 modificar su elecci\xF3n?"),m())}function Vn(e,i){if(e&1){let t=A();s(0,"p-button",30),v("click",function(){b(t);let l=o();return h(l.isVisibleRefusedModal=!1)}),m(),s(1,"p-button",31),v("click",function(){b(t);let l=o();return h(l.acceptTrackingLogDocuments())}),m()}if(e&2){let t=o();c("label",t.LabelButtonActionEnum.CANCEL)("icon",t.IconButtonActionEnum.CANCEL)("text",!0)("severity",t.SeverityButtonActionEnum.CANCEL),r(),c("label",t.LabelButtonActionEnum.ACCEPTED)("icon",t.IconButtonActionEnum.ACCEPTED)("severity",t.SeverityButtonActionEnum.REFUSED)}}var qt=(()=>{let i=class i{constructor(){this.activatedRoute=d(Me),this.authService=d(H),this.coreService=d(O),this.formBuilder=d(fe),this.cataloguesHttpService=d(ce),this.trackingLogsHttpService=d(_e),this.filesHttpService=d(Te),this.breadcrumbService=d(Y),this.PrimeIcons=P,this.IconButtonActionEnum=L,this.SeverityButtonActionEnum=J,this.LabelButtonActionEnum=T,this.BreadcrumbEnum=w,this.TableEnum=Q,this.messageService=d(j),this.messageDialogService=d($),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new te(""),this.items=[],this.formErrors=[],this.types=[],this.trackingLogType="execution",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.isVisibleRefusedModal=!1,this.isVisibleAcceptedModal=!1,this.AddendumEnum=Ae,this.breadcrumbService.setItems([{label:w.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:w.PERIODS_SUPERVISOR}]),this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(se(500)).subscribe(n=>{this.findPeriodsByAgreement()})}ngOnInit(){this.findPeriodsByAgreement(),this.loadTypes(),this.activatedRoute.queryParams.subscribe(n=>{this.trackingLogType=n.type})}buildForm(){this.form=this.formBuilder.group({reportFile:[null,ee.required],evidenceFile:[null],observation:[null,ee.required]})}findPeriodsByAgreement(){this.trackingLogsHttpService.findPeriodsByAgreement(this.agreementId,this.trackingLogType).subscribe(n=>{this.items=n})}loadTypes(){this.types=this.cataloguesHttpService.findByType(pe.PERIODS_TRACKING_LOG)}buildColumns(){this.columns=[{field:"name",header:S.reportPeriod},{field:"documentName",header:S.name},{field:"files",header:S.documentName},{field:"trafficLight",header:S.trafficLight},{field:"uploadedAt",header:S.uploadedAt},{field:"user",header:S.user},{field:"state",header:S.state}]}buildButtonActions(){this.buttonActions=[{id:x.TRACKING_LOG,label:T.TRACKING_LOG,icon:L.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}},{id:x.ACCEPTED,label:T.ACCEPTED,icon:L.ACCEPTED,command:()=>{this.isVisibleAcceptedModal=!0}},{id:x.REFUSED,label:T.REFUSED,icon:L.REFUSED,command:()=>{this.isVisibleRefusedModal=!0}}]}validateButtonActions(n){this.buildButtonActions(),(!n.trackingLog||n.trackingLog.state?.code===de.ACCEPTED||n.trackingLog.state?.code===de.REFUSED)&&(this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===x.ACCEPTED),1),this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===x.REFUSED),1))}selectItem(n){this.isButtonActions=!0,this.selectedItem=n,this.validateButtonActions(n)}downloadFile(n){this.filesHttpService.downloadFile(n)}refuseTrackingLogDocuments(){this.trackingLogsHttpService.changeState(this.selectedItem.trackingLog.id,!1,this.observationFileField.value).subscribe(()=>{this.findPeriodsByAgreement(),this.isVisibleRefusedModal=!1,this.observation=""})}acceptTrackingLogDocuments(){this.trackingLogsHttpService.changeState(this.selectedItem.trackingLog.id,!0).subscribe(()=>{this.findPeriodsByAgreement(),this.isVisibleAcceptedModal=!1})}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}get observationFileField(){return this.form.controls.observation}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=k({type:i,selectors:[["app-period-list"]],inputs:{agreementId:"agreementId"},decls:25,vars:29,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],[3,"agreementId"],["header","Bit\xE1cora",3,"visibleChange","visible","modal"],[3,"period"],["header","Header",3,"visibleChange","visible","modal"],[1,"grid","p-fluid",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","observation","label","Observaci\xF3n",3,"required"],["pInputTextarea","","id","observation","formControlName","observation"],["appErrorMessage","",3,"errors","touched","dirty"],["pTemplate","footer"],[1,"flex"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[3,"click","icon"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[3,"click","label","icon","text","severity"],[3,"click","label","icon","severity"]],template:function(l,a){if(l&1){let E=A();s(0,"p-toolbar"),u(1,"div",1)(2,"div",2),m(),s(3,"p-table",3,0),_(5,mn,3,1,"ng-template",4)(6,pn,5,1,"ng-template",5)(7,In,5,3,"ng-template",6)(8,Dn,3,2,"ng-template",7)(9,wn,0,0,"ng-template",8),m(),s(10,"app-button-action",9),v("isHide",function(C){return b(E),h(a.isButtonActions=!C)}),m(),u(11,"app-additional-document-list",10),s(12,"p-dialog",11),R("visibleChange",function(C){return b(E),V(a.isVisibleTrackingLogModal,C)||(a.isVisibleTrackingLogModal=C),h(C)}),_(13,Bn,1,1,"app-tracking-log-list",12),m(),s(14,"p-dialog",13),R("visibleChange",function(C){return b(E),V(a.isVisibleRefusedModal,C)||(a.isVisibleRefusedModal=C),h(C)}),_(15,Pn,2,0,"ng-template",5),s(16,"form",14)(17,"div",15),u(18,"label",16)(19,"textarea",17)(20,"small",18),m()(),_(21,kn,2,7,"ng-template",19),m(),s(22,"p-dialog",13),R("visibleChange",function(C){return b(E),V(a.isVisibleAcceptedModal,C)||(a.isVisibleAcceptedModal=C),h(C)}),_(23,Mn,2,0,"ng-template",5)(24,Vn,2,7,"ng-template",19),m()}l&2&&(r(3),c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading),r(7),c("buttonActions",a.buttonActions)("enabled",a.isButtonActions),r(),c("agreementId",a.agreementId),r(),W(K(26,sn)),M("visible",a.isVisibleTrackingLogModal),c("modal",!0),r(),g(13,a.isVisibleTrackingLogModal?13:-1),r(),W(K(27,Kt)),M("visible",a.isVisibleRefusedModal),c("modal",!0),r(2),c("formGroup",a.form),r(2),c("required",a.observationFileField),r(2),c("errors",a.observationFileField.errors)("touched",a.observationFileField.touched)("dirty",a.observationFileField.dirty),r(2),W(K(28,Kt)),M("visible",a.isVisibleAcceptedModal),c("modal",!0))},dependencies:[Ie,Ce,he,q,ae,Z,ge,Le,Se,ue,ie,ne,re,oe,ye,Fe,be,De,we,Be,zt,me],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let e=i;return e})();var Rn=()=>({width:"100%"}),jt=()=>({width:"35rem"});function Nn(e,i){if(e&1&&(s(0,"div",19)(1,"h1"),p(2),m()()),e&2){let t=o();r(2),z(t.BreadcrumbEnum.PERIODS_CLOSING_SUPERVISOR)}}function On(e,i){if(e&1&&(s(0,"th",20),p(1),u(2,"p-sortIcon",22),m()),e&2){let t=i.$implicit;c("pSortableColumn",t.field),r(),f(" ",t.header," "),r(),c("field",t.field)}}function $n(e,i){if(e&1&&(s(0,"tr"),F(1,On,3,3,"th",20,y),s(3,"th",21),p(4),m()()),e&2){let t=i.$implicit,n=o();r(),I(t),r(3),f(" ",n.TableEnum.ACTIONS," ")}}function Hn(e,i){if(e&1&&p(0),e&2){let t=o(2).$implicit,n=o().$implicit;f(" ",n[t.field].unit.name," ")}}function Gn(e,i){if(e&1&&_(0,Hn,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="administrator"?0:-1)}}function Un(e,i){if(e&1){let t=A();s(0,"span"),p(1),m(),s(2,"p-button",25),v("click",function(){let l=b(t).$implicit,a=o(5);return h(a.downloadFile(l))}),m(),u(3,"p-divider")}if(e&2){let t=i.$implicit,n=o(5);r(),f("",t.type.name,": "),r(),c("icon",n.IconButtonActionEnum.DOWNLOAD)("label",t.name)("text",!0)("severity",n.SeverityButtonActionEnum.DOWNLOAD)}}function Wn(e,i){if(e&1&&F(0,Un,4,5,null,null,y),e&2){let t=o(3).$implicit;I(t==null?null:t.trackingLogDocuments)}}function zn(e,i){if(e&1&&u(0,"i",27),e&2){let t=o(6);G(t.PrimeIcons.CIRCLE_FILL)}}function Kn(e,i){if(e&1&&u(0,"i",28),e&2){let t=o(6);G(t.PrimeIcons.CIRCLE_FILL)}}function qn(e,i){if(e&1&&_(0,zn,1,2,"i",26)(1,Kn,1,2),e&2){let t=o(4).$implicit;g(0,t.trackingLog.state.code==="REPORTED"||t.trackingLog.state.code==="ACCEPTED"?0:1)}}function jn(e,i){if(e&1&&u(0,"i",28),e&2){let t=o(5);G(t.PrimeIcons.CIRCLE_FILL)}}function Yn(e,i){if(e&1&&_(0,qn,2,1)(1,jn,1,2),e&2){let t=o(3).$implicit;g(0,t.trackingLog?0:1)}}function Jn(e,i){if(e&1&&(p(0),u(1,"br"),p(2),D(3,"date"),u(4,"br"),p(5),D(6,"date")),e&2){let t=o(3).$implicit;f(" ",t.name," "),r(2),f(" ",N(3,3,t.startedAt,"d MMMM y")," - "),r(3),f(" ",N(6,6,t.endedAt,"d MMMM y")," ")}}function Qn(e,i){if(e&1&&(p(0),D(1,"date")),e&2){let t=o(3).$implicit;f(" ",N(1,1,t.uploadedAt,"dd/MM/y - HH:mm")," ")}}function Xn(e,i){if(e&1&&p(0),e&2){let t=o(3).$implicit;f(" ",t.trackingLog==null||t.trackingLog.state==null?null:t.trackingLog.state.name," ")}}function Zn(e,i){if(e&1&&p(0),e&2){let t=o(4).$implicit;le(" ",t.trackingLog.user.name," ",t.trackingLog.user.lastname," ")}}function eo(e,i){if(e&1&&_(0,Zn,1,2),e&2){let t=o(3).$implicit;g(0,t.trackingLog!=null&&t.trackingLog.user?0:-1)}}function to(e,i){if(e&1&&p(0),e&2){let t=o(2).$implicit,n=o().$implicit;f(" ",n[t.field]," ")}}function io(e,i){if(e&1&&_(0,Wn,2,0)(1,Yn,2,1)(2,Jn,7,9)(3,Qn,2,4)(4,Xn,1,1)(5,eo,1,1)(6,to,1,1),e&2){let t,n=o().$implicit;g(0,(t=n.field)==="files"?0:t==="trafficLight"?1:t==="name"?2:t==="uploadedAt"?3:t==="state"?4:t==="user"?5:6)}}function no(e,i){if(e&1&&(s(0,"td"),_(1,Gn,1,1)(2,io,7,1),m()),e&2){let t=i.$implicit,n=o().$implicit;r(),g(1,n[t.field]!=null&&n[t.field].id?1:-1),r(),g(2,n[t.field]!=null&&n[t.field].id?-1:2)}}function oo(e,i){if(e&1){let t=A();s(0,"tr",23),F(1,no,3,2,"td",null,y),s(3,"td",21)(4,"p-button",24),v("click",function(){let l=b(t).$implicit,a=o();return h(a.selectItem(l))}),m()()()}if(e&2){let t=i.$implicit,n=i.columns,l=i.rowIndex,a=o();c("pSelectableRow",t)("pSelectableRowIndex",l),r(),I(n),r(3),c("icon",a.PrimeIcons.ELLIPSIS_V)}}function ro(e,i){if(e&1&&(s(0,"tr")(1,"td"),p(2),m()()),e&2){let t=i.$implicit,n=o();r(),U("colspan",t.length),r(),f(" ",n.messageService.paginatorNoRecordsFound," ")}}function ao(e,i){}function lo(e,i){if(e&1&&u(0,"app-tracking-log-list",11),e&2){let t=o();c("period",t.selectedItem)}}function so(e,i){e&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de rechazar, no podr\xE1 modificar su elecci\xF3n?"),m())}function mo(e,i){if(e&1){let t=A();s(0,"p-button",29),v("click",function(){b(t);let l=o();return h(l.isVisibleRefusedModal=!1)}),m(),s(1,"p-button",30),v("click",function(){b(t);let l=o();return h(l.refuseTrackingLogDocuments())}),m()}if(e&2){let t=o();c("label",t.LabelButtonActionEnum.CANCEL)("icon",t.IconButtonActionEnum.CANCEL)("text",!0)("severity",t.SeverityButtonActionEnum.CANCEL),r(),c("label",t.LabelButtonActionEnum.REFUSED)("icon",t.IconButtonActionEnum.REFUSED)("severity",t.SeverityButtonActionEnum.REFUSED)}}function co(e,i){e&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de aceptar, no podr\xE1 modificar su elecci\xF3n?"),m())}function po(e,i){if(e&1){let t=A();s(0,"p-button",29),v("click",function(){b(t);let l=o();return h(l.isVisibleRefusedModal=!1)}),m(),s(1,"p-button",30),v("click",function(){b(t);let l=o();return h(l.acceptTrackingLogDocuments())}),m()}if(e&2){let t=o();c("label",t.LabelButtonActionEnum.CANCEL)("icon",t.IconButtonActionEnum.CANCEL)("text",!0)("severity",t.SeverityButtonActionEnum.CANCEL),r(),c("label",t.LabelButtonActionEnum.ACCEPTED)("icon",t.IconButtonActionEnum.ACCEPTED)("severity",t.SeverityButtonActionEnum.REFUSED)}}var Yt=(()=>{let i=class i{constructor(){this.activatedRoute=d(Me),this.authService=d(H),this.coreService=d(O),this.formBuilder=d(fe),this.cataloguesHttpService=d(ce),this.trackingLogsHttpService=d(_e),this.filesHttpService=d(Te),this.breadcrumbService=d(Y),this.PrimeIcons=P,this.IconButtonActionEnum=L,this.SeverityButtonActionEnum=J,this.LabelButtonActionEnum=T,this.BreadcrumbEnum=w,this.TableEnum=Q,this.messageService=d(j),this.messageDialogService=d($),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new te(""),this.items=[],this.formErrors=[],this.types=[],this.trackingLogType="closing",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.isVisibleRefusedModal=!1,this.isVisibleAcceptedModal=!1,this.AddendumEnum=Ae,this.breadcrumbService.setItems([{label:w.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:w.PERIODS_CLOSING_SUPERVISOR}]),this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(se(500)).subscribe(n=>{this.findPeriodsByAgreement()})}ngOnInit(){this.findPeriodsByAgreement(),this.loadTypes(),this.activatedRoute.queryParams.subscribe(n=>{this.trackingLogType=n.type})}buildForm(){this.form=this.formBuilder.group({reportFile:[null,ee.required],evidenceFile:[null],observation:[null,ee.required]})}findPeriodsByAgreement(){this.trackingLogsHttpService.findPeriodsByAgreement(this.agreementId,this.trackingLogType).subscribe(n=>{this.items=n})}loadTypes(){this.types=this.cataloguesHttpService.findByType(pe.PERIODS_TRACKING_LOG)}buildColumns(){this.columns=[{field:"name",header:S.reportPeriod},{field:"documentName",header:S.name},{field:"files",header:S.documentName},{field:"trafficLight",header:S.trafficLight},{field:"uploadedAt",header:S.uploadedAt},{field:"user",header:S.user},{field:"state",header:S.state}]}buildButtonActions(){this.buttonActions=[{id:x.TRACKING_LOG,label:T.TRACKING_LOG,icon:L.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}},{id:x.ACCEPTED,label:T.ACCEPTED,icon:L.ACCEPTED,command:()=>{this.isVisibleAcceptedModal=!0}},{id:x.REFUSED,label:T.REFUSED,icon:L.REFUSED,command:()=>{this.isVisibleRefusedModal=!0}}]}validateButtonActions(n){this.buildButtonActions(),(!n.trackingLog||n.trackingLog.state?.code===de.ACCEPTED||n.trackingLog.state?.code===de.REFUSED)&&(this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===x.ACCEPTED),1),this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===x.REFUSED),1))}selectItem(n){this.isButtonActions=!0,this.selectedItem=n,this.validateButtonActions(n)}downloadFile(n){this.filesHttpService.downloadFile(n)}validateFilesForm(){return this.formErrors=[],this.reportFileField.invalid&&this.formErrors.push(S.reportFile),this.evidenceFileField.invalid&&this.formErrors.push(S.evidenceFile),this.formErrors.length===0}uploadReportFile(n,l){this.reportFileField.patchValue(n.files[0]),l.clear()}uploadEvidenceFile(n,l){this.evidenceFileField.patchValue(n.files[0]),l.clear()}refuseTrackingLogDocuments(){this.trackingLogsHttpService.changeState(this.selectedItem.trackingLog.id,!1,this.observationFileField.value).subscribe(()=>{this.findPeriodsByAgreement(),this.isVisibleRefusedModal=!1,this.observation=""})}acceptTrackingLogDocuments(){this.trackingLogsHttpService.changeState(this.selectedItem.trackingLog.id,!0).subscribe(()=>{this.findPeriodsByAgreement(),this.isVisibleAcceptedModal=!1})}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}get observationFileField(){return this.form.controls.observation}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=k({type:i,selectors:[["app-period-closing-list"]],inputs:{agreementId:"agreementId"},decls:24,vars:28,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Bit\xE1cora",3,"visibleChange","visible","modal"],["trackingLogType","closing",3,"period"],["header","Header",3,"visibleChange","visible","modal"],[1,"grid","p-fluid",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","observation","label","Observaci\xF3n",3,"required"],["pInputTextarea","","id","observation","formControlName","observation"],["appErrorMessage","",3,"errors","touched","dirty"],["pTemplate","footer"],[1,"flex"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[3,"click","icon"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[3,"click","label","icon","text","severity"],[3,"click","label","icon","severity"]],template:function(l,a){if(l&1){let E=A();s(0,"p-toolbar"),u(1,"div",1)(2,"div",2),m(),s(3,"p-table",3,0),_(5,Nn,3,1,"ng-template",4)(6,$n,5,1,"ng-template",5)(7,oo,5,3,"ng-template",6)(8,ro,3,2,"ng-template",7)(9,ao,0,0,"ng-template",8),m(),s(10,"app-button-action",9),v("isHide",function(C){return b(E),h(a.isButtonActions=!C)}),m(),s(11,"p-dialog",10),R("visibleChange",function(C){return b(E),V(a.isVisibleTrackingLogModal,C)||(a.isVisibleTrackingLogModal=C),h(C)}),_(12,lo,1,1,"app-tracking-log-list",11),m(),s(13,"p-dialog",12),R("visibleChange",function(C){return b(E),V(a.isVisibleRefusedModal,C)||(a.isVisibleRefusedModal=C),h(C)}),_(14,so,2,0,"ng-template",5),s(15,"form",13)(16,"div",14),u(17,"label",15)(18,"textarea",16)(19,"small",17),m()(),_(20,mo,2,7,"ng-template",18),m(),s(21,"p-dialog",12),R("visibleChange",function(C){return b(E),V(a.isVisibleAcceptedModal,C)||(a.isVisibleAcceptedModal=C),h(C)}),_(22,co,2,0,"ng-template",5)(23,po,2,7,"ng-template",18),m()}l&2&&(r(3),c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading),r(7),c("buttonActions",a.buttonActions)("enabled",a.isButtonActions),r(),W(K(25,Rn)),M("visible",a.isVisibleTrackingLogModal),c("modal",!0),r(),g(12,a.isVisibleTrackingLogModal?12:-1),r(),W(K(26,jt)),M("visible",a.isVisibleRefusedModal),c("modal",!0),r(2),c("formGroup",a.form),r(2),c("required",a.observationFileField),r(2),c("errors",a.observationFileField.errors)("touched",a.observationFileField.touched)("dirty",a.observationFileField.dirty),r(2),W(K(27,jt)),M("visible",a.isVisibleAcceptedModal),c("modal",!0))},dependencies:[Ie,Ce,he,q,ae,Z,ge,Le,Se,ue,ie,ne,re,oe,ye,Fe,be,De,we,Be,me],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let e=i;return e})();function uo(e,i){if(e&1&&(s(0,"div",2),u(1,"label",3)(2,"input",4),m()),e&2){let t=o(2);r(),c("label",t.ClosingNotificationEnum.closeType),r(),c("value",t.closingNotification.closeType==null?null:t.closingNotification.closeType.name)}}function go(e,i){if(e&1&&(s(0,"div",2),u(1,"label",5)(2,"input",6),m()),e&2){let t=o(2);r(),c("label",t.ClosingNotificationEnum.closedAt),r(),c("value",t.closingNotification.closedAt)}}function fo(e,i){if(e&1&&(s(0,"div",2),u(1,"label",7)(2,"input",8),m()),e&2){let t=o(2);r(),c("label",t.ClosingNotificationEnum.closeDetail),r(),c("value",t.closingNotification.closeDetail)}}function Co(e,i){if(e&1&&(s(0,"form",0),_(1,uo,3,2,"div",2)(2,go,3,2,"div",2)(3,fo,3,2,"div",2),m()),e&2){let t=o();r(),g(1,(t.closingNotification.closeType==null?null:t.closingNotification.closeType.code)!==t.CatalogueClosingNotificationsCloseTypeEnum.TERM?1:-1),r(),g(2,t.closingNotification.closedAt?2:-1),r(),g(3,(t.closingNotification.closeType==null?null:t.closingNotification.closeType.code)!==t.CatalogueClosingNotificationsCloseTypeEnum.TERM?3:-1)}}function bo(e,i){if(e&1&&u(0,"app-period-closing-list",1),e&2){let t=o();c("agreementId",t.agreementId)}}var Jt=(()=>{let i=class i{constructor(){this.authService=d(H),this.breadcrumbService=d(Y),this.agreementsHttpService=d($e),this.confirmationService=d(Re),this.closingNotificationsHttpService=d(pt),this.cataloguesHttpService=d(ce),this.coreService=d(O),this.messageDialogService=d($),this.formBuilder=d(fe),this.Validators=ee,this.closeTypes=[],this.AgreementFormEnum=X,this.AgreementStateEnum=Ne,this.SkeletonEnum=lt,this.ClosingNotificationEnum=ct,this.PrimeIcons=P,this.CatalogueAgreementsTypeEnum=rt,this.CatalogueClosingNotificationsCloseTypeEnum=at,this.breadcrumbService.setItems([{label:w.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:w.CLOSING_NOTIFICATION}])}ngOnInit(){this.loadCloseTypes(),this.findClosingNotificationByAgreement()}findClosingNotificationByAgreement(){this.closingNotificationsHttpService.findClosingNotificationByAgreement(this.agreementId).subscribe(n=>{this.closingNotification=n})}loadCloseTypes(){this.closeTypes=this.cataloguesHttpService.findByType(pe.CLOSING_NOTIFICATIONS_CLOSE_TYPE)}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=k({type:i,selectors:[["app-agreement-termination-list"]],inputs:{agreementId:"agreementId"},decls:3,vars:2,consts:[[1,"p-fluid","grid"],[3,"agreementId"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","closeType",3,"label"],["pInputText","","id","closeType","readonly","",3,"value"],["appLabel","","for","closedAt",3,"label"],["pInputText","","id","closedAt","readonly","",3,"value"],["appLabel","","for","closeDetail",3,"label"],["pInputText","","id","closeDetail","readonly","",3,"value"]],template:function(l,a){l&1&&(s(0,"p-panel"),_(1,Co,4,3,"form",0),m(),_(2,bo,1,1,"app-period-closing-list",1)),l&2&&(r(),g(1,a.closingNotification?1:-1),r(),g(2,a.closingNotification&&(a.closingNotification.closeType==null?null:a.closingNotification.closeType.code)===a.CatalogueClosingNotificationsCloseTypeEnum.TERM?2:-1))},dependencies:[Ce,ge,ue,ut,ft,bt,Yt]});let e=i;return e})();var ho=[{path:"agreement-list",component:$t},{path:"period-list/:agreementId",component:qt},{path:"tracking-log-list",component:Be},{path:"agreement-termination-list/:agreementId",component:Jt}],Qt=(()=>{let i=class i{};i.\u0275fac=function(l){return new(l||i)},i.\u0275mod=ke({type:i}),i.\u0275inj=Pe({imports:[je.forChild(ho),je]});let e=i;return e})();var Ea=(()=>{let i=class i{};i.\u0275fac=function(l){return new(l||i)},i.\u0275mod=ke({type:i}),i.\u0275inj=Pe({imports:[nt,Qt,Mt,Lt,_t,At,Tt,vt,wt,gt,Ct,Bt,Rt,Nt,Ot,Ft,xt,It,kt,ht,Et]});let e=i;return e})();export{Ea as NationalSupervisorModule};
