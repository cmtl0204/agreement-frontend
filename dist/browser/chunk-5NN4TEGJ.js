import{a as It,b as Lt}from"./chunk-73DS62TK.js";import"./chunk-YSMGJQC4.js";import"./chunk-LHPWVR7O.js";import{c as At}from"./chunk-5JL33SAL.js";import"./chunk-Y6GVBF7F.js";import"./chunk-FQ424XXU.js";import"./chunk-ISADC5UE.js";import{d as ct,e as mt}from"./chunk-CLOQCT5C.js";import{A as nt,B as Se,C as Te,Ga as Me,Ha as xt,Ia as bt,Ja as Et,Ka as yt,La as St,Q as J,R as lt,Ra as Tt,Xa as Ft,Y as rt,Ya as Dt,Z as at,aa as pt,ba as dt,d as et,ha as Fe,i as K,ia as De,ja as ut,k as F,ka as _t,m as H,n as he,na as gt,p as tt,pa as Ae,q as ve,qa as ft,r as xe,ra as Ie,sa as Ct,t as be,ta as Le,ua as ht,v as Ee,va as Ne,w as Q,wa as vt,x as it,y as ot,z as ye}from"./chunk-OY72BBVG.js";import{j as P,m as A,n as st}from"./chunk-GFXZWTUR.js";import{A as pe,D as Ge,Da as z,E as qe,I as W,J as de,L as We,M as ee,N as te,O as ue,P as O,Q as je,S as _e,T as ge,ba as ze,ca as Ke,e as U,fa as Qe,k as N,ka as ie,la as S,ma as fe,na as j,o as V,r as G,s as Ue,ta as Je,u as q,ua as Ce,v as k,va as Ye,wa as Xe,xa as Ze,z as me}from"./chunk-ODTB3GIQ.js";import{Aa as v,Ba as h,Ca as s,E as oe,H as p,J as D,Ja as ae,K as ne,La as d,Ma as y,Mb as $e,Na as E,O as g,Oa as se,P as f,Qa as M,Ra as w,Rb as Be,Sa as B,U as le,Wa as Z,_ as l,eb as $,fb as Pe,gb as ce,ja as _,ka as Oe,la as m,oa as X,pa as re,qa as C,ra as R,sa as I,ta as L,ua as r,va as a,wa as u,yb as He,zb as Re}from"./chunk-EUOB27Q6.js";var zt=(t,i)=>i.field,Kt=()=>({width:"50rem"});function Qt(t,i){if(t&1){let e=v();r(0,"h2"),d(1,"Ejecuci\xF3n del Convenio"),a(),u(2,"p-divider"),r(3,"p-button",8),h("click",function(){g(e);let n=s();return f(n.openFilesModal())}),a()}if(t&2){let e=s();l(3),m("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.CREATE_CLOSING_LOG)("loading",e.coreService.isLoading)("severity",e.SeverityButtonActionEnum.UPLOAD)}}function Jt(t,i){if(t&1&&(r(0,"th",9),d(1),a()),t&2){let e=i.$implicit;m("pSortableColumn",e.field),l(),E(" ",e.header," ")}}function Yt(t,i){if(t&1&&(r(0,"tr"),I(1,Jt,2,2,"th",9,zt),r(3,"th",10),d(4),a()()),t&2){let e=i.$implicit,o=s();l(),L(e),l(3),E(" ",o.TableEnum.ACTIONS," ")}}function Xt(t,i){if(t&1){let e=v();r(0,"tr")(1,"td"),d(2),a(),r(3,"td"),d(4),a(),r(5,"td"),d(6),$(7,"customFormatDateTime"),a(),r(8,"td"),d(9),a(),r(10,"td")(11,"p-button",11),h("click",function(){let n=g(e),c=n.$implicit,x=n.rowIndex,b=s();return f(b.deleteFile(c.id,x))}),a()()()}if(t&2){let e=i.$implicit,o=s();l(2),y(e.type==null?null:e.type.name),l(2),y(e.description),l(2),y(Pe(7,8,e.registeredAt)),l(3),se("",e.user==null?null:e.user.name," ",e.user==null?null:e.user.lastname,""),l(2),m("pTooltip",o.LabelButtonActionEnum.DELETE)("severity",o.SeverityButtonActionEnum.DELETE)("icon",o.IconButtonActionEnum.DELETE)}}function Zt(t,i){if(t&1&&(u(0,"i"),r(1,"div",21),d(2),a()),t&2){let e=s(3);re(e.PrimeIcons.FILE_PDF),l(2),y(e.reportFileField.value==null?null:e.reportFileField.value.name)}}function ei(t,i){t&1&&(r(0,"div",13)(1,"p-messages",19),_(2,Zt,3,3,"ng-template",20),a()())}function ti(t,i){if(t&1){let e=v();r(0,"form",12)(1,"div",13),u(2,"label",14),r(3,"p-fileUpload",15,0),h("uploadHandler",function(n){g(e);let c=ae(4),x=s();return f(x.uploadReportFile(n,c))}),a(),u(5,"small",16),a(),r(6,"div",13),u(7,"label",17)(8,"textarea",18)(9,"small",16),a(),_(10,ei,3,0,"div",13),a()}if(t&2){let e=s();m("formGroup",e.form),l(2),m("label",e.ReportExecutionEnum.type)("required",e.reportFileField),l(),m("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),l(2),m("errors",e.reportFileField.errors)("touched",e.reportFileField.touched)("dirty",e.reportFileField.dirty),l(2),m("label",e.ReportExecutionEnum.description)("required",e.descriptionField),l(2),m("errors",e.descriptionField.errors)("touched",e.descriptionField.touched)("dirty",e.descriptionField.dirty),l(),C(10,e.reportFileField.value?10:-1)}}function ii(t,i){if(t&1){let e=v();r(0,"p-button",22),h("click",function(){g(e);let n=s();return f(n.closeModal())}),a(),r(1,"p-button",23),h("click",function(){g(e);let n=s();return f(n.onSubmit())}),a()}if(t&2){let e=s();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),l(),m("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.UPLOAD)("severity",e.SeverityButtonActionEnum.UPLOAD)}}var wt=(()=>{let i=class i{constructor(){this.coreService=p(G),this.formBuilder=p(Q),this.messageDialogService=p(k),this.agreementsHttpService=p(j),this.confirmationService=p(U),this.filesHttpService=p(fe),this.reportExecutions=[],this.columns=[],this.isVisibleFilesModal=!1,this.formErrors=[],this.IconButtonActionEnum=te,this.SeverityButtonActionEnum=ue,this.TableEnum=_e,this.PrimeIcons=N,this.LabelButtonActionEnum=ee,this.FileEnum=ge,this.ReportExecutionEnum=S}ngOnInit(){this.buildForm(),this.buildColumns(),this.findReportExecutions()}buildForm(){this.form=this.formBuilder.group({reportFile:[null,F.required],description:[null,F.required]})}buildColumns(){this.columns=[{field:"type",header:S.type},{field:"description",header:S.description},{field:"registeredAt",header:S.registeredAt},{field:"user",header:S.user}]}findReportExecutions(){this.agreementsHttpService.findReportExecutions(this.agreementId).subscribe(o=>{this.reportExecutions=o})}openFilesModal(){this.isVisibleFilesModal=!0}closeModal(){this.isVisibleFilesModal=!1,this.form.reset()}onSubmit(){if(this.form.valid){let o=new FormData;o.append("report",this.reportFileField.value),o.append("description",this.descriptionField.value),this.agreementsHttpService.createReportExecution(this.agreementId,o).subscribe(n=>{this.findReportExecutions(),this.isVisibleFilesModal=!1,this.form.reset()})}else this.form.markAllAsTouched(),this.formErrors=[],this.reportFileField.invalid&&this.formErrors.push(S.type),this.reportFileField.invalid&&this.formErrors.push(S.description),this.messageDialogService.fieldErrors(this.formErrors)}uploadReportFile(o,n){this.reportFileField.patchValue(o.files[0]),n.clear()}deleteFile(o,n){this.confirmationService.confirm({key:"confirmDialog",message:"No podr\xE1 recuperar la informaci\xF3n registrada",header:"\xBFEst\xE1 seguro de eliminar?",icon:N.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.filesHttpService.remove(o).subscribe(()=>{this.reportExecutions.splice(n,1)})}})}get reportFileField(){return this.form.controls.reportFile}get descriptionField(){return this.form.controls.description}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=D({type:i,selectors:[["app-closing-execution-document"]],inputs:{agreementId:"agreementId"},decls:8,vars:7,consts:[["uploadFiles",""],["styleClass","p-datatable-striped",3,"value","columns"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Subir Archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],[3,"click","icon","label","loading","severity"],[3,"pSortableColumn"],["colspan","2"],[3,"click","pTooltip","severity","icon"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","report",3,"label","required"],["id","report","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appErrorMessage","",3,"errors","touched","dirty"],["appLabel","","for","description",3,"label","required"],["id","description","pInputTextarea","","formControlName","description"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(n,c){n&1&&(r(0,"p-panel")(1,"p-table",1),_(2,Qt,4,4,"ng-template",2)(3,Yt,5,1,"ng-template",3)(4,Xt,12,10,"ng-template",4),a()(),r(5,"p-dialog",5),B("visibleChange",function(b){return w(c.isVisibleFilesModal,b)||(c.isVisibleFilesModal=b),b}),_(6,ti,11,17,"ng-template",6)(7,ii,2,7,"ng-template",7),a()),n&2&&(l(),m("value",c.reportExecutions)("columns",c.columns),l(4),X(Z(6,Kt)),M("visible",c.isVisibleFilesModal),m("modal",!0))},dependencies:[P,xe,K,H,he,V,Fe,De,A,Me,Le,Ie,Se,Te,et,Ne,be,Ee,J,Ft]});let t=i;return t})();function ri(t,i){if(t&1&&(r(0,"div",13)(1,"div"),d(2),a()()),t&2){let e=i.$implicit;l(2),y(e.name)}}function ai(t,i){if(t&1&&(r(0,"div",13)(1,"div"),d(2),a()()),t&2){let e=i.$implicit;l(2),y(e.name)}}function si(t,i){t&1&&u(0,"input",9)}function ci(t,i){t&1&&u(0,"p-calendar",14),t&2&&m("iconDisplay","input")("showIcon",!0)}function mi(t,i){if(t&1){let e=v();r(0,"p-toolbar")(1,"div",15),u(2,"app-header-form",16),a(),r(3,"div",17)(4,"app-form-button-action",18),h("submit",function(){g(e);let n=s(2);return f(n.onSubmit())}),a()()()}if(t&2){let e=s(2);l(2),m("icon",e.PrimeIcons.PENCIL),l(2),m("iconSubmitButton",e.PrimeIcons.SEND)("isVisibleCancelButton",!1)}}function pi(t,i){if(t&1&&(r(0,"p-panel",0)(1,"h3"),d(2,"Notificar fecha de Acta de Terminaci\xF3n y Cierre del Convenio"),a(),r(3,"form",1)(4,"div",2),u(5,"label",3),r(6,"p-dropdown",4),_(7,ri,3,1,"ng-template",5)(8,ai,3,1,"ng-template",6),a(),u(9,"small",7),a(),r(10,"div",2),u(11,"label",8),_(12,si,1,0,"input",9)(13,ci,1,2),u(14,"small",7),r(15,"p")(16,"em"),d(17," Nota: Registre la fecha que consta en el documento suscrito entre las partes "),a()()(),r(18,"div",10),u(19,"label",11)(20,"textarea",12)(21,"small",7),a()(),u(22,"p-divider"),_(23,mi,5,3,"p-toolbar"),a()),t&2){let e=s();l(3),m("formGroup",e.form),l(2),m("label",e.ClosingNotificationEnum.closeType)("required",e.closeTypeField),l(),m("options",e.closeTypes),l(3),m("errors",e.closeTypeField.errors)("touched",e.closeTypeField.touched)("dirty",e.closeTypeField.dirty),l(2),m("label",e.ClosingNotificationEnum.closedAt)("required",e.closedAtField),l(),C(12,e.idField.value?12:13),l(2),m("errors",e.closedAtField.errors)("touched",e.closedAtField.touched)("dirty",e.closedAtField.dirty),l(5),m("label",e.ClosingNotificationEnum.closeDetail)("required",e.closeDetailField),l(2),m("errors",e.closeDetailField.errors)("touched",e.closeDetailField.touched)("dirty",e.closeDetailField.dirty),l(2),C(23,e.idField.value?-1:23)}}function di(t,i){if(t&1&&(r(0,"div",13)(1,"div"),d(2),a()()),t&2){let e=i.$implicit;l(2),y(e.name)}}function ui(t,i){if(t&1&&(r(0,"div",13)(1,"div"),d(2),a()()),t&2){let e=i.$implicit;l(2),y(e.name)}}function _i(t,i){if(t&1&&(r(0,"p-panel",0)(1,"form",1)(2,"div",2),u(3,"label",19),r(4,"p-dropdown",20),_(5,di,3,1,"ng-template",5)(6,ui,3,1,"ng-template",6),a()(),r(7,"div",2),u(8,"label",21)(9,"input",22),a(),r(10,"div",10),u(11,"label",23)(12,"input",24),a()()()),t&2){let e=s();l(),m("formGroup",e.form),l(2),m("label",e.ClosingNotificationEnum.closeType)("required",e.closeTypeField),l(),m("options",e.closeTypes),l(4),m("label",e.ClosingNotificationEnum.closedAt)("required",e.closedAtField),l(3),m("label",e.ClosingNotificationEnum.closeDetail)("required",e.closeDetailField)}}var Bt=(()=>{let i=class i{constructor(){this.authService=p(z),this.breadcrumbService=p(q),this.agreementsHttpService=p(j),this.confirmationService=p(U),this.closingNotificationsHttpService=p(Ye),this.trackingLogsHttpService=p(Ce),this.cataloguesHttpService=p(me),this.coreService=p(G),this.messageDialogService=p(k),this.formBuilder=p(Q),this.validPeriodsExecution=!1,this.Validators=F,this.closingNotificationOut=new le,this.formErrors=[],this.closeTypes=[],this.AgreementFormEnum=ze,this.AgreementStateEnum=Ke,this.SkeletonEnum=je,this.ClosingNotificationEnum=ie,this.PrimeIcons=N,this.CatalogueAgreementsTypeEnum=Ge,this.CatalogueClosingNotificationsCloseTypeEnum=W,this.breadcrumbService.setItems([{label:O.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:O.CLOSING_NOTIFICATION}]),this.buildForm()}ngOnInit(){this.loadCloseTypes(),this.findClosingNotificationByAgreement(),this.validatePeriodsExecution()}buildForm(){this.form=this.formBuilder.group({id:[null],agreement:[null,F.required],closedAt:[null,F.required],closeDetail:[null,F.required],closeType:[null,F.required]})}createClosingNotification(){this.agreementField.patchValue({id:this.agreementId}),this.closingNotificationsHttpService.createClosingNotificationClosedByAgreement(this.form.value).subscribe(o=>{this.findClosingNotificationByAgreement()})}updateClosedAt(){this.closingNotificationsHttpService.updateClosedAt(this.idField.value,this.closedAtField.value).subscribe(o=>{this.findClosingNotificationByAgreement()})}validatePeriodsExecution(){this.trackingLogsHttpService.validationPeriods(this.agreementId,"execution").subscribe(o=>{this.validPeriodsExecution=o})}findClosingNotificationByAgreement(){this.closingNotificationsHttpService.findClosingNotificationByAgreement(this.agreementId).subscribe(o=>{this.closingNotificationOut.emit(o),o&&(this.closingNotification=o,this.form.patchValue(o),(this.closingNotification.closeType?.code===W.MUTUAL||this.closingNotification.closeType?.code===W.OBJECT||this.closingNotification.closeType?.code===W.UNILATERAL)&&this.form.disable(),this.closingNotification.closeType?.code===W.TERM&&this.closeDetailField.clearValidators(),o.closedAt&&(this.closedAtField.setValue(At(o.closedAt)),this.form.disable()),this.endedAt=new Date(this.closingNotification.agreement.endedAt+"T05:00:00"))})}validateForm(){return this.formErrors=[],this.closedAtField.invalid&&this.formErrors.push(ie.closedAt),this.closeDetailField.invalid&&this.formErrors.push(ie.closeDetail),this.closeTypeField.invalid&&this.formErrors.push(ie.closeType),this.formErrors.length===0}onSubmit(){this.validateForm()?this.confirmationService.confirm({key:"confirmDialog",message:"\xBFEst\xE1 seguro de notificar la terminiaci\xF3n del convenio?",header:"",icon:N.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.closingNotification&&this.closingNotification.closeType?.code===de.TERM?this.updateClosedAt():this.createClosingNotification()}}):(this.form.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}onUpdate(){this.validateForm()?this.confirmationService.confirm({key:"confirmDialog",message:"\xBFEst\xE1 seguro de notificar la terminiaci\xF3n del convenio?",header:"",icon:N.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.createClosingNotification()}}):(this.form.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}loadCloseTypes(){this.closeTypes=this.cataloguesHttpService.findByType(pe.CLOSING_NOTIFICATIONS_CLOSE_TYPE)}get idField(){return this.form.controls.id}get agreementField(){return this.form.controls.agreement}get closedAtField(){return this.form.controls.closedAt}get closeDetailField(){return this.form.controls.closeDetail}get closeTypeField(){return this.form.controls.closeType}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=D({type:i,selectors:[["app-closing-notification"]],inputs:{agreementId:"agreementId"},outputs:{closingNotificationOut:"closingNotificationOut"},decls:2,vars:2,consts:[["header","TIPO DE TERMINACI\xD3N DEL CONVENIO"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","closeType",3,"label","required"],["id","closeType","formControlName","closeType","dataKey","id","placeholder","Selecione",3,"options"],["pTemplate","selectedItem"],["pTemplate","item"],["appErrorMessage","",3,"errors","touched","dirty"],["appLabel","","for","closedAt",3,"label","required"],["pInputText","","formControlName","closedAt"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","closeDetail",3,"label","required"],["pInputTextarea","","id","closeDetail","formControlName","closeDetail"],[1,"flex","align-items-center","gap-2"],["id","closedAt","formControlName","closedAt","dateFormat","dd/mm/yy",3,"iconDisplay","showIcon"],[1,"p-toolbar-group-left"],["label","Registro",3,"icon"],[1,"p-toolbar-group-right"],["labelSubmitButton","Notificar",3,"submit","iconSubmitButton","isVisibleCancelButton"],["appLabel","","for","closeType2",3,"label","required"],["id","closeType2","formControlName","closeType","dataKey","id","placeholder","Selecione",3,"options"],["appLabel","","for","closedAt2",3,"label","required"],["pInputText","","id","closedAt2","formControlName","closedAt"],["appLabel","","for","closeDetail2",3,"label","required"],["pInputText","","id","closeDetail2","formControlName","closeDetail"]],template:function(n,c){n&1&&_(0,pi,24,19,"p-panel",0)(1,_i,13,8,"p-panel",0),n&2&&(C(0,c.closingNotification?-1:0),l(),C(1,c.closingNotification?1:-1))},dependencies:[xe,K,H,he,ye,V,A,Se,Te,bt,Tt,Ne,be,Ee,J,rt,pt,Ae]});let t=i;return t})();var fi=(t,i)=>i.id,Ci=()=>({width:"50rem"}),hi=()=>({width:"100%"});function vi(t,i){if(t&1){let e=v();r(0,"p-button",17),h("click",function(){g(e);let n=s(2);return f(n.openFilesModal())}),a()}if(t&2){let e=s(2);m("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.CREATE_CLOSING_LOG)("loading",e.coreService.isLoading)("severity",e.SeverityButtonActionEnum.UPLOAD)}}function xi(t,i){if(t&1&&(r(0,"h2"),d(1),a(),r(2,"p-toolbar")(3,"div",14),_(4,vi,1,4,"p-button",15),a(),u(5,"div",16),a()),t&2){let e=s();l(),y(e.BreadcrumbEnum.CLOSING_LOG_ADMINISTRATOR),l(3),C(4,e.items.length===0?4:-1)}}function bi(t,i){if(t&1&&(r(0,"th",18),d(1),u(2,"p-sortIcon",19),a()),t&2){let e=i.$implicit;m("pSortableColumn",e.field),l(),E(" ",e.header," "),l(),m("field",e.field)}}function Ei(t,i){if(t&1&&(r(0,"tr"),I(1,bi,3,3,"th",18,R),a()),t&2){let e=i.$implicit;l(),L(e)}}function yi(t,i){if(t&1&&d(0),t&2){let e=s(2).$implicit,o=s().$implicit;E(" ",o[e.field].unit.name," ")}}function Si(t,i){if(t&1&&d(0),t&2){let e=s(4).$implicit;se(" ",e.user.name," ",e.user.lastname," ")}}function Ti(t,i){if(t&1&&_(0,Si,1,2),t&2){let e=s(3).$implicit;C(0,e!=null&&e.user?0:-1)}}function Fi(t,i){if(t&1&&d(0),t&2){let e=s(3).$implicit;E(" ",e==null||e.state==null?null:e.state.name," ")}}function Di(t,i){if(t&1&&_(0,yi,1,1)(1,Ti,1,1)(2,Fi,1,1),t&2){let e,o=s().$implicit;C(0,(e=o.field)==="administrator"?0:e==="user"?1:e==="state"?2:-1)}}function Ai(t,i){if(t&1&&(r(0,"span"),d(1),a(),u(2,"p-divider")),t&2){let e=i.$implicit;l(),E("",e.type.name,": ")}}function Ii(t,i){if(t&1&&I(0,Ai,3,1,null,null,R),t&2){let e=s(4).$implicit;L(e==null?null:e.closingLogDocuments)}}function Li(t,i){if(t&1&&_(0,Ii,2,0),t&2){let e=s(3).$implicit;C(0,e!=null&&e.closingLogDocuments?0:-1)}}function Ni(t,i){if(t&1){let e=v();r(0,"p-button",21),h("click",function(){let n=g(e).$implicit,c=s(6);return f(c.downloadFile(n))}),a(),u(1,"p-divider")}if(t&2){let e=i.$implicit,o=s(6);m("icon",o.IconButtonActionEnum.DOWNLOAD)("label",e.name)("text",!0)("severity",o.SeverityButtonActionEnum.DOWNLOAD)}}function Mi(t,i){if(t&1&&I(0,Ni,2,4,null,null,R),t&2){let e=s(4).$implicit;L(e==null?null:e.closingLogDocuments)}}function wi(t,i){if(t&1&&_(0,Mi,2,0),t&2){let e=s(3).$implicit;C(0,e!=null&&e.closingLogDocuments?0:-1)}}function Bi(t,i){if(t&1&&(r(0,"span"),d(1),a(),u(2,"p-divider")),t&2){let e=i.$implicit;l(),y(e.description)}}function Vi(t,i){if(t&1&&I(0,Bi,3,1,null,null,R),t&2){let e=s(4).$implicit;L(e==null?null:e.closingLogDocuments)}}function ki(t,i){if(t&1&&_(0,Vi,2,0),t&2){let e=s(3).$implicit;C(0,e!=null&&e.closingLogDocuments?0:-1)}}function Oi(t,i){if(t&1&&(d(0),u(1,"br"),d(2),$(3,"date"),u(4,"br"),d(5),$(6,"date")),t&2){let e=s(3).$implicit;E(" ",e.name," "),l(2),E(" ",ce(3,3,e.startedAt,"d MMMM y")," - "),l(3),E(" ",ce(6,6,e.endedAt,"d MMMM y")," ")}}function Pi(t,i){if(t&1&&(d(0),$(1,"date")),t&2){let e=s(3).$implicit;E(" ",ce(1,1,e.uploadedAt,"dd/MM/y - HH:mm")," ")}}function Hi(t,i){if(t&1&&d(0),t&2){let e=s(2).$implicit,o=s().$implicit;E(" ",o[e.field]," ")}}function Ri(t,i){if(t&1&&_(0,Li,1,1)(1,wi,1,1)(2,ki,1,1)(3,Oi,7,9)(4,Pi,2,4)(5,Hi,1,1),t&2){let e,o=s().$implicit;C(0,(e=o.field)==="closingLogDocumentsUpload"?0:e==="closingLogDocuments"?1:e==="description"?2:e==="name"?3:e==="uploadedAt"?4:5)}}function $i(t,i){if(t&1&&(r(0,"td"),_(1,Di,3,1)(2,Ri,6,1),a()),t&2){let e=i.$implicit,o=s().$implicit;l(),C(1,o[e.field]!=null&&o[e.field].id?1:-1),l(),C(2,o[e.field]!=null&&o[e.field].id?-1:2)}}function Ui(t,i){if(t&1&&(r(0,"tr",20),I(1,$i,3,2,"td",null,R),a()),t&2){let e=i.$implicit,o=i.columns,n=i.rowIndex;m("pSelectableRow",e)("pSelectableRowIndex",n),l(),L(o)}}function Gi(t,i){if(t&1&&(r(0,"tr")(1,"td"),d(2),a()()),t&2){let e=i.$implicit,o=s();l(),Oe("colspan",e.length),l(),E(" ",o.messageService.paginatorNoRecordsFound," ")}}function qi(t,i){}function Wi(t,i){if(t&1&&(u(0,"i"),r(1,"div",30),d(2),a()),t&2){let e=s(2).$index,o=s(2);re(o.PrimeIcons.FILE_PDF),l(2),y(o.files[e].file.name)}}function ji(t,i){t&1&&(r(0,"div",23)(1,"p-messages",28),_(2,Wi,3,3,"ng-template",29),a()())}function zi(t,i){if(t&1){let e=v();r(0,"div",23)(1,"label",24),d(2," Descripci\xF3n "),r(3,"b",25),d(4,"*"),a()(),r(5,"input",26),B("ngModelChange",function(n){let c=g(e).$implicit;return w(c.description,n)||(c.description=n),f(n)}),a()(),r(6,"div",23)(7,"label",24),d(8),r(9,"b",25),d(10,"*"),a()(),r(11,"p-fileUpload",27,1),h("uploadHandler",function(n){let c=g(e),x=c.$implicit,b=c.$index,T=ae(12),Ht=s(2);return f(Ht.onUpload(n,T,x,b))}),a()(),_(13,ji,3,0,"div",23),r(14,"div",23),u(15,"p-divider"),a()}if(t&2){let e=i.$implicit,o=i.$index,n=s(2);l(),m("for",e.id),l(4),M("ngModel",e.description),l(2),m("for",e.id),l(),E(" ",e.name," "),l(3),m("chooseIcon",n.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",n.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",n.FileEnum.maxFileSize)("auto",!0)("customUpload",!0)("disabled",!e.description),l(2),C(13,n.files.length>o&&n.files[o]?13:-1)}}function Ki(t,i){if(t&1&&(r(0,"div",22),I(1,zi,16,11,null,null,fi),a()),t&2){let e=s();l(),L(e.closeTypes)}}function Qi(t,i){if(t&1){let e=v();r(0,"p-button",31),h("click",function(){g(e);let n=s();return f(n.closeModal())}),a(),r(1,"p-button",32),h("click",function(){g(e);let n=s();return f(n.onSubmit())}),a()}if(t&2){let e=s();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),l(),m("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.UPLOAD)("severity",e.SeverityButtonActionEnum.UPLOAD)}}function Ji(t,i){if(t&1&&u(0,"app-closing-log-list",13),t&2){let e=s();m("agreementId",e.agreementId)}}var Vt=(()=>{let i=class i{constructor(){this.closingLogOut=new le,this.activatedRoute=p($e),this.authService=p(z),this.coreService=p(G),this.confirmationService=p(U),this.formBuilder=p(Q),this.cataloguesHttpService=p(me),this.periodsHttpService=p(Je),this.trackingLogsHttpService=p(Ce),this.closingLogsHttpService=p(Xe),this.agreementsHttpService=p(j),this.filesHttpService=p(fe),this.breadcrumbService=p(q),this.PrimeIcons=N,this.IconButtonActionEnum=te,this.SeverityButtonActionEnum=ue,this.LabelButtonActionEnum=ee,this.BreadcrumbEnum=O,this.TableEnum=_e,this.messageService=p(Ue),this.messageDialogService=p(k),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new tt(""),this.items=[],this.formErrors=[],this.files=[],this.types=[],this.closeTypes=[],this.trackingLogType="execution",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Qe,this.CatalogueTrackingLogsStateEnum=qe,this.CatalogueClosingNotificationsCloseTypesDocumentEnum=de,this.FileEnum=ge,this.descriptions=[],this.buildForm(),this.buildButtonActions(),this.buildColumns()}ngOnInit(){this.findClosingLogCurrentByAgreement(),this.findAgreement(this.agreementId),this.loadTypes(),this.loadTypesByCloseType(),this.activatedRoute.queryParams.subscribe(o=>{this.trackingLogType=o.type})}buildForm(){this.form=this.formBuilder.group({reportFile:[null,F.required],evidenceFile:[null]})}findAgreement(o){this.agreementsHttpService.findOne(o).subscribe(n=>{this.agreement=n})}findClosingLogCurrentByAgreement(){this.closingLogsHttpService.findClosingLogCurrentByAgreement(this.agreementId).subscribe(o=>{this.closingLogOut.emit(o),o&&(this.items=[o])})}loadTypes(){this.types=this.cataloguesHttpService.findByType(pe.PERIODS_TRACKING_LOG)}loadTypesByCloseType(){this.closeTypes=this.cataloguesHttpService.findByParent(this.closingNotification?.closeType?.id)}createClosingLog(){let o=new FormData;for(let n of this.files)o.append("typeIds",n.type.id),o.append("descriptions",n.description),o.append("files",n.file);this.closingLogsHttpService.createClosingLogClosed(this.agreementId,o).subscribe(n=>{this.findClosingLogCurrentByAgreement(),this.isVisibleFilesModal=!1})}onUpload(o,n,c,x){this.files.find(T=>T?.type?.id===c.id)?this.files[x]={type:c,file:o.files[0],description:c.description}:this.files[x]={type:c,file:o.files[0],description:c.description},n.clear()}openFilesModal(){this.closingNotification?(this.loadTypesByCloseType(),this.isVisibleFilesModal=!0):this.messageDialogService.errorCustom("Importante!",`Es necesario notificar la terminaci\xF3n del convenio antes de subir los documentos habilitantes para el cierre del convenio.
`)}onSubmit(){this.validateFilesForm()?this.createClosingLog():this.messageDialogService.fieldErrors(this.formErrors)}buildColumns(){this.columns=[{field:"closingLogDocumentsUpload",header:S.type},{field:"closingLogDocuments",header:S.file},{field:"description",header:S.description},{field:"uploadedAt",header:S.registeredAt},{field:"user",header:S.user}]}buildButtonActions(){this.buttonActions=[{id:We.TRACKING_LOG,label:ee.TRACKING_LOG,icon:te.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}]}validateButtonActions(o){this.buildButtonActions()}downloadFile(o){this.filesHttpService.downloadFile(o)}validateFilesForm(){return this.formErrors=[],this.closeTypes.forEach(o=>{this.files.find(c=>c.type?.id===o?.id)||this.formErrors.push(o.name)}),this.formErrors.length===0}closeModal(){this.isVisibleFilesModal=!1,this.files=[]}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=D({type:i,selectors:[["app-closing-documents"]],inputs:{agreementId:"agreementId",closingNotification:"closingNotification"},outputs:{closingLogOut:"closingLogOut"},decls:13,vars:16,consts:[["dt",""],["uploadFiles",""],["dataKey","id","styleClass","p-datatable-striped",3,"value","columns","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Subir Archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["header","Bit\xE1cora de seguimiento al cierre del Convenio",3,"visibleChange","visible","modal"],[3,"agreementId"],[1,"p-toolbar-group-left"],[3,"icon","label","loading","severity"],[1,"p-toolbar-group-right"],[3,"click","icon","label","loading","severity"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[1,"ml-2",3,"click","icon","label","text","severity"],[1,"p-fluid","grid"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],[3,"for"],[1,"p-error"],["pInputText","",3,"ngModelChange","ngModel"],["id","report","mode","basic","chooseLabel","Cargar","invalidFileSizeMessageDetail","","name","files[]","accept",".pdf,.rar,.zip",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload","disabled"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(n,c){if(n&1){let x=v();r(0,"p-table",2,0),_(2,xi,6,2,"ng-template",3)(3,Ei,3,0,"ng-template",4)(4,Ui,3,2,"ng-template",5)(5,Gi,3,2,"ng-template",6)(6,qi,0,0,"ng-template",7),a(),r(7,"app-button-action",8),h("isHide",function(T){return g(x),f(c.isButtonActions=!T)}),a(),r(8,"p-dialog",9),B("visibleChange",function(T){return g(x),w(c.isVisibleFilesModal,T)||(c.isVisibleFilesModal=T),f(T)}),_(9,Ki,3,0,"ng-template",10)(10,Qi,2,7,"ng-template",11),a(),r(11,"p-dialog",12),B("visibleChange",function(T){return g(x),w(c.isVisibleTrackingLogModal,T)||(c.isVisibleTrackingLogModal=T),f(T)}),_(12,Ji,1,1,"app-closing-log-list",13),a()}n&2&&(m("value",c.items)("columns",c.columns)("loading",c.coreService.isLoading),l(7),m("buttonActions",c.buttonActions)("enabled",c.isButtonActions),l(),X(Z(14,Ci)),M("visible",c.isVisibleFilesModal),m("modal",!0),l(3),X(Z(15,hi)),M("visible",c.isVisibleTrackingLogModal),m("modal",!0),l(),C(12,c.isVisibleTrackingLogModal?12:-1))},dependencies:[P,K,H,ve,ye,V,Fe,De,_t,ut,A,Me,Le,Ie,St,Ae,It,He]});let t=i;return t})();function Xi(t,i){t&1&&(r(0,"h2"),d(1," Enviar documentaci\xF3n "),a())}function Zi(t,i){if(t&1){let e=v();u(0,"p-divider",4),r(1,"p-button",5),h("click",function(){g(e);let n=s(2);return f(n.closeAgreement())}),a()}if(t&2){let e=s(2);l(),m("disabled",!e.checked)}}function eo(t,i){if(t&1){let e=v();r(0,"div",2)(1,"p-checkbox",3),B("ngModelChange",function(n){g(e);let c=s();return w(c.checked,n)||(c.checked=n),f(n)}),a(),u(2,"p-divider",4),d(3," Enviar documentaci\xF3n habilitante validada, para registro del cierre del convenio en el sistema inform\xE1tico. "),_(4,Zi,2,1),a()}if(t&2){let e=s();l(),M("ngModel",e.checked),m("binary",!0)("disabled",!!e.closedAgreement),l(3),C(4,e.closedAgreement?-1:4)}}var kt=(()=>{let i=class i{constructor(){this.checked=!1,this.closedAgreementsHttpService=p(Ze),this.messageDialogService=p(k)}ngOnInit(){this.findClosedAgreementByAgreement()}closeAgreement(){console.log(this.closingLog),this.closingLog?this.closedAgreementsHttpService.createClose(this.agreementId).subscribe(()=>{this.checked=!0,this.findClosedAgreementByAgreement()}):this.messageDialogService.errorCustom("Importante!","Es necesario subir los documentos habilitantes para el cierre del convenio antes de notificar el cierre del convenio.")}findClosedAgreementByAgreement(){this.closedAgreementsHttpService.findClosedAgreementByAgreement(this.agreementId).subscribe(o=>{o&&(this.checked=!0,this.closedAgreement=o)})}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=D({type:i,selectors:[["app-send-document"]],inputs:{agreementId:"agreementId",closingLog:"closingLog"},decls:3,vars:0,consts:[["pTemplate","header"],["pTemplate","content"],[1,"card","flex"],[3,"ngModelChange","ngModel","binary","disabled"],["layout","vertical"],["label","Enviar","severity","success",3,"click","disabled"]],template:function(n,c){n&1&&(r(0,"p-panel"),_(1,Xi,2,0,"ng-template",0)(2,eo,5,4,"ng-template",1),a())},dependencies:[P,H,ve,V,A,J,ct]});let t=i;return t})();var Ot=(()=>{let i=class i{constructor(){this.authService=p(z),this.breadcrumbService=p(q),this.breadcrumbService.setItems([{label:O.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:O.PERIODS_CLOSING_ADMINISTRATOR}])}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=D({type:i,selectors:[["app-agreement-tracking"]],inputs:{agreementId:"agreementId"},decls:7,vars:6,consts:[[3,"agreementId"],[3,"closingNotificationOut","agreementId"],[3,"closingLogOut","agreementId","closingNotification"],[3,"agreementId","closingLog"],["key","confirmDialog"]],template:function(n,c){n&1&&(u(0,"app-closing-execution-document",0)(1,"p-divider"),r(2,"app-closing-notification",1),h("closingNotificationOut",function(b){return c.closingNotification=b}),a(),u(3,"p-divider"),r(4,"app-closing-documents",2),h("closingLogOut",function(b){return c.closingLog=b}),a(),u(5,"app-send-document",3)(6,"p-confirmDialog",4)),n&2&&(m("agreementId",c.agreementId),l(2),m("agreementId",c.agreementId),l(2),m("agreementId",c.agreementId)("closingNotification",c.closingNotification),l(),m("agreementId",c.agreementId)("closingLog",c.closingLog))},dependencies:[A,Et,wt,Bt,Vt,kt]});let t=i;return t})();var io=[{path:":agreementId",component:Ot}],Pt=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=ne({type:i}),i.\u0275inj=oe({imports:[Be.forChild(io),Be]});let t=i;return t})();var kn=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=ne({type:i}),i.\u0275inj=oe({imports:[Re,Pt,P,it,nt,gt,st,xt,ht,Ct,Dt,vt,ot,lt,at,dt,ft,yt,Lt,mt]});let t=i;return t})();export{kn as AgreementTrackingModule};
