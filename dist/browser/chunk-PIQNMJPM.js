import{a as Qt,b as Zt,c as ei}from"./chunk-W55QGEBD.js";import{a as ii}from"./chunk-7HXD7PNW.js";import{a as ri}from"./chunk-QWAFC6UH.js";import{a as Se,b as Re}from"./chunk-USXWAO77.js";import{a as Xt,b as Jt}from"./chunk-J7QGL3UU.js";import{a as vt}from"./chunk-2TYLG2KP.js";import{d as Ct}from"./chunk-DT435XTF.js";import{a as Yt}from"./chunk-RDJW5QPI.js";import{c as ti,d as ni,f as oi}from"./chunk-KQIJHZHJ.js";import{b as Kt}from"./chunk-ISADC5UE.js";import{c as Et,e as Tt}from"./chunk-TD7NH4PG.js";import{A as bt,Aa as qt,B as H,C as G,Fa as Ut,Ga as he,Ha as Ht,Ia as Gt,Ja as Rt,Ka as Wt,Q as ae,R as Ft,Ra as $t,Sa as pe,Ua as jt,Va as ye,Xa as zt,Y as le,Z as yt,_ as It,aa as St,ba as At,ca as Ue,d as oe,da as Dt,ga as Vt,ha as se,i as Y,ia as me,k as g,m as R,n as P,na as wt,pa as Nt,q as Fe,qa as Ot,r as q,ra as He,t as U,ta as Ge,u as Pe,ua as Bt,v as W,va as Ce,w as M,wa as Lt,x as ot,y as gt,ya as kt,z as X,za as Pt}from"./chunk-2OKY4X77.js";import{e as ft,j as re,k as ht,m as qe,n as xt,r as Mt}from"./chunk-6YZ5KF2Q.js";import{$ as ke,A as N,D as ut,F as Be,G as Ze,K as et,M as ee,N as te,O as j,P as tt,Q as z,S as ie,T as Me,W as Le,X as ne,Z as xe,_ as K,aa as it,ba as y,ca as nt,e as Oe,ea as Ie,fa as Te,i as mt,k as Q,ka as ct,la as _e,ma as _t,o as L,r as $,u as pt,v as B,w as Z,x as dt,z as k,za as fe}from"./chunk-WDHHI5WV.js";import{Aa as F,Ba as b,Ca as p,E as De,H as h,J as O,Ja as Ne,K as Ve,La as u,Ma as v,Na as T,O as c,Ob as st,P as _,Pa as Je,Qa as D,Ra as V,Rb as Qe,Sa as w,U as I,Wa as ce,_ as a,c as at,ja as f,la as m,oa as ue,pa as we,qa as C,ra as J,sa as S,ta as A,ua as l,va as s,wa as d,zb as lt}from"./chunk-EUOB27Q6.js";function Ci(t,i){if(t&1&&(l(0,"div",11)(1,"label"),u(2,"Plazo total del convenio:"),s()(),l(3,"div",12),d(4,"label",13)(5,"app-form-help-field",14)(6,"p-calendar",15)(7,"small",5),s(),l(8,"div",16),d(9,"label",17)(10,"app-form-help-field",3)(11,"input",18)(12,"small",5),s()),t&2){let e=p();a(4),m("label",e.AgreementFormEnum.endedAt)("required",e.endedAtField),a(2),m("iconDisplay","input")("showIcon",!0)("minDate",e.startedAtField.value),a(),m("errors",e.endedAtField.errors)("touched",e.endedAtField.touched)("dirty",e.endedAtField.dirty),a(2),m("label",e.AgreementFormEnum.totalTerm)("required",e.totalTermField),a(3),m("errors",e.totalTermField.errors)("touched",e.totalTermField.touched)("dirty",e.totalTermField.dirty)}}function yi(t,i){if(t&1&&(l(0,"div",11),d(1,"label",19),l(2,"textarea",20),u(3,"      "),s(),d(4,"small",5),s()),t&2){let e=p();a(),m("label",e.AgreementFormEnum.endedReason)("required",e.endedReasonField),a(3),m("errors",e.endedReasonField.errors)("touched",e.endedReasonField.touched)("dirty",e.endedReasonField.dirty)}}var si=(()=>{let i=class i{constructor(){this.coreService=h($),this.formBuilder=h(M),this.cataloguesHttpService=h(k),this.messageDialogService=h(B),this.formOutput=new I,this.formErrorsOutput=new I,this.nextOutput=new I,this.prevOutput=new I,this.formErrors=[],this.Validators=g,this.SkeletonEnum=z,this.AgreementFormEnum=y,this.buildForm()}ngOnInit(){this.patchValueForm(),this.validateForm()}buildForm(){this.form=this.formBuilder.group({subscribedAt:[{value:null,disabled:!0}],startedAt:[{value:null,disabled:!0}],isFinishDate:[{value:null,disabled:!0}],endedAt:[{value:null,disabled:!0}],endedReason:[null],yearTerm:[null],monthTerm:[null],dayTerm:[null],totalTerm:[null]}),this.checkValueChanges()}patchValueForm(){let E=this.formInput,{endedAt:r,startedAt:n,subscribedAt:o}=E,x=at(E,["endedAt","startedAt","subscribedAt"]);this.form.patchValue(x),n&&this.startedAtField.setValue(Re(n)),o&&this.subscribedAtField.setValue(Re(o)),r&&this.endedAtField.setValue(Re(r))}checkValueChanges(){this.form.valueChanges.subscribe(r=>{this.formOutput.emit(r),this.validateForm()}),this.isFinishDateField.valueChanges.subscribe(r=>{r?(this.endedAtField.setValidators(g.required),this.totalTermField.setValidators(g.required),this.endedReasonField.clearValidators(),this.endedReasonField.reset()):r===!1&&(this.endedReasonField.setValidators(g.required),this.endedAtField.clearValidators(),this.totalTermField.clearValidators(),this.endedAtField.reset(),this.totalTermField.reset()),this.endedReasonField.updateValueAndValidity(),this.endedAtField.updateValueAndValidity(),this.yearTermField.updateValueAndValidity(),this.monthTermField.updateValueAndValidity(),this.dayTermField.updateValueAndValidity(),this.totalTermField.updateValueAndValidity()})}validateForm(){this.formErrors=[],this.subscribedAtField.invalid&&this.formErrors.push(y.subscribedAt),this.startedAtField.invalid&&this.formErrors.push(y.startedAt),this.isFinishDateField.invalid&&this.formErrors.push(y.isFinishDate),this.endedAtField.invalid&&this.formErrors.push(y.endedAt),this.endedReasonField.invalid&&this.formErrors.push(y.endedReason),this.yearTermField.invalid&&this.formErrors.push(y.yearTerm),this.monthTermField.invalid&&this.formErrors.push(y.monthTerm),this.dayTermField.invalid&&this.formErrors.push(y.dayTerm),this.totalTermField.invalid&&this.formErrors.push(y.totalTerm),this.formErrorsOutput.emit(this.formErrors)}get subscribedAtField(){return this.form.controls.subscribedAt}get startedAtField(){return this.form.controls.startedAt}get isFinishDateField(){return this.form.controls.isFinishDate}get endedAtField(){return this.form.controls.endedAt}get endedReasonField(){return this.form.controls.endedReason}get yearTermField(){return this.form.controls.yearTerm}get monthTermField(){return this.form.controls.monthTerm}get dayTermField(){return this.form.controls.dayTerm}get totalTermField(){return this.form.controls.totalTerm}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=O({type:i,selectors:[["app-agreement-date"]],inputs:{formInput:"formInput"},outputs:{formOutput:"formOutput",formErrorsOutput:"formErrorsOutput",nextOutput:"nextOutput",prevOutput:"prevOutput"},decls:17,vars:24,consts:[[1,"p-fluid","grid",3,"formGroup"],[1,"field","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","subscribedAt",3,"label","required"],["content","Fecha que consta en convenio"],["id","subscribedAt","formControlName","subscribedAt","dateFormat","dd/mm/yy",3,"iconDisplay","showIcon"],["appErrorMessage","",3,"errors","touched","dirty"],["appLabel","","for","startedAt",3,"label","required"],["id","startedAt","formControlName","startedAt","dateFormat","dd/mm/yy",3,"iconDisplay","showIcon","minDate"],[1,"field","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","isFinishDate",3,"label","required"],["id","isFinishDate","formControlName","isFinishDate",1,"ml-2",3,"disabled"],[1,"field","col-12"],[1,"field","col-12","xl:col-3","lg:col-3","md:col-3","sm:col-12"],["appLabel","","for","endedAt",3,"label","required"],["content","Registrar conforme se\xF1ala convenio"],["id","endedAt","formControlName","endedAt","dateFormat","dd/mm/yy",3,"iconDisplay","showIcon","minDate"],[1,"field","col-12","xl:col-9","lg:col-9","md:col-9","sm:col-12"],["appLabel","","for","totalTerm",3,"label","required"],["pInputText","","id","totalTerm","formControlName","totalTerm"],["appLabel","","for","endedReason",3,"label","required"],["pInputTextarea","","id","endedReason","formControlName","endedReason","rows","5","cols","30",2,"resize","none"]],template:function(n,o){n&1&&(l(0,"form",0)(1,"div",1),d(2,"label",2)(3,"app-form-help-field",3)(4,"p-calendar",4)(5,"small",5),s(),l(6,"div",1),d(7,"label",6)(8,"app-form-help-field",3)(9,"p-calendar",7)(10,"small",5),s(),l(11,"div",8),d(12,"label",9)(13,"app-input-switch",10)(14,"small",5),s(),f(15,Ci,13,13)(16,yi,5,5,"div",11),s()),n&2&&(m("formGroup",o.form),a(2),m("label",o.AgreementFormEnum.subscribedAt)("required",o.subscribedAtField),a(2),m("iconDisplay","input")("showIcon",!0),a(),m("errors",o.subscribedAtField.errors)("touched",o.subscribedAtField.touched)("dirty",o.subscribedAtField.dirty),a(2),m("label",o.AgreementFormEnum.startedAt)("required",o.startedAtField),a(2),m("iconDisplay","input")("showIcon",!0)("minDate",o.subscribedAtField.value),a(),m("errors",o.startedAtField.errors)("touched",o.startedAtField.touched)("dirty",o.startedAtField.dirty),a(2),m("label",o.AgreementFormEnum.isFinishDate)("required",o.isFinishDateField),a(),m("disabled",!0),a(),m("errors",o.isFinishDateField.errors)("touched",o.isFinishDateField.touched)("dirty",o.isFinishDateField.dirty),a(),C(15,o.isFinishDateField.value?15:-1),a(),C(16,o.isFinishDateField.value===!1?16:-1))},dependencies:[q,Y,R,P,U,W,H,G,pe,ye,X,St,Ce]});let t=i;return t})();function Ti(t,i){if(t&1&&(l(0,"div",28)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Si(t,i){if(t&1&&(l(0,"div",28)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Ai(t,i){if(t&1&&(l(0,"div",28)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Di(t,i){if(t&1&&(l(0,"div",28)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Vi(t,i){if(t&1&&(l(0,"div",28)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function wi(t,i){if(t&1&&(l(0,"div",28)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Ni(t,i){if(t&1&&(l(0,"div",28)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Oi(t,i){if(t&1&&(l(0,"div",28)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Bi(t,i){if(t&1&&(l(0,"div",24),d(1,"label",29),l(2,"p-dropdown",30),f(3,Ni,3,1,"ng-template",16)(4,Oi,3,1,"ng-template",17),s(),d(5,"small",5),s()),t&2){let e=p();a(),m("label",e.AgreementFormEnum.specialType)("required",e.specialTypeField),a(),m("options",e.specialTypes),a(3),m("errors",e.specialTypeField.errors)("touched",e.specialTypeField.touched)("dirty",e.specialTypeField.dirty)}}var mi=(()=>{let i=class i{constructor(){this.authService=h(fe),this.agreementsHttpService=h(_e),this.cataloguesHttpService=h(k),this.coreService=h($),this.formBuilder=h(M),this.messageDialogService=h(B),this.Validators=g,this.formOutput=new I,this.formErrorsOutput=new I,this.formErrors=[],this.origins=[],this.specialTypes=[],this.states=[],this.types=[],this.AgreementFormEnum=y,this.AgreementStateEnum=nt,this.SkeletonEnum=z,this.buildForm()}ngOnInit(){this.loadStates(),this.loadOrigins(),this.loadTypes(),this.loadSpecialTypes(),this.patchValueForm(),this.validateForm()}buildForm(){this.form=this.formBuilder.group({agreementState:this.agreementStateForm,name:[null,[g.required]],internalNumber:[null,{validators:g.required,updateOn:"blur"}],number:[null,[g.required]],objective:[null,[g.required]],origin:[{value:null,disabled:!0}],specialType:[null],type:[null,[g.required]]}),this.checkValueChanges()}patchValueForm(){this.form.patchValue(this.formInput),this.internalNumberField.setAsyncValidators([Ct(this.agreementsHttpService,this.formInput?.id)])}get agreementStateForm(){return this.formBuilder.group({state:[{value:null,disabled:!0}]})}checkValueChanges(){this.form.valueChanges.subscribe(r=>{this.formOutput.emit(r),this.validateForm()}),this.typeField.valueChanges.subscribe(r=>{r&&r.code===ut.SPECIAL?this.specialTypeField.setValidators(g.required):this.specialTypeField.clearValidators(),this.specialTypeField.reset(),this.specialTypeField.updateValueAndValidity()})}validateForm(){this.formErrors=[],this.stateField.invalid&&this.formErrors.push(nt.state),this.nameField.invalid&&this.formErrors.push(y.name),this.internalNumberField.invalid&&this.formErrors.push(y.internalNumber),this.internalNumberField.hasError("agreementExists")&&this.messageDialogService.errorCustom("Convenio ya existe","El n\xFAmero interno de convenio ya se encuentra registrado"),this.numberField.invalid&&this.formErrors.push(y.number),this.objectiveField.invalid&&this.formErrors.push(y.objective),this.originField.invalid&&this.formErrors.push(y.origin),this.typeField.invalid&&this.formErrors.push(y.type),this.specialTypeField.invalid&&this.formErrors.push(y.specialType),this.formErrorsOutput.emit(this.formErrors)}loadStates(){this.states=this.cataloguesHttpService.findByType(N.AGREEMENT_STATES_STATE)}loadOrigins(){this.origins=this.cataloguesHttpService.findByType(N.AGREEMENTS_ORIGIN)}loadTypes(){this.types=this.cataloguesHttpService.findByType(N.AGREEMENTS_TYPE)}loadSpecialTypes(){this.specialTypes=this.cataloguesHttpService.findByType(N.AGREEMENTS_SPECIAL_TYPE)}get agreementStateFormField(){return this.form.controls.agreementState}get stateField(){return this.agreementStateFormField.controls.state}get nameField(){return this.form.controls.name}get internalNumberField(){return this.form.controls.internalNumber}get numberField(){return this.form.controls.number}get originField(){return this.form.controls.origin}get typeField(){return this.form.controls.type}get objectiveField(){return this.form.controls.objective}get specialTypeField(){return this.form.controls.specialType}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=O({type:i,selectors:[["app-basic-data"]],inputs:{formInput:"formInput"},outputs:{formOutput:"formOutput",formErrorsOutput:"formErrorsOutput"},decls:40,vars:41,consts:[[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-3","lg:col-3","md:col-6","sm:col-12"],["appLabel","","for","internalNumber",3,"label","required"],["content","Colocar n\xFAmero asignado por la unidad de seguimiento"],["id","internalNumber","formControlName","internalNumber",3,"useGrouping"],["appErrorMessage","",3,"errors","touched","dirty"],["appLabel","","for","number",3,"label","required"],["content","Colocar numeraci\xF3n detallada en el convenio"],["pInputText","","id","number","formControlName","number"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","name",3,"label","required"],["content","Registrar textualmente el nombre del convenio - tipo oraci\xF3n"],["pInputText","","id","name","formControlName","name"],[1,"field","col-12","xl:col-4","lg:col-4","md:col-6","sm:col-12"],["appLabel","","for","origin",3,"label","required"],["id","origin","formControlName","origin","dataKey","id","placeholder","Selecione",3,"options"],["pTemplate","selectedItem"],["pTemplate","item"],["formGroupName","agreementState",1,"field","col-12","xl:col-4","lg:col-4","md:col-6","sm:col-12"],["appLabel","","for","state",3,"label","required"],["content","Escoger opci\xF3n del estado actual del convenio"],["id","state","formControlName","state","dataKey","id","placeholder","Seleccione",3,"options"],["appLabel","","for","type",3,"label","required"],["id","type","formControlName","type","dataKey","id","placeholder","Selecione",3,"options"],[1,"field","col-12","xl:col-4","lg:col-4","md:col-6","sm:col-12","xl:col-offset-8"],[1,"field","col-12"],["appLabel","","for","objective",3,"label","required"],["pInputTextarea","","id","objective","formControlName","objective","rows","6","cols","30"],[1,"flex","align-items-center","gap-2"],["appLabel","","for","specialType",3,"label","required"],["id","specialType","formControlName","specialType","dataKey","id","placeholder","Selecione",3,"options"]],template:function(n,o){n&1&&(l(0,"form",0)(1,"div",1),d(2,"label",2)(3,"app-form-help-field",3)(4,"p-inputNumber",4)(5,"small",5),s(),l(6,"div",1),d(7,"label",6)(8,"app-form-help-field",7)(9,"input",8)(10,"small",5),s(),l(11,"div",9),d(12,"label",10)(13,"app-form-help-field",11)(14,"input",12)(15,"small",5),s(),l(16,"div",13),d(17,"label",14),l(18,"p-dropdown",15),f(19,Ti,3,1,"ng-template",16)(20,Si,3,1,"ng-template",17),s(),d(21,"small",5),s(),l(22,"div",18),d(23,"label",19)(24,"app-form-help-field",20),l(25,"p-dropdown",21),f(26,Ai,3,1,"ng-template",16)(27,Di,3,1,"ng-template",17),s(),d(28,"small",5),s(),l(29,"div",13),d(30,"label",22),l(31,"p-dropdown",23),f(32,Vi,3,1,"ng-template",16)(33,wi,3,1,"ng-template",17),s(),d(34,"small",5),s(),f(35,Bi,6,6,"div",24),l(36,"div",25),d(37,"label",26)(38,"textarea",27)(39,"small",5),s()()),n&2&&(m("formGroup",o.form),a(2),m("label",o.AgreementFormEnum.internalNumber)("required",o.internalNumberField),a(2),m("useGrouping",!1),a(),m("errors",o.internalNumberField.errors)("touched",o.internalNumberField.touched)("dirty",o.internalNumberField.dirty),a(2),m("label",o.AgreementFormEnum.number)("required",o.numberField),a(3),m("errors",o.numberField.errors)("touched",o.numberField.touched)("dirty",o.numberField.dirty),a(2),m("label",o.AgreementFormEnum.name)("required",o.nameField),a(3),m("errors",o.nameField.errors)("touched",o.nameField.touched)("dirty",o.nameField.dirty),a(2),m("label",o.AgreementFormEnum.origin)("required",o.originField),a(),m("options",o.origins),a(3),m("errors",o.originField.errors)("touched",o.originField.touched)("dirty",o.originField.dirty),a(2),m("label",o.AgreementStateEnum.state)("required",o.stateField),a(2),m("options",o.states),a(3),m("errors",o.stateField.errors)("touched",o.stateField.touched)("dirty",o.stateField.dirty),a(2),m("label",o.AgreementFormEnum.type)("required",o.typeField),a(),m("options",o.types),a(3),m("errors",o.typeField.errors)("touched",o.typeField.touched)("dirty",o.typeField.dirty),a(),C(35,o.specialTypeField.hasValidator(o.Validators.required)?35:-1),a(2),m("label",o.AgreementFormEnum.objective)("required",o.objectiveField),a(2),m("errors",o.objectiveField.errors)("touched",o.objectiveField.touched)("dirty",o.objectiveField.dirty))},dependencies:[q,Y,R,P,U,W,Pe,H,G,L,pe,X,le,Ue,Ce]});let t=i;return t})();var di=(t,i)=>i.field,ki=()=>({width:"50rem",height:"50rem"}),pi=()=>({width:"50rem"});function Pi(t,i){if(t&1){let e=F();l(0,"h4"),u(1,"Ministerio de Turismo:"),s(),l(2,"p-button",14),b("click",function(){c(e);let n=p();return _(n.showInternalInstitutionModal())}),s()}if(t&2){let e=p();a(2),m("icon",e.IconButtonActionEnum.ADD)("pTooltip",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}function qi(t,i){if(t&1&&(l(0,"th",18),u(1),s()),t&2){let e=i.$implicit;m("pSortableColumn",e.field),a(),T(" ",e.header," ")}}function Ui(t,i){if(t&1&&(l(0,"tr")(1,"th",17),u(2),s(),S(3,qi,2,2,"th",18,di),s()),t&2){let e=p(3);a(2),T(" ",e.TableEnum.ACTIONS," "),a(),A(e.internalInstitutionsColumns)}}function Hi(t,i){if(t&1){let e=F();l(0,"p-button",19),b("click",function(){let n=c(e).$index,o=p().rowIndex,x=p(3);return _(x.deleteInternalInstitutionDetail(o,n))}),s(),d(1,"p-divider")}if(t&2){let e=p(4);m("icon",e.IconButtonActionEnum.DELETE)("severity",e.SeverityButtonActionEnum.DELETE)("pTooltip","Eliminar Unidad/Cargo")}}function Gi(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Ri(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Wi(t,i){if(t&1){let e=F();l(0,"p-dropdown",20),w("ngModelChange",function(n){let o=c(e).$implicit;return V(o.position,n)||(o.position=n),_(n)}),b("onChange",function(){c(e);let n=p(4);return _(n.formOutput.emit(n.formInput))}),f(1,Gi,3,1,"ng-template",8)(2,Ri,3,1,"ng-template",9),s(),d(3,"p-divider")}if(t&2){let e=i.$implicit,r=p(4);m("id",e.position),D("ngModel",e.position),m("options",r.positions)}}function $i(t,i){if(t&1&&(l(0,"tr")(1,"td"),S(2,Hi,2,3,null,null,J),s(),l(4,"td"),S(5,Wi,4,3,null,null,J),s()()),t&2){let e=i.$implicit;a(2),A(e.internalInstitutionDetails),a(3),A(e.internalInstitutionDetails)}}function ji(t,i){if(t&1&&(l(0,"p-table",15),f(1,Ui,5,1,"ng-template",0)(2,$i,7,0,"ng-template",16),s()),t&2){let e=p(2);m("value",e.formInput.internalInstitutions)("columns",e.internalInstitutionsColumns)}}function zi(t,i){if(t&1&&f(0,ji,3,2,"p-table",15),t&2){let e=p();C(0,e.formInput.internalInstitutions.length>0?0:-1)}}function Ki(t,i){if(t&1){let e=F();l(0,"h4"),u(1,"Contraparte:"),s(),l(2,"p-button",14),b("click",function(){c(e);let n=p();return _(n.showExternalInstitutionModal())}),s()}if(t&2){let e=p();a(2),m("icon",e.IconButtonActionEnum.ADD)("pTooltip",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}function Yi(t,i){if(t&1&&(l(0,"th",18),u(1),s()),t&2){let e=i.$implicit;m("pSortableColumn",e.field),a(),T(" ",e.header," ")}}function Xi(t,i){if(t&1&&(l(0,"tr"),d(1,"th"),S(2,Yi,2,2,"th",18,di),d(4,"th",22),s()),t&2){let e=i.$implicit;a(2),A(e)}}function Ji(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Qi(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Zi(t,i){if(t&1){let e=F();l(0,"input",26),w("ngModelChange",function(n){let o=c(e).$implicit;return V(o.unit,n)||(o.unit=n),_(n)}),b("keyup",function(){c(e);let n=p(4);return _(n.formOutput.emit(n.formInput))}),s()}if(t&2){let e=i.$implicit;D("ngModel",e.unit)}}function en(t,i){if(t&1){let e=F();l(0,"input",26),w("ngModelChange",function(n){let o=c(e).$implicit;return V(o.position,n)||(o.position=n),_(n)}),b("keyup",function(){c(e);let n=p(4);return _(n.formOutput.emit(n.formInput))}),s()}if(t&2){let e=i.$implicit;D("ngModel",e.position)}}function tn(t,i){if(t&1){let e=F();l(0,"p-button",27),b("click",function(){let n=c(e).$index,o=p().rowIndex,x=p(3);return _(x.deleteExternalInstitutionDetail(o,n))}),s(),d(1,"br")}if(t&2){let e=p(4);m("icon",e.IconButtonActionEnum.REMOVE)("severity",e.SeverityButtonActionEnum.DELETE)("text",!0)("pTooltip","Eliminar Cargo")}}function nn(t,i){if(t&1){let e=F();l(0,"tr")(1,"td")(2,"p-button",23),b("click",function(){let n=c(e).rowIndex,o=p(3);return _(o.deleteExternalInstitution(n))}),s()(),l(3,"td")(4,"p-dropdown",20),w("ngModelChange",function(n){let o=c(e).$implicit;return V(o.personType,n)||(o.personType=n),_(n)}),b("onChange",function(){c(e);let n=p(3);return _(n.formOutput.emit(n.formInput))}),f(5,Ji,3,1,"ng-template",8)(6,Qi,3,1,"ng-template",9),s()(),l(7,"td"),u(8),s(),l(9,"td"),S(10,Zi,1,1,"input",24,J),s(),l(12,"td"),S(13,en,1,1,"input",24,J),s(),l(15,"td"),S(16,tn,2,4,null,null,J),s(),l(18,"td")(19,"p-button",25),b("click",function(){let n=c(e).rowIndex,o=p(3);return _(o.showExternalInstitutionDetailModal(n))}),s()()()}if(t&2){let e=i.$implicit,r=p(3);a(2),m("icon",r.IconButtonActionEnum.DELETE)("severity",r.SeverityButtonActionEnum.DELETE)("pTooltip","Eliminar Compareciente"),a(2),m("id",e.personType.id),D("ngModel",e.personType),m("options",r.externalPersonTypes),a(4),T(" ",e.name," "),a(2),A(e.externalInstitutionDetails),a(3),A(e.externalInstitutionDetails),a(3),A(e.externalInstitutionDetails),a(3),m("text",!0)("icon",r.PrimeIcons.PLUS_CIRCLE)("severity",r.SeverityButtonActionEnum.ADD)}}function on(t,i){if(t&1&&(l(0,"p-table",15),f(1,Xi,5,0,"ng-template",0)(2,nn,20,10,"ng-template",16),s()),t&2){let e=p(2);m("value",e.formInput.externalInstitutions)("columns",e.externalInstitutionsColumns)}}function rn(t,i){if(t&1&&f(0,on,3,2,"p-table",15),t&2){let e=p();C(0,e.formInput.externalInstitutions.length>0?0:-1)}}function an(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function ln(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function sn(t,i){if(t&1){let e=F();l(0,"p-button",28),b("click",function(){c(e);let n=p();return _(n.isVisibleInternalInstitutionForm=!1)}),s(),l(1,"p-button",29),b("click",function(){c(e);let n=p();return _(n.addInternalInstitution())}),s()}if(t&2){let e=p();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),a(),m("icon",e.IconButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)("label",e.LabelButtonActionEnum.ADD)}}function mn(t,i){t&1&&(l(0,"h3"),u(1," Agregar "),d(2,"app-form-help-field",6),s())}function pn(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function dn(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function un(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function cn(t,i){if(t&1&&(l(0,"div",21)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function _n(t,i){if(t&1&&(l(0,"form",3)(1,"div",4),d(2,"label",30),l(3,"p-dropdown",31),f(4,pn,3,1,"ng-template",8)(5,dn,3,1,"ng-template",9),s(),d(6,"small",10),s(),l(7,"div",4),d(8,"label",32),l(9,"p-dropdown",33),f(10,un,3,1,"ng-template",8)(11,cn,3,1,"ng-template",9),s(),d(12,"small",10),s()(),l(13,"form",3)(14,"div",34),d(15,"label",35)(16,"input",36)(17,"small",10),s(),l(18,"div",34),d(19,"label",37)(20,"input",38)(21,"small",10),s()()),t&2){let e=p();m("formGroup",e.externalInstitutionForm),a(2),m("label",e.ExternalInstitutionsFormEnum.name)("required",e.externalInstitutionNameField),a(),m("options",e.externalNames),a(3),m("errors",e.externalInstitutionNameField.errors)("touched",e.externalInstitutionNameField.touched)("dirty",e.externalInstitutionNameField.dirty),a(2),m("label",e.ExternalInstitutionsFormEnum.personType)("required",e.externalInstitutionPersonTypeField),a(),m("options",e.externalPersonTypes),a(3),m("errors",e.externalInstitutionPersonTypeField.errors)("touched",e.externalInstitutionPersonTypeField.touched)("dirty",e.externalInstitutionPersonTypeField.dirty),a(),m("formGroup",e.externalInstitutionDetailForm),a(2),m("label",e.ExternalInstitutionsFormEnum.position)("required",e.externalInstitutionDetailPositionField),a(2),m("errors",e.externalInstitutionDetailPositionField.errors)("touched",e.externalInstitutionDetailPositionField.touched)("dirty",e.externalInstitutionDetailPositionField.dirty),a(2),m("label",e.ExternalInstitutionsFormEnum.unit)("required",e.externalInstitutionDetailUnitField),a(2),m("errors",e.externalInstitutionDetailUnitField.errors)("touched",e.externalInstitutionDetailUnitField.touched)("dirty",e.externalInstitutionDetailUnitField.dirty)}}function fn(t,i){if(t&1){let e=F();l(0,"p-button",29),b("click",function(){c(e);let n=p(2);return _(n.updateExternalInstitution())}),s()}if(t&2){let e=p(2);m("icon",e.IconButtonActionEnum.UPDATE)("severity",e.SeverityButtonActionEnum.UPDATE)("label",e.LabelButtonActionEnum.UPDATE)}}function hn(t,i){if(t&1){let e=F();l(0,"p-button",29),b("click",function(){c(e);let n=p(2);return _(n.addExternalInstitution())}),s()}if(t&2){let e=p(2);m("icon",e.IconButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)("label",e.LabelButtonActionEnum.ADD)}}function gn(t,i){if(t&1){let e=F();l(0,"p-button",28),b("click",function(){c(e);let n=p();return _(n.isVisibleExternalInstitutionForm=!1)}),s(),f(1,fn,1,3,"p-button",39)(2,hn,1,3)}if(t&2){let e=p();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),a(),C(1,e.externalInstitutionDetailIdField.value?1:2)}}function bn(t,i){if(t&1&&(l(0,"form",3)(1,"div",4),d(2,"label",40)(3,"input",41)(4,"small",10),s(),l(5,"div",4),d(6,"label",42)(7,"input",43)(8,"small",10),s()()),t&2){let e=p();m("formGroup",e.externalInstitutionDetailForm),a(2),m("label",e.ExternalInstitutionsFormEnum.unit)("required",e.externalInstitutionDetailUnitField),a(2),m("errors",e.externalInstitutionDetailUnitField.errors)("touched",e.externalInstitutionDetailUnitField.touched)("dirty",e.externalInstitutionDetailUnitField.dirty),a(2),m("label",e.ExternalInstitutionsFormEnum.position)("required",e.externalInstitutionDetailPositionField),a(2),m("errors",e.externalInstitutionDetailPositionField.errors)("touched",e.externalInstitutionDetailPositionField.touched)("dirty",e.externalInstitutionDetailPositionField.dirty)}}function vn(t,i){if(t&1){let e=F();l(0,"p-button",28),b("click",function(){c(e);let n=p();return _(n.isVisibleExternalInstitutionDetailForm=!1)}),s(),l(1,"p-button",44),b("click",function(){c(e);let n=p();return _(n.addExternalInstitutionDetail())}),s()}if(t&2){let e=p();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),a(),m("label",e.LabelButtonActionEnum.ADD)("icon",e.IconButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}var ui=(()=>{let i=class i{constructor(){this.authService=h(fe),this.cataloguesHttpService=h(k),this.coreService=h($),this.formBuilder=h(M),this.messageDialogService=h(B),this.formInput=Z(),this.formOutput=new I,this.formErrorsOutput=new I,this.externalInstitutionsColumns=[],this.internalInstitutionsColumns=[],this.formErrors=[],this.isVisibleExternalInstitutionDetailForm=!1,this.isVisibleInternalInstitutionForm=!1,this.isVisibleExternalInstitutionForm=!1,this.index=-1,this.internalPersonTypes=[],this.externalPersonTypes=[],this.externalNames=[],this.positions=[],this.ExternalInstitutionsFormEnum=K,this.InternalInstitutionsFormEnum=xe,this.SkeletonEnum=z,this.PrimeIcons=Q,this.SeverityButtonActionEnum=j,this.LabelButtonActionEnum=ee,this.IconButtonActionEnum=te,this.AgreementFormEnum=y,this.TableEnum=ie,this.buildForm(),this.buildExternalInstitutionForm(),this.buildInternalInstitutionForm(),this.buildExternalInstitutionDetailForm(),this.buildInternalInstitutionDetailForm(),this.buildExternalInstitutionsColumns(),this.buildInternalInstitutionsColumns(),this.checkValueChanges()}ngOnInit(){this.loadInternalPersonTypes(),this.loadExternalPersonTypes(),this.loadExternalNames(),this.loadPositions(),this.patchValueForm(),this.validateForm()}buildForm(){this.form=this.formBuilder.group({internalInstitutions:this.formBuilder.array([],g.required),externalInstitutions:this.formBuilder.array([],g.required)})}patchValueForm(){this.form.patchValue(this.formInput)}checkValueChanges(){this.form.valueChanges.subscribe(r=>{this.formOutput.emit(this.formInput),this.validateForm()})}validateForm(){this.formErrors=[],this.formInput.internalInstitutions?.length===0&&this.formErrors.push("Comparecientes - Mintur"),this.formInput.externalInstitutions?.length===0&&this.formErrors.push("Comparecientes - Contraparte"),this.formErrorsOutput.emit(this.formErrors)}buildInternalInstitutionForm(){this.internalInstitutionForm=this.formBuilder.group({name:["Ministerio de Turismo"],personType:[null,[g.required]]})}buildInternalInstitutionDetailForm(){this.internalInstitutionDetailForm=this.formBuilder.group({position:[null,[g.required]],unit:[null]})}buildExternalInstitutionForm(){this.externalInstitutionForm=this.formBuilder.group({personType:[null,[g.required]],name:[null,[g.required]]})}buildExternalInstitutionDetailForm(){this.externalInstitutionDetailForm=this.formBuilder.group({id:[null],position:[null,[g.required]],unit:[null,[g.required,g.pattern(Se())]]})}buildInternalInstitutionsColumns(){this.internalInstitutionsColumns=[{field:"position",header:xe.position}]}buildExternalInstitutionsColumns(){this.externalInstitutionsColumns=[{field:"personType",header:K.personType},{field:"name",header:K.name},{field:"position",header:K.unit},{field:"position",header:K.position}]}addInternalInstitution(){this.internalInstitutionPersonTypeField.patchValue(this.internalPersonTypes.find(r=>r.code===Ze.PUBLIC)),this.internalInstitutionNameField.patchValue("Ministerio de Turismo"),this.validateInternalInstitutionForm()&&this.validateInternalInstitutionDetailForm()?(this.formInput.internalInstitutions.length===0&&this.formInput.internalInstitutions.push(this.internalInstitutionForm.value),this.index=0,this.form.patchValue(this.formInput),this.addInternalInstitutionDetail(),this.internalInstitutionForm.reset(),this.isVisibleInternalInstitutionForm=!1):(this.internalInstitutionForm.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}addInternalInstitutionDetail(){this.validateInternalInstitutionDetailForm()?(this.formInput?.internalInstitutions&&(this.formInput?.internalInstitutions[this.index].internalInstitutionDetails?this.formInput.internalInstitutions[this.index].internalInstitutionDetails.push(this.internalInstitutionDetailForm.value):this.formInput.internalInstitutions[this.index].internalInstitutionDetails=[this.internalInstitutionDetailForm.value]),this.form.patchValue(this.formInput),this.internalInstitutionDetailPositionField.reset()):(this.internalInstitutionDetailForm.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}addExternalInstitution(){this.validateExternalInstitutionForm()&&this.validateExternalInstitutionDetailForm()?(this.formInput.externalInstitutions.length===0?(this.formInput.externalInstitutions.push(this.externalInstitutionForm.value),this.index=0):(this.index=this.formInput.externalInstitutions.findIndex(r=>r.name.toLowerCase()===this.externalInstitutionNameField.value.toLowerCase()),this.index===-1&&(this.formInput.externalInstitutions.push(this.externalInstitutionForm.value),this.index=this.formInput.externalInstitutions.length-1)),this.form.patchValue(this.formInput),this.addExternalInstitutionDetail(),this.externalInstitutionForm.reset(),this.isVisibleExternalInstitutionForm=!1):(this.externalInstitutionForm.markAllAsTouched(),this.externalInstitutionDetailForm.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}updateExternalInstitution(){this.validateExternalInstitutionForm()&&this.validateExternalInstitutionDetailForm()?(this.index=this.formInput.externalInstitutions.findIndex(r=>r.name.toLowerCase()===this.externalInstitutionNameField.value.toLowerCase()),this.index===-1&&(this.formInput.externalInstitutions.push(this.externalInstitutionForm.value),this.index=this.formInput.externalInstitutions.length-1),this.form.patchValue(this.formInput),this.addExternalInstitutionDetail(),this.externalInstitutionForm.reset(),this.isVisibleExternalInstitutionForm=!1):(this.externalInstitutionForm.markAllAsTouched(),this.externalInstitutionDetailForm.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}addExternalInstitutionDetail(){this.validateExternalInstitutionDetailForm()?(this.formInput?.externalInstitutions&&(this.formInput?.externalInstitutions[this.index].externalInstitutionDetails?this.formInput.externalInstitutions[this.index].externalInstitutionDetails.push(this.externalInstitutionDetailForm.value):this.formInput.externalInstitutions[this.index].externalInstitutionDetails=[this.externalInstitutionDetailForm.value]),this.form.patchValue(this.formInput),this.isVisibleExternalInstitutionDetailForm=!1,this.externalInstitutionDetailForm.reset()):(this.externalInstitutionDetailForm.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}showExternalInstitutionModal(){this.isVisibleExternalInstitutionForm=!0}showExternalInstitutionDetailModal(r){this.isVisibleExternalInstitutionDetailForm=!0,this.index=r}deleteExternalInstitution(r){if(this.formInput.obligations.some(n=>n.institutionName.includes(this.formInput.externalInstitutions[r].name))){this.messageDialogService.errorCustom("Existe obligaciones asignadas","Por favor elimine primero las obligaciones");return}if(this.formInput.financings.some(n=>n.institutionName===this.formInput.externalInstitutions[r].name)){this.messageDialogService.errorCustom("Existe financiamientos asignados","Por favor elimine primero los financiamientos");return}this.formInput.externalInstitutions.splice(r,1),this.form.patchValue(this.formInput)}deleteInternalInstitutionDetail(r,n){this.formInput.internalInstitutions[r].internalInstitutionDetails.splice(n,1)}deleteInternalInstitution(r){this.formInput.internalInstitutions.splice(r,1),this.form.patchValue(this.formInput)}deleteExternalInstitutionDetail(r,n){if(this.formInput.externalInstitutions[r].externalInstitutionDetails.length===1){this.messageDialogService.errorCustom("No se puede elminar","Debe contener al menos una unidad y un cargo");return}this.formInput.externalInstitutions[r].externalInstitutionDetails.splice(n,1)}validateExternalInstitutionForm(){return this.formErrors=[],this.externalInstitutionNameField.invalid&&this.formErrors.push(K.name),this.externalInstitutionPersonTypeField.invalid&&this.formErrors.push(K.personType),this.externalInstitutionDetailUnitField.invalid&&this.formErrors.push(K.unit),this.externalInstitutionDetailPositionField.invalid&&this.formErrors.push(K.position),this.formErrors.length===0}validateExternalInstitutionDetailForm(){return this.formErrors=[],this.externalInstitutionDetailUnitField.invalid&&this.formErrors.push(K.unit),this.externalInstitutionDetailPositionField.invalid&&this.formErrors.push(K.position),this.formErrors.length===0}validateInternalInstitutionForm(){return this.formErrors=[],this.internalInstitutionPersonTypeField.invalid&&this.formErrors.push(xe.personType),this.formErrors.length===0}validateInternalInstitutionDetailForm(){return this.formErrors=[],this.internalInstitutionDetailPositionField.invalid&&this.formErrors.push(xe.position),this.internalInstitutionDetailForm.valid&&this.formErrors.length===0}loadInternalPersonTypes(){this.internalPersonTypes=this.cataloguesHttpService.findByType(N.INTERNAL_INSTITUTIONS_PERSON_TYPE),this.internalInstitutionPersonTypeField.patchValue(this.internalPersonTypes.find(r=>r.code===Ze.PUBLIC))}loadExternalPersonTypes(){this.externalPersonTypes=this.cataloguesHttpService.findByType(N.EXTERNAL_INSTITUTIONS_PERSON_TYPE)}loadExternalNames(){this.externalNames=this.cataloguesHttpService.findByType(N.EXTERNAL_INSTITUTIONS_NAME)}loadPositions(){this.positions=this.cataloguesHttpService.findByType(N.INTERNAL_INSTITUTIONS_POSITION)}save(){this.formOutput.emit(this.form.value)}showInternalInstitutionModal(){this.isVisibleInternalInstitutionForm=!0}get internalInstitutionsField(){return this.form.get("internalInstitutions")}get externalInstitutionsField(){return this.form.get("externalInstitutions")}get internalInstitutionNameField(){return this.internalInstitutionForm.controls.name}get internalInstitutionPersonTypeField(){return this.internalInstitutionForm.controls.personType}get internalInstitutionDetailPositionField(){return this.internalInstitutionDetailForm.controls.position}get externalInstitutionNameField(){return this.externalInstitutionForm.controls.name}get externalInstitutionPersonTypeField(){return this.externalInstitutionForm.controls.personType}get externalInstitutionDetailIdField(){return this.externalInstitutionDetailForm.controls.id}get externalInstitutionDetailUnitField(){return this.externalInstitutionDetailForm.controls.unit}get externalInstitutionDetailPositionField(){return this.externalInstitutionDetailForm.controls.position}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=O({type:i,selectors:[["app-appearer"]],inputs:{formInput:"formInput"},outputs:{formOutput:"formOutput",formErrorsOutput:"formErrorsOutput"},decls:23,vars:23,consts:[["pTemplate","header"],["pTemplate","content"],["header","Agregar",3,"visibleChange","visible","modal","maximizable"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","internalPosition",3,"label","required"],["content","Registrar conforme se detalla en el convenio"],["id","internalPosition","formControlName","position","dataKey","id","placeholder","Selecione",3,"options"],["pTemplate","selectedItem"],["pTemplate","item"],["appErrorMessage","",3,"errors","touched","dirty"],["pTemplate","footer"],[3,"visibleChange","visible","modal"],["header","Contraparte",3,"visibleChange","visible","modal"],[1,"ml-2",3,"click","icon","pTooltip","severity"],["styleClass","p-datatable-striped",3,"value","columns"],["pTemplate","body"],[2,"width","5%"],[3,"pSortableColumn"],[1,"ml-1",3,"click","icon","severity","pTooltip"],["dataKey","id","placeholder","Selecione","appendTo","body",3,"ngModelChange","onChange","id","ngModel","options"],[1,"flex","align-items-center","gap-2"],["colspan","2"],[3,"click","icon","severity","pTooltip"],["pInputText","",3,"ngModel"],["pTooltip","Agregar Unidad/Cargo",3,"click","text","icon","severity"],["pInputText","",3,"ngModelChange","keyup","ngModel"],[3,"click","icon","severity","text","pTooltip"],[3,"click","label","icon","text","severity"],[3,"click","icon","severity","label"],["appLabel","","for","name",3,"label","required"],["id","name","formControlName","name","dataKey","id","optionValue","name","placeholder","Seleccione",3,"options"],["appLabel","","for","externalPersonType",3,"label","required"],["id","externalPersonType","formControlName","personType","dataKey","id","placeholder","Selecione",3,"options"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","externalPosition2",3,"label","required"],["pInputText","","id","externalPosition2","formControlName","position"],["appLabel","","for","unit2",3,"label","required"],["pInputText","","id","unit2","formControlName","unit"],[3,"icon","severity","label"],["appLabel","","for","unit1",3,"label","required"],["pInputText","","id","unit1","formControlName","unit"],["appLabel","","for","externalPosition1",3,"label","required"],["pInputText","","id","externalPosition1","formControlName","position"],[3,"click","label","icon","severity"]],template:function(n,o){n&1&&(l(0,"p-panel"),f(1,Pi,3,3,"ng-template",0)(2,zi,1,1,"ng-template",1),s(),l(3,"p-panel"),f(4,Ki,3,3,"ng-template",0)(5,rn,1,1,"ng-template",1),s(),l(6,"p-dialog",2),w("visibleChange",function(E){return V(o.isVisibleInternalInstitutionForm,E)||(o.isVisibleInternalInstitutionForm=E),E}),l(7,"form",3)(8,"div",4),d(9,"label",5)(10,"app-form-help-field",6),l(11,"p-dropdown",7),f(12,an,3,1,"ng-template",8)(13,ln,3,1,"ng-template",9),s(),d(14,"small",10),s()(),f(15,sn,2,7,"ng-template",11),s(),l(16,"p-dialog",12),w("visibleChange",function(E){return V(o.isVisibleExternalInstitutionForm,E)||(o.isVisibleExternalInstitutionForm=E),E}),f(17,mn,3,0,"ng-template",0)(18,_n,22,24,"ng-template",1)(19,gn,3,5,"ng-template",11),s(),l(20,"p-dialog",13),w("visibleChange",function(E){return V(o.isVisibleExternalInstitutionDetailForm,E)||(o.isVisibleExternalInstitutionDetailForm=E),E}),f(21,bn,9,11,"ng-template",1)(22,vn,2,7,"ng-template",11),s()),n&2&&(a(6),ue(ce(20,ki)),D("visible",o.isVisibleInternalInstitutionForm),m("modal",!0)("maximizable",!0),a(),m("formGroup",o.internalInstitutionDetailForm),a(2),m("label",o.InternalInstitutionsFormEnum.position)("required",o.internalInstitutionDetailPositionField),a(2),m("options",o.positions),a(3),m("errors",o.internalInstitutionDetailPositionField.errors)("touched",o.internalInstitutionDetailPositionField.touched)("dirty",o.internalInstitutionDetailPositionField.dirty),a(2),ue(ce(21,pi)),D("visible",o.isVisibleExternalInstitutionForm),m("modal",!0),a(4),ue(ce(22,pi)),D("visible",o.isVisibleExternalInstitutionDetailForm),m("modal",!0))},dependencies:[q,Y,R,P,U,W,Fe,H,G,oe,L,pe,re,qe,X,le,ae,se,me,he],styles:[".button-group[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:.5rem}"]});let t=i;return t})();var Fn=(t,i)=>i.field,Cn=()=>({width:"50rem"});function yn(t,i){if(t&1){let e=F();l(0,"h4"),u(1),s(),l(2,"p-button",4),b("click",function(){c(e);let n=p();return _(n.showObligationModal())}),s()}if(t&2){let e=p();a(),T("",e.ObligationForEnum.header,":"),a(),m("icon",e.IconButtonActionEnum.ADD)("pTooltip","1. Agregar tipo de obligaciones")("severity",e.SeverityButtonActionEnum.ADD)}}function xn(t,i){if(t&1&&(l(0,"th",7),u(1),s()),t&2){let e=i.$implicit;m("pSortableColumn",e.field),a(),T(" ",e.header," ")}}function In(t,i){if(t&1&&(l(0,"tr")(1,"th"),u(2),s(),S(3,xn,2,2,"th",7,Fn),l(5,"th",8),u(6),s()()),t&2){let e=i.$implicit,r=p(3);a(2),T(" ",r.TableEnum.ACTIONS," "),a(),A(e),a(3),T(" ",r.TableEnum.ACTIONS," ")}}function Tn(t,i){if(t&1){let e=F();l(0,"input",12),w("ngModelChange",function(n){let o=c(e).$implicit;return V(o.description,n)||(o.description=n),_(n)}),s()}if(t&2){let e=i.$implicit;D("ngModel",e.description)}}function Sn(t,i){if(t&1){let e=F();l(0,"p-button",13),b("click",function(){let n=c(e).$index,o=p().rowIndex,x=p(3);return _(x.deleteObligationDetail(o,n))}),s(),d(1,"br")}if(t&2){let e=p(4);m("icon",e.IconButtonActionEnum.REMOVE)("severity",e.SeverityButtonActionEnum.DELETE)("text",!0)("pTooltip",e.LabelButtonActionEnum.DELETE)}}function An(t,i){if(t&1){let e=F();l(0,"tr")(1,"td")(2,"p-button",9),b("click",function(){let n=c(e).rowIndex,o=p(3);return _(o.deleteObligation(n))}),s()(),l(3,"td"),u(4),s(),l(5,"td"),u(6),s(),l(7,"td"),S(8,Tn,1,1,"input",10,J),s(),l(10,"td"),S(11,Sn,2,4,null,null,J),s(),l(13,"td")(14,"p-button",11),b("click",function(){let n=c(e).rowIndex,o=p(3);return _(o.showObligationDetailModal(n))}),s()()()}if(t&2){let e=i.$implicit,r=p(3);a(2),m("icon",r.IconButtonActionEnum.DELETE)("severity",r.SeverityButtonActionEnum.DELETE)("pTooltip",r.LabelButtonActionEnum.DELETE),a(2),v(e.institutionName),a(2),v(e.type==null?null:e.type.name),a(2),A(e.obligationDetails),a(3),A(e.obligationDetails),a(3),m("icon",r.PrimeIcons.PLUS_CIRCLE)("severity",r.SeverityButtonActionEnum.ADD)("text",!0)("pTooltip","2. Agregar obligaciones")}}function Dn(t,i){if(t&1&&(l(0,"p-table",5),f(1,In,7,2,"ng-template",0)(2,An,15,9,"ng-template",6),s()),t&2){let e=p(2);m("value",e.formInput.obligations)("columns",e.columns)}}function Vn(t,i){if(t&1&&f(0,Dn,3,2,"p-table",5),t&2){let e=p();C(0,e.formInput.obligations.length>0?0:-1)}}function wn(t,i){if(t&1&&(l(0,"div",24)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Nn(t,i){if(t&1&&(l(0,"div",24)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function On(t,i){if(t&1&&(l(0,"div",24)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Bn(t,i){if(t&1&&(l(0,"div",24)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Mn(t,i){if(t&1&&(l(0,"p-dropdown",26),f(1,On,3,1,"ng-template",18)(2,Bn,3,1,"ng-template",19),s()),t&2){let e=p(3);m("options",e.formInput.externalInstitutions)}}function Ln(t,i){if(t&1&&d(0,"p-multiSelect",27),t&2){let e=p(3);m("options",e.institutions)}}function kn(t,i){if(t&1&&(l(0,"div",15),d(1,"label",25),f(2,Mn,3,1,"p-dropdown",26)(3,Ln,1,1,"p-multiSelect",27),d(4,"small",20),s()),t&2){let e=p(2);a(),m("label",e.ObligationForEnum.institutionName)("required",e.obligationInstitutionNameField),a(),C(2,e.obligationTypeField.value.code===e.CatalogueObligationsTypeEnum.EXTERNAL?2:-1),a(),C(3,e.obligationTypeField.value.code===e.CatalogueObligationsTypeEnum.JOIN?3:-1),a(),m("errors",e.obligationInstitutionNameField.errors)("touched",e.obligationInstitutionNameField.touched)("dirty",e.obligationInstitutionNameField.dirty)}}function Pn(t,i){if(t&1&&(l(0,"form",14)(1,"div",15),d(2,"label",16),l(3,"p-dropdown",17),f(4,wn,3,1,"ng-template",18)(5,Nn,3,1,"ng-template",19),s(),d(6,"small",20),s(),f(7,kn,5,7,"div",15),l(8,"div",15)(9,"form",21),d(10,"label",22)(11,"textarea",23)(12,"small",20),s()()()),t&2){let e=p();m("formGroup",e.obligationForm),a(2),m("label",e.ObligationForEnum.type)("required",e.obligationTypeField),a(),m("options",e.obligationTypes),a(3),m("errors",e.obligationTypeField.errors)("touched",e.obligationTypeField.touched)("dirty",e.obligationTypeField.dirty),a(),C(7,e.obligationTypeField.value&&(e.obligationTypeField.value.code===e.CatalogueObligationsTypeEnum.EXTERNAL||e.obligationTypeField.value.code===e.CatalogueObligationsTypeEnum.JOIN)?7:-1),a(2),m("formGroup",e.obligationDetailForm),a(),m("label",e.ObligationDetailForEnum.description)("required",e.obligationDetailDescriptionField),a(2),m("errors",e.obligationDetailDescriptionField.errors)("touched",e.obligationDetailDescriptionField.touched)("dirty",e.obligationDetailDescriptionField.dirty)}}function qn(t,i){if(t&1){let e=F();l(0,"p-button",28),b("click",function(){c(e);let n=p();return _(n.isVisibleObligationForm=!1)}),s(),l(1,"p-button",29),b("click",function(){c(e);let n=p();return _(n.addObligation())}),s()}if(t&2){let e=p();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),a(),m("icon",e.IconButtonActionEnum.ADD)("label",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}function Un(t,i){if(t&1&&(l(0,"form",14)(1,"div",15),d(2,"label",30)(3,"textarea",31)(4,"small",20),s()()),t&2){let e=p();m("formGroup",e.obligationDetailForm),a(2),m("label",e.ObligationDetailForEnum.description)("required",e.obligationDetailDescriptionField),a(2),m("errors",e.obligationDetailDescriptionField.errors)("touched",e.obligationDetailDescriptionField.touched)("dirty",e.obligationDetailDescriptionField.dirty)}}function Hn(t,i){if(t&1){let e=F();l(0,"p-button",28),b("click",function(){c(e);let n=p();return _(n.isVisibleObligationDetailForm=!1)}),s(),l(1,"p-button",29),b("click",function(){c(e);let n=p();return _(n.addObligationDetail())}),s()}if(t&2){let e=p();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),a(),m("icon",e.IconButtonActionEnum.ADD)("label",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}var Xe=(()=>{let i=class i{constructor(){this.formBuilder=h(M),this.messageDialogService=h(B),this.formInput=Z(),this.formOutput=new I,this.formErrorsOutput=new I,this.cataloguesHttpService=h(k),this.coreService=h($),this.obligationTypes=[],this.institutions=[],this.SkeletonEnum=z,this.SeverityButtonActionEnum=j,this.PrimeIcons=Q,this.formErrors=[],this.IconButtonActionEnum=te,this.LabelButtonActionEnum=ee,this.CatalogueObligationsTypeEnum=Be,this.TableEnum=ie,this.isVisibleObligationForm=!1,this.isVisibleObligationDetailForm=!1,this.ObligationForEnum=ke,this.ObligationDetailForEnum=it,this.columns=[],this.index=-1,this.buildForm(),this.buildObligationForm(),this.buildObligationDetailForm(),this.buildColumns(),this.checkValueChanges()}ngOnInit(){this.loadObligationTypes(),this.loadInstitutions(),this.patchValueForm(),this.validateForm()}buildColumns(){this.columns=[{field:"type",header:ke.type},{field:"institutionName",header:ke.institutionResponsible},{field:"obligations",header:it.description}]}buildForm(){this.form=this.formBuilder.group({obligations:this.formBuilder.array([],g.required)})}buildObligationForm(){this.obligationForm=this.formBuilder.group({institutionName:[null,[g.required]],type:[null,[g.required]]})}buildObligationDetailForm(){this.obligationDetailForm=this.formBuilder.group({description:[null,[g.required]]})}patchValueForm(){this.form.patchValue(this.formInput)}checkValueChanges(){this.form.valueChanges.subscribe(r=>{this.formOutput.emit(this.formInput),this.validateForm()}),this.obligationTypeField.valueChanges.subscribe(r=>{this.obligationInstitutionNameField.reset(),r&&r.code===Be.INTERNAL&&this.formInput.internalInstitutions&&this.obligationInstitutionNameField.setValue(this.formInput.internalInstitutions[0].name)})}validateForm(){this.formErrors=[],this.formInput.obligations?.length===0&&this.formErrors.push("Obligaciones"),this.formErrorsOutput.emit(this.formErrors)}validateObligationForm(){return this.formErrors=[],this.obligationTypeField.invalid&&this.formErrors.push(this.ObligationForEnum.type),this.obligationInstitutionNameField.invalid&&this.formErrors.push(this.ObligationForEnum.institutionName),this.obligationDetailDescriptionField.invalid&&this.formErrors.push(this.ObligationDetailForEnum.description),this.formErrors.length===0}validateObligationDetailForm(){return this.formErrors=[],this.obligationDetailDescriptionField.invalid&&this.formErrors.push(this.ObligationDetailForEnum.description),this.formErrors.length===0}loadObligationTypes(){this.obligationTypes=this.cataloguesHttpService.findByType(N.OBLIGATIONS_TYPE)}loadInstitutions(){this.institutions=[];let r=[],n=[];this.formInput.internalInstitutions&&(r=this.formInput.internalInstitutions.map(o=>o.name)),this.formInput.externalInstitutions&&(n=this.formInput.externalInstitutions.map(o=>o.name)),this.institutions=r.concat(n)}addObligation(){if(this.validateObligationForm()){let r=this.obligationForm.value;if(Array.isArray(r.institutionName)&&r.institutionName.sort(),r.institutionName=r.institutionName.toString(),r.institutionName=r.institutionName.replace(",",", "),r.obligationDetails=[this.obligationDetailForm.value],this.obligationTypeField.value.code===Be.JOIN&&this.obligationInstitutionNameField.value.length<2){this.messageDialogService.errorCustom("M\xEDnimo requerido","Debe seleccionar al menos 2 (dos) Instituciones");return}if(this.formInput.obligations.findIndex(n=>n.institutionName===r.institutionName)>-1){this.messageDialogService.errorCustom("Duplicado","La instituci\xF3n seleccionada, ya cuenta con obligaciones registradas, por favor para agregar nuevas obligaciones, hacerlo a trav\xE9s del icono m\xE1s (+)");return}this.formInput.obligations.push(r),this.formInput.obligations.sort(),this.form.patchValue(this.formInput),this.obligationForm.reset(),this.obligationDetailForm.reset(),this.isVisibleObligationForm=!1}else this.obligationForm.markAllAsTouched(),this.obligationDetailForm.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors)}addObligationDetail(){this.validateObligationDetailForm()?(this.formInput.obligations&&(this.formInput.obligations[this.index].obligationDetails?this.formInput.obligations[this.index].obligationDetails?.push(this.obligationDetailForm.value):this.formInput.obligations[this.index].obligationDetails=[this.obligationDetailForm.value]),this.form.patchValue(this.formInput),this.obligationDetailForm.reset(),this.isVisibleObligationDetailForm=!1):(this.obligationDetailForm.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}deleteObligation(r){this.formInput.obligations?.splice(r,1),this.form.patchValue(this.formInput)}deleteObligationDetail(r,n){if(this.formInput.obligations[r].obligationDetails.length===1){this.messageDialogService.errorCustom("No se puede elminar","Debe haber al menos un campo");return}this.formInput.obligations[r].obligationDetails?.splice(n,1),this.formInput.obligations[r].obligationDetails.length===0&&this.formInput.obligations.splice(r,1),this.form.patchValue(this.formInput)}showObligationModal(){this.isVisibleObligationForm=!0}showObligationDetailModal(r){this.isVisibleObligationDetailForm=!0,this.index=r}get obligationInstitutionNameField(){return this.obligationForm.controls.institutionName}get obligationTypeField(){return this.obligationForm.controls.type}get obligationDetailDescriptionField(){return this.obligationDetailForm.controls.description}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=O({type:i,selectors:[["app-obligation"]],inputs:{formInput:"formInput"},outputs:{formOutput:"formOutput",formErrorsOutput:"formErrorsOutput"},decls:9,vars:7,consts:[["pTemplate","header"],["pTemplate","content"],["header","Agregar",3,"visibleChange","visible","modal"],["pTemplate","footer"],[1,"ml-2",3,"click","icon","pTooltip","severity"],["styleClass","p-datatable-striped",3,"value","columns"],["pTemplate","body"],[3,"pSortableColumn"],["colspan","2"],[3,"click","icon","severity","pTooltip"],["pInputText","",3,"ngModel"],[3,"click","icon","severity","text","pTooltip"],["pInputText","",3,"ngModelChange","ngModel"],["size","small",3,"click","icon","severity","text","pTooltip"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","type",3,"label","required"],["id","type","formControlName","type","dataKey","id","placeholder","Seleccione",3,"options"],["pTemplate","selectedItem"],["pTemplate","item"],["appErrorMessage","",3,"errors","touched","dirty"],[3,"formGroup"],["appLabel","","for","description",3,"label","required"],["pInputTextarea","","id","description","formControlName","description"],[1,"flex","align-items-center","gap-2"],["appLabel","","for","institutionName",3,"label","required"],["id","institutionName","formControlName","institutionName","optionValue","name","placeholder","Seleccione",3,"options"],["formControlName","institutionName","placeholder","Seleccione","appendTo","body",3,"options"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"],["appLabel","","for","descriptionEdit",3,"label","required"],["pInputTextarea","","id","descriptionEdit","formControlName","description"]],template:function(n,o){n&1&&(l(0,"p-panel"),f(1,yn,3,4,"ng-template",0)(2,Vn,1,1,"ng-template",1),s(),l(3,"p-dialog",2),w("visibleChange",function(E){return V(o.isVisibleObligationForm,E)||(o.isVisibleObligationForm=E),E}),f(4,Pn,13,14,"ng-template",1)(5,qn,2,7,"ng-template",3),s(),l(6,"p-dialog",2),w("visibleChange",function(E){return V(o.isVisibleObligationDetailForm,E)||(o.isVisibleObligationDetailForm=E),E}),f(7,Un,5,6,"ng-template",1)(8,Hn,2,7,"ng-template",3),s()),n&2&&(a(3),D("visible",o.isVisibleObligationForm),m("modal",!0),a(3),ue(ce(6,Cn)),D("visible",o.isVisibleObligationDetailForm),m("modal",!0))},dependencies:[q,Y,R,P,U,W,Fe,H,G,oe,L,re,X,le,ae,Ce,Xt,se,me,he]});let t=i;return t})();var Rn=(t,i)=>i.field;function Wn(t,i){if(t&1){let e=F();l(0,"p-button",9),b("click",function(){c(e);let n=p(3);return _(n.showFinancingModal())}),s()}if(t&2){let e=p(3);m("icon",e.IconButtonActionEnum.ADD)("pTooltip",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}function $n(t,i){if(t&1&&(l(0,"h4"),u(1),s(),f(2,Wn,1,3,"p-button",8)),t&2){let e=p(2);a(),T("",e.FinancingsFormEnum.header,":"),a(),C(2,e.isFinancingField.value?2:-1)}}function jn(t,i){if(t&1&&(l(0,"th",12),u(1),s()),t&2){let e=i.$implicit;m("pSortableColumn",e.field),a(),T(" ",e.header," ")}}function zn(t,i){if(t&1&&(l(0,"tr"),S(1,jn,2,2,"th",12,Rn),l(3,"th",13),u(4),s()()),t&2){let e=i.$implicit,r=p(4);a(),A(e),a(3),T(" ",r.TableEnum.ACTIONS," ")}}function Kn(t,i){if(t&1&&(l(0,"div",20)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e)}}function Yn(t,i){if(t&1&&(l(0,"div",20)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e)}}function Xn(t,i){if(t&1){let e=F();l(0,"tr")(1,"td")(2,"p-dropdown",14),w("ngModelChange",function(n){let o=c(e).$implicit;return V(o.institutionName,n)||(o.institutionName=n),_(n)}),b("onChange",function(){c(e);let n=p(4);return _(n.formOutput.emit(n.formInput))}),f(3,Kn,3,1,"ng-template",15)(4,Yn,3,1,"ng-template",16),s()(),l(5,"td")(6,"p-inputNumber",17),w("ngModelChange",function(n){let o=c(e).$implicit;return V(o.budget,n)||(o.budget=n),_(n)}),s()(),l(7,"td")(8,"input",18),w("ngModelChange",function(n){let o=c(e).$implicit;return V(o.paymentMethod,n)||(o.paymentMethod=n),_(n)}),s()(),l(9,"td")(10,"input",18),w("ngModelChange",function(n){let o=c(e).$implicit;return V(o.source,n)||(o.source=n),_(n)}),s()(),l(11,"td")(12,"p-button",19),b("click",function(){let n=c(e).rowIndex,o=p(4);return _(o.deleteFinancing(n))}),s()()()}if(t&2){let e=i.$implicit,r=p(4);a(2),D("ngModel",e.institutionName),m("options",r.combinedInstitutions),a(4),D("ngModel",e.budget),m("minFractionDigits",2)("maxFractionDigits",2),a(2),D("ngModel",e.paymentMethod),a(2),D("ngModel",e.source),a(2),m("icon",r.IconButtonActionEnum.DELETE)("severity",r.SeverityButtonActionEnum.DELETE)("pTooltip",r.LabelButtonActionEnum.DELETE)}}function Jn(t,i){if(t&1&&(l(0,"p-table",10),f(1,zn,5,1,"ng-template",5)(2,Xn,13,10,"ng-template",11),s()),t&2){let e=p(3);m("value",e.formInput.financings)("columns",e.financingsColumns)}}function Qn(t,i){if(t&1&&f(0,Jn,3,2,"p-table",10),t&2){let e=p(2);C(0,e.isFinancingField.value&&e.formInput.financings.length>0?0:-1)}}function Zn(t,i){t&1&&(l(0,"p-panel"),f(1,$n,3,2,"ng-template",5)(2,Qn,1,1,"ng-template",6),s())}function eo(t,i){t&1&&(l(0,"h3"),u(1,"Agregar "),d(2,"app-form-help-field",21),s())}function to(t,i){if(t&1&&(l(0,"div",20)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e)}}function io(t,i){if(t&1&&(l(0,"div",20)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e)}}function no(t,i){if(t&1&&(l(0,"form",22)(1,"div",1),d(2,"label",23),l(3,"p-dropdown",24),f(4,to,3,1,"ng-template",15)(5,io,3,1,"ng-template",16),s(),d(6,"small",25),s(),l(7,"div",1),d(8,"label",26)(9,"p-inputNumber",27)(10,"small",25),s(),l(11,"div",1),d(12,"label",28)(13,"input",29)(14,"small",25),s(),l(15,"div",1),d(16,"label",30)(17,"input",31)(18,"small",25),s()()),t&2){let e=p();m("formGroup",e.financingForm),a(2),m("label",e.FinancingsFormEnum.institutionName)("required",e.institutionNameField),a(),m("options",e.combinedInstitutions),a(3),m("errors",e.institutionNameField.errors)("touched",e.institutionNameField.touched)("dirty",e.institutionNameField.dirty),a(2),m("label",e.FinancingsFormEnum.budget)("required",e.budgetField),a(),m("minFractionDigits",2)("maxFractionDigits",2),a(),m("errors",e.budgetField.errors)("touched",e.budgetField.touched)("dirty",e.budgetField.dirty),a(2),m("label",e.FinancingsFormEnum.paymentMethod)("required",e.paymentMethodField),a(2),m("errors",e.paymentMethodField.errors)("touched",e.paymentMethodField.touched)("dirty",e.paymentMethodField.dirty),a(2),m("label",e.FinancingsFormEnum.source)("required",e.sourceField),a(2),m("errors",e.sourceField.errors)("touched",e.sourceField.touched)("dirty",e.sourceField.dirty)}}function oo(t,i){if(t&1){let e=F();l(0,"p-button",32),b("click",function(){c(e);let n=p();return _(n.isVisibleFinancingForm=!1)}),s(),l(1,"p-button",33),b("click",function(){c(e);let n=p();return _(n.addFinancing())}),s()}if(t&2){let e=p();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),a(),m("label",e.LabelButtonActionEnum.ADD)("icon",e.IconButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}var ci=(()=>{let i=class i{constructor(){this.authService=h(fe),this.cataloguesHttpService=h(k),this.coreService=h($),this.formBuilder=h(M),this.messageDialogService=h(B),this.messageService=h(mt),this.financingsColumns=[],this.formInput=Z(),this.formOutput=new I,this.formErrorsOutput=new I,this.formErrors=[],this.combinedInstitutions=[],this.AgreementFormEnum=y,this.SeverityButtonActionEnum=j,this.IconButtonActionEnum=te,this.LabelButtonActionEnum=ee,this.FinancingsFormEnum=ne,this.SkeletonEnum=z,this.TableEnum=ie,this.isVisibleFinancingForm=!1,this.buildForm(),this.buildFinancingForm(),this.buildFinancingsColumns(),this.checkValueChanges()}ngOnInit(){this.loadCombineInstitutions(),this.patchValueForm(),this.validateForm()}patchValueForm(){this.form.patchValue(this.formInput),this.formInput.financings.length>0&&this.isFinancingField.disable()}buildForm(){this.form=this.formBuilder.group({isFinancing:[null,[g.required]],financings:this.formBuilder.array([],g.required)})}buildFinancingForm(){this.financingForm=this.formBuilder.group({institutionName:[null,[g.required]],budget:[null,[g.required,g.pattern(/^\d+(\.\d{2,2})?$/)]],paymentMethod:[null,[g.required,g.pattern(Se())]],source:[null,[g.required,g.pattern(Se())]]})}buildFinancingsColumns(){this.financingsColumns=[{field:"institutionName",header:ne.institutionName},{field:"budget",header:ne.budget},{field:"paymentMethod",header:ne.paymentMethod},{field:"source",header:ne.source}]}addFinancing(){if(this.validateFinancingForm()){if(this.formInput.financings.findIndex(r=>r.institutionName===this.financingForm.value.institutionName)>-1){this.messageDialogService.errorCustom("La entidad ya est\xE1 registrada","Intente con otra por favor");return}this.formInput.financings.push(this.financingForm.value),this.form.patchValue(this.formInput),this.financingForm.reset(),this.isVisibleFinancingForm=!1}else this.financingForm.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors)}deleteFinancing(r){this.formInput.financings.splice(r,1),this.form.patchValue(this.formInput)}loadCombineInstitutions(){this.combinedInstitutions=[];let r=[],n=[];this.formInput.internalInstitutions&&(r=this.formInput.internalInstitutions.map(o=>o.name)),this.formInput.externalInstitutions&&(n=this.formInput.externalInstitutions.map(o=>o.name)),this.combinedInstitutions=r.concat(n)}validateForm(){this.formErrors=[],this.isFinancingField.value&&this.formInput.financings&&this.formInput.financings.length===0&&this.formErrors.push("Financiamientos"),this.formErrorsOutput.emit(this.formErrors)}validateFinancingForm(){return this.formErrors=[],this.institutionNameField.invalid&&this.formErrors.push(ne.institutionName),this.budgetField.invalid&&this.formErrors.push(ne.budget),this.paymentMethodField.invalid&&this.formErrors.push(ne.paymentMethod),this.sourceField.invalid&&this.formErrors.push(ne.source),this.formErrors.length===0}checkValueChanges(){this.form.valueChanges.subscribe(r=>{this.formOutput.emit(this.formInput),this.validateForm()}),this.isFinancingField.valueChanges.subscribe(r=>{this.formInput.isFinancing=r,r?(this.institutionNameField.setValidators(g.required),this.budgetField.setValidators(g.required),this.paymentMethodField.setValidators(g.required),this.sourceField.setValidators(g.required)):(this.institutionNameField.clearValidators(),this.budgetField.clearValidators(),this.paymentMethodField.clearValidators(),this.sourceField.clearValidators()),this.financingForm.reset(),this.institutionNameField.updateValueAndValidity(),this.budgetField.updateValueAndValidity(),this.paymentMethodField.updateValueAndValidity(),this.sourceField.updateValueAndValidity()})}showFinancingModal(){this.isVisibleFinancingForm=!0}get isFinancingField(){return this.form.controls.isFinancing}get institutionNameField(){return this.financingForm.controls.institutionName}get budgetField(){return this.financingForm.controls.budget}get paymentMethodField(){return this.financingForm.controls.paymentMethod}get sourceField(){return this.financingForm.controls.source}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=O({type:i,selectors:[["app-financing"]],inputs:{formInput:"formInput"},outputs:{formOutput:"formOutput",formErrorsOutput:"formErrorsOutput"},decls:9,vars:7,consts:[[1,"p-fluid","grid","text-center",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","isFinancing",3,"label","required"],["id","isFinancing","formControlName","isFinancing",1,"ml-2",3,"disabled"],[3,"visibleChange","visible","modal"],["pTemplate","header"],["pTemplate","content"],["pTemplate","footer"],[1,"ml-2",3,"icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","pTooltip","severity"],["styleClass","p-datatable-striped",3,"value","columns"],["pTemplate","body"],[3,"pSortableColumn"],[1,"text-center"],["id","institutionName","placeholder","Selecione","appendTo","body",3,"ngModelChange","onChange","ngModel","options"],["pTemplate","selectedItem"],["pTemplate","item"],["mode","decimal",3,"ngModelChange","ngModel","minFractionDigits","maxFractionDigits"],["pInputText","",3,"ngModelChange","ngModel"],[3,"click","icon","severity","pTooltip"],[1,"flex","align-items-center","gap-2"],["content","Llenar campos conforme se\xF1ala convenio."],[1,"p-fluid","grid",3,"formGroup"],["appLabel","","for","combinedInstitution",3,"label","required"],["id","combinedInstitution","formControlName","institutionName","placeholder","Selecione","appendTo","body",3,"options"],["appErrorMessage","",3,"errors","touched","dirty"],["appLabel","","for","budget",3,"label","required"],["id","budget","formControlName","budget","mode","decimal",3,"minFractionDigits","maxFractionDigits"],["appLabel","","for","paymentMethod",3,"label","required"],["pInputText","","id","paymentMethod","formControlName","paymentMethod"],["appLabel","","for","source",3,"label","required"],["pInputText","","id","source","formControlName","source"],[3,"click","label","icon","text","severity"],[3,"click","label","icon","severity"]],template:function(n,o){n&1&&(l(0,"form",0)(1,"div",1),d(2,"label",2)(3,"app-input-switch",3),s()(),f(4,Zn,3,0,"p-panel"),l(5,"p-dialog",4),w("visibleChange",function(E){return V(o.isVisibleFinancingForm,E)||(o.isVisibleFinancingForm=E),E}),f(6,eo,3,0,"ng-template",5)(7,no,19,24,"ng-template",6)(8,oo,2,7,"ng-template",7),s()),n&2&&(m("formGroup",o.form),a(2),m("label",o.AgreementFormEnum.isFinancing)("required",o.isFinancingField),a(),m("disabled",o.isFinancingField.disabled),a(),C(4,o.isFinancingField.value?4:-1),a(),D("visible",o.isVisibleFinancingForm),m("modal",!0))},dependencies:[q,Y,R,P,U,W,Fe,H,G,oe,L,pe,ye,re,X,le,ae,Ue,se,me,he]});let t=i;return t})();var so=(t,i)=>i.id,mo=(t,i)=>i.field;function po(t,i){if(t&1&&(d(0,"i"),l(1,"div",11),u(2),s()),t&2){let e=p().$implicit,r=p();we(r.PrimeIcons.FILE_PDF),a(2),T(" ",e.name," ")}}function uo(t,i){if(t&1){let e=F();l(0,"div",3),d(1,"label",4),l(2,"p-messages",5),f(3,po,3,3,"ng-template",6),s()(),l(4,"div",7),d(5,"label",8)(6,"p-divider"),l(7,"p-fileUpload",9,0),b("uploadHandler",function(n){let o=c(e).$implicit,x=Ne(8),E=p();return _(E.uploadFile(n,x,o))}),s(),d(9,"small",10),s()}if(t&2){let e=p();a(),m("label",e.FileFormEnum.type)("required",e.typeField),a(4),m("label",e.FileFormEnum.myFile)("required",e.fileField),a(2),m("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),a(2),m("errors",e.fileField.errors)("touched",e.fileField.touched)("dirty",e.fileField.dirty)}}function co(t,i){if(t&1&&(l(0,"th",14),u(1),s()),t&2){let e=i.$implicit;m("pSortableColumn",e.field),a(),T(" ",e.header," ")}}function _o(t,i){if(t&1&&(l(0,"tr"),S(1,co,2,2,"th",14,mo),l(3,"th"),u(4),s()()),t&2){let e=i.$implicit,r=p(2);a(),A(e),a(3),v(r.TableEnum.ACTIONS)}}function fo(t,i){if(t&1){let e=F();l(0,"tr")(1,"td"),u(2),s(),l(3,"td"),u(4),s(),l(5,"td")(6,"p-button",15),b("click",function(){let n=c(e),o=n.$implicit,x=n.rowIndex,E=p(2);return _(E.removeFile(x,o))}),s(),l(7,"p-button",16),b("click",function(){let n=c(e).$implicit,o=p(2);return _(o.download(n))}),s()()()}if(t&2){let e=i.$implicit,r=p(2);a(2),v(e.type.name),a(2),v(e.name),a(2),m("icon",r.IconButtonActionEnum.DELETE)("pTooltip",r.LabelButtonActionEnum.DELETE)("severity",r.SeverityButtonActionEnum.DELETE),a(),m("icon",r.IconButtonActionEnum.DOWNLOAD)("pTooltip",r.LabelButtonActionEnum.DOWNLOAD)("severity",r.SeverityButtonActionEnum.DOWNLOAD)}}function ho(t,i){if(t&1&&(l(0,"p-table",2),f(1,_o,5,1,"ng-template",12)(2,fo,8,8,"ng-template",13),s()),t&2){let e=p();m("value",e.formInput.enablingDocuments)("columns",e.columns)}}var _i=(()=>{let i=class i{constructor(){this.formInput=Z(),this.formOutput=new I,this.formErrorsOutput=new I,this.cataloguesHttpService=h(k),this.messageDialogService=h(B),this.filesHttpService=h(ct),this.agreementsHttpService=h(_e),this.confirmationService=h(Oe),this.formBuilder=h(M),this.formErrors=[],this.LabelButtonActionEnum=ee,this.IconButtonActionEnum=te,this.FileFormEnum=Le,this.TableEnum=ie,this.SeverityButtonActionEnum=j,this.PrimeIcons=Q,this.types=[],this.typesClone=[],this.columns=[],this.FileEnum=Me,this.buildForm(),this.buildFileForm(),this.buildColumns()}ngOnInit(){this.loadTypes(),this.patchValueForm(),this.validateForm()}patchValueForm(){this.form.patchValue(this.formInput)}buildForm(){this.form=this.formBuilder.group({files:this.formBuilder.array([],g.required)}),this.checkValuesChange()}buildFileForm(){this.fileForm=this.formBuilder.group({type:[null,g.required],myFile:[null,g.required]}),this.checkValuesChange()}checkValuesChange(){this.form.valueChanges.subscribe(r=>{this.formOutput.emit(this.formInput),this.validateForm()})}buildColumns(){this.columns=[{field:"type",header:Le.type},{field:"name",header:Le.name}]}loadTypes(){this.types=this.cataloguesHttpService.findByType(N.AGREEMENTS_ENABLING_DOCUMENT),this.typesClone=this.cataloguesHttpService.findByType(N.AGREEMENTS_ENABLING_DOCUMENT);for(let r=0;r<this.formInput.enablingDocuments.length;r++){let n=this.types.findIndex(o=>o.id===this.formInput.enablingDocuments[r].type?.id);this.types.splice(n,1)}}validateForm(){this.formErrors=[],this.formInput.enablingDocuments.length<2&&this.formErrors.push(`Debe cargar los ${this.types.length} tipos de archivos`),this.formErrorsOutput.emit(this.formErrors)}validateFileForm(r,n){return this.formErrors=[],this.formInput.enablingDocuments.findIndex(o=>o.type?.id===n.id)>-1&&this.formErrors.push(`${n.name} ya se encuentra cargado`),this.formInput.enablingDocuments.findIndex(o=>o.name===r.name)>-1&&this.formErrors.push(`El archivo ${r.name} ya se encuentra cargado`),this.formErrors.length===0}uploadFile(r,n,o){let x=r.files[0];if(this.validateFileForm(x,o)){let E=new FormData;E.append("file",x),E.append("typeId",o.id),this.agreementsHttpService.uploadEnablingDocument(this.formInput.id,E,!0).subscribe(vi=>{this.formInput.enablingDocuments.push({id:vi.id,name:x.name,type:o});let Ei=this.types.findIndex(Fi=>Fi.id===o.id);this.types.splice(Ei,1),this.form.patchValue(this.formInput)})}else this.messageDialogService.fieldErrors(this.formErrors),this.form.markAllAsTouched();n.clear()}removeFile(r,n){this.confirmationService.confirm({key:"confirmDialog",message:"\xBFEst\xE1 seguro de eliminar de manera definitiva el archivo?",header:"",icon:Q.TRASH,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.filesHttpService.remove(n.id,!0,this.formInput.id).subscribe(o=>{this.formInput.enablingDocuments.splice(r,1),this.types.push(n.type),this.form.patchValue(this.formInput.enablingDocuments)})}})}download(r){this.filesHttpService.downloadFile(r)}get typeField(){return this.fileForm.controls.type}get fileField(){return this.fileForm.controls.myFile}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=O({type:i,selectors:[["app-document"]],inputs:{formInput:"formInput"},outputs:{formOutput:"formOutput",formErrorsOutput:"formErrorsOutput"},decls:4,vars:2,consts:[["uploadFiles",""],[1,"p-fluid","grid",3,"formGroup"],["styleClass","p-datatable-striped",3,"value","columns"],[1,"field","col-12","xl:col-4","lg:col-4","md:col-4","sm:col-12"],["appLabel","",3,"label","required"],["severity","info"],["pTemplate",""],[1,"field","col-12","xl:col-2","lg:col-2","md:col-2","sm:col-12"],["appLabel","","for","file",3,"label","required"],["id","file","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appErrorMessage","",3,"errors","touched","dirty"],[1,"ml-2"],["pTemplate","header"],["pTemplate","body"],[3,"pSortableColumn"],[3,"click","icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","pTooltip","severity"]],template:function(n,o){n&1&&(l(0,"form",1),S(1,uo,10,12,null,null,so),s(),f(3,ho,3,2,"p-table",2)),n&2&&(m("formGroup",o.fileForm),a(),A(o.types),a(2),C(3,o.formInput.enablingDocuments.length>0?3:-1))},dependencies:[q,P,U,H,G,oe,L,re,qe,Ge,He,se,me]});let t=i;return t})();function bo(t,i){if(t&1&&(l(0,"div",14)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function vo(t,i){if(t&1&&(l(0,"div",14)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Eo(t,i){if(t&1&&(l(0,"div",14)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Fo(t,i){if(t&1&&(l(0,"div",14)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),v(e.name)}}function Co(t,i){if(t&1&&(l(0,"div",14)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),Je("",e.name," ",e.lastname," (",e.email,")")}}function yo(t,i){if(t&1&&(l(0,"div",14)(1,"div"),u(2),s()()),t&2){let e=i.$implicit;a(2),Je("",e.name," ",e.lastname," (",e.email,")")}}var fi=(()=>{let i=class i{constructor(){this.coreService=h($),this.cataloguesHttpService=h(k),this.formBuilder=h(M),this.messageDialogService=h(B),this.usersHttpService=h(ii),this.formOutput=new I,this.formErrorsOutput=new I,this.formErrors=[],this.Validators=g,this.units=[],this.positions=[],this.users=[],this.SkeletonEnum=z,this.AgreementFormEnum=y,this.AdministratorFormEnum=Ie,this.buildForm()}ngOnInit(){this.loadUnits(),this.loadUsers(),this.patchValueForm(),this.validateForm()}buildForm(){this.form=this.formBuilder.group({administrator:this.administratorForm}),this.checkValueChanges()}patchValueForm(){this.form.patchValue(this.formInput)}checkValueChanges(){this.form.valueChanges.subscribe(r=>{this.formOutput.emit(r),this.validateForm()}),this.unitField.valueChanges.subscribe(()=>{this.loadPositions()})}get administratorForm(){return this.formBuilder.group({id:[null],unit:[null,g.required],position:[null,g.required],user:[null,g.required]})}validateForm(){this.formErrors=[],this.unitField.invalid&&this.formErrors.push(Ie.unit),this.positionField.invalid&&this.formErrors.push(Ie.position),this.userField.invalid&&this.formErrors.push(Ie.user),this.formErrorsOutput.emit(this.formErrors)}loadPositions(){this.positionField.setValue(null),this.positions=this.cataloguesHttpService.findByParent(this.unitField.value.id)}loadUnits(){this.units=this.cataloguesHttpService.findByType(N.ADMINISTRATORS_UNIT)}loadUsers(){this.usersHttpService.findAllUsersLDAP().subscribe(r=>{this.users=r})}get administratorFormField(){return this.form.controls.administrator}get unitField(){return this.administratorFormField.controls.unit}get positionField(){return this.administratorFormField.controls.position}get userField(){return this.administratorFormField.controls.user}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=O({type:i,selectors:[["app-agreement-administrator"]],inputs:{formInput:"formInput"},outputs:{formOutput:"formOutput",formErrorsOutput:"formErrorsOutput"},decls:21,vars:22,consts:[[1,"p-fluid","grid",3,"formGroup"],["formGroupName","administrator",1,"col-12"],[1,"grid"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","unit",3,"label","required"],["id","unit","formControlName","unit","dataKey","id","placeholder","Seleccione","filterBy","name","appendTo","body",3,"options","filter"],["pTemplate","selectedItem"],["pTemplate","item"],["appErrorMessage","",3,"errors","touched","dirty"],["appLabel","","for","position",3,"label","required"],["id","position","formControlName","position","dataKey","id","filterBy","name","placeholder","Seleccione","appendTo","body",3,"options","filter"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","user",3,"label","required"],["id","user","formControlName","user","dataKey","email","placeholder","Seleccione","filterBy","email,lastname,name","appendTo","body",3,"options","filter"],[1,"flex","align-items-center","gap-2"]],template:function(n,o){n&1&&(l(0,"form",0)(1,"div",1)(2,"div",2)(3,"div",3),d(4,"label",4),l(5,"p-dropdown",5),f(6,bo,3,1,"ng-template",6)(7,vo,3,1,"ng-template",7),s(),d(8,"small",8),s(),l(9,"div",3),d(10,"label",9),l(11,"p-dropdown",10),f(12,Eo,3,1,"ng-template",6)(13,Fo,3,1,"ng-template",7),s(),d(14,"small",8),s(),l(15,"div",11),d(16,"label",12),l(17,"p-dropdown",13),f(18,Co,3,3,"ng-template",6)(19,yo,3,3,"ng-template",7),s(),d(20,"small",8),s()()()()),n&2&&(m("formGroup",o.form),a(4),m("label",o.AdministratorFormEnum.unit)("required",o.unitField),a(),m("options",o.units)("filter",!0),a(3),m("errors",o.unitField.errors)("touched",o.unitField.touched)("dirty",o.unitField.dirty),a(2),m("label",o.AdministratorFormEnum.position)("required",o.positionField),a(),m("options",o.positions)("filter",!0),a(3),m("errors",o.positionField.errors)("touched",o.positionField.touched)("dirty",o.positionField.dirty),a(2),m("label",o.AdministratorFormEnum.user)("required",o.userField),a(),m("options",o.users)("filter",!0),a(3),m("errors",o.userField.errors)("touched",o.userField.touched)("dirty",o.userField.dirty))},dependencies:[q,R,P,U,W,Pe,H,G,L,le]});let t=i;return t})();var Io=(t,i)=>i.field,To=()=>({width:"50rem"});function So(t,i){if(t&1&&(l(0,"p"),d(1,"p-tag",8),s()),t&2){let e=p();a(),m("severity",e.SeverityButtonActionEnum.DELETE)}}function Ao(t,i){if(t&1){let e=F();l(0,"p-button",11),b("click",function(){c(e);let n=p(3);return _(n.showAddendumModal())}),s()}if(t&2){let e=p(3);m("icon",e.IconButtonActionEnum.ADD)("pTooltip",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}function Do(t,i){if(t&1&&(l(0,"h4"),u(1),s(),f(2,Ao,1,3,"p-button",10)),t&2){let e=p(2);a(),T("",e.AddendumEnum.header,":"),a(),C(2,e.isAddendumField.value?2:-1)}}function Vo(t,i){if(t&1&&(l(0,"th",14),u(1),s()),t&2){let e=i.$implicit;m("pSortableColumn",e.field),a(),T(" ",e.header," ")}}function wo(t,i){if(t&1&&(l(0,"tr"),S(1,Vo,2,2,"th",14,Io),l(3,"th"),u(4),s()()),t&2){let e=i.$implicit,r=p(4);a(),A(e),a(3),v(r.TableEnum.ACTIONS)}}function No(t,i){if(t&1&&u(0),t&2){let e=i.$implicit;T(" ",e.name," ")}}function Oo(t,i){if(t&1){let e=F();l(0,"tr")(1,"td"),u(2),s(),l(3,"td"),S(4,No,1,1,null,null,J),s(),l(6,"td")(7,"p-button",15),b("click",function(){let n=c(e).$implicit,o=p(4);return _(o.deleteAddendum(n.id))}),s()()()}if(t&2){let e=i.$implicit,r=p(4);a(2),v(e.description),a(2),A(e.files),a(3),m("icon",r.IconButtonActionEnum.DELETE)("pTooltip",r.LabelButtonActionEnum.DELETE)("severity",r.SeverityButtonActionEnum.DELETE)}}function Bo(t,i){if(t&1&&(l(0,"p-table",12),f(1,wo,5,1,"ng-template",9)(2,Oo,8,4,"ng-template",13),s()),t&2){let e=p(3);m("value",e.formInput.addendums)("columns",e.columns)}}function Mo(t,i){if(t&1&&f(0,Bo,3,2,"p-table",12),t&2){let e=p(2);C(0,e.formInput.addendums.length>0?0:-1)}}function Lo(t,i){t&1&&(l(0,"p-panel"),f(1,Do,3,2,"ng-template",9)(2,Mo,1,1,"ng-template",6),s())}function ko(t,i){if(t&1&&(d(0,"i"),l(1,"div",25),u(2),s()),t&2){let e=p(3);we(e.PrimeIcons.FILE_PDF),a(2),v(e.fileField.value==null?null:e.fileField.value.name)}}function Po(t,i){t&1&&(l(0,"div",20)(1,"p-messages",23),f(2,ko,3,3,"ng-template",24),s()())}function qo(t,i){if(t&1){let e=F();l(0,"div",16)(1,"div",2),d(2,"label",17)(3,"input",18)(4,"small",19),s(),l(5,"div",20),d(6,"label",21),l(7,"p-fileUpload",22,0),b("uploadHandler",function(n){c(e);let o=Ne(8),x=p();return _(x.uploadAddendumFile(n,o))}),s(),d(9,"small",19),s(),f(10,Po,3,0,"div",20),s()}if(t&2){let e=p();m("formGroup",e.addendumForm),a(2),m("label",e.AddendumEnum.description)("required",e.descriptionField),a(2),m("errors",e.descriptionField.errors)("touched",e.descriptionField.touched)("dirty",e.descriptionField.dirty),a(2),m("label",e.AddendumEnum.file)("required",e.fileField),a(),m("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),a(2),m("errors",e.fileField.errors)("touched",e.fileField.touched)("dirty",e.fileField.dirty),a(),C(10,e.fileField.value?10:-1)}}function Uo(t,i){if(t&1){let e=F();l(0,"p-button",26),b("click",function(){c(e);let n=p();return _(n.isVisibleAddendumForm=!1)}),s(),l(1,"p-button",27),b("click",function(){c(e);let n=p();return _(n.onUpload())}),s()}if(t&2){let e=p();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),a(),m("icon",e.IconButtonActionEnum.ADD)("label",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}var hi=(()=>{let i=class i{constructor(){this.formInput=Z(),this.formOutput=new I,this.formErrorsOutput=new I,this.agreementsHttpService=h(_e),this.addendumsHttpService=h(_t),this.cataloguesHttpService=h(k),this.messageDialogService=h(B),this.formBuilder=h(M),this.formErrors=[],this.LabelButtonActionEnum=ee,this.IconButtonActionEnum=te,this.AddendumEnum=Te,this.AgreementFormEnum=y,this.TableEnum=ie,this.SeverityButtonActionEnum=j,this.PrimeIcons=Q,this.types=[],this.columns=[],this.isVisibleAddendumForm=!1,this.yesNo=[],this.FileEnum=Me,this.buildForm(),this.buildAddendumForm(),this.buildFileForm(),this.checkValuesChange(),this.buildColumns(),this.yesNo=[{label:"Si",value:!0},{label:"No",value:!1}]}ngOnInit(){this.loadTypes(),this.patchValueForm(),this.validateForm()}patchValueForm(){this.form.patchValue(this.formInput),this.formInput.addendums.length>0?this.isAddendumField.disable():this.isAddendumField.enable()}buildForm(){this.form=this.formBuilder.group({isAddendum:[!1],addendums:this.formBuilder.array([],g.required)})}buildAddendumForm(){this.addendumForm=this.formBuilder.group({description:[null],file:[null]})}buildFileForm(){this.fileForm=this.formBuilder.group({type:[null,g.required],myFile:[null,g.required]}),this.checkValuesChange()}checkValuesChange(){this.form.valueChanges.subscribe(r=>{this.formOutput.emit(this.formInput),this.validateForm()}),this.isAddendumField.valueChanges.subscribe(r=>{this.formInput.isAddendum=r,r?(this.descriptionField.setValidators(g.required),this.fileField.setValidators(g.required)):(this.descriptionField.clearValidators(),this.fileField.clearValidators()),this.descriptionField.updateValueAndValidity()})}buildColumns(){this.columns=[{field:"description",header:Te.description},{field:"file",header:Te.file}]}loadTypes(){this.types=this.cataloguesHttpService.findByType(N.AGREEMENTS_ADDENDUM_DOCUMENT)}validateForm(){this.formErrors=[],this.formErrorsOutput.emit(this.formErrors)}validateAddendumForm(){return this.formErrors=[],this.descriptionField.invalid&&this.formErrors.push(Te.description),this.formErrors.length===0}uploadAddendumFile(r,n){this.fileField.patchValue({file:r.files[0],name:r.files[0].name,type:this.types[0]}),n.clear()}onUpload(){if(this.validateAddendumForm()){let r=new FormData;r.append("file",this.fileField.value.file),r.append("typeId",this.fileField.value.type.id),r.append("description",this.descriptionField.value),this.agreementsHttpService.uploadAddendum(this.formInput.id,r,!0).subscribe(n=>{this.formInput.addendums.push({id:n.id,description:this.descriptionField.value,files:[{file:this.fileField.value.file,name:this.fileField.value.name}]}),this.form.patchValue(this.formInput),this.addendumForm.reset(),this.isVisibleAddendumForm=!1,this.formInput.addendums.length>0&&this.isAddendumField.disable()})}else this.messageDialogService.fieldErrors(this.formErrors),this.form.markAllAsTouched(),this.addendumForm.markAllAsTouched()}showAddendumModal(){this.isVisibleAddendumForm=!0}deleteAddendum(r){this.addendumsHttpService.remove(r,!0,this.formInput.id).subscribe(n=>{let o=this.formInput.addendums.findIndex(x=>x.id===r);this.formInput.addendums.splice(o,1),this.form.patchValue(this.formInput),this.formInput.addendums.length===0&&this.isAddendumField.enable()})}get isAddendumField(){return this.form.controls.isAddendum}get descriptionField(){return this.addendumForm.controls.description}get fileField(){return this.addendumForm.controls.file}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=O({type:i,selectors:[["app-addendum"]],inputs:{formInput:"formInput"},outputs:{formOutput:"formOutput",formErrorsOutput:"formErrorsOutput"},decls:11,vars:10,consts:[["uploadFiles",""],[1,"p-fluid","grid","text-center",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","isAddendum",3,"label","required"],["id","isAddendum","formControlName","isAddendum",1,"ml-2"],["header","Agregar",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["value","Debe eliminar todas las adendas antes de poder cambiar de opci\xF3n",1,"ml-2",3,"severity"],["pTemplate","header"],[1,"ml-2",3,"icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","pTooltip","severity"],["styleClass","p-datatable-striped",3,"value","columns"],["pTemplate","body"],[3,"pSortableColumn"],[3,"click","icon","pTooltip","severity"],[1,"p-fluid","grid",3,"formGroup"],["appLabel","","for","description",3,"label","required"],["pInputText","","type","text","id","description","formControlName","description"],["appErrorMessage","",3,"errors","touched","dirty"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","file",3,"label","required"],["id","file","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(n,o){n&1&&(l(0,"h3"),u(1,`La secci\xF3n que se muestra a continuaci\xF3n no es de car\xE1cter obligatorio, sin embargo, si se ha realizado una adenda o modificatorio al convenio, por favor complete los siguientes campos:
`),s(),l(2,"form",1)(3,"div",2),d(4,"label",3)(5,"app-input-switch",4),f(6,So,2,1,"p"),s()(),f(7,Lo,3,0,"p-panel"),l(8,"p-dialog",5),w("visibleChange",function(E){return V(o.isVisibleAddendumForm,E)||(o.isVisibleAddendumForm=E),E}),f(9,qo,11,17,"ng-template",6)(10,Uo,2,7,"ng-template",7),s()),n&2&&(a(2),m("formGroup",o.form),a(2),m("label",o.AgreementFormEnum.isAddendum)("required",o.isAddendumField),a(2),C(6,o.formInput.addendums.length>0?6:-1),a(),C(7,o.formInput.isAddendum?7:-1),a(),ue(ce(9,To)),D("visible",o.isVisibleAddendumForm),m("modal",!0))},dependencies:[q,Y,R,P,U,W,H,G,oe,L,ye,re,X,ae,Ge,He,se,me,he,Pt]});let t=i;return t})();function Go(t,i){t&1&&(l(0,"h3"),u(1,"Ficha de Convenio"),s())}function Ro(t,i){t&1&&(l(0,"h3"),u(1,"Administrador del Convenio"),s(),d(2,"app-form-help-field",17))}function Wo(t,i){if(t&1){let e=F();l(0,"app-agreement-administrator",18),b("formErrorsOutput",function(n){c(e);let o=p(3);return _(o.agreementAdministratorErrors=n)})("formOutput",function(n){c(e);let o=p(3);return _(o.save(n))}),s()}if(t&2){let e=p(3);m("formInput",e.form.value)}}function $o(t,i){t&1&&(l(0,"h3"),u(1,"Documentaci\xF3n"),s())}function jo(t,i){t&1&&(l(0,"h3"),u(1,"Registro de adendas o modificatorios"),s())}function zo(t,i){if(t&1){let e=F();l(0,"div",2)(1,"p-toolbar"),d(2,"div",3),l(3,"div",4)(4,"app-form-button-action",5),b("cancel",function(){c(e);let n=p(2);return _(n.redirectAgreementList())}),s()()(),l(5,"p-accordion")(6,"p-accordionTab")(7,"p-toolbar")(8,"div",3),d(9,"app-header-form",6),s(),l(10,"div",4)(11,"app-form-button-action",7),b("submit",function(){c(e);let n=p(2);return _(n.validateFormAgreement())})("cancel",function(){c(e);let n=p(2);return _(n.redirectAgreementList())}),s()()(),f(12,Go,2,0,"ng-template",8),l(13,"p-panel",9)(14,"app-basic-data",10),b("formErrorsOutput",function(n){c(e);let o=p(2);return _(o.basicDataErrors=n)})("formOutput",function(n){c(e);let o=p(2);return _(o.save(n))}),s()(),l(15,"p-panel",11)(16,"app-agreement-date",10),b("formErrorsOutput",function(n){c(e);let o=p(2);return _(o.agreementDateErrors=n)})("formOutput",function(n){c(e);let o=p(2);return _(o.save(n))}),s()(),l(17,"p-panel",12),f(18,Ro,3,0,"ng-template",8)(19,Wo,1,1,"ng-template",1),s(),l(20,"p-panel",13)(21,"app-appearer",10),b("formErrorsOutput",function(n){c(e);let o=p(2);return _(o.appearerErrors=n)})("formOutput",function(n){c(e);let o=p(2);return _(o.save(n))}),s()(),l(22,"p-panel",14)(23,"app-obligation",10),b("formErrorsOutput",function(n){c(e);let o=p(2);return _(o.obligationErrors=n)})("formOutput",function(n){c(e);let o=p(2);return _(o.save(n))}),s()(),l(24,"p-panel",15)(25,"app-financing",16),b("formOutput",function(n){c(e);let o=p(2);return _(o.save(n))})("formErrorsOutput",function(n){c(e);let o=p(2);return _(o.financingErrors=n)}),s()(),l(26,"p-toolbar")(27,"div",3),d(28,"app-header-form",6),s(),l(29,"div",4)(30,"app-form-button-action",7),b("submit",function(){c(e);let n=p(2);return _(n.validateFormAgreement())})("cancel",function(){c(e);let n=p(2);return _(n.redirectAgreementList())}),s()()()(),l(31,"p-accordionTab"),f(32,$o,2,0,"ng-template",8),l(33,"p-panel",12)(34,"app-document",16),b("formOutput",function(n){c(e);let o=p(2);return _(o.save(n))})("formErrorsOutput",function(n){c(e);let o=p(2);return _(o.documentErrors=n)}),s()()(),l(35,"p-accordionTab"),f(36,jo,2,0,"ng-template",8),l(37,"p-panel",12)(38,"app-addendum",16),b("formOutput",function(n){c(e);let o=p(2);return _(o.save(n))})("formErrorsOutput",function(n){c(e);let o=p(2);return _(o.documentErrors=n)}),s()()()()()}if(t&2){let e=p(2);a(4),m("isVisibleCancelButton",!0)("isVisibleSubmitButton",!1),a(5),m("icon",e.PrimeIcons.PENCIL),a(2),m("iconSubmitButton",e.PrimeIcons.SAVE)("isVisibleCancelButton",!1),a(3),m("formInput",e.form.value),a(2),m("formInput",e.form.value),a(5),m("formInput",e.form.value),a(2),m("formInput",e.form.value),a(2),m("formInput",e.form.value),a(3),m("icon",e.PrimeIcons.PENCIL),a(2),m("iconSubmitButton",e.PrimeIcons.SAVE)("isVisibleCancelButton",!1),a(4),m("formInput",e.form.value),a(4),m("formInput",e.form.value)}}function Ko(t,i){t&1&&(l(0,"p-panel"),f(1,zo,39,15,"ng-template",1),s())}var gi=(()=>{let i=class i{constructor(){this.authService=h(fe),this.agreementsService=h(dt),this.agreementsHttpService=h(_e),this.breadcrumbService=h(pt),this.confirmationService=h(Oe),this.formBuilder=h(M),this.messageDialogService=h(B),this.router=h(st),this.SeverityButtonActionEnum=j,this.PrimeIcons=Q,this.formErrors=[],this.basicDataErrors=[],this.agreementDateErrors=[],this.agreementAdministratorErrors=[],this.appearerErrors=[],this.obligationErrors=[],this.financingErrors=[],this.documentErrors=[],this.activeStep=0,this.breadcrumbService.setItems([{label:tt.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:tt.AGREEMENTS_UPDATE}]),this.buildForm()}ngOnInit(){this.agreementsService.agreementStorage&&(this.form.patchValue(this.agreementsService.agreementStorage),this.idField.value&&(this.activeStep=3),this.enablingDocumentsField.value.length==2&&this.enablingDocumentsField.value.every(r=>r.id)&&(this.activeStep=4))}buildForm(){this.form=this.formBuilder.group({id:[null],agreementState:[null],name:[null],internalNumber:[null],number:[null],origin:[null],type:[null],specialType:[null],internalInstitutions:[[]],externalInstitutions:[[]],subscribedAt:[new Date],startedAt:[new Date],isFinishDate:[!0],endedAt:[null],endedReason:[null],totalTerm:[null],yearTerm:[null],monthTerm:[null],dayTerm:[null],objective:[null],administrator:[null],obligations:[[]],isFinancing:[!1],financings:[[]],isAddendum:[!1],addendums:[[]],enablingDocuments:[[]],enabled:[!1]})}validateFormAgreement(){this.formErrors=[],this.formErrors=this.formErrors.concat(this.basicDataErrors),this.formErrors=this.formErrors.concat(this.agreementDateErrors),this.formErrors=this.formErrors.concat(this.agreementAdministratorErrors),this.formErrors=this.formErrors.concat(this.appearerErrors),this.formErrors.length===0?this.update():this.messageDialogService.fieldErrors(this.formErrors)}save(r){this.form.patchValue(r),this.agreementsService.agreement=this.form.value}update(){this.confirmationService.confirm({key:"confirmDialog",message:"",header:"\xBFEst\xE1 seguro de actualizar?",acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.agreementsHttpService.update(this.idField.value,this.agreementsService.agreement).subscribe(r=>{this.redirectAgreementList()})}})}redirectAgreementList(){this.authService.role.code===et.NATIONAL_SUPERVISOR&&this.router.navigate(["/core/national-supervisor/agreement-list"]),this.authService.role.code===et.INTERNATIONAL_SUPERVISOR&&this.router.navigate(["/core/international-supervisor/agreement-list"])}get idField(){return this.form.controls.id}get enablingDocumentsField(){return this.form.controls.enablingDocuments}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=O({type:i,selectors:[["app-update"]],inputs:{id:"id"},decls:2,vars:1,consts:[["key","confirmDialog"],["pTemplate","content"],[1,"p-fluid","grid"],[1,"p-toolbar-group-left"],[1,"p-toolbar-group-right"],[3,"cancel","isVisibleCancelButton","isVisibleSubmitButton"],["label","Registro",3,"icon"],["labelSubmitButton","Guardar Cambios",3,"submit","cancel","iconSubmitButton","isVisibleCancelButton"],["pTemplate","header"],["header","Datos B\xE1sicos",1,"col-12"],[3,"formErrorsOutput","formOutput","formInput"],["header","Fechas del Convenio",1,"col-12"],[1,"col-12"],["header","Comparecientes",1,"col-12"],["header","Obligaciones",1,"col-12"],["header","Financiamiento",1,"col-12"],[3,"formOutput","formErrorsOutput","formInput"],["content","Registrar conforme se\xF1ala convenio o designaci\xF3n"],[1,"col-12",3,"formErrorsOutput","formOutput","formInput"]],template:function(n,o){n&1&&(f(0,Ko,2,0,"p-panel"),d(1,"p-confirmDialog",0)),n&2&&C(0,o.form.valid?0:-1)},dependencies:[Gt,L,$t,pe,ae,Nt,Rt,Zt,Qt,si,mi,ui,Xe,ci,_i,fi,hi]});let t=i;return t})();var Yo=[{path:"",component:gi},{title:"Obligaciones de las partes",path:"part-obligation",component:Xe,canDeactivate:[vt]}],bi=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=Ve({type:i}),i.\u0275inj=De({imports:[Qe.forChild(Yo),Qe]});let t=i;return t})();var Yl=(()=>{let i=class i{};i.\u0275fac=function(n){return new(n||i)},i.\u0275mod=Ve({type:i}),i.\u0275inj=De({imports:[lt,bi,gt,ot,zt,ht,It,Tt,xt,bt,Et,ft,yt,Mt,Ft,Kt,Ot,kt,Dt,ni,At,oi,ti,ri,Bt,Lt,Jt,ot,wt,Ht,Wt,Vt,jt,qt,Yt,Ut,ei]});let t=i;return t})();export{Yl as UpdateModule};
