import{a as Dt}from"./chunk-HVRJOU4A.js";import{c as At}from"./chunk-5JL33SAL.js";import{A as pt,B as Be,C as Pe,Ga as Ve,Ha as St,Ia as yt,Ja as Oe,Ka as Et,La as He,Q as dt,R as _t,Ra as Ft,Y as ut,Ya as It,Z as gt,aa as ft,ba as ht,d as ke,e as it,ha as X,i as ot,ia as Z,ja as ee,k as R,ka as te,m as nt,n as rt,na as vt,p as Q,pa as ie,qa as xt,r as lt,ra as Me,t as at,ta as Ne,ua as Lt,v as st,va as Tt,w as Ce,wa as bt,y as ct,z as mt}from"./chunk-OY72BBVG.js";import{j as $,m as fe,n as Ct}from"./chunk-GFXZWTUR.js";import{A as _e,Ba as tt,Da as J,E as Ee,I as ue,J as Qe,L as Fe,M as O,N as H,O as q,P as w,S as j,T as Ie,e as me,fa as Ae,ga as B,ha as oe,ia as K,k as D,ka as ve,ma as De,na as ge,o as M,r as N,s as W,ta as Xe,u as pe,ua as Y,v as V,va as Ze,wa as we,x as Je,ya as et,z as de}from"./chunk-ODTB3GIQ.js";import{Aa as x,Ba as v,Ca as n,E as Le,H as d,J as I,Ja as he,K as Te,La as p,Ma as P,Mb as Se,Na as C,O as f,Oa as G,Ob as ye,P as h,Pa as Ke,Qa as le,Ra as ae,Rb as Ue,Sa as se,U as be,Wa as ce,_ as r,eb as E,fb as Re,gb as A,ja as _,ka as U,la as m,oa as re,p as xe,pa as k,qa as g,ra as y,sa as b,ta as S,ua as s,va as c,w as je,wa as u,yb as z,zb as Ye}from"./chunk-EUOB27Q6.js";function Rt(e,i){if(e&1&&(s(0,"div",13)(1,"div"),p(2),c()()),e&2){let t=i.$implicit;r(2),P(t.name)}}function Ut(e,i){if(e&1&&(s(0,"div",13)(1,"div"),p(2),c()()),e&2){let t=i.$implicit;r(2),P(t.name)}}function Gt(e,i){e&1&&u(0,"input",9)}function zt(e,i){e&1&&u(0,"p-calendar",14),e&2&&m("iconDisplay","input")("showIcon",!0)}function Wt(e,i){if(e&1){let t=x();s(0,"p-toolbar")(1,"div",15),u(2,"app-header-form",16),c(),s(3,"div",17)(4,"app-form-button-action",18),v("submit",function(){f(t);let a=n();return h(a.onSubmit())}),c()()()}if(e&2){let t=n();r(2),m("icon",t.PrimeIcons.PENCIL),r(2),m("iconSubmitButton",t.PrimeIcons.SEND)("isVisibleCancelButton",!1)}}var kt=(()=>{let i=class i{constructor(){this.closingNotificationOut=new be,this.breadcrumbService=d(pe),this.agreementsHttpService=d(ge),this.confirmationService=d(me),this.closingNotificationsHttpService=d(Ze),this.trackingLogsHttpService=d(Y),this.cataloguesHttpService=d(de),this.coreService=d(N),this.messageDialogService=d(V),this.formBuilder=d(Ce),this.ClosingNotificationEnum=ve,this.CatalogueClosingNotificationsCloseTypeEnum=ue,this.PrimeIcons=D,this.formErrors=[],this.closeTypes=[],this.buildForm()}ngOnInit(){this.loadCloseTypes(),this.findClosingNotificationByAgreement()}buildForm(){this.form=this.formBuilder.group({id:[null],agreement:[null,R.required],closedAt:[null,R.required],closeDetail:[null,R.required],closeType:[null,R.required]})}createClosingNotification(){this.agreementField.patchValue({id:this.agreementId}),this.closingNotificationsHttpService.createClosingNotificationClosingProcessByAgreement(this.form.value).subscribe(o=>{this.findClosingNotificationByAgreement()})}findClosingNotificationByAgreement(){this.closingNotificationsHttpService.findClosingNotificationByAgreement(this.agreementId).subscribe(o=>{o&&(this.closingNotification=o,this.closingNotificationOut.emit(o),this.form.patchValue(o),(this.closingNotification.closeType?.code===ue.MUTUAL||this.closingNotification.closeType?.code===ue.OBJECT||this.closingNotification.closeType?.code===ue.UNILATERAL)&&this.form.disable(),this.closingNotification.closeType?.code===ue.TERM&&this.closeDetailField.clearValidators(),o.closedAt&&(this.closedAtField.setValue(At(o.closedAt)),this.form.disable()),this.endedAt=new Date(this.closingNotification.agreement.endedAt+"T05:00:00"))})}validateForm(){return this.formErrors=[],this.closedAtField.invalid&&this.formErrors.push(ve.closedAt),this.closeDetailField.invalid&&this.formErrors.push(ve.closeDetail),this.closeTypeField.invalid&&this.formErrors.push(ve.closeType),this.formErrors.length===0}onSubmit(){this.validateForm()?this.confirmationService.confirm({key:"confirmDialog",message:"\xBFEst\xE1 seguro de notificar la terminiaci\xF3n del convenio?",header:"",icon:D.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.createClosingNotification()}}):(this.form.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}loadCloseTypes(){this.closeTypes=this.cataloguesHttpService.findByType(_e.CLOSING_NOTIFICATIONS_CLOSE_TYPE)}get idField(){return this.form.controls.id}get agreementField(){return this.form.controls.agreement}get closedAtField(){return this.form.controls.closedAt}get closeDetailField(){return this.form.controls.closeDetail}get closeTypeField(){return this.form.controls.closeType}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=I({type:i,selectors:[["app-closing-notification"]],inputs:{agreementId:"agreementId"},outputs:{closingNotificationOut:"closingNotificationOut"},decls:24,vars:19,consts:[["header","NOTIFICACI\xD3N INICIO DEL PROCESO DE CIERRE DEL CONVENIO"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","closeType",3,"label","required"],["id","closeType","formControlName","closeType","dataKey","id","placeholder","Selecione",3,"options"],["pTemplate","selectedItem"],["pTemplate","item"],["appErrorMessage","",3,"errors","touched","dirty"],["appLabel","","for","closedAt",3,"label","required"],["pInputText","","formControlName","closedAt"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","closeDetail",3,"label","required"],["pInputTextarea","","id","closeDetail","formControlName","closeDetail"],[1,"flex","align-items-center","gap-2"],["id","closedAt","formControlName","closedAt","dateFormat","dd/mm/yy",3,"iconDisplay","showIcon"],[1,"p-toolbar-group-left"],["label","Registro",3,"icon"],[1,"p-toolbar-group-right"],["labelSubmitButton","Notificar",3,"submit","iconSubmitButton","isVisibleCancelButton"]],template:function(a,l){a&1&&(s(0,"p-panel",0)(1,"h3"),p(2,"Notificar fecha de Acta de Terminaci\xF3n y Cierre del Convenio"),c(),s(3,"form",1)(4,"div",2),u(5,"label",3),s(6,"p-dropdown",4),_(7,Rt,3,1,"ng-template",5)(8,Ut,3,1,"ng-template",6),c(),u(9,"small",7),c(),s(10,"div",2),u(11,"label",8),_(12,Gt,1,0,"input",9)(13,zt,1,2),u(14,"small",7),s(15,"p")(16,"em"),p(17," Nota: Registre la fecha que consta en el documento suscrito entre las partes "),c()()(),s(18,"div",10),u(19,"label",11)(20,"textarea",12)(21,"small",7),c()(),u(22,"p-divider"),_(23,Wt,5,3,"p-toolbar"),c()),a&2&&(r(3),m("formGroup",l.form),r(2),m("label",l.ClosingNotificationEnum.closeType)("required",l.closeTypeField),r(),m("options",l.closeTypes),r(3),m("errors",l.closeTypeField.errors)("touched",l.closeTypeField.touched)("dirty",l.closeTypeField.dirty),r(2),m("label",l.ClosingNotificationEnum.closedAt)("required",l.closedAtField),r(),g(12,l.idField.value?12:13),r(2),m("errors",l.closedAtField.errors)("touched",l.closedAtField.touched)("dirty",l.closedAtField.dirty),r(5),m("label",l.ClosingNotificationEnum.closeDetail)("required",l.closeDetailField),r(2),m("errors",l.closeDetailField.errors)("touched",l.closeDetailField.touched)("dirty",l.closeDetailField.dirty),r(2),g(23,l.idField.value?-1:23))},dependencies:[M,ie,fe,Be,Pe,yt,Ft,ft,ut,mt,Tt,dt,lt,ot,nt,rt,at,st]});let e=i;return e})();function jt(e,i){if(e&1&&(s(0,"div",10)(1,"h2"),p(2),E(3,"customFormatDate"),E(4,"customFormatDate"),c()()),e&2){let t=n();r(2),Ke(" ",t.period.name,": ",Re(3,3,t.period.startedAt)," - ",Re(4,5,t.period.endedAt)," ")}}function Kt(e,i){if(e&1&&(s(0,"th",11),p(1),u(2,"p-sortIcon",12),c()),e&2){let t=i.$implicit;m("pSortableColumn",t.field),r(),C(" ",t.header," "),r(),m("field",t.field)}}function Yt(e,i){if(e&1&&(s(0,"tr"),b(1,Kt,3,3,"th",11,y),c()),e&2){let t=i.$implicit;r(),S(t)}}function Jt(e,i){if(e&1&&(u(0,"br"),s(1,"b"),p(2,"Comentario: "),c(),p(3)),e&2){let t=n(4).$implicit;r(3),C("",t.observation," ")}}function Qt(e,i){if(e&1&&(p(0),_(1,Jt,4,1)),e&2){let t=n(3).$implicit;G(" ",t.user.name," ",t.user.lastname," "),r(),g(1,t.observation?1:-1)}}function Xt(e,i){if(e&1&&p(0),e&2){let t=n(3).$implicit;C(" ",t.state.name," ")}}function Zt(e,i){if(e&1&&_(0,Qt,2,3)(1,Xt,1,1),e&2){let t,o=n().$implicit;g(0,(t=o.field)==="user"?0:t==="state"?1:-1)}}function ei(e,i){if(e&1&&(p(0),E(1,"date")),e&2){let t=n(4).$implicit;C(" ",A(1,1,t.registeredAt,"dd/MM/yy - HH:mm")," ")}}function ti(e,i){if(e&1&&_(0,ei,2,4),e&2){let t=n(3).$implicit;g(0,t.registeredAt?0:-1)}}function ii(e,i){if(e&1&&p(0),e&2){let t=n(2).$implicit,o=n().$implicit;C(" ",o[t.field]," ")}}function oi(e,i){if(e&1&&_(0,ti,1,1)(1,ii,1,1),e&2){let t,o=n().$implicit;g(0,(t=o.field)==="registeredAt"?0:1)}}function ni(e,i){if(e&1&&(s(0,"td"),_(1,Zt,2,1)(2,oi,2,1),c()),e&2){let t=i.$implicit,o=n().$implicit;r(),g(1,o[t.field]!=null&&o[t.field].id?1:-1),r(),g(2,o[t.field]!=null&&o[t.field].id?-1:2)}}function ri(e,i){if(e&1&&(s(0,"tr",13),b(1,ni,3,2,"td",null,y),c()),e&2){let t=i.$implicit,o=i.columns,a=i.rowIndex;m("pSelectableRow",t)("pSelectableRowIndex",a),r(),S(o)}}function li(e,i){if(e&1&&(s(0,"tr")(1,"td"),p(2),c()()),e&2){let t=i.$implicit,o=n();r(),U("colspan",t.length),r(),C(" ",o.messageService.paginatorNoRecordsFound," ")}}function ai(e,i){}var Bt=(()=>{let i=class i{constructor(){this.authService=d(J),this.coreService=d(N),this.router=d(ye),this.trackingLogsHttpService=d(Y),this.PrimeIcons=D,this.IconButtonActionEnum=H,this.SeverityButtonActionEnum=q,this.LabelButtonActionEnum=O,this.BreadcrumbEnum=w,this.TableEnum=j,this.messageService=d(W),this.messageDialogService=d(V),this.buttonActions=[],this.columns=[],this.search=new Q(""),this.items=[],this.isVisibleAgreementView=!1,this.buildColumns()}ngOnInit(){this.items=this.period.trackingLogs}buildColumns(){this.columns=[{field:"state",header:K.state},{field:"registeredAt",header:K.registeredAt},{field:"user",header:K.user}]}redirectAgreementLogForm(o){this.router.navigate(["/core/agreements/log",o])}downloadLog(){this.trackingLogsHttpService.downloadLog(this.period.id,this.trackingLogType)}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=I({type:i,selectors:[["app-tracking-log-list"]],inputs:{period:"period",trackingLogType:"trackingLogType"},decls:11,vars:9,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"ml-2",3,"click","icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[1,"flex"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"]],template:function(a,l){if(a&1){let L=x();s(0,"p-toolbar")(1,"div",1)(2,"p-button",2),v("click",function(){return f(L),h(l.downloadLog())}),c()(),u(3,"div",3),c(),s(4,"p-table",4,0),_(6,jt,5,7,"ng-template",5)(7,Yt,3,0,"ng-template",6)(8,ri,3,2,"ng-template",7)(9,li,3,2,"ng-template",8)(10,ai,0,0,"ng-template",9),c()}a&2&&(r(2),m("icon",l.IconButtonActionEnum.DOWNLOAD)("label",l.LabelButtonActionEnum.DOWNLOAD)("loading",l.coreService.isLoading)("severity",l.SeverityButtonActionEnum.SYNC),r(2),m("value",l.items)("columns",l.columns)("paginator",!0)("rows",10)("loading",l.coreService.isLoading))},dependencies:[X,M,Z,te,ee,ie,$,z,tt],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let e=i;return e})();var ui=()=>({width:"50rem"}),gi=()=>({width:"100%"});function Ci(e,i){if(e&1){let t=x();s(0,"h2"),p(1),c(),s(2,"h3"),p(3,"Descargue aqu\xED el Formato de Informe de avance de avance semestral de cierre del convenio:"),c(),s(4,"p-button",14),v("click",function(){f(t);let a=n();return h(a.downloadFormat(a.FormatsEnum.format_002))}),c()}if(e&2){let t=n();r(),P(t.BreadcrumbEnum.PERIODS_CLOSING_ADMINISTRATOR),r(3),m("icon",t.IconButtonActionEnum.DOWNLOAD)("label",t.LabelButtonActionEnum.DOWNLOAD)("severity",t.SeverityButtonActionEnum.DOWNLOAD)}}function fi(e,i){if(e&1&&(s(0,"th",15),p(1),u(2,"p-sortIcon",17),c()),e&2){let t=i.$implicit;m("pSortableColumn",t.field),r(),C(" ",t.header," "),r(),m("field",t.field)}}function hi(e,i){if(e&1&&(s(0,"tr"),b(1,fi,3,3,"th",15,y),s(3,"th",16),p(4),c()()),e&2){let t=i.$implicit,o=n();r(),S(t),r(3),C(" ",o.TableEnum.ACTIONS," ")}}function vi(e,i){if(e&1&&p(0),e&2){let t=n(2).$implicit,o=n().$implicit;C(" ",o[t.field].unit.name," ")}}function xi(e,i){if(e&1&&_(0,vi,1,1),e&2){let t,o=n().$implicit;g(0,(t=o.field)==="administrator"?0:-1)}}function Li(e,i){if(e&1){let t=x();s(0,"p-button",21),v("click",function(){f(t);let a=n(4).$implicit,l=n();return h(l.showFilesModal(a))}),c()}if(e&2){let t=n(5);m("icon",t.IconButtonActionEnum.ADD)("pTooltip",t.LabelButtonActionEnum.ADD)("severity",t.SeverityButtonActionEnum.ADD)}}function Ti(e,i){if(e&1){let t=x();s(0,"span"),p(1),c(),s(2,"p-button",22),v("click",function(){let a=f(t).$implicit,l=n(6);return h(l.downloadFile(a))}),c(),u(3,"p-divider")}if(e&2){let t=i.$implicit,o=n(6);r(),C("",t.type.name,": "),r(),m("icon",o.IconButtonActionEnum.DOWNLOAD)("label",t.name)("text",!0)("severity",o.SeverityButtonActionEnum.DOWNLOAD)}}function bi(e,i){if(e&1&&b(0,Ti,4,5,null,null,y),e&2){let t=n(4).$implicit;S(t==null?null:t.trackingLogDocuments)}}function Si(e,i){if(e&1&&_(0,Li,1,3,"p-button",20)(1,bi,2,0),e&2){let t=n(3).$implicit,o=n();g(0,!(t!=null&&t.trackingLog)||t.trackingLog.state.code===o.CatalogueTrackingLogsStateEnum.REFUSED?0:1)}}function yi(e,i){if(e&1&&u(0,"i",24),e&2){let t=n(6);k(t.PrimeIcons.CIRCLE_FILL)}}function Ei(e,i){if(e&1&&u(0,"i",25),e&2){let t=n(6);k(t.PrimeIcons.CIRCLE_FILL)}}function Fi(e,i){if(e&1&&_(0,yi,1,2,"i",23)(1,Ei,1,2),e&2){let t=n(4).$implicit;g(0,t.trackingLog.state.code==="REPORTED"||t.trackingLog.state.code==="ACCEPTED"?0:1)}}function Ii(e,i){if(e&1&&u(0,"i",25),e&2){let t=n(5);k(t.PrimeIcons.CIRCLE_FILL)}}function Ai(e,i){if(e&1&&_(0,Fi,2,1)(1,Ii,1,2),e&2){let t=n(3).$implicit;g(0,t.trackingLog?0:1)}}function Di(e,i){if(e&1&&(p(0),u(1,"br"),p(2),E(3,"date"),u(4,"br"),p(5),E(6,"date")),e&2){let t=n(3).$implicit;C(" ",t.name," "),r(2),C(" ",A(3,3,t.startedAt,"d MMMM y")," - "),r(3),C(" ",A(6,6,t.endedAt,"d MMMM y")," ")}}function wi(e,i){if(e&1&&(p(0),E(1,"date")),e&2){let t=n(3).$implicit;C(" ",A(1,1,t.uploadedAt,"dd/MM/y - HH:mm")," ")}}function ki(e,i){if(e&1&&p(0),e&2){let t=n(3).$implicit;C(" ",t.trackingLog==null||t.trackingLog.state==null?null:t.trackingLog.state.name," ")}}function Bi(e,i){if(e&1&&p(0),e&2){let t=n(4).$implicit;G(" ",t.trackingLog.user.name," ",t.trackingLog.user.lastname," ")}}function Pi(e,i){if(e&1&&_(0,Bi,1,2),e&2){let t=n(3).$implicit;g(0,t.trackingLog!=null&&t.trackingLog.user?0:-1)}}function Mi(e,i){if(e&1&&p(0),e&2){let t=n(2).$implicit,o=n().$implicit;C(" ",o[t.field]," ")}}function Ni(e,i){if(e&1&&_(0,Si,2,1)(1,Ai,2,1)(2,Di,7,9)(3,wi,2,4)(4,ki,1,1)(5,Pi,1,1)(6,Mi,1,1),e&2){let t,o=n().$implicit;g(0,(t=o.field)==="files"?0:t==="trafficLight"?1:t==="name"?2:t==="uploadedAt"?3:t==="state"?4:t==="user"?5:6)}}function Vi(e,i){if(e&1&&(s(0,"td"),_(1,xi,1,1)(2,Ni,7,1),c()),e&2){let t=i.$implicit,o=n().$implicit;r(),g(1,o[t.field]!=null&&o[t.field].id?1:-1),r(),g(2,o[t.field]!=null&&o[t.field].id?-1:2)}}function Oi(e,i){if(e&1){let t=x();s(0,"tr",18),b(1,Vi,3,2,"td",null,y),s(3,"td",16)(4,"p-button",19),v("click",function(){let a=f(t).$implicit,l=n();return h(l.selectItem(a))}),c()()()}if(e&2){let t=i.$implicit,o=i.columns,a=i.rowIndex,l=n();m("pSelectableRow",t)("pSelectableRowIndex",a),r(),S(o),r(3),m("icon",l.PrimeIcons.ELLIPSIS_V)}}function Hi(e,i){if(e&1&&(s(0,"tr")(1,"td"),p(2),c()()),e&2){let t=i.$implicit,o=n();r(),U("colspan",t.length),r(),C(" ",o.messageService.paginatorNoRecordsFound," ")}}function $i(e,i){}function Ri(e,i){if(e&1&&(u(0,"i"),s(1,"div",36),p(2),c()),e&2){let t=n(3);k(t.PrimeIcons.FILE_PDF),r(2),P(t.reportFileField.value==null?null:t.reportFileField.value.name)}}function Ui(e,i){e&1&&(s(0,"div",31)(1,"p-messages",34),_(2,Ri,3,3,"ng-template",35),c()())}function Gi(e,i){if(e&1&&(u(0,"i"),s(1,"div",36),p(2),c()),e&2){let t=n(3);k(t.PrimeIcons.FILE_PDF),r(2),P(t.evidenceFileField.value==null?null:t.evidenceFileField.value.name)}}function zi(e,i){e&1&&(s(0,"div",31)(1,"p-messages",34),_(2,Gi,3,3,"ng-template",35),c()())}function Wi(e,i){if(e&1){let t=x();s(0,"div",26)(1,"div",27),u(2,"label",28),s(3,"p-fileUpload",29,1),v("uploadHandler",function(a){f(t);let l=he(4),L=n();return h(L.uploadReportFile(a,l))}),c(),u(5,"small",30),c(),_(6,Ui,3,0,"div",31),s(7,"div",27),u(8,"label",32),s(9,"p-fileUpload",33,1),v("uploadHandler",function(a){f(t);let l=he(4),L=n();return h(L.uploadEvidenceFile(a,l))}),c(),u(11,"small",30),c(),_(12,zi,3,0,"div",31),c()}if(e&2){let t=n();r(2),m("label",t.PeriodEnum.reportClosingFile)("required",t.reportFileField),r(),m("chooseIcon",t.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",t.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",t.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),r(2),m("errors",t.reportFileField.errors)("touched",t.reportFileField.touched)("dirty",t.reportFileField.dirty),r(),g(6,t.reportFileField.value?6:-1),r(2),m("label",t.PeriodEnum.evidenceClosingFile)("required",t.evidenceFileField),r(),m("chooseIcon",t.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",t.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",t.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),r(2),m("errors",t.evidenceFileField.errors)("touched",t.evidenceFileField.touched)("dirty",t.evidenceFileField.dirty),r(),g(12,t.evidenceFileField.value?12:-1)}}function qi(e,i){if(e&1){let t=x();s(0,"p-button",37),v("click",function(){f(t);let a=n();return h(a.closeModal())}),c(),s(1,"p-button",38),v("click",function(){f(t);let a=n();return h(a.onUpload())}),c()}if(e&2){let t=n();m("label",t.LabelButtonActionEnum.CANCEL)("icon",t.IconButtonActionEnum.CANCEL)("text",!0)("severity",t.SeverityButtonActionEnum.CANCEL),r(),m("icon",t.IconButtonActionEnum.UPLOAD)("label",t.LabelButtonActionEnum.UPLOAD)("severity",t.SeverityButtonActionEnum.UPLOAD)}}function ji(e,i){if(e&1&&u(0,"app-tracking-log-list",13),e&2){let t=n();m("period",t.selectedItem)}}var Pt=(()=>{let i=class i{constructor(){this.activatedRoute=d(Se),this.authService=d(J),this.coreService=d(N),this.confirmationService=d(me),this.formBuilder=d(Ce),this.cataloguesHttpService=d(de),this.trackingLogsHttpService=d(Y),this.parametersHttpService=d(et),this.agreementsHttpService=d(ge),this.filesHttpService=d(De),this.agreementsService=d(Je),this.router=d(ye),this.breadcrumbService=d(pe),this.PrimeIcons=D,this.IconButtonActionEnum=H,this.SeverityButtonActionEnum=q,this.LabelButtonActionEnum=O,this.BreadcrumbEnum=w,this.TableEnum=j,this.messageService=d(W),this.messageDialogService=d(V),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new Q(""),this.items=[],this.formErrors=[],this.types=[],this.trackingLogType="closing",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Ae,this.CatalogueTrackingLogsStateEnum=Ee,this.PeriodEnum=B,this.FileEnum=Ie,this.FormatsEnum=Dt,this.breadcrumbService.setItems([{label:w.AGREEMENTS,routerLink:["/core/agreement-administrator/agreement-list"]},{label:w.PERIODS_CLOSING_ADMINISTRATOR}]),this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(je(500)).subscribe(o=>{this.findPeriodsByAgreement()})}ngOnInit(){this.findPeriodsByAgreement(),this.findAgreement(this.agreementId),this.loadTypes()}buildForm(){this.form=this.formBuilder.group({reportFile:[null,R.required],evidenceFile:[null]})}findAgreement(o){this.agreementsHttpService.findOne(o).subscribe(a=>{this.agreement=a})}findPeriodsByAgreement(){this.trackingLogsHttpService.findPeriodsByAgreement(this.agreementId,this.trackingLogType).subscribe(o=>{this.items=o})}loadTypes(){this.types=this.cataloguesHttpService.findByType(_e.PERIODS_TRACKING_LOG)}createPeriod(){this.trackingLogsHttpService.createPeriod(this.agreementId,this.trackingLogType).subscribe(o=>{this.findPeriodsByAgreement()})}buildColumns(){this.columns=[{field:"name",header:B.reportPeriod},{field:"documentName",header:B.name},{field:"files",header:B.documentName},{field:"trafficLight",header:B.trafficLight},{field:"uploadedAt",header:B.uploadedAt},{field:"user",header:B.user},{field:"state",header:B.state}]}buildButtonActions(){this.buttonActions=[{id:Fe.TRACKING_LOG,label:O.TRACKING_LOG,icon:H.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}]}validateButtonActions(o){this.buildButtonActions()}remove(o){}paginate(o){}selectItem(o){this.isButtonActions=!0,this.selectedItem=o,this.validateButtonActions(o)}showFilesModal(o){this.selectedItem=o,this.isVisibleFilesModal=!0}downloadFile(o){this.filesHttpService.downloadFile(o)}onUpload(){console.log("1"),this.validateFilesForm()?(console.log("2"),this.confirmationService.confirm({key:"confirmDialog",message:"\xBFEst\xE1 seguro de subir los archivos?",header:"",icon:D.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{let o=new FormData;o.append("report",this.reportFileField.value),o.append("evidence",this.evidenceFileField.value),this.trackingLogsHttpService.createTrackingLog(this.selectedItem.id,o,this.trackingLogType).subscribe(a=>{this.findPeriodsByAgreement(),this.isVisibleFilesModal=!1,this.reportFileField.setValue(null),this.evidenceFileField.setValue(null)})}})):this.messageDialogService.fieldErrors(this.formErrors)}validateFilesForm(){return this.formErrors=[],this.reportFileField.invalid&&this.formErrors.push(B.reportFile),this.evidenceFileField.invalid&&this.formErrors.push(B.evidenceFile),this.formErrors.length===0}uploadReportFile(o,a){this.reportFileField.patchValue(o.files[0]),a.clear()}uploadEvidenceFile(o,a){this.evidenceFileField.patchValue(o.files[0]),a.clear()}closeModal(){this.isVisibleFilesModal=!1,this.reportFileField.setValue(null),this.evidenceFileField.setValue(null)}downloadFormat(o){this.parametersHttpService.downloadFile(o)}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=I({type:i,selectors:[["app-period-tacking-log-list"]],inputs:{agreementId:"agreementId"},decls:13,vars:18,consts:[["dt",""],["uploadFiles",""],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Subir Archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["header","Bit\xE1cora",3,"visibleChange","visible","modal"],["trackingLogType","closing",3,"period"],[1,"ml-2",3,"click","icon","label","severity"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[3,"click","icon"],[1,"ml-2",3,"icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[1,"p-fluid","grid"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","report",3,"label","required"],["id","report","mode","basic","chooseLabel","Cargar","invalidFileSizeMessageDetail","","name","files[]","accept",".pdf",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appErrorMessage","",3,"errors","touched","dirty"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","evidence",3,"label","required"],["id","evidence","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(a,l){if(a&1){let L=x();s(0,"p-table",2,0),_(2,Ci,5,4,"ng-template",3)(3,hi,5,1,"ng-template",4)(4,Oi,5,3,"ng-template",5)(5,Hi,3,2,"ng-template",6)(6,$i,0,0,"ng-template",7),c(),s(7,"app-button-action",8),v("isHide",function(T){return f(L),h(l.isButtonActions=!T)}),c(),s(8,"p-dialog",9),se("visibleChange",function(T){return f(L),ae(l.isVisibleFilesModal,T)||(l.isVisibleFilesModal=T),h(T)}),_(9,Wi,13,22,"ng-template",10)(10,qi,2,7,"ng-template",11),c(),s(11,"p-dialog",12),se("visibleChange",function(T){return f(L),ae(l.isVisibleTrackingLogModal,T)||(l.isVisibleTrackingLogModal=T),h(T)}),_(12,ji,1,1,"app-tracking-log-list",13),c()}a&2&&(m("value",l.items)("columns",l.columns)("paginator",!0)("rows",10)("loading",l.coreService.isLoading),r(7),m("buttonActions",l.buttonActions)("enabled",l.isButtonActions),r(),re(ce(16,ui)),le("visible",l.isVisibleFilesModal),m("modal",!0),r(3),re(ce(17,gi)),le("visible",l.isVisibleTrackingLogModal),m("modal",!0),r(),g(12,l.isVisibleTrackingLogModal?12:-1))},dependencies:[X,M,Z,te,ee,$,ke,fe,Be,Pe,He,Ve,Ne,Me,Bt,z]});let e=i;return e})();function Yi(e,i){e&1&&u(0,"div",10)}function Ji(e,i){if(e&1&&(s(0,"th",11),p(1),u(2,"p-sortIcon",12),c()),e&2){let t=i.$implicit;m("pSortableColumn",t.field),r(),C(" ",t.header," "),r(),m("field",t.field)}}function Qi(e,i){if(e&1&&(s(0,"tr"),b(1,Ji,3,3,"th",11,y),c()),e&2){let t=i.$implicit;r(),S(t)}}function Xi(e,i){if(e&1&&(u(0,"br"),s(1,"b"),p(2,"Comentario: "),c(),p(3)),e&2){let t=n(4).$implicit;r(3),C("",t.observation," ")}}function Zi(e,i){if(e&1&&(p(0),_(1,Xi,4,1)),e&2){let t=n(3).$implicit;G(" ",t.user.name," ",t.user.lastname," "),r(),g(1,t.observation?1:-1)}}function eo(e,i){if(e&1&&p(0),e&2){let t=n(3).$implicit;C(" ",t.state.name," ")}}function to(e,i){if(e&1&&_(0,Zi,2,3)(1,eo,1,1),e&2){let t,o=n().$implicit;g(0,(t=o.field)==="user"?0:t==="state"?1:-1)}}function io(e,i){if(e&1&&(p(0),E(1,"date")),e&2){let t=n(4).$implicit;C(" ",A(1,1,t.registeredAt,"dd/MM/yy - HH:mm")," ")}}function oo(e,i){if(e&1&&_(0,io,2,4),e&2){let t=n(3).$implicit;g(0,t.registeredAt?0:-1)}}function no(e,i){if(e&1&&p(0),e&2){let t=n(2).$implicit,o=n().$implicit;C(" ",o[t.field]," ")}}function ro(e,i){if(e&1&&_(0,oo,1,1)(1,no,1,1),e&2){let t,o=n().$implicit;g(0,(t=o.field)==="registeredAt"?0:1)}}function lo(e,i){if(e&1&&(s(0,"td"),_(1,to,2,1)(2,ro,2,1),c()),e&2){let t=i.$implicit,o=n().$implicit;r(),g(1,o[t.field]!=null&&o[t.field].id?1:-1),r(),g(2,o[t.field]!=null&&o[t.field].id?-1:2)}}function ao(e,i){if(e&1&&(s(0,"tr",13),b(1,lo,3,2,"td",null,y),c()),e&2){let t=i.$implicit,o=i.columns,a=i.rowIndex;m("pSelectableRow",t)("pSelectableRowIndex",a),r(),S(o)}}function so(e,i){if(e&1&&(s(0,"tr")(1,"td"),p(2),c()()),e&2){let t=i.$implicit,o=n();r(),U("colspan",t.length),r(),C(" ",o.messageService.paginatorNoRecordsFound," ")}}function co(e,i){}var Mt=(()=>{let i=class i{constructor(){this.authService=d(J),this.coreService=d(N),this.closingLogsHttpService=d(we),this.PrimeIcons=D,this.IconButtonActionEnum=H,this.SeverityButtonActionEnum=q,this.LabelButtonActionEnum=O,this.BreadcrumbEnum=w,this.TableEnum=j,this.messageService=d(W),this.messageDialogService=d(V),this.buttonActions=[],this.columns=[],this.search=new Q(""),this.items=[],this.isVisibleAgreementView=!1,this.buildColumns()}ngOnInit(){this.findClosingLogsByAgreement()}buildColumns(){this.columns=[{field:"state",header:K.state},{field:"registeredAt",header:K.registeredAt},{field:"user",header:K.user}]}findClosingLogsByAgreement(){this.closingLogsHttpService.findClosingLogsByAgreement(this.agreementId).subscribe(o=>{o&&(this.items=o)})}downloadLog(){this.closingLogsHttpService.downloadLog(this.agreementId)}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=I({type:i,selectors:[["app-closing-log-list"]],inputs:{agreementId:"agreementId"},decls:11,vars:9,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"ml-2",3,"click","icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[1,"flex"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"]],template:function(a,l){if(a&1){let L=x();s(0,"p-toolbar")(1,"div",1)(2,"p-button",2),v("click",function(){return f(L),h(l.downloadLog())}),c()(),u(3,"div",3),c(),s(4,"p-table",4,0),_(6,Yi,1,0,"ng-template",5)(7,Qi,3,0,"ng-template",6)(8,ao,3,2,"ng-template",7)(9,so,3,2,"ng-template",8)(10,co,0,0,"ng-template",9),c()}a&2&&(r(2),m("icon",l.IconButtonActionEnum.DOWNLOAD)("label",l.LabelButtonActionEnum.DOWNLOAD)("loading",l.coreService.isLoading)("severity",l.SeverityButtonActionEnum.SYNC),r(2),m("value",l.items)("columns",l.columns)("paginator",!0)("rows",10)("loading",l.coreService.isLoading))},dependencies:[X,M,Z,te,ee,ie,$,z],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let e=i;return e})();var _o=(e,i)=>i.id,uo=()=>({width:"50rem"}),go=()=>({width:"100%"});function Co(e,i){e&1&&(s(0,"div",20),p(1," Previo a reportar la documentaci\xF3n en la secciones GESTI\xD3N DE CIERRE DE CONVENIO \xE9stos (reportes de avence de cierre) deber\xE1 contar con todos los reportes en estado ACEPTADO. "),c())}function fo(e,i){e&1&&(s(0,"p-messages",15),_(1,Co,2,0,"ng-template",19),c())}function ho(e,i){if(e&1){let t=x();s(0,"p-button",21),v("click",function(){f(t);let a=n(2);return h(a.openFilesModal())}),c()}if(e&2){let t=n(2);m("icon",t.IconButtonActionEnum.UPLOAD)("label",t.LabelButtonActionEnum.CREATE_CLOSING_LOG)("loading",t.coreService.isLoading)("severity",t.SeverityButtonActionEnum.UPLOAD)}}function vo(e,i){if(e&1&&(s(0,"h2"),p(1),c(),_(2,fo,2,0,"p-messages",15),s(3,"p-toolbar")(4,"div",16),_(5,ho,1,4,"p-button",17),c(),u(6,"div",18),c()),e&2){let t=n();r(),P(t.BreadcrumbEnum.CLOSING_LOG_ADMINISTRATOR),r(),g(2,!t.validPeriodsClosing&&t.closingNotification&&(t.closingNotification.closeType==null?null:t.closingNotification.closeType.code)===t.CatalogueClosingNotificationsCloseTypesDocumentEnum.TERM?2:-1),r(3),g(5,t.items.length===0?5:-1)}}function xo(e,i){if(e&1&&(s(0,"th",23),p(1),u(2,"p-sortIcon",24),c()),e&2){let t=i.$implicit;m("pSortableColumn",t.field),r(),C(" ",t.header," "),r(),m("field",t.field)}}function Lo(e,i){if(e&1&&(s(0,"tr"),u(1,"th",22),b(2,xo,3,3,"th",23,y),s(4,"th",22),p(5),c()()),e&2){let t=i.$implicit,o=n();r(2),S(t),r(3),C(" ",o.TableEnum.ACTIONS," ")}}function To(e,i){if(e&1){let t=x();s(0,"p-button",28),v("click",function(){f(t);let a=n(2);return h(a.openFilesModal())}),c()}if(e&2){let t=n(2);m("icon",t.IconButtonActionEnum.ADD)("pTooltip",t.LabelButtonActionEnum.ADD)("severity",t.SeverityButtonActionEnum.ADD)}}function bo(e,i){if(e&1&&p(0),e&2){let t=n(2).$implicit,o=n().$implicit;C(" ",o[t.field].unit.name," ")}}function So(e,i){if(e&1&&p(0),e&2){let t=n(4).$implicit;G(" ",t.user.name," ",t.user.lastname," ")}}function yo(e,i){if(e&1&&_(0,So,1,2),e&2){let t=n(3).$implicit;g(0,t!=null&&t.user?0:-1)}}function Eo(e,i){if(e&1&&p(0),e&2){let t=n(3).$implicit;C(" ",t==null||t.state==null?null:t.state.name," ")}}function Fo(e,i){if(e&1&&_(0,bo,1,1)(1,yo,1,1)(2,Eo,1,1),e&2){let t,o=n().$implicit;g(0,(t=o.field)==="administrator"?0:t==="user"?1:t==="state"?2:-1)}}function Io(e,i){if(e&1&&(s(0,"span"),p(1),c(),u(2,"p-divider")),e&2){let t=i.$implicit;r(),C("",t.type.name,": ")}}function Ao(e,i){if(e&1&&b(0,Io,3,1,null,null,y),e&2){let t=n(4).$implicit;S(t==null?null:t.closingLogDocuments)}}function Do(e,i){if(e&1&&_(0,Ao,2,0),e&2){let t=n(3).$implicit;g(0,t!=null&&t.closingLogDocuments?0:-1)}}function wo(e,i){if(e&1){let t=x();s(0,"p-button",29),v("click",function(){let a=f(t).$implicit,l=n(6);return h(l.downloadFile(a))}),c(),u(1,"p-divider")}if(e&2){let t=i.$implicit,o=n(6);m("icon",o.IconButtonActionEnum.DOWNLOAD)("label",t.name)("text",!0)("severity",o.SeverityButtonActionEnum.DOWNLOAD)}}function ko(e,i){if(e&1&&b(0,wo,2,4,null,null,y),e&2){let t=n(4).$implicit;S(t==null?null:t.closingLogDocuments)}}function Bo(e,i){if(e&1&&_(0,ko,2,0),e&2){let t=n(3).$implicit;g(0,t!=null&&t.closingLogDocuments?0:-1)}}function Po(e,i){if(e&1&&u(0,"i",31),e&2){let t=n(6);k(t.PrimeIcons.CIRCLE_FILL)}}function Mo(e,i){if(e&1&&u(0,"i",32),e&2){let t=n(6);k(t.PrimeIcons.CIRCLE_FILL)}}function No(e,i){if(e&1&&_(0,Po,1,2,"i",30)(1,Mo,1,2),e&2){let t=n(4).$implicit;g(0,t.state.code==="REPORTED"||t.state.code==="ACCEPTED"?0:1)}}function Vo(e,i){if(e&1&&u(0,"i",32),e&2){let t=n(5);k(t.PrimeIcons.CIRCLE_FILL)}}function Oo(e,i){if(e&1&&_(0,No,2,1)(1,Vo,1,2),e&2){let t=n(3).$implicit;g(0,t.closingLogDocuments?0:1)}}function Ho(e,i){if(e&1&&(p(0),u(1,"br"),p(2),E(3,"date"),u(4,"br"),p(5),E(6,"date")),e&2){let t=n(3).$implicit;C(" ",t.name," "),r(2),C(" ",A(3,3,t.startedAt,"d MMMM y")," - "),r(3),C(" ",A(6,6,t.endedAt,"d MMMM y")," ")}}function $o(e,i){if(e&1&&(p(0),E(1,"date")),e&2){let t=n(3).$implicit;C(" ",A(1,1,t.uploadedAt,"dd/MM/y - HH:mm")," ")}}function Ro(e,i){if(e&1&&p(0),e&2){let t=n(2).$implicit,o=n().$implicit;C(" ",o[t.field]," ")}}function Uo(e,i){if(e&1&&_(0,Do,1,1)(1,Bo,1,1)(2,Oo,2,1)(3,Ho,7,9)(4,$o,2,4)(5,Ro,1,1),e&2){let t,o=n().$implicit;g(0,(t=o.field)==="closingLogDocumentsUpload"?0:t==="closingLogDocuments"?1:t==="trafficLight"?2:t==="name"?3:t==="uploadedAt"?4:5)}}function Go(e,i){if(e&1&&(s(0,"td"),_(1,Fo,3,1)(2,Uo,6,1),c()),e&2){let t=i.$implicit,o=n().$implicit;r(),g(1,o[t.field]!=null&&o[t.field].id?1:-1),r(),g(2,o[t.field]!=null&&o[t.field].id?-1:2)}}function zo(e,i){if(e&1){let t=x();s(0,"tr",25)(1,"td"),_(2,To,1,3,"p-button",26),c(),b(3,Go,3,2,"td",null,y),s(5,"td",22)(6,"p-button",27),v("click",function(){let a=f(t).$implicit,l=n();return h(l.selectItem(a))}),c()()()}if(e&2){let t=i.$implicit,o=i.columns,a=i.rowIndex,l=n();m("pSelectableRow",t)("pSelectableRowIndex",a),r(2),g(2,!(t!=null&&t.closingLogDocuments)||t.state.code===l.CatalogueTrackingLogsStateEnum.REFUSED?2:-1),r(),S(o),r(3),m("icon",l.PrimeIcons.ELLIPSIS_V)}}function Wo(e,i){if(e&1&&(s(0,"tr")(1,"td"),p(2),c()()),e&2){let t=i.$implicit,o=n();r(),U("colspan",t.length),r(),C(" ",o.messageService.paginatorNoRecordsFound," ")}}function qo(e,i){}function jo(e,i){if(e&1&&(u(0,"i"),s(1,"div",20),p(2),c()),e&2){let t=n(2).$index,o=n(2);k(o.PrimeIcons.FILE_PDF),r(2),P(o.files[t].file.name)}}function Ko(e,i){e&1&&(s(0,"div",34)(1,"p-messages",38),_(2,jo,3,3,"ng-template",19),c()())}function Yo(e,i){if(e&1){let t=x();s(0,"div",34)(1,"label",35),p(2),s(3,"b",36),p(4,"*"),c()(),s(5,"p-fileUpload",37,1),v("uploadHandler",function(a){let l=f(t).$implicit,L=he(6),F=n(2);return h(F.onUpload(a,L,l))}),c()(),_(7,Ko,3,0,"div",34)}if(e&2){let t=i.$implicit,o=i.$index,a=n(2);r(),m("for",t.id),r(),C(" ",t.name," "),r(3),m("chooseIcon",a.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",a.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",a.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),r(2),g(7,a.files.length>o?7:-1)}}function Jo(e,i){if(e&1&&(s(0,"div",33),b(1,Yo,8,8,null,null,_o),c()),e&2){let t=n();r(),S(t.closeTypes)}}function Qo(e,i){if(e&1){let t=x();s(0,"p-button",39),v("click",function(){f(t);let a=n();return h(a.closeModal())}),c(),s(1,"p-button",40),v("click",function(){f(t);let a=n();return h(a.onSubmit())}),c()}if(e&2){let t=n();m("label",t.LabelButtonActionEnum.CANCEL)("icon",t.IconButtonActionEnum.CANCEL)("text",!0)("severity",t.SeverityButtonActionEnum.CANCEL),r(),m("icon",t.IconButtonActionEnum.UPLOAD)("label",t.LabelButtonActionEnum.UPLOAD)("severity",t.SeverityButtonActionEnum.UPLOAD)}}function Xo(e,i){if(e&1&&u(0,"app-closing-log-list",13),e&2){let t=n();m("agreementId",t.agreementId)}}var Nt=(()=>{let i=class i{constructor(){this.periodsOut=new be,this.activatedRoute=d(Se),this.authService=d(J),this.coreService=d(N),this.confirmationService=d(me),this.formBuilder=d(Ce),this.cataloguesHttpService=d(de),this.periodsHttpService=d(Xe),this.trackingLogsHttpService=d(Y),this.closingLogsHttpService=d(we),this.agreementsHttpService=d(ge),this.filesHttpService=d(De),this.breadcrumbService=d(pe),this.PrimeIcons=D,this.IconButtonActionEnum=H,this.SeverityButtonActionEnum=q,this.LabelButtonActionEnum=O,this.BreadcrumbEnum=w,this.TableEnum=j,this.messageService=d(W),this.messageDialogService=d(V),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new Q(""),this.items=[],this.formErrors=[],this.files=[],this.types=[],this.closeTypes=[],this.trackingLogType="execution",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Ae,this.CatalogueTrackingLogsStateEnum=Ee,this.CatalogueClosingNotificationsCloseTypesDocumentEnum=Qe,this.FileEnum=Ie,this.validPeriodsClosing=!1,this.validPeriodsExecution=!1,this.breadcrumbService.setItems([{label:w.AGREEMENTS,routerLink:["/core/agreement-administrator/agreement-list"]},{label:w.PERIODS}]),this.buildForm(),this.buildButtonActions(),this.buildColumns()}ngOnInit(){this.findClosingLogCurrentByAgreement(),this.findAgreement(this.agreementId),this.loadTypes(),this.loadTypesByCloseType(),setTimeout(()=>{this.validatePeriods()},500),this.activatedRoute.queryParams.subscribe(o=>{this.trackingLogType=o.type})}buildForm(){this.form=this.formBuilder.group({reportFile:[null,R.required],evidenceFile:[null]})}findAgreement(o){this.agreementsHttpService.findOne(o).subscribe(a=>{this.agreement=a})}findClosingLogCurrentByAgreement(){this.closingLogsHttpService.findClosingLogCurrentByAgreement(this.agreementId).subscribe(o=>{o&&(this.items=[o])})}loadTypes(){this.types=this.cataloguesHttpService.findByType(_e.PERIODS_TRACKING_LOG)}loadTypesByCloseType(){this.closeTypes=this.cataloguesHttpService.findByParent(this.closingNotification?.closeType?.id)}createClosingLog(){let o=new FormData;for(let a of this.files)o.append("typeIds",a.type.id),o.append("files",a.file);this.closingLogsHttpService.createClosingLog(this.agreementId,o).subscribe(a=>{this.findClosingLogCurrentByAgreement(),this.isVisibleFilesModal=!1})}onUpload(o,a,l){let L=this.files.findIndex(F=>F.type?.id===l.id);L===-1?this.files.push({type:l,file:o.files[0]}):this.files[L]={type:l,file:o.files[0]},a.clear()}openFilesModal(){this.closingNotification?(this.loadTypesByCloseType(),xe(this.trackingLogsHttpService.validationPeriods(this.agreementId,"execution"),this.trackingLogsHttpService.validationPeriods(this.agreementId,"closing")).subscribe(o=>{o.length>0&&(this.validPeriodsExecution=o[0],this.validPeriodsClosing=o[1],this.validPeriodsClosing?this.confirmationService.confirm({key:"confirmDialog",message:"",header:"\xBFEst\xE1 seguro de contar con los documentos habilitantes para el cierre del convenio?",acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.closingLogsHttpService.createPeriodClosing(this.agreementId).subscribe(a=>{xe(this.trackingLogsHttpService.validationPeriods(this.agreementId,"execution"),this.trackingLogsHttpService.validationPeriods(this.agreementId,"closing")).subscribe(l=>{l.length>0&&(this.validPeriodsExecution=l[0],this.validPeriodsClosing=l[1],this.periodsOut.emit(),this.validPeriodsClosing?this.isVisibleFilesModal=!0:this.messageDialogService.errorCustom("Alerta!","No se puede subir la documentaci\xF3n habilitante para el cierre del convenio porque falta reportar o tener aceptados todos los reportes de avance del cierre del convenio"))})})}}):this.messageDialogService.errorCustom("Alerta!","No se puede subir la documentaci\xF3n habilitante para el cierre del convenio porque falta reportar o tener aceptados todos los reportes de avance del cierre del convenio"))})):this.messageDialogService.errorCustom("Importante!","Por favor debe notificar la fecha de Acta de Terminaci\xF3n y Cierre del Convenio")}onSubmit(){this.validateFilesForm()?this.createClosingLog():this.messageDialogService.fieldErrors(this.formErrors)}buildColumns(){this.columns=[{field:"closingLogDocumentsUpload",header:oe.documentName},{field:"closingLogDocuments",header:oe.fileName},{field:"trafficLight",header:oe.trafficLight},{field:"uploadedAt",header:oe.uploadedAt},{field:"user",header:oe.user},{field:"state",header:oe.state}]}buildButtonActions(){this.buttonActions=[{id:Fe.TRACKING_LOG,label:O.TRACKING_LOG,icon:H.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}]}validateButtonActions(o){this.buildButtonActions()}remove(o){}selectItem(o){this.isButtonActions=!0,this.selectedItem=o,this.validateButtonActions(o)}downloadFile(o){this.filesHttpService.downloadFile(o)}validateFilesForm(){return this.formErrors=[],this.closeTypes.forEach(o=>{this.files.find(l=>l.type?.id===o?.id)||this.formErrors.push(o.name)}),this.formErrors.length===0}closeModal(){this.isVisibleFilesModal=!1,this.files=[]}validatePeriods(){this.validPeriodsClosing=!1,this.validPeriodsExecution=!1,this.closingNotification&&xe(this.trackingLogsHttpService.validationPeriods(this.agreementId,"execution"),this.trackingLogsHttpService.validationPeriods(this.agreementId,"closing")).subscribe(o=>{o.length>0&&(this.validPeriodsExecution=o[0],this.validPeriodsClosing=o[1])})}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=I({type:i,selectors:[["app-closing-log-current"]],inputs:{agreementId:"agreementId",closingNotification:"closingNotification"},outputs:{periodsOut:"periodsOut"},decls:14,vars:16,consts:[["dt",""],["uploadFiles",""],["dataKey","id","styleClass","p-datatable-striped",3,"value","columns","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Subir Archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["header","Bit\xE1cora de seguimiento al cierre del Convenio",3,"visibleChange","visible","modal"],[3,"agreementId"],["key","confirmDialog"],["severity","error"],[1,"p-toolbar-group-left"],[3,"icon","label","loading","severity"],[1,"p-toolbar-group-right"],["pTemplate",""],[1,"ml-2"],[3,"click","icon","label","loading","severity"],[1,"text-center"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[1,"ml-2",3,"icon","pTooltip","severity"],[3,"click","icon"],[1,"ml-2",3,"click","icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[1,"p-fluid","grid"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],[3,"for"],[1,"p-error"],["id","report","mode","basic","chooseLabel","Cargar","invalidFileSizeMessageDetail","","name","files[]","accept",".pdf,.rar,.zip",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["severity","info"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(a,l){if(a&1){let L=x();s(0,"p-table",2,0),_(2,vo,7,3,"ng-template",3)(3,Lo,6,1,"ng-template",4)(4,zo,7,4,"ng-template",5)(5,Wo,3,2,"ng-template",6)(6,qo,0,0,"ng-template",7),c(),s(7,"app-button-action",8),v("isHide",function(T){return f(L),h(l.isButtonActions=!T)}),c(),s(8,"p-dialog",9),se("visibleChange",function(T){return f(L),ae(l.isVisibleFilesModal,T)||(l.isVisibleFilesModal=T),h(T)}),_(9,Jo,3,0,"ng-template",10)(10,Qo,2,7,"ng-template",11),c(),s(11,"p-dialog",12),se("visibleChange",function(T){return f(L),ae(l.isVisibleTrackingLogModal,T)||(l.isVisibleTrackingLogModal=T),h(T)}),_(12,Xo,1,1,"app-closing-log-list",13),c(),u(13,"p-confirmDialog",14)}a&2&&(m("value",l.items)("columns",l.columns)("loading",l.coreService.isLoading),r(7),m("buttonActions",l.buttonActions)("enabled",l.isButtonActions),r(),re(ce(14,uo)),le("visible",l.isVisibleFilesModal),m("modal",!0),r(3),re(ce(15,go)),le("visible",l.isVisibleTrackingLogModal),m("modal",!0),r(),g(12,l.isVisibleTrackingLogModal?12:-1))},dependencies:[X,M,Z,te,ee,ie,$,ke,fe,He,Ve,Ne,Me,Oe,Mt,z],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let e=i;return e})();function en(e,i){if(e&1&&u(0,"app-period-tacking-log-list",3),e&2){let t=n(2);m("agreementId",t.agreementId)}}function tn(e,i){if(e&1){let t=x();_(0,en,1,1,"app-period-tacking-log-list",3),s(1,"app-closing-log-current",4),v("periodsOut",function(){f(t);let a=n();return h(a.refreshPeriodTrackingLog())}),c()}if(e&2){let t=n();g(0,t.periodChange?0:-1),r(),m("agreementId",t.agreementId)("closingNotification",t.closingNotification)}}var Vt=(()=>{let i=class i{constructor(){this.periodChange=!0}refreshPeriodTrackingLog(){this.periodChange=!1,setTimeout(()=>{this.periodChange=!0},500)}};i.\u0275fac=function(a){return new(a||i)},i.\u0275cmp=I({type:i,selectors:[["app-closing-process"]],inputs:{agreementId:"agreementId"},decls:3,vars:2,consts:[[3,"closingNotificationOut","agreementId"],[3,"agreementId","closingNotification"],["key","confirmDialog"],[3,"agreementId"],[3,"periodsOut","agreementId","closingNotification"]],template:function(a,l){a&1&&(s(0,"app-closing-notification",0),v("closingNotificationOut",function(F){return l.closingNotification=F}),c(),_(1,tn,2,3,"app-closing-log-current",1),u(2,"p-confirmDialog",2)),a&2&&(m("agreementId",l.agreementId),r(),g(1,l.closingNotification?1:-1))},dependencies:[Oe,kt,Pt,Nt]});let e=i;return e})();var on=[{path:"a/:agreementId",component:Vt}],Ot=(()=>{let i=class i{};i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=Te({type:i}),i.\u0275inj=Le({imports:[Ue.forChild(on),Ue]});let e=i;return e})();var Wr=(()=>{let i=class i{};i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=Te({type:i}),i.\u0275inj=Le({imports:[Ye,Ot,vt,xt,$,it,Ct,It,St,Lt,ht,gt,pt,bt,_t,ct,Et]});let e=i;return e})();export{Wr as ClosingProcessModule};
