import{a as Jt,b as Xt}from"./chunk-PA44NL7E.js";import{b as Mt}from"./chunk-F2YT2OT5.js";import{a as Yt,b as Qt}from"./chunk-QQDTH5XV.js";import"./chunk-627X2FBC.js";import"./chunk-ISADC5UE.js";import{d as Pt,e as kt}from"./chunk-PCAWTIGC.js";import{A as wt,Aa as Wt,B as ye,C as Ce,Ga as he,Ha as zt,Ja as at,Ka as qt,La as Ie,Q as ze,R as Bt,Xa as Kt,Ya as jt,ba as Vt,d as lt,fa as Rt,ha as K,i as Ae,ia as X,ja as le,k as J,ka as ae,m as de,n as _e,na as Ot,o as Ft,p as re,pa as qe,q as It,qa as Gt,r as ue,ra as Ke,t as Le,ta as Ve,ua as Ht,v as Te,va as Fe,w as ge,wa as $t,y as Dt,za as Ut}from"./chunk-UA443E4I.js";import{j as q,k as yt,m as fe,n as Nt}from"./chunk-RX3J5GNH.js";import{A as ce,Aa as Tt,Ba as We,D as xt,Da as z,E as Ee,H as se,I as vt,J as Qe,K as _t,L as M,M as S,N as A,O as W,P as D,Q as Et,S as Q,T as Me,ba as be,ca as ot,e as Be,ea as bt,fa as Ne,ga as y,ia as pe,ja as He,k as N,ka as St,la as Pe,ma as oe,na as ke,o as G,r as $,s as ie,u as ne,ua as Se,v as U,va as At,wa as rt,x as ht,xa as Lt,z as me}from"./chunk-QNM73EAO.js";import{Aa as E,Ba as v,Ca as o,E as et,H as _,J as R,Ja as Ge,K as tt,La as p,Ma as F,Mb as Ue,Na as C,O as f,Oa as Z,Ob as nt,P as h,Pa as gt,Qa as P,Ra as k,Rb as dt,Sa as V,Wa as Y,Xa as it,_ as r,eb as I,fb as xe,gb as O,ja as d,ka as ee,la as c,oa as j,p as pt,pa as H,qa as g,ra as B,sa as L,ta as T,tb as Ct,ua as s,va as m,w as we,wa as u,yb as te,zb as ft}from"./chunk-EUOB27Q6.js";var fi=t=>({enabled:t});function hi(t,i){if(t&1&&(s(0,"div",10)(1,"h1"),p(2),m()()),t&2){let e=o();r(2),F(e.BreadcrumbEnum.AGREEMENTS)}}function xi(t,i){if(t&1&&(s(0,"th",11),p(1),u(2,"p-sortIcon",13),m()),t&2){let e=i.$implicit;c("pSortableColumn",e.field),r(),C(" ",e.header," "),r(),c("field",e.field)}}function vi(t,i){if(t&1&&(s(0,"tr"),L(1,xi,3,3,"th",11,B),s(3,"th",12),p(4),m()()),t&2){let e=i.$implicit,n=o();r(),T(e),r(3),C(" ",n.TableEnum.ACTIONS," ")}}function Ei(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field].unit.name," ")}}function bi(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field].state.name," ")}}function Si(t,i){if(t&1&&d(0,Ei,1,1)(1,bi,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="administrator"?0:e==="agreementState"?1:-1)}}function Ai(t,i){if(t&1&&(p(0),I(1,"customFormatDate")),t&2){let e=o(4).$implicit;C(" ",xe(1,1,e.subscribedAt)," ")}}function Li(t,i){if(t&1&&d(0,Ai,2,3),t&2){let e=o(3).$implicit;g(0,e.subscribedAt?0:-1)}}function Ti(t,i){if(t&1&&(p(0),I(1,"customFormatDate")),t&2){let e=o(4).$implicit;C(" ",xe(1,1,e.endedAt)," ")}}function yi(t,i){t&1&&p(0," Indefinido ")}function Fi(t,i){if(t&1&&d(0,Ti,2,3)(1,yi,1,0),t&2){let e=o(3).$implicit;g(0,e.endedAt?0:1)}}function Ii(t,i){if(t&1&&(p(0),I(1,"yesNo")),t&2){let e=o(3).$implicit;C(" ",xe(1,1,e.isFinancing)," ")}}function Di(t,i){t&1&&u(0,"p-tag",16)}function wi(t,i){t&1&&u(0,"p-tag",17)}function Bi(t,i){if(t&1&&d(0,Di,1,0,"p-tag",16)(1,wi,1,0),t&2){let e=o(3).$implicit;g(0,e.enabled?0:1)}}function Mi(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field]," ")}}function Ni(t,i){if(t&1&&d(0,Li,1,1)(1,Fi,2,1)(2,Ii,2,3)(3,Bi,2,1)(4,Mi,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="subscribedAt"?0:e==="endedAt"?1:e==="isFinancing"?2:e==="enabled"?3:4)}}function Pi(t,i){if(t&1&&(s(0,"td"),d(1,Si,2,1)(2,Ni,5,1),m()),t&2){let e=i.$implicit,n=o().$implicit;r(),g(1,n[e.field]!=null&&n[e.field].id?1:-1),r(),g(2,n[e.field]!=null&&n[e.field].id?-1:2)}}function ki(t,i){if(t&1){let e=E();s(0,"tr",14),L(1,Pi,3,2,"td",null,B),s(3,"td",12)(4,"p-button",15),v("click",function(){let l=f(e).$implicit,a=o();return h(a.selectItem(l))}),m()()()}if(t&2){let e=i.$implicit,n=i.columns,l=i.rowIndex,a=o();c("pSelectableRow",e)("pSelectableRowIndex",l)("ngClass",it(4,fi,!e.enabled)),r(),T(n),r(3),c("icon",a.PrimeIcons.ELLIPSIS_V)}}function Vi(t,i){if(t&1&&(s(0,"tr")(1,"td"),p(2),m()()),t&2){let e=i.$implicit,n=o();r(),ee("colspan",e.length),r(),C(" ",n.messageService.paginatorNoRecordsFound," ")}}function Ri(t,i){}function Oi(t,i){if(t&1&&u(0,"app-view",9),t&2){let e=o();c("id",e.selectedItem.id)}}var ei=(()=>{let i=class i{constructor(){this.authService=_(z),this.coreService=_($),this.agreementsHttpService=_(ke),this.agreementsService=_(ht),this.router=_(nt),this.breadcrumbService=_(ne),this.PrimeIcons=N,this.IconButtonActionEnum=A,this.SeverityButtonActionEnum=W,this.LabelButtonActionEnum=S,this.BreadcrumbEnum=D,this.TableEnum=Q,this.messageService=_(ie),this.messageDialogService=_(U),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new re(""),this.items=[],this.isVisibleAgreementView=!1,this.breadcrumbService.setItems([{label:D.AGREEMENTS}]),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(we(500)).subscribe(n=>{this.findAgreements()})}ngOnInit(){this.findAgreements()}findAgreements(){this.authService.role.code===_t.NATIONAL_MANAGER&&this.agreementsHttpService.findNationalManagerAgreementsByOrigin().subscribe(n=>{this.items=n}),this.authService.role.code===_t.INTERNATIONAL_MANAGER&&this.agreementsHttpService.findInternationalManagerAgreementsByOrigin().subscribe(n=>{this.items=n})}buildColumns(){this.columns=[{field:"number",header:be.number},{field:"internalNumber",header:be.internalNumber},{field:"name",header:be.name},{field:"administrator",header:bt.header},{field:"agreementState",header:ot.state},{field:"subscribedAt",header:be.subscribedAt},{field:"endedAt",header:be.endedAt},{field:"isFinancing",header:be.isFinancing},{field:"enabled",header:be.enabled}]}buildButtonActions(){this.buttonActions=[{id:M.AGREEMENT,label:S.AGREEMENT,icon:A.AGREEMENT,command:()=>{this.selectedItem?.id&&this.redirectViewAgreement()}},{id:M.AGREEMENT_LOG,label:S.AGREEMENT_LOG,icon:A.AGREEMENT_LOG,command:()=>{this.selectedItem?.id&&this.redirectAgreementLogForm(this.selectedItem.id)}}]}validateButtonActions(n){this.buildButtonActions(),n.initialState?.code===se.CURRENT&&this.buttonActions.push({id:M.AGREEMENT_TRACKING_PERIOD,label:S.MANAGER_AGREEMENT_TRACKING_PERIOD,icon:A.MANAGER_AGREEMENT_TRACKING_PERIOD,command:()=>{this.selectedItem?.id&&this.redirectTrackingLogList(this.selectedItem.id)}},{id:M.AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,label:S.MANAGER_AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,icon:A.MANAGER_AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,command:()=>{this.selectedItem?.id&&this.redirectAgreementTerminationList(this.selectedItem.id)}},{id:M.MANAGER_AGREEMENT_CLOSED,label:S.MANAGER_AGREEMENT_CLOSED,icon:A.MANAGER_AGREEMENT_CLOSED,command:()=>{this.selectedItem?.id&&this.redirectClosedAgreement(this.selectedItem.id)}}),n.initialState?.code===se.CLOSING_PROCESS&&this.buttonActions.push({id:M.AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,label:S.MANAGER_AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,icon:A.MANAGER_AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,command:()=>{this.selectedItem?.id&&this.redirectAgreementTerminationList(this.selectedItem.id)}},{id:M.MANAGER_AGREEMENT_CLOSED,label:S.MANAGER_AGREEMENT_CLOSED,icon:A.MANAGER_AGREEMENT_CLOSED,command:()=>{this.selectedItem?.id&&this.redirectClosedAgreement(this.selectedItem.id)}}),n.initialState?.code===se.CLOSED&&this.buttonActions.push({id:M.AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,label:S.MANAGER_AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,icon:A.MANAGER_AGREEMENT_CLOSING_MANAGEMENT_SUPERVISION,command:()=>{this.selectedItem?.id&&this.redirectAgreementTerminationList(this.selectedItem.id)}},{id:M.MANAGER_AGREEMENT_CLOSED,label:S.MANAGER_AGREEMENT_CLOSED,icon:A.MANAGER_AGREEMENT_CLOSED,command:()=>{this.selectedItem?.id&&this.redirectClosedAgreement(this.selectedItem.id)}})}redirectCreateForm(){this.agreementsService.clearAgreement(),this.router.navigate(["/core/agreements","register"])}redirectViewAgreement(){this.isVisibleAgreementView=!0}redirectAgreementLogForm(n){this.router.navigate(["/core/agreements/log",n])}redirectTrackingLogList(n){this.router.navigate([`/core/${this.authService.role.code}/period-list`,n])}remove(n){}paginate(n){}selectItem(n){this.agreementsHttpService.findOne(n.id).subscribe(l=>{this.isButtonActions=!0,this.selectedItem=l,this.validateButtonActions(l),this.agreementsService.agreement=l})}redirectAgreementTerminationList(n){this.router.navigate([`/core/${this.authService.role.code}/agreement-termination-list`,n],{queryParams:{type:"closing"}})}redirectClosedAgreement(n){this.router.navigate([`/core/${this.authService.role.code}/closed-agreement`,n])}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-agreement-list"]],decls:10,vars:10,consts:[["dt",""],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Convenio",3,"visibleChange","visible","modal"],[3,"id"],[1,"flex"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex","ngClass"],[3,"click","icon"],["severity","info","value","Registrado"],["severity","danger","value","En Proceso"]],template:function(l,a){if(l&1){let b=E();s(0,"p-table",1,0),d(2,hi,3,1,"ng-template",2)(3,vi,5,1,"ng-template",3)(4,ki,5,6,"ng-template",4)(5,Vi,3,2,"ng-template",5)(6,Ri,0,0,"ng-template",6),m(),s(7,"app-button-action",7),v("isHide",function(x){return f(b),h(a.isButtonActions=!x)}),m(),s(8,"p-dialog",8),V("visibleChange",function(x){return f(b),k(a.isVisibleAgreementView,x)||(a.isVisibleAgreementView=x),h(x)}),d(9,Oi,1,1,"app-view",9),m()}l&2&&(c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading),r(7),c("buttonActions",a.buttonActions)("enabled",a.isButtonActions),r(),P("visible",a.isVisibleAgreementView),c("modal",!0),r(),g(9,a.selectedItem&&a.isVisibleAgreementView?9:-1))},dependencies:[Ct,Ie,G,q,K,X,ae,le,Ut,he,Yt,Tt,We],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=i;return t})();function Gi(t,i){if(t&1&&(s(0,"div",10)(1,"h2"),p(2),I(3,"customFormatDate"),I(4,"customFormatDate"),m()()),t&2){let e=o();r(2),gt(" ",e.period.name,": ",xe(3,3,e.period.startedAt)," - ",xe(4,5,e.period.endedAt)," ")}}function Hi(t,i){if(t&1&&(s(0,"th",11),p(1),u(2,"p-sortIcon",12),m()),t&2){let e=i.$implicit;c("pSortableColumn",e.field),r(),C(" ",e.header," "),r(),c("field",e.field)}}function $i(t,i){if(t&1&&(s(0,"tr"),L(1,Hi,3,3,"th",11,B),m()),t&2){let e=i.$implicit;r(),T(e)}}function Ui(t,i){if(t&1&&(u(0,"br"),s(1,"b"),p(2,"Comentario: "),m(),p(3)),t&2){let e=o(4).$implicit;r(3),C("",e.observation," ")}}function Wi(t,i){if(t&1&&(p(0),d(1,Ui,4,1)),t&2){let e=o(3).$implicit;Z(" ",e.user.name," ",e.user.lastname," "),r(),g(1,e.observation?1:-1)}}function zi(t,i){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e.state.name," ")}}function qi(t,i){if(t&1&&d(0,Wi,2,3)(1,zi,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="user"?0:e==="state"?1:-1)}}function Ki(t,i){if(t&1&&(p(0),I(1,"date")),t&2){let e=o(4).$implicit;C(" ",O(1,1,e.registeredAt,"dd/MM/yy - HH:mm")," ")}}function ji(t,i){if(t&1&&d(0,Ki,2,4),t&2){let e=o(3).$implicit;g(0,e.registeredAt?0:-1)}}function Yi(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field]," ")}}function Qi(t,i){if(t&1&&d(0,ji,1,1)(1,Yi,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="registeredAt"?0:1)}}function Ji(t,i){if(t&1&&(s(0,"td"),d(1,qi,2,1)(2,Qi,2,1),m()),t&2){let e=i.$implicit,n=o().$implicit;r(),g(1,n[e.field]!=null&&n[e.field].id?1:-1),r(),g(2,n[e.field]!=null&&n[e.field].id?-1:2)}}function Xi(t,i){if(t&1&&(s(0,"tr",13),L(1,Ji,3,2,"td",null,B),m()),t&2){let e=i.$implicit,n=i.columns,l=i.rowIndex;c("pSelectableRow",e)("pSelectableRowIndex",l),r(),T(n)}}function Zi(t,i){if(t&1&&(s(0,"tr")(1,"td"),p(2),m()()),t&2){let e=i.$implicit,n=o();r(),ee("colspan",e.length),r(),C(" ",n.messageService.paginatorNoRecordsFound," ")}}function en(t,i){}var je=(()=>{let i=class i{constructor(){this.authService=_(z),this.coreService=_($),this.router=_(nt),this.trackingLogsHttpService=_(Se),this.PrimeIcons=N,this.IconButtonActionEnum=A,this.SeverityButtonActionEnum=W,this.LabelButtonActionEnum=S,this.BreadcrumbEnum=D,this.TableEnum=Q,this.messageService=_(ie),this.messageDialogService=_(U),this.buttonActions=[],this.columns=[],this.search=new re(""),this.items=[],this.isVisibleAgreementView=!1,this.buildColumns()}ngOnInit(){this.items=this.period.trackingLogs}buildColumns(){this.columns=[{field:"state",header:pe.state},{field:"registeredAt",header:pe.registeredAt},{field:"user",header:pe.user}]}redirectAgreementLogForm(n){this.router.navigate(["/core/agreements/log",n])}downloadLog(){this.trackingLogsHttpService.downloadLog(this.period.id,this.trackingLogType)}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-tracking-log-list"]],inputs:{period:"period",trackingLogType:"trackingLogType"},decls:11,vars:9,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"ml-2",3,"click","icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[1,"flex"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"]],template:function(l,a){if(l&1){let b=E();s(0,"p-toolbar")(1,"div",1)(2,"p-button",2),v("click",function(){return f(b),h(a.downloadLog())}),m()(),u(3,"div",3),m(),s(4,"p-table",4,0),d(6,Gi,5,7,"ng-template",5)(7,$i,3,0,"ng-template",6)(8,Xi,3,2,"ng-template",7)(9,Zi,3,2,"ng-template",8)(10,en,0,0,"ng-template",9),m()}l&2&&(r(2),c("icon",a.IconButtonActionEnum.DOWNLOAD)("label",a.LabelButtonActionEnum.DOWNLOAD)("loading",a.coreService.isLoading)("severity",a.SeverityButtonActionEnum.SYNC),r(2),c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading))},dependencies:[G,qe,q,K,X,ae,le,te,We],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=i;return t})();var nn=()=>({width:"50rem"});function on(t,i){if(t&1&&(s(0,"div",13)(1,"h2"),p(2),m()()),t&2){let e=o();r(2),F(e.BreadcrumbEnum.ADDITIONAL_DOCUMENTS_MANAGER)}}function rn(t,i){if(t&1&&(s(0,"th",14),p(1),u(2,"p-sortIcon",15),m()),t&2){let e=i.$implicit;c("pSortableColumn",e.field),r(),C(" ",e.header," "),r(),c("field",e.field)}}function ln(t,i){if(t&1&&(s(0,"tr"),L(1,rn,3,3,"th",14,B),m()),t&2){let e=i.$implicit;r(),T(e)}}function an(t,i){if(t&1&&p(0),t&2){let e=o(4).$implicit;Z(" ",e.user.name," ",e.user.lastname," ")}}function sn(t,i){if(t&1&&d(0,an,1,2),t&2){let e=o(3).$implicit;g(0,e!=null&&e.user?0:-1)}}function mn(t,i){if(t&1&&d(0,sn,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="user"?0:-1)}}function cn(t,i){if(t&1){let e=E();s(0,"span"),p(1),m(),s(2,"p-button",17),v("click",function(){let l=f(e).$implicit,a=o(5);return h(a.downloadFile(l))}),m(),u(3,"p-divider")}if(t&2){let e=i.$implicit,n=o(5);r(),C("",e.type.name,": "),r(),c("icon",n.IconButtonActionEnum.DOWNLOAD)("label",e.name)("text",!0)("severity",n.SeverityButtonActionEnum.DOWNLOAD)}}function pn(t,i){if(t&1&&L(0,cn,4,5,null,null,B),t&2){let e=o(3).$implicit;T(e==null?null:e.additionalDocuments)}}function dn(t,i){if(t&1&&p(0),t&2){let e=o(3).$implicit;Z(" ",e.name," ",e.sequence," ")}}function _n(t,i){if(t&1&&(p(0),I(1,"date")),t&2){let e=o(3).$implicit;C(" ",O(1,1,e.uploadedAt,"dd/MM/y - HH:mm")," ")}}function un(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field]," ")}}function gn(t,i){if(t&1&&d(0,pn,2,0)(1,dn,1,2)(2,_n,2,4)(3,un,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="additionalDocuments"?0:e==="name"?1:e==="uploadedAt"?2:3)}}function Cn(t,i){if(t&1&&(s(0,"td"),d(1,mn,1,1)(2,gn,4,1),m()),t&2){let e=i.$implicit,n=o().$implicit;r(),g(1,n[e.field]!=null&&n[e.field].id?1:-1),r(),g(2,n[e.field]!=null&&n[e.field].id?-1:2)}}function fn(t,i){if(t&1&&(s(0,"tr",16),L(1,Cn,3,2,"td",null,B),m()),t&2){let e=i.$implicit,n=i.columns,l=i.rowIndex;c("pSelectableRow",e)("pSelectableRowIndex",l),r(),T(n)}}function hn(t,i){if(t&1&&(s(0,"tr")(1,"td"),p(2),m()()),t&2){let e=i.$implicit,n=o();r(),ee("colspan",e.length),r(),C(" ",n.messageService.paginatorNoRecordsFound," ")}}function xn(t,i){}function vn(t,i){if(t&1&&(u(0,"i"),s(1,"div",30),p(2),m()),t&2){let e=o(3);H(e.PrimeIcons.FILE_PDF),r(2),F(e.reportFileField.value==null?null:e.reportFileField.value.name)}}function En(t,i){t&1&&(s(0,"div",23)(1,"p-messages",28),d(2,vn,3,3,"ng-template",29),m()())}function bn(t,i){if(t&1&&(u(0,"i"),s(1,"div",30),p(2),m()),t&2){let e=o(3);H(e.PrimeIcons.FILE_PDF),r(2),F(e.evidenceFileField.value==null?null:e.evidenceFileField.value.name)}}function Sn(t,i){t&1&&(s(0,"div",23)(1,"p-messages",28),d(2,bn,3,3,"ng-template",29),m()())}function An(t,i){if(t&1){let e=E();s(0,"form",18)(1,"div",19),u(2,"label",20),s(3,"p-fileUpload",21,1),v("uploadHandler",function(l){f(e);let a=Ge(4),b=o();return h(b.uploadReportFile(l,a))}),m(),u(5,"small",22),m(),d(6,En,3,0,"div",23),s(7,"div",19),u(8,"label",24),s(9,"p-fileUpload",25,1),v("uploadHandler",function(l){f(e);let a=Ge(4),b=o();return h(b.uploadEvidenceFile(l,a))}),m(),u(11,"small",22),m(),d(12,Sn,3,0,"div",23),s(13,"div",23),u(14,"label",26)(15,"textarea",27)(16,"small",22),m()()}if(t&2){let e=o();c("formGroup",e.form),r(2),c("label",e.AdditionalDocumentEnum.reportFile)("required",e.reportFileField),r(),c("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),r(2),c("errors",e.reportFileField.errors)("touched",e.reportFileField.touched)("dirty",e.reportFileField.dirty),r(),g(6,e.reportFileField.value?6:-1),r(2),c("label",e.AdditionalDocumentEnum.evidenceFile)("required",e.evidenceFileField),r(),c("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),r(2),c("errors",e.evidenceFileField.errors)("touched",e.evidenceFileField.touched)("dirty",e.evidenceFileField.dirty),r(),g(12,e.evidenceFileField.value?12:-1),r(2),c("label",e.AdditionalDocumentEnum.detail)("required",e.detailField),r(2),c("errors",e.detailField.errors)("touched",e.detailField.touched)("dirty",e.detailField.dirty)}}function Ln(t,i){if(t&1){let e=E();s(0,"p-button",31),v("click",function(){f(e);let l=o();return h(l.isVisibleFilesModal=!1)}),m(),s(1,"p-button",32),v("click",function(){f(e);let l=o();return h(l.onUpload())}),m()}if(t&2){let e=o();c("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),r(),c("icon",e.IconButtonActionEnum.REPORT)("label",e.LabelButtonActionEnum.REPORT)("severity",e.SeverityButtonActionEnum.REPORT)}}var oi=(()=>{let i=class i{constructor(){this.authService=_(z),this.coreService=_($),this.formBuilder=_(ge),this.cataloguesHttpService=_(me),this.trackingLogsHttpService=_(Se),this.filesHttpService=_(oe),this.confirmationService=_(Be),this.breadcrumbService=_(ne),this.PrimeIcons=N,this.IconButtonActionEnum=A,this.SeverityButtonActionEnum=W,this.LabelButtonActionEnum=S,this.BreadcrumbEnum=D,this.TableEnum=Q,this.messageService=_(ie),this.messageDialogService=_(U),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new re(""),this.items=[],this.formErrors=[],this.types=[],this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Ne,this.CatalogueTrackingLogsStateEnum=Ee,this.AdditionalDocumentEnum=He,this.FileEnum=Me,this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(we(500)).subscribe(n=>{this.findAdditionalDocumentsByAgreement()})}ngOnInit(){this.findAdditionalDocumentsByAgreement(),this.loadTypes()}buildForm(){this.form=this.formBuilder.group({reportFile:[null],evidenceFile:[null],detail:[null,J.required]})}findAdditionalDocumentsByAgreement(){this.trackingLogsHttpService.findExecutionAdditionalDocumentsByAgreement(this.agreementId).subscribe(n=>{this.items=n})}loadTypes(){this.types=this.cataloguesHttpService.findByType(ce.PERIODS_TRACKING_LOG)}buildColumns(){this.columns=[{field:"name",header:He.name},{field:"detail",header:He.detail},{field:"additionalDocuments",header:He.additionalDocuments},{field:"uploadedAt",header:He.uploadedAt},{field:"user",header:He.user}]}buildButtonActions(){this.buttonActions=[{id:M.TRACKING_LOG,label:S.TRACKING_LOG,icon:A.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}]}validateButtonActions(n){this.buildButtonActions()}remove(n){this.confirmationService.confirm({key:"confirmDialog",message:"No se podr\xE1 recuperar la informaci\xF3n",header:"\xBFEst\xE1 seguro de eliminar?",icon:N.TRASH,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.trackingLogsHttpService.deleteAdditionalDocument(n).subscribe(l=>{this.findAdditionalDocumentsByAgreement()})}})}selectItem(n){this.isButtonActions=!0,this.selectedItem=n,this.validateButtonActions(n)}showFilesModal(){this.isVisibleFilesModal=!0}downloadFile(n){this.filesHttpService.downloadFile(n)}onUpload(){if(this.validateFilesForm()){let n=new FormData;n.append("report",this.reportFileField.value),n.append("evidence",this.evidenceFileField.value),n.append("detail",this.detailField.value),this.trackingLogsHttpService.createExecutionAdditionalDocument(this.agreementId,n).subscribe(l=>{this.findAdditionalDocumentsByAgreement(),this.isVisibleFilesModal=!1})}else this.messageDialogService.fieldErrors(this.formErrors)}validateFilesForm(){return this.formErrors=[],this.reportFileField.invalid&&this.formErrors.push(y.reportFile),this.evidenceFileField.invalid&&this.formErrors.push(y.evidenceFile),this.formErrors.length===0}uploadReportFile(n,l){this.reportFileField.patchValue(n.files[0]),l.clear()}uploadEvidenceFile(n,l){this.evidenceFileField.patchValue(n.files[0]),l.clear()}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}get detailField(){return this.form.controls.detail}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-additional-document-list"]],inputs:{agreementId:"agreementId"},decls:12,vars:12,consts:[["dt",""],["uploadFiles",""],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Subir archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["key","confirmDialog"],[1,"flex"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[1,"ml-2",3,"click","icon","label","text","severity"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","report",3,"label","required"],["id","report","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appErrorMessage","",3,"errors","touched","dirty"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","evidence",3,"label","required"],["id","evidence","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appLabel","","for","detail",3,"label","required"],["pInputTextarea","","id","detail","formControlName","detail"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(l,a){if(l&1){let b=E();s(0,"p-table",2,0),d(2,on,3,1,"ng-template",3)(3,ln,3,0,"ng-template",4)(4,fn,3,2,"ng-template",5)(5,hn,3,2,"ng-template",6)(6,xn,0,0,"ng-template",7),m(),s(7,"app-button-action",8),v("isHide",function(x){return f(b),h(a.isButtonActions=!x)}),m(),s(8,"p-dialog",9),V("visibleChange",function(x){return f(b),k(a.isVisibleFilesModal,x)||(a.isVisibleFilesModal=x),h(x)}),d(9,An,17,28,"ng-template",10)(10,Ln,2,7,"ng-template",11),m(),u(11,"p-confirmDialog",12)}l&2&&(c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading),r(7),c("buttonActions",a.buttonActions)("enabled",a.isButtonActions),r(),j(Y(11,nn)),P("visible",a.isVisibleFilesModal),c("modal",!0))},dependencies:[ye,Ce,Ie,G,q,ue,Ae,de,_e,K,X,ae,le,Le,Te,he,Ve,Ke,fe,Fe,at,te],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=i;return t})();var yn=()=>({width:"100%"}),ri=()=>({width:"35rem"});function Fn(t,i){if(t&1&&(s(0,"div",18)(1,"h1"),p(2),m()()),t&2){let e=o();r(2),F(e.BreadcrumbEnum.PERIODS_MANAGER)}}function In(t,i){if(t&1&&(s(0,"th",19),p(1),u(2,"p-sortIcon",21),m()),t&2){let e=i.$implicit;c("pSortableColumn",e.field),r(),C(" ",e.header," "),r(),c("field",e.field)}}function Dn(t,i){if(t&1&&(s(0,"tr"),L(1,In,3,3,"th",19,B),s(3,"th",20),p(4),m()()),t&2){let e=i.$implicit,n=o();r(),T(e),r(3),C(" ",n.TableEnum.ACTIONS," ")}}function wn(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field].unit.name," ")}}function Bn(t,i){if(t&1&&d(0,wn,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="administrator"?0:-1)}}function Mn(t,i){if(t&1){let e=E();s(0,"span"),p(1),m(),s(2,"p-button",24),v("click",function(){let l=f(e).$implicit,a=o(5);return h(a.downloadFile(l))}),m(),u(3,"p-divider")}if(t&2){let e=i.$implicit,n=o(5);r(),C("",e.type.name,": "),r(),c("icon",n.IconButtonActionEnum.DOWNLOAD)("label",e.name)("text",!0)("severity",n.SeverityButtonActionEnum.DOWNLOAD)}}function Nn(t,i){if(t&1&&L(0,Mn,4,5,null,null,B),t&2){let e=o(3).$implicit;T(e==null?null:e.trackingLogDocuments)}}function Pn(t,i){if(t&1&&u(0,"i",26),t&2){let e=o(6);H(e.PrimeIcons.CIRCLE_FILL)}}function kn(t,i){if(t&1&&u(0,"i",27),t&2){let e=o(6);H(e.PrimeIcons.CIRCLE_FILL)}}function Vn(t,i){if(t&1&&d(0,Pn,1,2,"i",25)(1,kn,1,2),t&2){let e=o(4).$implicit;g(0,e.trackingLog.state.code==="REPORTED"||e.trackingLog.state.code==="ACCEPTED"?0:1)}}function Rn(t,i){if(t&1&&u(0,"i",27),t&2){let e=o(5);H(e.PrimeIcons.CIRCLE_FILL)}}function On(t,i){if(t&1&&d(0,Vn,2,1)(1,Rn,1,2),t&2){let e=o(3).$implicit;g(0,e.trackingLog?0:1)}}function Gn(t,i){if(t&1&&(p(0),u(1,"br"),p(2),I(3,"date"),u(4,"br"),p(5),I(6,"date")),t&2){let e=o(3).$implicit;C(" ",e.name," "),r(2),C(" ",O(3,3,e.startedAt,"d MMMM y")," - "),r(3),C(" ",O(6,6,e.endedAt,"d MMMM y")," ")}}function Hn(t,i){if(t&1&&(p(0),I(1,"date")),t&2){let e=o(3).$implicit;C(" ",O(1,1,e.uploadedAt,"dd/MM/y - HH:mm")," ")}}function $n(t,i){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e.trackingLog==null||e.trackingLog.state==null?null:e.trackingLog.state.name," ")}}function Un(t,i){if(t&1&&p(0),t&2){let e=o(4).$implicit;Z(" ",e.trackingLog.user.name," ",e.trackingLog.user.lastname," ")}}function Wn(t,i){if(t&1&&d(0,Un,1,2),t&2){let e=o(3).$implicit;g(0,e.trackingLog!=null&&e.trackingLog.user?0:-1)}}function zn(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field]," ")}}function qn(t,i){if(t&1&&d(0,Nn,2,0)(1,On,2,1)(2,Gn,7,9)(3,Hn,2,4)(4,$n,1,1)(5,Wn,1,1)(6,zn,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="files"?0:e==="trafficLight"?1:e==="name"?2:e==="uploadedAt"?3:e==="state"?4:e==="user"?5:6)}}function Kn(t,i){if(t&1&&(s(0,"td"),d(1,Bn,1,1)(2,qn,7,1),m()),t&2){let e=i.$implicit,n=o().$implicit;r(),g(1,n[e.field]!=null&&n[e.field].id?1:-1),r(),g(2,n[e.field]!=null&&n[e.field].id?-1:2)}}function jn(t,i){if(t&1){let e=E();s(0,"tr",22),L(1,Kn,3,2,"td",null,B),s(3,"td",20)(4,"p-button",23),v("click",function(){let l=f(e).$implicit,a=o();return h(a.selectItem(l))}),m()()()}if(t&2){let e=i.$implicit,n=i.columns,l=i.rowIndex,a=o();c("pSelectableRow",e)("pSelectableRowIndex",l),r(),T(n),r(3),c("icon",a.PrimeIcons.ELLIPSIS_V)}}function Yn(t,i){if(t&1&&(s(0,"tr")(1,"td"),p(2),m()()),t&2){let e=i.$implicit,n=o();r(),ee("colspan",e.length),r(),C(" ",n.messageService.paginatorNoRecordsFound," ")}}function Qn(t,i){}function Jn(t,i){if(t&1&&u(0,"app-tracking-log-list",10),t&2){let e=o();c("period",e.selectedItem)}}function Xn(t,i){t&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de rechazar, no podr\xE1 modificar su elecci\xF3n?"),m())}function Zn(t,i){if(t&1){let e=E();s(0,"p-button",28),v("click",function(){f(e);let l=o();return h(l.isVisibleRefusedModal=!1)}),m(),s(1,"p-button",29),v("click",function(){f(e);let l=o();return h(l.refuseTrackingLogDocuments())}),m()}if(t&2){let e=o();c("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),r(),c("label",e.LabelButtonActionEnum.REFUSED)("icon",e.IconButtonActionEnum.REFUSED)("severity",e.SeverityButtonActionEnum.REFUSED)}}function eo(t,i){t&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de aceptar, no podr\xE1 modificar su elecci\xF3n?"),m())}function to(t,i){if(t&1){let e=E();s(0,"p-button",28),v("click",function(){f(e);let l=o();return h(l.isVisibleAcceptedModal=!1)}),m(),s(1,"p-button",29),v("click",function(){f(e);let l=o();return h(l.acceptTrackingLogDocuments())}),m()}if(t&2){let e=o();c("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),r(),c("label",e.LabelButtonActionEnum.ACCEPTED)("icon",e.IconButtonActionEnum.ACCEPTED)("severity",e.SeverityButtonActionEnum.REFUSED)}}var li=(()=>{let i=class i{constructor(){this.activatedRoute=_(Ue),this.authService=_(z),this.coreService=_($),this.formBuilder=_(ge),this.cataloguesHttpService=_(me),this.trackingLogsHttpService=_(Se),this.filesHttpService=_(oe),this.breadcrumbService=_(ne),this.PrimeIcons=N,this.IconButtonActionEnum=A,this.SeverityButtonActionEnum=W,this.LabelButtonActionEnum=S,this.BreadcrumbEnum=D,this.TableEnum=Q,this.messageService=_(ie),this.messageDialogService=_(U),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new re(""),this.items=[],this.formErrors=[],this.types=[],this.trackingLogType="execution",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.isVisibleRefusedModal=!1,this.isVisibleAcceptedModal=!1,this.AddendumEnum=Ne,this.breadcrumbService.setItems([{label:D.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:D.PERIODS_SUPERVISOR}]),this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(we(500)).subscribe(n=>{this.findPeriodsByAgreement()})}ngOnInit(){this.findPeriodsByAgreement(),this.loadTypes()}buildForm(){this.form=this.formBuilder.group({reportFile:[null,J.required],evidenceFile:[null],observation:[null,J.required]})}findPeriodsByAgreement(){console.log(this.trackingLogType),this.trackingLogsHttpService.findPeriodsByAgreement(this.agreementId,this.trackingLogType).subscribe(n=>{this.items=n})}loadTypes(){this.types=this.cataloguesHttpService.findByType(ce.PERIODS_TRACKING_LOG)}buildColumns(){this.columns=[{field:"name",header:y.reportPeriod},{field:"documentName",header:y.name},{field:"files",header:y.documentName},{field:"trafficLight",header:y.trafficLight},{field:"uploadedAt",header:y.uploadedAt},{field:"user",header:y.user},{field:"state",header:y.state}]}buildButtonActions(){this.buttonActions=[{id:M.TRACKING_LOG,label:S.TRACKING_LOG,icon:A.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}},{id:M.ACCEPTED,label:S.ACCEPTED,icon:A.ACCEPTED,command:()=>{this.isVisibleAcceptedModal=!0}},{id:M.REFUSED,label:S.REFUSED,icon:A.REFUSED,command:()=>{this.isVisibleRefusedModal=!0}}]}validateButtonActions(n){this.buildButtonActions(),(!n.trackingLog||n.trackingLog.state?.code===Ee.ACCEPTED||n.trackingLog.state?.code===Ee.REFUSED)&&(this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===M.ACCEPTED),1),this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===M.REFUSED),1))}selectItem(n){this.isButtonActions=!0,this.selectedItem=n,this.validateButtonActions(n)}downloadFile(n){this.filesHttpService.downloadFile(n)}refuseTrackingLogDocuments(){this.observationFileField.valid?this.trackingLogsHttpService.changeState(this.selectedItem.trackingLog.id,!1,this.observationFileField.value).subscribe(()=>{this.findPeriodsByAgreement(),this.isVisibleRefusedModal=!1}):(this.form.markAllAsTouched(),this.formErrors=[pe.observation],this.messageDialogService.fieldErrors(this.formErrors))}acceptTrackingLogDocuments(){this.trackingLogsHttpService.changeState(this.selectedItem.trackingLog.id,!0).subscribe(()=>{this.findPeriodsByAgreement(),this.isVisibleAcceptedModal=!1})}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}get observationFileField(){return this.form.controls.observation}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-period-list"]],inputs:{agreementId:"agreementId"},decls:22,vars:29,consts:[["dt",""],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],[3,"agreementId"],["header","Bit\xE1cora",3,"visibleChange","visible","modal"],["trackingLogType","execution",3,"period"],["header","Header",3,"visibleChange","visible","modal"],[1,"grid","p-fluid",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","observation","label","Observaci\xF3n",3,"required"],["pInputTextarea","","id","observation","formControlName","observation"],["appErrorMessage","",3,"errors","touched","dirty"],["pTemplate","footer"],[1,"flex"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[3,"click","icon"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[3,"click","label","icon","text","severity"],[3,"click","label","icon","severity"]],template:function(l,a){if(l&1){let b=E();s(0,"p-table",1,0),d(2,Fn,3,1,"ng-template",2)(3,Dn,5,1,"ng-template",3)(4,jn,5,3,"ng-template",4)(5,Yn,3,2,"ng-template",5)(6,Qn,0,0,"ng-template",6),m(),s(7,"app-button-action",7),v("isHide",function(x){return f(b),h(a.isButtonActions=!x)}),m(),u(8,"app-additional-document-list",8),s(9,"p-dialog",9),V("visibleChange",function(x){return f(b),k(a.isVisibleTrackingLogModal,x)||(a.isVisibleTrackingLogModal=x),h(x)}),d(10,Jn,1,1,"app-tracking-log-list",10),m(),s(11,"p-dialog",11),V("visibleChange",function(x){return f(b),k(a.isVisibleRefusedModal,x)||(a.isVisibleRefusedModal=x),h(x)}),d(12,Xn,2,0,"ng-template",3),s(13,"form",12)(14,"div",13),u(15,"label",14)(16,"textarea",15)(17,"small",16),m()(),d(18,Zn,2,7,"ng-template",17),m(),s(19,"p-dialog",11),V("visibleChange",function(x){return f(b),k(a.isVisibleAcceptedModal,x)||(a.isVisibleAcceptedModal=x),h(x)}),d(20,eo,2,0,"ng-template",3)(21,to,2,7,"ng-template",17),m()}l&2&&(c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading),r(7),c("buttonActions",a.buttonActions)("enabled",a.isButtonActions),r(),c("agreementId",a.agreementId),r(),j(Y(26,yn)),P("visible",a.isVisibleTrackingLogModal),c("modal",!0),r(),g(10,a.isVisibleTrackingLogModal?10:-1),r(),j(Y(27,ri)),P("visible",a.isVisibleRefusedModal),c("modal",!0),r(2),c("formGroup",a.form),r(2),c("required",a.observationFileField),r(2),c("errors",a.observationFileField.errors)("touched",a.observationFileField.touched)("dirty",a.observationFileField.dirty),r(2),j(Y(28,ri)),P("visible",a.isVisibleAcceptedModal),c("modal",!0))},dependencies:[ye,Ce,Ie,G,q,ue,Ae,de,_e,K,X,ae,le,Le,Te,he,fe,Fe,je,oi,te],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=i;return t})();var io=()=>({width:"100%"}),ai=()=>({width:"35rem"});function no(t,i){if(t&1&&(s(0,"div",17)(1,"h2"),p(2),m()()),t&2){let e=o();r(2),F(e.BreadcrumbEnum.PERIODS_CLOSING_MANAGER)}}function oo(t,i){if(t&1&&(s(0,"th",18),p(1),u(2,"p-sortIcon",20),m()),t&2){let e=i.$implicit;c("pSortableColumn",e.field),r(),C(" ",e.header," "),r(),c("field",e.field)}}function ro(t,i){if(t&1&&(s(0,"tr"),L(1,oo,3,3,"th",18,B),s(3,"th",19),p(4),m()()),t&2){let e=i.$implicit,n=o();r(),T(e),r(3),C(" ",n.TableEnum.ACTIONS," ")}}function lo(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field].unit.name," ")}}function ao(t,i){if(t&1&&d(0,lo,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="administrator"?0:-1)}}function so(t,i){if(t&1){let e=E();s(0,"span"),p(1),m(),s(2,"p-button",23),v("click",function(){let l=f(e).$implicit,a=o(5);return h(a.downloadFile(l))}),m(),u(3,"p-divider")}if(t&2){let e=i.$implicit,n=o(5);r(),C("",e.type.name,": "),r(),c("icon",n.IconButtonActionEnum.DOWNLOAD)("label",e.name)("text",!0)("severity",n.SeverityButtonActionEnum.DOWNLOAD)}}function mo(t,i){if(t&1&&L(0,so,4,5,null,null,B),t&2){let e=o(3).$implicit;T(e==null?null:e.trackingLogDocuments)}}function co(t,i){if(t&1&&u(0,"i",25),t&2){let e=o(6);H(e.PrimeIcons.CIRCLE_FILL)}}function po(t,i){if(t&1&&u(0,"i",26),t&2){let e=o(6);H(e.PrimeIcons.CIRCLE_FILL)}}function _o(t,i){if(t&1&&d(0,co,1,2,"i",24)(1,po,1,2),t&2){let e=o(4).$implicit;g(0,e.trackingLog.state.code==="REPORTED"||e.trackingLog.state.code==="ACCEPTED"?0:1)}}function uo(t,i){if(t&1&&u(0,"i",26),t&2){let e=o(5);H(e.PrimeIcons.CIRCLE_FILL)}}function go(t,i){if(t&1&&d(0,_o,2,1)(1,uo,1,2),t&2){let e=o(3).$implicit;g(0,e.trackingLog?0:1)}}function Co(t,i){if(t&1&&(p(0),u(1,"br"),p(2),I(3,"date"),u(4,"br"),p(5),I(6,"date")),t&2){let e=o(3).$implicit;C(" ",e.name," "),r(2),C(" ",O(3,3,e.startedAt,"d MMMM y")," - "),r(3),C(" ",O(6,6,e.endedAt,"d MMMM y")," ")}}function fo(t,i){if(t&1&&(p(0),I(1,"date")),t&2){let e=o(3).$implicit;C(" ",O(1,1,e.uploadedAt,"dd/MM/y - HH:mm")," ")}}function ho(t,i){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e.trackingLog==null||e.trackingLog.state==null?null:e.trackingLog.state.name," ")}}function xo(t,i){if(t&1&&p(0),t&2){let e=o(4).$implicit;Z(" ",e.trackingLog.user.name," ",e.trackingLog.user.lastname," ")}}function vo(t,i){if(t&1&&d(0,xo,1,2),t&2){let e=o(3).$implicit;g(0,e.trackingLog!=null&&e.trackingLog.user?0:-1)}}function Eo(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field]," ")}}function bo(t,i){if(t&1&&d(0,mo,2,0)(1,go,2,1)(2,Co,7,9)(3,fo,2,4)(4,ho,1,1)(5,vo,1,1)(6,Eo,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="files"?0:e==="trafficLight"?1:e==="name"?2:e==="uploadedAt"?3:e==="state"?4:e==="user"?5:6)}}function So(t,i){if(t&1&&(s(0,"td"),d(1,ao,1,1)(2,bo,7,1),m()),t&2){let e=i.$implicit,n=o().$implicit;r(),g(1,n[e.field]!=null&&n[e.field].id?1:-1),r(),g(2,n[e.field]!=null&&n[e.field].id?-1:2)}}function Ao(t,i){if(t&1){let e=E();s(0,"tr",21),L(1,So,3,2,"td",null,B),s(3,"td",19)(4,"p-button",22),v("click",function(){let l=f(e).$implicit,a=o();return h(a.selectItem(l))}),m()()()}if(t&2){let e=i.$implicit,n=i.columns,l=i.rowIndex,a=o();c("pSelectableRow",e)("pSelectableRowIndex",l),r(),T(n),r(3),c("icon",a.PrimeIcons.ELLIPSIS_V)}}function Lo(t,i){if(t&1&&(s(0,"tr")(1,"td"),p(2),m()()),t&2){let e=i.$implicit,n=o();r(),ee("colspan",e.length),r(),C(" ",n.messageService.paginatorNoRecordsFound," ")}}function To(t,i){}function yo(t,i){if(t&1&&u(0,"app-tracking-log-list",9),t&2){let e=o();c("period",e.selectedItem)}}function Fo(t,i){t&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de rechazar, no podr\xE1 modificar su elecci\xF3n?"),m())}function Io(t,i){if(t&1){let e=E();s(0,"p-button",27),v("click",function(){f(e);let l=o();return h(l.isVisibleRefusedModal=!1)}),m(),s(1,"p-button",28),v("click",function(){f(e);let l=o();return h(l.refuseTrackingLogDocuments())}),m()}if(t&2){let e=o();c("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),r(),c("label",e.LabelButtonActionEnum.REFUSED)("icon",e.IconButtonActionEnum.REFUSED)("severity",e.SeverityButtonActionEnum.REFUSED)}}function Do(t,i){t&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de aceptar, no podr\xE1 modificar su elecci\xF3n?"),m())}function wo(t,i){if(t&1){let e=E();s(0,"p-button",27),v("click",function(){f(e);let l=o();return h(l.isVisibleAcceptedModal=!1)}),m(),s(1,"p-button",28),v("click",function(){f(e);let l=o();return h(l.acceptTrackingLogDocuments())}),m()}if(t&2){let e=o();c("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),r(),c("label",e.LabelButtonActionEnum.ACCEPTED)("icon",e.IconButtonActionEnum.ACCEPTED)("severity",e.SeverityButtonActionEnum.REFUSED)}}var si=(()=>{let i=class i{constructor(){this.activatedRoute=_(Ue),this.authService=_(z),this.coreService=_($),this.formBuilder=_(ge),this.cataloguesHttpService=_(me),this.trackingLogsHttpService=_(Se),this.filesHttpService=_(oe),this.breadcrumbService=_(ne),this.PrimeIcons=N,this.IconButtonActionEnum=A,this.SeverityButtonActionEnum=W,this.LabelButtonActionEnum=S,this.BreadcrumbEnum=D,this.TableEnum=Q,this.messageService=_(ie),this.messageDialogService=_(U),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new re(""),this.items=[],this.formErrors=[],this.types=[],this.trackingLogType="closing",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.isVisibleRefusedModal=!1,this.isVisibleAcceptedModal=!1,this.AddendumEnum=Ne,this.breadcrumbService.setItems([{label:D.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:D.PERIODS_CLOSING_SUPERVISOR}]),this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(we(500)).subscribe(n=>{this.findPeriodsByAgreement()})}ngOnInit(){this.findPeriodsByAgreement(),this.loadTypes(),this.activatedRoute.queryParams.subscribe(n=>{this.trackingLogType=n.type})}buildForm(){this.form=this.formBuilder.group({reportFile:[null,J.required],evidenceFile:[null],observation:[null,J.required]})}findPeriodsByAgreement(){this.trackingLogsHttpService.findPeriodsByAgreement(this.agreementId,this.trackingLogType).subscribe(n=>{this.items=n})}loadTypes(){this.types=this.cataloguesHttpService.findByType(ce.PERIODS_TRACKING_LOG)}buildColumns(){this.columns=[{field:"name",header:y.reportPeriod},{field:"documentName",header:y.name},{field:"files",header:y.documentName},{field:"trafficLight",header:y.trafficLight},{field:"uploadedAt",header:y.uploadedAt},{field:"user",header:y.user},{field:"state",header:y.state}]}buildButtonActions(){this.buttonActions=[{id:M.TRACKING_LOG,label:S.TRACKING_LOG,icon:A.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}},{id:M.ACCEPTED,label:S.ACCEPTED,icon:A.ACCEPTED,command:()=>{this.isVisibleAcceptedModal=!0}},{id:M.REFUSED,label:S.REFUSED,icon:A.REFUSED,command:()=>{this.isVisibleRefusedModal=!0}}]}validateButtonActions(n){this.buildButtonActions(),(!n.trackingLog||n.trackingLog.state?.code===Ee.ACCEPTED||n.trackingLog.state?.code===Ee.REFUSED)&&(this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===M.ACCEPTED),1),this.buttonActions.splice(this.buttonActions.findIndex(l=>l.id===M.REFUSED),1))}selectItem(n){this.isButtonActions=!0,this.selectedItem=n,this.validateButtonActions(n)}downloadFile(n){this.filesHttpService.downloadFile(n)}refuseTrackingLogDocuments(){this.observationFileField.valid?this.trackingLogsHttpService.changeState(this.selectedItem.trackingLog.id,!1,this.observationFileField.value).subscribe(()=>{this.findPeriodsByAgreement(),this.isVisibleRefusedModal=!1,this.observation=""}):(this.form.markAllAsTouched(),this.formErrors=["Observaci\xF3n"],this.messageDialogService.fieldErrors(this.formErrors))}acceptTrackingLogDocuments(){this.trackingLogsHttpService.changeState(this.selectedItem.trackingLog.id,!0).subscribe(()=>{this.findPeriodsByAgreement(),this.isVisibleAcceptedModal=!1})}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}get observationFileField(){return this.form.controls.observation}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-period-closing-list"]],inputs:{agreementId:"agreementId"},decls:21,vars:28,consts:[["dt",""],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Bit\xE1cora",3,"visibleChange","visible","modal"],["trackingLogType","closing",3,"period"],["header","Header",3,"visibleChange","visible","modal"],[1,"grid","p-fluid",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","observation","label","Observaci\xF3n",3,"required"],["pInputTextarea","","id","observation","formControlName","observation"],["appErrorMessage","",3,"errors","touched","dirty"],["pTemplate","footer"],[1,"flex"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[3,"click","icon"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[3,"click","label","icon","text","severity"],[3,"click","label","icon","severity"]],template:function(l,a){if(l&1){let b=E();s(0,"p-table",1,0),d(2,no,3,1,"ng-template",2)(3,ro,5,1,"ng-template",3)(4,Ao,5,3,"ng-template",4)(5,Lo,3,2,"ng-template",5)(6,To,0,0,"ng-template",6),m(),s(7,"app-button-action",7),v("isHide",function(x){return f(b),h(a.isButtonActions=!x)}),m(),s(8,"p-dialog",8),V("visibleChange",function(x){return f(b),k(a.isVisibleTrackingLogModal,x)||(a.isVisibleTrackingLogModal=x),h(x)}),d(9,yo,1,1,"app-tracking-log-list",9),m(),s(10,"p-dialog",10),V("visibleChange",function(x){return f(b),k(a.isVisibleRefusedModal,x)||(a.isVisibleRefusedModal=x),h(x)}),d(11,Fo,2,0,"ng-template",3),s(12,"form",11)(13,"div",12),u(14,"label",13)(15,"textarea",14)(16,"small",15),m()(),d(17,Io,2,7,"ng-template",16),m(),s(18,"p-dialog",10),V("visibleChange",function(x){return f(b),k(a.isVisibleAcceptedModal,x)||(a.isVisibleAcceptedModal=x),h(x)}),d(19,Do,2,0,"ng-template",3)(20,wo,2,7,"ng-template",16),m()}l&2&&(c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading),r(7),c("buttonActions",a.buttonActions)("enabled",a.isButtonActions),r(),j(Y(25,io)),P("visible",a.isVisibleTrackingLogModal),c("modal",!0),r(),g(9,a.isVisibleTrackingLogModal?9:-1),r(),j(Y(26,ai)),P("visible",a.isVisibleRefusedModal),c("modal",!0),r(2),c("formGroup",a.form),r(2),c("required",a.observationFileField),r(2),c("errors",a.observationFileField.errors)("touched",a.observationFileField.touched)("dirty",a.observationFileField.dirty),r(2),j(Y(27,ai)),P("visible",a.isVisibleAcceptedModal),c("modal",!0))},dependencies:[ye,Ce,Ie,G,q,ue,Ae,de,_e,K,X,ae,le,Le,Te,he,fe,Fe,je,te],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=i;return t})();function Mo(t,i){t&1&&u(0,"div",10)}function No(t,i){if(t&1&&(s(0,"th",11),p(1),u(2,"p-sortIcon",12),m()),t&2){let e=i.$implicit;c("pSortableColumn",e.field),r(),C(" ",e.header," "),r(),c("field",e.field)}}function Po(t,i){if(t&1&&(s(0,"tr"),L(1,No,3,3,"th",11,B),m()),t&2){let e=i.$implicit;r(),T(e)}}function ko(t,i){if(t&1&&(u(0,"br"),s(1,"b"),p(2,"Comentario: "),m(),p(3)),t&2){let e=o(4).$implicit;r(3),C("",e.observation," ")}}function Vo(t,i){if(t&1&&(p(0),d(1,ko,4,1)),t&2){let e=o(3).$implicit;Z(" ",e.user.name," ",e.user.lastname," "),r(),g(1,e.observation?1:-1)}}function Ro(t,i){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e.state.name," ")}}function Oo(t,i){if(t&1&&d(0,Vo,2,3)(1,Ro,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="user"?0:e==="state"?1:-1)}}function Go(t,i){if(t&1&&(p(0),I(1,"date")),t&2){let e=o(4).$implicit;C(" ",O(1,1,e.registeredAt,"dd/MM/yy - HH:mm")," ")}}function Ho(t,i){if(t&1&&d(0,Go,2,4),t&2){let e=o(3).$implicit;g(0,e.registeredAt?0:-1)}}function $o(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field]," ")}}function Uo(t,i){if(t&1&&d(0,Ho,1,1)(1,$o,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="registeredAt"?0:1)}}function Wo(t,i){if(t&1&&(s(0,"td"),d(1,Oo,2,1)(2,Uo,2,1),m()),t&2){let e=i.$implicit,n=o().$implicit;r(),g(1,n[e.field]!=null&&n[e.field].id?1:-1),r(),g(2,n[e.field]!=null&&n[e.field].id?-1:2)}}function zo(t,i){if(t&1&&(s(0,"tr",13),L(1,Wo,3,2,"td",null,B),m()),t&2){let e=i.$implicit,n=i.columns,l=i.rowIndex;c("pSelectableRow",e)("pSelectableRowIndex",l),r(),T(n)}}function qo(t,i){if(t&1&&(s(0,"tr")(1,"td"),p(2),m()()),t&2){let e=i.$implicit,n=o();r(),ee("colspan",e.length),r(),C(" ",n.messageService.paginatorNoRecordsFound," ")}}function Ko(t,i){}var mi=(()=>{let i=class i{constructor(){this.authService=_(z),this.coreService=_($),this.closingLogsHttpService=_(rt),this.PrimeIcons=N,this.IconButtonActionEnum=A,this.SeverityButtonActionEnum=W,this.LabelButtonActionEnum=S,this.BreadcrumbEnum=D,this.TableEnum=Q,this.messageService=_(ie),this.messageDialogService=_(U),this.buttonActions=[],this.columns=[],this.search=new re(""),this.items=[],this.isVisibleAgreementView=!1,this.buildColumns()}ngOnInit(){this.findClosingLogsByAgreement()}buildColumns(){this.columns=[{field:"state",header:pe.state},{field:"registeredAt",header:pe.registeredAt},{field:"user",header:pe.user}]}findClosingLogsByAgreement(){this.closingLogsHttpService.findClosingLogsByAgreement(this.agreementId).subscribe(n=>{n&&(this.items=n)})}downloadLog(){this.closingLogsHttpService.downloadLog(this.agreementId)}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-closing-log-list"]],inputs:{agreementId:"agreementId"},decls:11,vars:9,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"ml-2",3,"click","icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[1,"flex"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"]],template:function(l,a){if(l&1){let b=E();s(0,"p-toolbar")(1,"div",1)(2,"p-button",2),v("click",function(){return f(b),h(a.downloadLog())}),m()(),u(3,"div",3),m(),s(4,"p-table",4,0),d(6,Mo,1,0,"ng-template",5)(7,Po,3,0,"ng-template",6)(8,zo,3,2,"ng-template",7)(9,qo,3,2,"ng-template",8)(10,Ko,0,0,"ng-template",9),m()}l&2&&(r(2),c("icon",a.IconButtonActionEnum.DOWNLOAD)("label",a.LabelButtonActionEnum.DOWNLOAD)("loading",a.coreService.isLoading)("severity",a.SeverityButtonActionEnum.SYNC),r(2),c("value",a.items)("columns",a.columns)("paginator",!0)("rows",10)("loading",a.coreService.isLoading))},dependencies:[G,qe,q,K,X,ae,le,te],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=i;return t})();var Yo=(t,i)=>i.id,Qo=()=>({width:"50rem"}),Jo=()=>({width:"100%"}),ci=()=>({width:"35rem"});function Xo(t,i){t&1&&(s(0,"div",25),p(1," Previo a reportar la documentaci\xF3n en la secciones GESTI\xD3N DE CIERRE DE CONVENIO \xE9stos (reportes de avence de cierre) deber\xE1 contar con todos los reportes en estado ACEPTADO. "),m())}function Zo(t,i){t&1&&(s(0,"p-messages",20),d(1,Xo,2,0,"ng-template",24),m())}function er(t,i){if(t&1){let e=E();s(0,"p-button",26),v("click",function(){f(e);let l=o(2);return h(l.openFilesModal())}),m()}if(t&2){let e=o(2);c("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.CREATE_CLOSING_LOG)("loading",e.coreService.isLoading)("severity",e.SeverityButtonActionEnum.UPLOAD)}}function tr(t,i){if(t&1&&(s(0,"h2"),p(1),m(),d(2,Zo,2,0,"p-messages",20),s(3,"p-toolbar")(4,"div",21),d(5,er,1,4,"p-button",22),m(),u(6,"div",23),m()),t&2){let e=o();r(),F(e.BreadcrumbEnum.CLOSING_LOG_ADMINISTRATOR),r(),g(2,!e.validPeriodsClosing&&e.closingNotification&&(e.closingNotification.closeType==null?null:e.closingNotification.closeType.code)===e.CatalogueClosingNotificationsCloseTypesDocumentEnum.TERM?2:-1),r(3),g(5,e.items.length===0?5:-1)}}function ir(t,i){if(t&1&&(s(0,"th",27),p(1),u(2,"p-sortIcon",29),m()),t&2){let e=i.$implicit;c("pSortableColumn",e.field),r(),C(" ",e.header," "),r(),c("field",e.field)}}function nr(t,i){if(t&1&&(s(0,"th",28),p(1),m()),t&2){let e=o(2);r(),C(" ",e.TableEnum.ACTIONS," ")}}function or(t,i){if(t&1&&(s(0,"tr"),L(1,ir,3,3,"th",27,B),d(3,nr,2,1,"th",28),m()),t&2){let e=i.$implicit,n=o();r(),T(e),r(2),g(3,(n.agreement.initialState==null?null:n.agreement.initialState.code)!=n.CatalogueAgreementStatesStateEnum.CLOSED?3:-1)}}function rr(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field].unit.name," ")}}function lr(t,i){if(t&1&&p(0),t&2){let e=o(4).$implicit;Z(" ",e.user.name," ",e.user.lastname," ")}}function ar(t,i){if(t&1&&d(0,lr,1,2),t&2){let e=o(3).$implicit;g(0,e!=null&&e.user?0:-1)}}function sr(t,i){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e==null||e.state==null?null:e.state.name," ")}}function mr(t,i){if(t&1&&d(0,rr,1,1)(1,ar,1,1)(2,sr,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="administrator"?0:e==="user"?1:e==="state"?2:-1)}}function cr(t,i){if(t&1&&(s(0,"span"),p(1),m(),u(2,"p-divider")),t&2){let e=i.$implicit;r(),C("",e.type.name,": ")}}function pr(t,i){if(t&1&&L(0,cr,3,1,null,null,B),t&2){let e=o(3).$implicit;T(e==null?null:e.closingLogDocuments)}}function dr(t,i){if(t&1){let e=E();s(0,"p-button",31),v("click",function(){let l=f(e).$implicit,a=o(6);return h(a.downloadFile(l))}),m(),u(1,"p-divider")}if(t&2){let e=i.$implicit,n=o(6);c("icon",n.IconButtonActionEnum.DOWNLOAD)("label",e.name)("text",!0)("severity",n.SeverityButtonActionEnum.DOWNLOAD)}}function _r(t,i){if(t&1&&L(0,dr,2,4,null,null,B),t&2){let e=o(4).$implicit;T(e==null?null:e.closingLogDocuments)}}function ur(t,i){if(t&1&&d(0,_r,2,0),t&2){let e=o(3).$implicit;g(0,e!=null&&e.closingLogDocuments?0:-1)}}function gr(t,i){if(t&1&&u(0,"i",33),t&2){let e=o(6);H(e.PrimeIcons.CIRCLE_FILL)}}function Cr(t,i){if(t&1&&u(0,"i",34),t&2){let e=o(6);H(e.PrimeIcons.CIRCLE_FILL)}}function fr(t,i){if(t&1&&d(0,gr,1,2,"i",32)(1,Cr,1,2),t&2){let e=o(4).$implicit;g(0,e.state.code==="REPORTED"||e.state.code==="ACCEPTED"?0:1)}}function hr(t,i){if(t&1&&u(0,"i",34),t&2){let e=o(5);H(e.PrimeIcons.CIRCLE_FILL)}}function xr(t,i){if(t&1&&d(0,fr,2,1)(1,hr,1,2),t&2){let e=o(3).$implicit;g(0,e.closingLogDocuments?0:1)}}function vr(t,i){if(t&1&&(p(0),u(1,"br"),p(2),I(3,"date"),u(4,"br"),p(5),I(6,"date")),t&2){let e=o(3).$implicit;C(" ",e.name," "),r(2),C(" ",O(3,3,e.startedAt,"d MMMM y")," - "),r(3),C(" ",O(6,6,e.endedAt,"d MMMM y")," ")}}function Er(t,i){if(t&1&&(p(0),I(1,"date")),t&2){let e=o(3).$implicit;C(" ",O(1,1,e.uploadedAt,"dd/MM/y - HH:mm")," ")}}function br(t,i){if(t&1&&p(0),t&2){let e=o(2).$implicit,n=o().$implicit;C(" ",n[e.field]," ")}}function Sr(t,i){if(t&1&&d(0,pr,2,0)(1,ur,1,1)(2,xr,2,1)(3,vr,7,9)(4,Er,2,4)(5,br,1,1),t&2){let e,n=o().$implicit;g(0,(e=n.field)==="closingLogDocumentsUpload"?0:e==="closingLogDocuments"?1:e==="trafficLight"?2:e==="name"?3:e==="uploadedAt"?4:5)}}function Ar(t,i){if(t&1&&(s(0,"td"),d(1,mr,3,1)(2,Sr,6,1),m()),t&2){let e=i.$implicit,n=o().$implicit;r(),g(1,n[e.field]!=null&&n[e.field].id?1:-1),r(),g(2,n[e.field]!=null&&n[e.field].id?-1:2)}}function Lr(t,i){if(t&1){let e=E();s(0,"td",28)(1,"p-button",35),v("click",function(){f(e);let l=o().$implicit,a=o();return h(a.selectItem(l))}),m()()}if(t&2){let e=o(2);r(),c("icon",e.PrimeIcons.ELLIPSIS_V)}}function Tr(t,i){if(t&1&&(s(0,"tr",30),L(1,Ar,3,2,"td",null,B),d(3,Lr,2,1,"td",28),m()),t&2){let e=i.$implicit,n=i.columns,l=i.rowIndex,a=o();c("pSelectableRow",e)("pSelectableRowIndex",l),r(),T(n),r(2),g(3,(a.agreement.initialState==null?null:a.agreement.initialState.code)!=a.CatalogueAgreementStatesStateEnum.CLOSED?3:-1)}}function yr(t,i){if(t&1&&(s(0,"tr")(1,"td"),p(2),m()()),t&2){let e=i.$implicit,n=o();r(),ee("colspan",e.length),r(),C(" ",n.messageService.paginatorNoRecordsFound," ")}}function Fr(t,i){}function Ir(t,i){if(t&1&&(u(0,"i"),s(1,"div",25),p(2),m()),t&2){let e=o(2).$index,n=o(2);H(n.PrimeIcons.FILE_PDF),r(2),F(n.files[e].file.name)}}function Dr(t,i){t&1&&(s(0,"div",16)(1,"p-messages",40),d(2,Ir,3,3,"ng-template",24),m()())}function wr(t,i){if(t&1){let e=E();s(0,"div",16)(1,"label",37),p(2),s(3,"b",38),p(4,"*"),m()(),s(5,"p-fileUpload",39,1),v("uploadHandler",function(l){let a=f(e).$implicit,b=Ge(6),w=o(2);return h(w.onUpload(l,b,a))}),m(),u(7,"small",19),m(),d(8,Dr,3,0,"div",16)}if(t&2){let e=i.$implicit,n=i.$index,l=o(2);r(),c("for",e.id),r(),C(" ",e.name," "),r(3),c("chooseIcon",l.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",l.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",l.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),r(2),c("errors",l.reportFileField.errors)("touched",l.reportFileField.touched)("dirty",l.reportFileField.dirty),r(),g(8,l.files.length>n?8:-1)}}function Br(t,i){if(t&1&&(s(0,"div",36),L(1,wr,9,11,null,null,Yo),m()),t&2){let e=o();r(),T(e.closeTypes)}}function Mr(t,i){if(t&1){let e=E();s(0,"p-button",41),v("click",function(){f(e);let l=o();return h(l.closeModal())}),m(),s(1,"p-button",42),v("click",function(){f(e);let l=o();return h(l.onSubmit())}),m()}if(t&2){let e=o();c("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),r(),c("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.UPLOAD)("severity",e.SeverityButtonActionEnum.UPLOAD)}}function Nr(t,i){if(t&1&&u(0,"app-closing-log-list",13),t&2){let e=o();c("agreementId",e.agreementId)}}function Pr(t,i){t&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de rechazar, no podr\xE1 modificar su elecci\xF3n?"),m())}function kr(t,i){if(t&1){let e=E();s(0,"p-button",41),v("click",function(){f(e);let l=o();return h(l.isVisibleRefusedModal=!1)}),m(),s(1,"p-button",43),v("click",function(){f(e);let l=o();return h(l.refuseTrackingLogDocuments())}),m()}if(t&2){let e=o();c("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),r(),c("label",e.LabelButtonActionEnum.REFUSED)("icon",e.IconButtonActionEnum.REFUSED)("severity",e.SeverityButtonActionEnum.REFUSED)}}function Vr(t,i){t&1&&(s(0,"h3"),p(1,"\xBFEst\xE1 seguro de aceptar, no podr\xE1 modificar su elecci\xF3n?"),m())}function Rr(t,i){if(t&1){let e=E();s(0,"p-button",41),v("click",function(){f(e);let l=o();return h(l.isVisibleAcceptedModal=!1)}),m(),s(1,"p-button",43),v("click",function(){f(e);let l=o();return h(l.acceptTrackingLogDocuments())}),m()}if(t&2){let e=o();c("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),r(),c("label",e.LabelButtonActionEnum.ACCEPTED)("icon",e.IconButtonActionEnum.ACCEPTED)("severity",e.SeverityButtonActionEnum.REFUSED)}}var pi=(()=>{let i=class i{constructor(){this.activatedRoute=_(Ue),this.authService=_(z),this.coreService=_($),this.formBuilder=_(ge),this.cataloguesHttpService=_(me),this.trackingLogsHttpService=_(Se),this.closingLogsHttpService=_(rt),this.agreementsHttpService=_(ke),this.filesHttpService=_(oe),this.breadcrumbService=_(ne),this.PrimeIcons=N,this.IconButtonActionEnum=A,this.SeverityButtonActionEnum=W,this.LabelButtonActionEnum=S,this.BreadcrumbEnum=D,this.TableEnum=Q,this.messageService=_(ie),this.messageDialogService=_(U),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new re(""),this.items=[],this.formErrors=[],this.files=[],this.types=[],this.closeTypes=[],this.trackingLogType="execution",this.isVisibleRefusedModal=!1,this.isVisibleAcceptedModal=!1,this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Ne,this.CatalogueTrackingLogsStateEnum=Ee,this.CatalogueClosingNotificationsCloseTypesDocumentEnum=Qe,this.FileEnum=Me,this.validPeriodsClosing=!1,this.validPeriodsExecution=!1,this.CatalogueAgreementStatesStateEnum=se,this.breadcrumbService.setItems([{label:D.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:D.PERIODS}]),this.buildForm(),this.buildButtonActions()}ngOnInit(){this.findClosingLogCurrentByAgreement(),this.findAgreement(this.agreementId),this.loadTypes(),this.loadTypesByCloseType(),setTimeout(()=>{this.validatePeriods()},500),this.activatedRoute.queryParams.subscribe(n=>{this.trackingLogType=n.type})}buildForm(){this.form=this.formBuilder.group({reportFile:[null,J.required],evidenceFile:[null],observation:[null,J.required]})}findAgreement(n){this.agreementsHttpService.findOne(n).subscribe(l=>{this.agreement=l,this.buildColumns()})}findClosingLogCurrentByAgreement(){this.closingLogsHttpService.findClosingLogCurrentByAgreement(this.agreementId).subscribe(n=>{n&&(this.items=[n])})}loadTypes(){this.types=this.cataloguesHttpService.findByType(ce.PERIODS_TRACKING_LOG)}loadTypesByCloseType(){this.closeTypes=this.cataloguesHttpService.findByParent(this.closingNotification?.closeType?.id)}createClosingLog(){let n=new FormData;for(let l of this.files)n.append("typeIds",l.type.id),n.append("files",l.file);this.closingLogsHttpService.createClosingLog(this.agreementId,n).subscribe(l=>{this.findClosingLogCurrentByAgreement(),this.isVisibleFilesModal=!1})}onUpload(n,l,a){let b=this.files.findIndex(w=>w.type?.id===a.id);b===-1?this.files.push({type:a,file:n.files[0]}):this.files[b]={type:a,file:n.files[0]},l.clear()}openFilesModal(){this.closingNotification?(this.loadTypesByCloseType(),pt(this.trackingLogsHttpService.validationPeriods(this.agreementId,"execution"),this.trackingLogsHttpService.validationPeriods(this.agreementId,"closing")).subscribe(n=>{if(n.length>0){if(this.validPeriodsExecution=n[0],this.validPeriodsClosing=n[1],!this.validPeriodsExecution){this.messageDialogService.errorCustom("Error de reportes ejecucion","Su mensaje va aqui");return}if(this.closingNotification.closeType?.code===Qe.TERM&&!this.validPeriodsClosing){this.messageDialogService.errorCustom("Error de reportes cierre","Su mensaje va aqui");return}this.isVisibleFilesModal=!0}})):this.messageDialogService.errorCustom("No existe closing notification","Su mensaje va aqui")}onSubmit(){this.validateFilesForm()?this.createClosingLog():this.messageDialogService.fieldErrors(this.formErrors)}buildColumns(){(this.agreement.initialState?.code===se.CURRENT||this.agreement.initialState?.code===se.CLOSING_PROCESS)&&(this.columns=[{field:"closingLogDocumentsUpload",header:y.documentName},{field:"closingLogDocuments",header:y.fileName},{field:"trafficLight",header:y.trafficLight},{field:"uploadedAt",header:y.uploadedAt},{field:"user",header:y.user},{field:"state",header:y.state}]),this.agreement.initialState?.code===se.CLOSED&&(this.columns=[{field:"closingLogDocumentsUpload",header:y.documentName},{field:"closingLogDocuments",header:y.fileName},{field:"uploadedAt",header:y.uploadedAt},{field:"user",header:y.user}])}buildButtonActions(){this.buttonActions=[]}validateButtonActions(n){this.buildButtonActions(),(this.agreement.initialState?.code===se.CURRENT||this.agreement.initialState?.code===se.CLOSING_PROCESS)&&(this.buttonActions=[{id:M.TRACKING_LOG,label:S.TRACKING_LOG,icon:A.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}])}remove(n){}selectItem(n){this.isButtonActions=!0,this.selectedItem=n,this.validateButtonActions(n)}showFilesModal(n){this.selectedItem=n,this.isVisibleFilesModal=!0}downloadFile(n){this.filesHttpService.downloadFile(n)}refuseTrackingLogDocuments(){this.observationFileField.valid?this.closingLogsHttpService.changeState(this.selectedItem.id,!1,this.observationFileField.value).subscribe(()=>{this.findClosingLogCurrentByAgreement(),this.isVisibleRefusedModal=!1,this.observationFileField.reset()}):(this.form.markAllAsTouched(),this.formErrors=[pe.observation],this.messageDialogService.fieldErrors(this.formErrors))}acceptTrackingLogDocuments(){this.closingLogsHttpService.changeState(this.selectedItem.id,!0).subscribe(()=>{this.findClosingLogCurrentByAgreement(),this.isVisibleAcceptedModal=!1})}validateFilesForm(){return this.formErrors=[],this.closeTypes.forEach(n=>{this.files.find(a=>a.type?.id===n?.id)||this.formErrors.push(n.name)}),this.formErrors.length===0}closeModal(){this.isVisibleFilesModal=!1,this.reportFileField.setValue(null),this.evidenceFileField.setValue(null)}validatePeriods(){this.validPeriodsClosing=!1,this.validPeriodsExecution=!1,this.closingNotification&&this.closingNotification.closeType?.code===Qe.TERM&&pt(this.trackingLogsHttpService.validationPeriods(this.agreementId,"execution"),this.trackingLogsHttpService.validationPeriods(this.agreementId,"closing")).subscribe(n=>{n.length>0&&(this.validPeriodsExecution=n[0],this.validPeriodsClosing=n[1])})}validatePeriodsClosing(){this.validPeriodsClosing=!1,this.closingNotification&&this.closingNotification.closeType?.code===Qe.TERM&&this.trackingLogsHttpService.validationPeriods(this.agreementId,"closing").subscribe(n=>{this.validPeriodsClosing=n})}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}get observationFileField(){return this.form.controls.observation}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-closing-log-current"]],inputs:{agreementId:"agreementId",closingNotification:"closingNotification"},decls:24,vars:31,consts:[["dt",""],["uploadFiles",""],["dataKey","id","styleClass","p-datatable-striped",3,"value","columns","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Subir Archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["header","Bit\xE1cora de seguimiento al cierre del Convenio",3,"visibleChange","visible","modal"],[3,"agreementId"],["header","Header",3,"visibleChange","visible","modal"],[1,"grid","p-fluid",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","observation","label","Observaci\xF3n",3,"required"],["pInputTextarea","","id","observation","formControlName","observation"],["appErrorMessage","",3,"errors","touched","dirty"],["severity","error"],[1,"p-toolbar-group-left"],[3,"icon","label","loading","severity"],[1,"p-toolbar-group-right"],["pTemplate",""],[1,"ml-2"],[3,"click","icon","label","loading","severity"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[3,"click","icon"],[1,"p-fluid","grid"],[3,"for"],[1,"p-error"],["id","report","mode","basic","chooseLabel","Cargar","invalidFileSizeMessageDetail","","name","files[]","accept",".pdf,.rar,.zip",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["severity","info"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"],[3,"click","label","icon","severity"]],template:function(l,a){if(l&1){let b=E();s(0,"p-table",2,0),d(2,tr,7,3,"ng-template",3)(3,or,4,1,"ng-template",4)(4,Tr,4,3,"ng-template",5)(5,yr,3,2,"ng-template",6)(6,Fr,0,0,"ng-template",7),m(),s(7,"app-button-action",8),v("isHide",function(x){return f(b),h(a.isButtonActions=!x)}),m(),s(8,"p-dialog",9),V("visibleChange",function(x){return f(b),k(a.isVisibleFilesModal,x)||(a.isVisibleFilesModal=x),h(x)}),d(9,Br,3,0,"ng-template",10)(10,Mr,2,7,"ng-template",11),m(),s(11,"p-dialog",12),V("visibleChange",function(x){return f(b),k(a.isVisibleTrackingLogModal,x)||(a.isVisibleTrackingLogModal=x),h(x)}),d(12,Nr,1,1,"app-closing-log-list",13),m(),s(13,"p-dialog",14),V("visibleChange",function(x){return f(b),k(a.isVisibleRefusedModal,x)||(a.isVisibleRefusedModal=x),h(x)}),d(14,Pr,2,0,"ng-template",4),s(15,"form",15)(16,"div",16),u(17,"label",17)(18,"textarea",18)(19,"small",19),m()(),d(20,kr,2,7,"ng-template",11),m(),s(21,"p-dialog",14),V("visibleChange",function(x){return f(b),k(a.isVisibleAcceptedModal,x)||(a.isVisibleAcceptedModal=x),h(x)}),d(22,Vr,2,0,"ng-template",4)(23,Rr,2,7,"ng-template",11),m()}l&2&&(c("value",a.items)("columns",a.columns)("loading",a.coreService.isLoading),r(7),c("buttonActions",a.buttonActions)("enabled",a.isButtonActions),r(),j(Y(27,Qo)),P("visible",a.isVisibleFilesModal),c("modal",!0),r(3),j(Y(28,Jo)),P("visible",a.isVisibleTrackingLogModal),c("modal",!0),r(),g(12,a.isVisibleTrackingLogModal?12:-1),r(),j(Y(29,ci)),P("visible",a.isVisibleRefusedModal),c("modal",!0),r(2),c("formGroup",a.form),r(2),c("required",a.observationFileField),r(2),c("errors",a.observationFileField.errors)("touched",a.observationFileField.touched)("dirty",a.observationFileField.dirty),r(2),j(Y(30,ci)),P("visible",a.isVisibleAcceptedModal),c("modal",!0))},dependencies:[ye,Ce,Ie,G,qe,q,ue,Ae,de,_e,K,X,ae,le,Le,Te,he,Ve,Ke,fe,Fe,mi,te],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=i;return t})();var Hr=(t,i)=>i.field,$r=()=>({width:"50rem"});function Ur(t,i){t&1&&(s(0,"h2"),p(1,"Ejecuci\xF3n del Convenio"),m())}function Wr(t,i){if(t&1&&(s(0,"th",8),p(1),m()),t&2){let e=i.$implicit;c("pSortableColumn",e.field),r(),C(" ",e.header," ")}}function zr(t,i){if(t&1&&(s(0,"tr"),L(1,Wr,2,2,"th",8,Hr),s(3,"th",9),p(4),m()()),t&2){let e=i.$implicit,n=o();r(),T(e),r(3),C(" ",n.TableEnum.ACTIONS," ")}}function qr(t,i){if(t&1){let e=E();s(0,"tr")(1,"td"),p(2),m(),s(3,"td"),p(4),m(),s(5,"td"),p(6),I(7,"customFormatDateTime"),m(),s(8,"td"),p(9),m(),s(10,"td")(11,"p-button",10),v("click",function(){let l=f(e).$implicit,a=o();return h(a.downloadFile(l))}),m()()()}if(t&2){let e=i.$implicit,n=o();r(2),F(e.type==null?null:e.type.name),r(2),F(e.description),r(2),F(xe(7,8,e.registeredAt)),r(3),Z("",e.user==null?null:e.user.name," ",e.user==null?null:e.user.lastname,""),r(2),c("pTooltip",n.LabelButtonActionEnum.DOWNLOAD)("severity",n.SeverityButtonActionEnum.DOWNLOAD)("icon",n.IconButtonActionEnum.DOWNLOAD)}}function Kr(t,i){if(t&1&&(u(0,"i"),s(1,"div",20),p(2),m()),t&2){let e=o(3);H(e.PrimeIcons.FILE_PDF),r(2),F(e.reportFileField.value==null?null:e.reportFileField.value.name)}}function jr(t,i){t&1&&(s(0,"div",12)(1,"p-messages",18),d(2,Kr,3,3,"ng-template",19),m()())}function Yr(t,i){if(t&1){let e=E();s(0,"form",11)(1,"div",12),u(2,"label",13),s(3,"p-fileUpload",14,0),v("uploadHandler",function(l){f(e);let a=Ge(4),b=o();return h(b.uploadReportFile(l,a))}),m(),u(5,"small",15),m(),s(6,"div",12),u(7,"label",16)(8,"textarea",17)(9,"small",15),m(),d(10,jr,3,0,"div",12),m()}if(t&2){let e=o();c("formGroup",e.form),r(2),c("label",e.ReportExecutionEnum.type)("required",e.reportFileField),r(),c("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),r(2),c("errors",e.reportFileField.errors)("touched",e.reportFileField.touched)("dirty",e.reportFileField.dirty),r(2),c("label",e.ReportExecutionEnum.description)("required",e.descriptionField),r(2),c("errors",e.descriptionField.errors)("touched",e.descriptionField.touched)("dirty",e.descriptionField.dirty),r(),g(10,e.reportFileField.value?10:-1)}}function Qr(t,i){if(t&1){let e=E();s(0,"p-button",21),v("click",function(){f(e);let l=o();return h(l.closeModal())}),m(),s(1,"p-button",22),v("click",function(){f(e);let l=o();return h(l.onSubmit())}),m()}if(t&2){let e=o();c("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),r(),c("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.UPLOAD)("severity",e.SeverityButtonActionEnum.UPLOAD)}}var _i=(()=>{let i=class i{constructor(){this.coreService=_($),this.formBuilder=_(ge),this.messageDialogService=_(U),this.agreementsHttpService=_(ke),this.confirmationService=_(Be),this.filesHttpService=_(oe),this.reportExecutions=[],this.columns=[],this.isVisibleFilesModal=!1,this.formErrors=[],this.IconButtonActionEnum=A,this.SeverityButtonActionEnum=W,this.TableEnum=Q,this.PrimeIcons=N,this.LabelButtonActionEnum=S,this.FileEnum=Me,this.ReportExecutionEnum=Pe}ngOnInit(){this.buildForm(),this.buildColumns(),this.findReportExecutions()}buildForm(){this.form=this.formBuilder.group({reportFile:[null,J.required],description:[null,J.required]})}buildColumns(){this.columns=[{field:"type",header:Pe.type},{field:"description",header:Pe.description},{field:"registeredAt",header:Pe.registeredAt},{field:"user",header:Pe.user}]}findReportExecutions(){this.agreementsHttpService.findReportExecutions(this.agreementId).subscribe(n=>{this.reportExecutions=n})}openFilesModal(){this.isVisibleFilesModal=!0}closeModal(){this.isVisibleFilesModal=!1,this.form.reset()}onSubmit(){if(this.form.valid){let n=new FormData;n.append("report",this.reportFileField.value),n.append("description",this.descriptionField.value),this.agreementsHttpService.createReportExecution(this.agreementId,n).subscribe(l=>{this.findReportExecutions(),this.isVisibleFilesModal=!1,this.form.reset()})}else this.form.markAllAsTouched(),this.formErrors=[],this.reportFileField.invalid&&this.formErrors.push(Pe.type),this.reportFileField.invalid&&this.formErrors.push(Pe.description),this.messageDialogService.fieldErrors(this.formErrors)}uploadReportFile(n,l){this.reportFileField.patchValue(n.files[0]),l.clear()}deleteFile(n,l){this.confirmationService.confirm({key:"confirmDialog",message:"No podr\xE1 recuperar la informaci\xF3n registrada",header:"\xBFEst\xE1 seguro de eliminar?",icon:N.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.filesHttpService.remove(n).subscribe(()=>{this.reportExecutions.splice(l,1)})}})}downloadFile(n){this.filesHttpService.downloadFile(n)}get reportFileField(){return this.form.controls.reportFile}get descriptionField(){return this.form.controls.description}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-closing-execution-document"]],inputs:{agreementId:"agreementId"},decls:8,vars:7,consts:[["uploadFiles",""],["styleClass","p-datatable-striped",3,"value","columns"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["header","Subir Archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],[3,"pSortableColumn"],["colspan","2"],[3,"click","pTooltip","severity","icon"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","report",3,"label","required"],["id","report","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appErrorMessage","",3,"errors","touched","dirty"],["appLabel","","for","description",3,"label","required"],["id","description","pInputTextarea","","formControlName","description"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(l,a){l&1&&(s(0,"p-panel")(1,"p-table",1),d(2,Ur,2,0,"ng-template",2)(3,zr,5,1,"ng-template",3)(4,qr,12,10,"ng-template",4),m()(),s(5,"p-dialog",5),V("visibleChange",function(w){return k(a.isVisibleFilesModal,w)||(a.isVisibleFilesModal=w),w}),d(6,Yr,11,17,"ng-template",6)(7,Qr,2,7,"ng-template",7),m()),l&2&&(r(),c("value",a.reportExecutions)("columns",a.columns),r(4),j(Y(6,$r)),P("visible",a.isVisibleFilesModal),c("modal",!0))},dependencies:[ye,Ce,lt,G,q,ue,Ae,de,_e,K,X,Le,Te,he,Ve,Ke,Fe,ze,Kt]});let t=i;return t})();var Xr=t=>[t];function Zr(t,i){if(t&1&&u(0,"app-closing-execution-document",0),t&2){let e=o();c("agreementId",e.agreementId)}}function el(t,i){if(t&1&&u(0,"app-period-closing-list",0),t&2){let e=o();c("agreementId",e.agreementId)}}function tl(t,i){if(t&1&&(s(0,"tr")(1,"th"),p(2),m(),s(3,"th"),p(4),m(),s(5,"th"),p(6),m(),s(7,"th"),p(8),m(),s(9,"th"),p(10),m()()),t&2){let e=o(3);r(2),F(e.ClosingNotificationEnum.closeType2),r(2),F(e.ClosingNotificationEnum.closeDetail),r(2),F(e.ClosingNotificationEnum.closedAt),r(2),F(e.ClosingNotificationEnum.registeredAt),r(2),F(e.ClosingNotificationEnum.user)}}function il(t,i){if(t&1&&(s(0,"tr")(1,"td"),p(2),m(),s(3,"td"),p(4),m(),s(5,"td"),p(6),I(7,"customFormatDate"),m(),s(8,"td"),p(9),I(10,"date"),m(),s(11,"td"),p(12),m()()),t&2){let e=i.$implicit;r(2),F(e.closeType==null?null:e.closeType.name),r(2),F(e.closeDetail),r(2),F(xe(7,5,e.closedAt)),r(3),F(O(10,7,e.registeredAt,"dd/MM/yyyy HH:mm")),r(3),F(e.user.name+" "+e.user.lastname)}}function nl(t,i){if(t&1&&(s(0,"p-panel",2)(1,"form",3)(2,"p-table",4),d(3,tl,11,5,"ng-template",5)(4,il,13,10,"ng-template",6),m()()()),t&2){let e=o(2);r(2),c("value",it(2,Xr,e.closingNotification))("loading",e.coreService.isLoading)}}function ol(t,i){if(t&1&&d(0,nl,5,4,"p-panel",2),t&2){let e=o();g(0,(e.closingNotification.closeType==null?null:e.closingNotification.closeType.code)!==e.CatalogueClosingNotificationsCloseTypeEnum.TERM?0:-1)}}function rl(t,i){if(t&1&&u(0,"app-period-closing-list",0),t&2){let e=o();c("agreementId",e.agreementId)}}var ui=(()=>{let i=class i{constructor(){this.authService=_(z),this.breadcrumbService=_(ne),this.agreementsHttpService=_(ke),this.confirmationService=_(Be),this.closingNotificationsHttpService=_(At),this.cataloguesHttpService=_(me),this.coreService=_($),this.filesHttpService=_(oe),this.messageDialogService=_(U),this.formBuilder=_(ge),this.Validators=J,this.closeTypes=[],this.AgreementFormEnum=be,this.AgreementStateEnum=ot,this.SkeletonEnum=Et,this.ClosingNotificationEnum=St,this.PrimeIcons=N,this.CatalogueAgreementsTypeEnum=xt,this.CatalogueClosingNotificationsCloseTypeEnum=vt,this.CatalogueAgreementStatesStateEnum=se,this.breadcrumbService.setItems([{label:D.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:D.CLOSING_NOTIFICATION}])}ngOnInit(){this.loadCloseTypes(),this.findClosingNotificationByAgreement()}findClosingNotificationByAgreement(){this.closingNotificationsHttpService.findClosingNotificationByAgreement(this.agreementId).subscribe(n=>{this.closingNotification=n})}loadCloseTypes(){this.closeTypes=this.cataloguesHttpService.findByType(ce.CLOSING_NOTIFICATIONS_CLOSE_TYPE)}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-agreement-termination-list"]],inputs:{agreementId:"agreementId"},decls:7,vars:6,consts:[[3,"agreementId"],[3,"agreementId","closingNotification"],["header","NOTIFICACI\xD3N INICIO DEL PROCESO DE CIERRE DEL CONVENIO"],[1,"p-fluid","grid"],["dataKey","id","styleClass","p-datatable-striped",3,"value","loading"],["pTemplate","header"],["pTemplate","body"]],template:function(l,a){l&1&&(d(0,Zr,1,1,"app-closing-execution-document",0)(1,el,1,1,"app-period-closing-list",0)(2,ol,1,1),u(3,"p-divider"),d(4,rl,1,1,"app-period-closing-list",0),s(5,"p-panel"),u(6,"app-closing-log-current",1),m()),l&2&&(g(0,a.closingNotification&&(a.closingNotification.agreement.initialState==null?null:a.closingNotification.agreement.initialState.code)===a.CatalogueAgreementStatesStateEnum.CLOSED?0:-1),r(),g(1,a.closingNotification&&(a.closingNotification.closeType==null?null:a.closingNotification.closeType.code)===a.CatalogueClosingNotificationsCloseTypeEnum.TERM?1:-1),r(),g(2,a.closingNotification?2:-1),r(2),g(4,a.closingNotification&&(a.closingNotification.agreement.initialState==null?null:a.closingNotification.agreement.initialState.code)===a.CatalogueAgreementStatesStateEnum.CLOSING_PROCESS?4:-1),r(2),c("agreementId",a.agreementId)("closingNotification",a.closingNotification))},dependencies:[G,ue,_e,Ft,K,fe,ze,si,pi,_i,te,We]});let t=i;return t})();var ll=(t,i)=>i.id;function al(t,i){t&1&&(s(0,"h2"),p(1," Registro de Cierre del Convenio "),m())}function sl(t,i){if(t&1){let e=E();s(0,"p-checkbox",6),V("ngModelChange",function(l){f(e);let a=o(2);return k(a.checked,l)||(a.checked=l),h(l)}),m()}if(t&2){let e=o(2);P("ngModel",e.checked),c("binary",!0)("disabled",e.checkedClosingDate)}}function ml(t,i){if(t&1){let e=E();u(0,"p-divider",5),s(1,"p-button",7),v("click",function(){f(e);let l=o(2);return h(l.closeAgreement())}),m()}if(t&2){let e=o(2);r(),c("disabled",!e.checked)}}function cl(t,i){if(t&1&&(s(0,"div",3),d(1,sl,1,3,"p-checkbox",4),u(2,"p-divider",5),p(3," Registrar de cierre del convenio "),d(4,ml,2,1),m()),t&2){let e=o();r(),g(1,e.closedAgreement?1:-1),r(3),g(4,e.checkedClosingDate?-1:4)}}function pl(t,i){t&1&&(s(0,"h2"),p(1," Comunicado registro del cierre del Convenio "),m(),u(2,"p"))}function dl(t,i){if(t&1){let e=E();s(0,"div",9),u(1,"label",10),s(2,"p-fileUpload",11,0),v("uploadHandler",function(l){f(e);let a=o(3);return h(a.uploadFile(l))}),m()()}if(t&2){let e=o(3);r(),c("label",e.fileType==null?null:e.fileType.name),r(),c("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0)}}function _l(t,i){if(t&1){let e=E();p(0),u(1,"p-divider"),p(2),s(3,"p-button",12),v("click",function(){let l=f(e).$implicit,a=o(4);return h(a.download(l))}),m()}if(t&2){let e=i.$implicit,n=o(4);C(" ",e==null||e.type==null?null:e.type.name," "),r(2),C(" ",e.name," "),r(),c("icon",n.IconButtonActionEnum.DOWNLOAD)("pTooltip",n.LabelButtonActionEnum.DOWNLOAD)("severity",n.SeverityButtonActionEnum.DOWNLOAD)}}function ul(t,i){if(t&1&&(s(0,"div",9),L(1,_l,4,5,null,null,ll),m()),t&2){let e=o(3);r(),T(e.closedAgreement.files)}}function gl(t,i){if(t&1&&d(0,dl,4,6,"div",9)(1,ul,3,0,"div",9),t&2){let e=o(2);g(0,e.closedAgreement.files.length===0?0:-1),r(),g(1,e.closedAgreement.files?1:-1)}}function Cl(t,i){if(t&1&&(s(0,"div",8),d(1,gl,2,2),m()),t&2){let e=o();r(),g(1,e.closedAgreement?1:-1)}}var gi=(()=>{let i=class i{constructor(){this.checked=!1,this.checkedClosingDate=!1,this.authService=_(z),this.breadcrumbService=_(ne),this.closedAgreementsHttpService=_(Lt),this.confirmationService=_(Be),this.cataloguesHttpService=_(me),this.filesHttpService=_(oe),this.PrimeIcons=N,this.FileEnum=Me,this.IconButtonActionEnum=A,this.LabelButtonActionEnum=S,this.SeverityButtonActionEnum=W,this.breadcrumbService.setItems([{label:D.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:D.PERIODS}])}ngOnInit(){this.findClosedAgreementByAgreement(),this.loadFileType()}loadFileType(){this.fileType=this.cataloguesHttpService.findByCode("CLOSED_AGREEMENT",ce.CLOSED_AGREEMENTS_DOCUMENT),console.log(this.fileType)}closeAgreement(){console.log("entro"),this.confirmationService.confirm({message:"Despu\xE9s de registrar, no podr\xE1 realizar cambios",header:"\xBFEst\xE1 seguro de registrar?",icon:N.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.closedAgreementsHttpService.updateClose(this.agreementId).subscribe(()=>{this.checked=!0,this.findClosedAgreementByAgreement()})}})}findClosedAgreementByAgreement(){this.checkedClosingDate=!1,this.closedAgreementsHttpService.findClosedAgreementByAgreement(this.agreementId).subscribe(n=>{n&&(this.closedAgreement=n,n?.closingDate&&(this.checked=!0,this.checkedClosingDate=!0))})}uploadFile(n){let l=new FormData;l.append("file",n.files[0]),this.closedAgreementsHttpService.uploadFile(this.closedAgreement.id,l).subscribe(a=>{this.findClosedAgreementByAgreement()})}download(n){this.filesHttpService.downloadFile(n)}};i.\u0275fac=function(l){return new(l||i)},i.\u0275cmp=R({type:i,selectors:[["app-closed-agreement"]],inputs:{agreementId:"agreementId"},decls:8,vars:0,consts:[["uploadFiles",""],["pTemplate","header"],["pTemplate","content"],[1,"card","flex"],[3,"ngModel","binary","disabled"],["layout","vertical"],[3,"ngModelChange","ngModel","binary","disabled"],["label","Registrar","severity","success",3,"click","disabled"],[1,"p-fluid","grid"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","file",3,"label"],["id","file","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],[3,"click","icon","pTooltip","severity"]],template:function(l,a){l&1&&(s(0,"p-panel"),d(1,al,2,0,"ng-template",1)(2,cl,5,2,"ng-template",2),m(),u(3,"p-divider"),s(4,"p-panel"),d(5,pl,3,0,"ng-template",1)(6,Cl,2,1,"ng-template",2),m(),u(7,"p-confirmDialog"))},dependencies:[Ce,lt,G,q,de,It,Ve,fe,at,ze,Pt],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=i;return t})();var fl=[{path:"agreement-list",component:ei},{path:"period-list/:agreementId",component:li},{path:"tracking-log-list",component:je},{path:"agreement-termination-list/:agreementId",component:ui},{path:"closed-agreement/:agreementId",component:gi}],Ci=(()=>{let i=class i{};i.\u0275fac=function(l){return new(l||i)},i.\u0275mod=tt({type:i}),i.\u0275inj=et({imports:[dt.forChild(fl),dt]});let t=i;return t})();var cm=(()=>{let i=class i{};i.\u0275fac=function(l){return new(l||i)},i.\u0275mod=tt({type:i}),i.\u0275inj=et({imports:[ft,Ci,jt,Gt,yt,Rt,Ot,Mt,Wt,Dt,wt,zt,Qt,Jt,Xt,Ht,Nt,$t,qt,Bt,Vt,kt]});let t=i;return t})();export{cm as NationalManagerModule};
