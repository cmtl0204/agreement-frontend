import{a as rt}from"./chunk-HVRJOU4A.js";import{a as ei,b as ti}from"./chunk-YSMGJQC4.js";import{b as Bt}from"./chunk-LHPWVR7O.js";import{c as Jt}from"./chunk-5JL33SAL.js";import{a as Xt,b as Zt}from"./chunk-Y6GVBF7F.js";import"./chunk-FQ424XXU.js";import"./chunk-ISADC5UE.js";import"./chunk-CLOQCT5C.js";import{A as Dt,Aa as qt,B as ye,C as Ie,Ga as ve,Ha as Wt,Ia as jt,Ja as lt,Ka as Kt,La as he,Q as wt,R as Pt,Ra as Qt,Y as Mt,Ya as Yt,aa as Nt,ba as Vt,d as Re,fa as Rt,ha as Q,i as Xe,ia as Y,ja as J,k as j,ka as X,m as Ze,n as et,na as Ot,p as K,pa as Z,qa as Ht,r as tt,ra as fe,sa as $t,t as it,ta as De,ua as Gt,v as nt,va as ot,w as ge,wa as Ut,y as yt,z as It,za as zt}from"./chunk-OY72BBVG.js";import{j as W,k as At,m as Ce,n as kt}from"./chunk-GFXZWTUR.js";import{A as de,Aa as Ft,Ba as Je,D as bt,Da as H,E as Te,H as _t,I as Ne,J as Ve,L as U,M as I,N as D,O as z,P as A,Q as Et,S as q,T as Se,ba as _e,ca as je,e as me,ea as Tt,fa as Le,ga as T,ia as Fe,ja as Pe,k as w,ka as ze,ma as Ae,na as ue,o as V,r as R,s as G,sa as St,ta as Ke,u as le,ua as re,v as O,va as Lt,wa as Qe,x as ke,ya as Ye,z as pe}from"./chunk-ODTB3GIQ.js";import{Aa as x,Ba as h,Ca as o,E as qe,H as _,J as N,Ja as se,K as We,La as p,Ma as B,Mb as Me,Na as C,O as f,Oa as ee,Ob as Ee,P as v,Pa as ft,Qa as te,Ra as ie,Rb as dt,Sa as ne,Wa as ce,Xa as vt,_ as l,eb as y,fb as we,gb as k,ja as d,ka as $,la as m,oa as ae,p as pt,pa as P,qa as g,ra as F,sa as S,ta as L,tb as ht,ua as a,va as c,w as be,wa as u,yb as oe,zb as xt}from"./chunk-EUOB27Q6.js";var _i=t=>({enabled:t});function ui(t,n){if(t&1&&(a(0,"div",12)(1,"h1"),p(2),c()()),t&2){let e=o();l(2),B(e.BreadcrumbEnum.AGREEMENTS)}}function gi(t,n){if(t&1&&(a(0,"th",13),p(1),u(2,"p-sortIcon",15),c()),t&2){let e=n.$implicit;m("pSortableColumn",e.field),l(),C(" ",e.header," "),l(),m("field",e.field)}}function Ci(t,n){if(t&1&&(a(0,"tr"),S(1,gi,3,3,"th",13,F),a(3,"th",14),p(4),c()()),t&2){let e=n.$implicit,i=o();l(),L(e),l(3),C(" ",i.TableEnum.ACTIONS," ")}}function fi(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field].unit.name," ")}}function vi(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field].state.name," ")}}function hi(t,n){if(t&1&&d(0,fi,1,1)(1,vi,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="administrator"?0:e==="agreementState"?1:-1)}}function xi(t,n){if(t&1&&(p(0),y(1,"customFormatDate")),t&2){let e=o(4).$implicit;C(" ",we(1,1,e.subscribedAt)," ")}}function bi(t,n){if(t&1&&d(0,xi,2,3),t&2){let e=o(3).$implicit;g(0,e.subscribedAt?0:-1)}}function Ei(t,n){if(t&1&&(p(0),y(1,"customFormatDate")),t&2){let e=o(4).$implicit;C(" ",we(1,1,e.endedAt)," ")}}function Ti(t,n){t&1&&p(0," Indefinido ")}function Si(t,n){if(t&1&&d(0,Ei,2,3)(1,Ti,1,0),t&2){let e=o(3).$implicit;g(0,e.endedAt?0:1)}}function Li(t,n){if(t&1&&(p(0),y(1,"yesNo")),t&2){let e=o(3).$implicit;C(" ",we(1,1,e.isFinancing)," ")}}function Fi(t,n){t&1&&u(0,"p-tag",18)}function Ai(t,n){t&1&&u(0,"p-tag",19)}function yi(t,n){if(t&1&&d(0,Fi,1,0,"p-tag",18)(1,Ai,1,0),t&2){let e=o(3).$implicit;g(0,e.enabled?0:1)}}function Ii(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field]," ")}}function Di(t,n){if(t&1&&d(0,bi,1,1)(1,Si,2,1)(2,Li,2,3)(3,yi,2,1)(4,Ii,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="subscribedAt"?0:e==="endedAt"?1:e==="isFinancing"?2:e==="enabled"?3:4)}}function wi(t,n){if(t&1&&(a(0,"td"),d(1,hi,2,1)(2,Di,5,1),c()),t&2){let e=n.$implicit,i=o().$implicit;l(),g(1,i[e.field]!=null&&i[e.field].id?1:-1),l(),g(2,i[e.field]!=null&&i[e.field].id?-1:2)}}function Pi(t,n){if(t&1){let e=x();a(0,"tr",16),S(1,wi,3,2,"td",null,F),a(3,"td",14)(4,"p-button",17),h("click",function(){let r=f(e).$implicit,s=o();return v(s.selectItem(r))}),c()()()}if(t&2){let e=n.$implicit,i=n.columns,r=n.rowIndex,s=o();m("pSelectableRow",e)("pSelectableRowIndex",r)("ngClass",vt(4,_i,!e.enabled)),l(),L(i),l(3),m("icon",s.PrimeIcons.ELLIPSIS_V)}}function Bi(t,n){if(t&1&&(a(0,"tr")(1,"td"),p(2),c()()),t&2){let e=n.$implicit,i=o();l(),$("colspan",e.length),l(),C(" ",i.messageService.paginatorNoRecordsFound," ")}}function Mi(t,n){}function ki(t,n){if(t&1&&u(0,"app-view",11),t&2){let e=o();m("id",e.selectedItem.id)}}var ii=(()=>{let n=class n{constructor(){this.authService=_(H),this.coreService=_(R),this.administratorsHttpService=_(St),this.agreementsHttpService=_(ue),this.agreementsService=_(ke),this.router=_(Ee),this.breadcrumbService=_(le),this.PrimeIcons=w,this.IconButtonActionEnum=D,this.SeverityButtonActionEnum=z,this.LabelButtonActionEnum=I,this.BreadcrumbEnum=A,this.TableEnum=q,this.messageService=_(G),this.messageDialogService=_(O),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new K(""),this.items=[],this.isVisibleAgreementView=!1,this.breadcrumbService.setItems([{label:A.AGREEMENTS}]),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(be(500)).subscribe(i=>{this.findAgreements()})}ngOnInit(){this.findAgreements()}findAgreements(){this.administratorsHttpService.findAgreementsByAdministrator(this.authService.auth.id).subscribe(i=>{this.items=i})}buildColumns(){this.columns=[{field:"number",header:_e.number},{field:"internalNumber",header:_e.internalNumber},{field:"name",header:_e.name},{field:"administrator",header:Tt.header},{field:"agreementState",header:je.state},{field:"subscribedAt",header:_e.subscribedAt},{field:"endedAt",header:_e.endedAt},{field:"isFinancing",header:_e.isFinancing},{field:"enabled",header:_e.enabled}]}buildButtonActions(){this.buttonActions=[{id:U.AGREEMENT,label:I.AGREEMENT,icon:D.AGREEMENT,command:()=>{this.redirectViewAgreement()}}]}validateButtonActions(i){this.buildButtonActions(),i.initialState?.code===_t.CURRENT&&this.buttonActions.push({id:U.AGREEMENT_PERIOD,label:I.AGREEMENT_PERIOD,icon:D.AGREEMENT_PERIOD,command:()=>{this.selectedItem?.id&&this.redirectTrackingLogList(this.selectedItem.id)}},{id:U.AGREEMENT_CLOSING_MANAGEMENT_ADMINISTRATOR,label:I.AGREEMENT_CLOSING_MANAGEMENT_ADMINISTRATOR,icon:D.AGREEMENT_CLOSING_MANAGEMENT_ADMINISTRATOR,command:()=>{this.selectedItem?.id&&this.redirectAgreementTerminationList(this.selectedItem.id)}}),i.initialState?.code===_t.CLOSING_PROCESS&&this.buttonActions.push({id:U.AGREEMENT_CLOSING_MANAGEMENT_ADMINISTRATOR,label:I.AGREEMENT_CLOSING_MANAGEMENT_ADMINISTRATOR,icon:D.AGREEMENT_CLOSING_MANAGEMENT_ADMINISTRATOR,command:()=>{this.selectedItem?.id&&this.redirectClosingProcess(this.selectedItem.id)}})}redirectViewAgreement(){this.isVisibleAgreementView=!0}redirectTrackingLogList(i){this.router.navigate(["/core/agreement-administrator/period-list",i],{queryParams:{type:"execution"}})}redirectAgreementTerminationList(i){this.router.navigate(["/core/agreement-administrator/agreement-termination-list",i],{queryParams:{type:"closing"}})}redirectClosingProcess(i){this.router.navigate(["/core/agreement-administrator/closing-process/a",i],{queryParams:{type:"closing"}})}remove(i){}paginate(i){}selectItem(i){this.agreementsHttpService.findOne(i.id).subscribe(r=>{this.isButtonActions=!0,this.selectedItem=r,this.validateButtonActions(r),this.agreementsService.agreement=r})}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=N({type:n,selectors:[["app-agreement-list"]],decls:13,vars:10,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Convenio",3,"visibleChange","visible","modal"],[3,"id"],[1,"flex"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex","ngClass"],[3,"click","icon"],["severity","info","value","Registrado"],["severity","danger","value","En Proceso"]],template:function(r,s){if(r&1){let b=x();a(0,"p-toolbar"),u(1,"div",1)(2,"div",2),c(),a(3,"p-table",3,0),d(5,ui,3,1,"ng-template",4)(6,Ci,5,1,"ng-template",5)(7,Pi,5,6,"ng-template",6)(8,Bi,3,2,"ng-template",7)(9,Mi,0,0,"ng-template",8),c(),a(10,"app-button-action",9),h("isHide",function(E){return f(b),v(s.isButtonActions=!E)}),c(),a(11,"p-dialog",10),ne("visibleChange",function(E){return f(b),ie(s.isVisibleAgreementView,E)||(s.isVisibleAgreementView=E),v(E)}),d(12,ki,1,1,"app-view",11),c()}r&2&&(l(3),m("value",s.items)("columns",s.columns)("paginator",!0)("rows",10)("loading",s.coreService.isLoading),l(7),m("buttonActions",s.buttonActions)("enabled",s.isButtonActions),l(),te("visible",s.isVisibleAgreementView),m("modal",!0),l(),g(12,s.selectedItem&&s.isVisibleAgreementView?12:-1))},dependencies:[ht,he,V,Z,W,Q,Y,X,J,zt,ve,Xt,Ft,Je],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=n;return t})();function Ni(t,n){if(t&1&&(a(0,"div",10)(1,"h2"),p(2),y(3,"customFormatDate"),y(4,"customFormatDate"),c()()),t&2){let e=o();l(2),ft(" ",e.period.name,": ",we(3,3,e.period.startedAt)," - ",we(4,5,e.period.endedAt)," ")}}function Vi(t,n){if(t&1&&(a(0,"th",11),p(1),u(2,"p-sortIcon",12),c()),t&2){let e=n.$implicit;m("pSortableColumn",e.field),l(),C(" ",e.header," "),l(),m("field",e.field)}}function Ri(t,n){if(t&1&&(a(0,"tr"),S(1,Vi,3,3,"th",11,F),c()),t&2){let e=n.$implicit;l(),L(e)}}function Oi(t,n){if(t&1&&(u(0,"br"),a(1,"b"),p(2,"Comentario: "),c(),p(3)),t&2){let e=o(4).$implicit;l(3),C("",e.observation," ")}}function Hi(t,n){if(t&1&&(p(0),d(1,Oi,4,1)),t&2){let e=o(3).$implicit;ee(" ",e.user.name," ",e.user.lastname," "),l(),g(1,e.observation?1:-1)}}function $i(t,n){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e.state.name," ")}}function Gi(t,n){if(t&1&&d(0,Hi,2,3)(1,$i,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="user"?0:e==="state"?1:-1)}}function Ui(t,n){if(t&1&&(p(0),y(1,"date")),t&2){let e=o(4).$implicit;C(" ",k(1,1,e.registeredAt,"dd/MM/yy - HH:mm")," ")}}function zi(t,n){if(t&1&&d(0,Ui,2,4),t&2){let e=o(3).$implicit;g(0,e.registeredAt?0:-1)}}function qi(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field]," ")}}function Wi(t,n){if(t&1&&d(0,zi,1,1)(1,qi,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="registeredAt"?0:1)}}function ji(t,n){if(t&1&&(a(0,"td"),d(1,Gi,2,1)(2,Wi,2,1),c()),t&2){let e=n.$implicit,i=o().$implicit;l(),g(1,i[e.field]!=null&&i[e.field].id?1:-1),l(),g(2,i[e.field]!=null&&i[e.field].id?-1:2)}}function Ki(t,n){if(t&1&&(a(0,"tr",13),S(1,ji,3,2,"td",null,F),c()),t&2){let e=n.$implicit,i=n.columns,r=n.rowIndex;m("pSelectableRow",e)("pSelectableRowIndex",r),l(),L(i)}}function Qi(t,n){if(t&1&&(a(0,"tr")(1,"td"),p(2),c()()),t&2){let e=n.$implicit,i=o();l(),$("colspan",e.length),l(),C(" ",i.messageService.paginatorNoRecordsFound," ")}}function Yi(t,n){}var Ue=(()=>{let n=class n{constructor(){this.authService=_(H),this.coreService=_(R),this.router=_(Ee),this.trackingLogsHttpService=_(re),this.PrimeIcons=w,this.IconButtonActionEnum=D,this.SeverityButtonActionEnum=z,this.LabelButtonActionEnum=I,this.BreadcrumbEnum=A,this.TableEnum=q,this.messageService=_(G),this.messageDialogService=_(O),this.buttonActions=[],this.columns=[],this.search=new K(""),this.items=[],this.isVisibleAgreementView=!1,this.buildColumns()}ngOnInit(){this.items=this.period.trackingLogs}buildColumns(){this.columns=[{field:"state",header:Fe.state},{field:"registeredAt",header:Fe.registeredAt},{field:"user",header:Fe.user}]}redirectAgreementLogForm(i){this.router.navigate(["/core/agreements/log",i])}downloadLog(){this.trackingLogsHttpService.downloadLog(this.period.id,this.trackingLogType)}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=N({type:n,selectors:[["app-tracking-log-list"]],inputs:{period:"period",trackingLogType:"trackingLogType"},decls:11,vars:9,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"ml-2",3,"click","icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[1,"flex"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"]],template:function(r,s){if(r&1){let b=x();a(0,"p-toolbar")(1,"div",1)(2,"p-button",2),h("click",function(){return f(b),v(s.downloadLog())}),c()(),u(3,"div",3),c(),a(4,"p-table",4,0),d(6,Ni,5,7,"ng-template",5)(7,Ri,3,0,"ng-template",6)(8,Ki,3,2,"ng-template",7)(9,Qi,3,2,"ng-template",8)(10,Yi,0,0,"ng-template",9),c()}r&2&&(l(2),m("icon",s.IconButtonActionEnum.DOWNLOAD)("label",s.LabelButtonActionEnum.DOWNLOAD)("loading",s.coreService.isLoading)("severity",s.SeverityButtonActionEnum.SYNC),l(2),m("value",s.items)("columns",s.columns)("paginator",!0)("rows",10)("loading",s.coreService.isLoading))},dependencies:[V,Z,W,Q,Y,X,J,oe,Je],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=n;return t})();var en=()=>({width:"50rem"});function tn(t,n){if(t&1&&(a(0,"div",16)(1,"h2"),p(2),c()()),t&2){let e=o();l(2),B(e.BreadcrumbEnum.ADDITIONAL_DOCUMENTS)}}function nn(t,n){if(t&1&&(a(0,"th",17),p(1),u(2,"p-sortIcon",19),c()),t&2){let e=n.$implicit;m("pSortableColumn",e.field),l(),C(" ",e.header," "),l(),m("field",e.field)}}function on(t,n){if(t&1&&(a(0,"tr"),S(1,nn,3,3,"th",17,F),a(3,"th",18),p(4),c()()),t&2){let e=n.$implicit,i=o();l(),L(e),l(3),C(" ",i.TableEnum.ACTIONS," ")}}function ln(t,n){if(t&1&&p(0),t&2){let e=o(4).$implicit;ee(" ",e.user.name," ",e.user.lastname," ")}}function rn(t,n){if(t&1&&d(0,ln,1,2),t&2){let e=o(3).$implicit;g(0,e!=null&&e.user?0:-1)}}function an(t,n){if(t&1&&d(0,rn,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="user"?0:-1)}}function sn(t,n){if(t&1){let e=x();a(0,"span"),p(1),c(),a(2,"p-button",22),h("click",function(){let r=f(e).$implicit,s=o(5);return v(s.downloadFile(r))}),c(),u(3,"p-divider")}if(t&2){let e=n.$implicit,i=o(5);l(),C("",e.type.name,": "),l(),m("icon",i.IconButtonActionEnum.DOWNLOAD)("label",e.name)("text",!0)("severity",i.SeverityButtonActionEnum.DOWNLOAD)}}function cn(t,n){if(t&1&&S(0,sn,4,5,null,null,F),t&2){let e=o(3).$implicit;L(e==null?null:e.additionalDocuments)}}function mn(t,n){if(t&1&&p(0),t&2){let e=o(3).$implicit;ee(" ",e.name," ",e.sequence," ")}}function pn(t,n){if(t&1&&(p(0),y(1,"date")),t&2){let e=o(3).$implicit;C(" ",k(1,1,e.uploadedAt,"dd/MM/y - HH:mm")," ")}}function dn(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field]," ")}}function _n(t,n){if(t&1&&d(0,cn,2,0)(1,mn,1,2)(2,pn,2,4)(3,dn,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="additionalDocuments"?0:e==="name"?1:e==="uploadedAt"?2:3)}}function un(t,n){if(t&1&&(a(0,"td"),d(1,an,1,1)(2,_n,4,1),c()),t&2){let e=n.$implicit,i=o().$implicit;l(),g(1,i[e.field]!=null&&i[e.field].id?1:-1),l(),g(2,i[e.field]!=null&&i[e.field].id?-1:2)}}function gn(t,n){if(t&1){let e=x();a(0,"tr",20),S(1,un,3,2,"td",null,F),a(3,"td",18)(4,"p-button",21),h("click",function(){let r=f(e).$implicit,s=o();return v(s.remove(r.id))}),c()()()}if(t&2){let e=n.$implicit,i=n.columns,r=n.rowIndex,s=o();m("pSelectableRow",e)("pSelectableRowIndex",r),l(),L(i),l(3),m("icon",s.PrimeIcons.TRASH)}}function Cn(t,n){if(t&1&&(a(0,"tr")(1,"td"),p(2),c()()),t&2){let e=n.$implicit,i=o();l(),$("colspan",e.length),l(),C(" ",i.messageService.paginatorNoRecordsFound," ")}}function fn(t,n){}function vn(t,n){if(t&1&&(u(0,"i"),a(1,"div",35),p(2),c()),t&2){let e=o(3);P(e.PrimeIcons.FILE_PDF),l(2),B(e.reportFileField.value==null?null:e.reportFileField.value.name)}}function hn(t,n){t&1&&(a(0,"div",28)(1,"p-messages",33),d(2,vn,3,3,"ng-template",34),c()())}function xn(t,n){if(t&1&&(u(0,"i"),a(1,"div",35),p(2),c()),t&2){let e=o(3);P(e.PrimeIcons.FILE_PDF),l(2),B(e.evidenceFileField.value==null?null:e.evidenceFileField.value.name)}}function bn(t,n){t&1&&(a(0,"div",28)(1,"p-messages",33),d(2,xn,3,3,"ng-template",34),c()())}function En(t,n){if(t&1){let e=x();a(0,"form",23)(1,"div",24),u(2,"label",25),a(3,"p-fileUpload",26,1),h("uploadHandler",function(r){f(e);let s=se(4),b=o();return v(b.uploadReportFile(r,s))}),c(),u(5,"small",27),c(),d(6,hn,3,0,"div",28),a(7,"div",24),u(8,"label",29),a(9,"p-fileUpload",30,1),h("uploadHandler",function(r){f(e);let s=se(4),b=o();return v(b.uploadEvidenceFile(r,s))}),c(),u(11,"small",27),c(),d(12,bn,3,0,"div",28),a(13,"div",28),u(14,"label",31)(15,"textarea",32)(16,"small",27),c()()}if(t&2){let e=o();m("formGroup",e.form),l(2),m("label",e.AdditionalDocumentEnum.reportFile)("required",e.reportFileField),l(),m("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),l(2),m("errors",e.reportFileField.errors)("touched",e.reportFileField.touched)("dirty",e.reportFileField.dirty),l(),g(6,e.reportFileField.value?6:-1),l(2),m("label",e.AdditionalDocumentEnum.evidenceFile)("required",e.evidenceFileField),l(),m("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),l(2),m("errors",e.evidenceFileField.errors)("touched",e.evidenceFileField.touched)("dirty",e.evidenceFileField.dirty),l(),g(12,e.evidenceFileField.value?12:-1),l(2),m("label",e.AdditionalDocumentEnum.detail)("required",e.detailField),l(2),m("errors",e.detailField.errors)("touched",e.detailField.touched)("dirty",e.detailField.dirty)}}function Tn(t,n){if(t&1){let e=x();a(0,"p-button",36),h("click",function(){f(e);let r=o();return v(r.closeModal())}),c(),a(1,"p-button",37),h("click",function(){f(e);let r=o();return v(r.onUpload())}),c()}if(t&2){let e=o();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),l(),m("icon",e.IconButtonActionEnum.REPORT)("label",e.LabelButtonActionEnum.REPORT)("severity",e.SeverityButtonActionEnum.REPORT)}}var oi=(()=>{let n=class n{constructor(){this.authService=_(H),this.coreService=_(R),this.formBuilder=_(ge),this.cataloguesHttpService=_(pe),this.trackingLogsHttpService=_(re),this.filesHttpService=_(Ae),this.confirmationService=_(me),this.breadcrumbService=_(le),this.PrimeIcons=w,this.IconButtonActionEnum=D,this.SeverityButtonActionEnum=z,this.LabelButtonActionEnum=I,this.BreadcrumbEnum=A,this.TableEnum=q,this.messageService=_(G),this.messageDialogService=_(O),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new K(""),this.items=[],this.formErrors=[],this.types=[],this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Le,this.CatalogueTrackingLogsStateEnum=Te,this.AdditionalDocumentEnum=Pe,this.FileEnum=Se,this.breadcrumbService.setItems([{label:A.AGREEMENTS,routerLink:["/core/agreement-administrator/agreement-list"]},{label:A.PERIODS}]),this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(be(500)).subscribe(i=>{this.findAdditionalDocumentsByAgreement()})}ngOnInit(){this.findAdditionalDocumentsByAgreement(),this.loadTypes()}buildForm(){this.form=this.formBuilder.group({reportFile:[null],evidenceFile:[null],detail:[null,j.required]})}findAdditionalDocumentsByAgreement(){this.trackingLogsHttpService.findExecutionAdditionalDocumentsByAgreement(this.agreementId).subscribe(i=>{this.items=i})}loadTypes(){this.types=this.cataloguesHttpService.findByType(de.PERIODS_TRACKING_LOG)}buildColumns(){this.columns=[{field:"name",header:Pe.name},{field:"detail",header:Pe.detail},{field:"additionalDocuments",header:Pe.additionalDocuments},{field:"uploadedAt",header:Pe.uploadedAt},{field:"user",header:Pe.user}]}buildButtonActions(){this.buttonActions=[{id:U.TRACKING_LOG,label:I.TRACKING_LOG,icon:D.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}]}validateButtonActions(i){this.buildButtonActions()}remove(i){this.confirmationService.confirm({key:"confirmDialog",message:"No se podr\xE1 recuperar la informaci\xF3n",header:"\xBFEst\xE1 seguro de eliminar?",icon:w.TRASH,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.trackingLogsHttpService.deleteAdditionalDocument(i).subscribe(r=>{this.findAdditionalDocumentsByAgreement()})}})}selectItem(i){this.isButtonActions=!0,this.selectedItem=i,this.validateButtonActions(i)}showFilesModal(){this.isVisibleFilesModal=!0}downloadFile(i){this.filesHttpService.downloadFile(i)}onUpload(){if(this.validateFilesForm()){let i=new FormData;i.append("report",this.reportFileField.value),i.append("evidence",this.evidenceFileField.value),i.append("detail",this.detailField.value),this.trackingLogsHttpService.createExecutionAdditionalDocument(this.agreementId,i).subscribe(r=>{this.findAdditionalDocumentsByAgreement(),this.form.reset(),this.isVisibleFilesModal=!1})}else this.form.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors)}validateFilesForm(){return this.formErrors=[],this.reportFileField.invalid&&this.formErrors.push(T.reportFile),this.evidenceFileField.invalid&&this.formErrors.push(T.evidenceFile),this.detailField.invalid&&this.formErrors.push(T.detail),this.formErrors.length===0}uploadReportFile(i,r){this.reportFileField.patchValue(i.files[0]),r.clear()}uploadEvidenceFile(i,r){this.evidenceFileField.patchValue(i.files[0]),r.clear()}closeModal(){this.isVisibleFilesModal=!1,this.reportFileField.reset(),this.evidenceFileField.reset(),this.detailField.reset()}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}get detailField(){return this.form.controls.detail}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=N({type:n,selectors:[["app-additional-document-list"]],inputs:{agreementId:"agreementId"},decls:16,vars:16,consts:[["dt",""],["uploadFiles",""],[1,"p-toolbar-group-left"],[3,"click","icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Subir archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["key","confirmDialog"],[1,"flex"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],["severity","danger",3,"click","icon"],[1,"ml-2",3,"click","icon","label","text","severity"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","report",3,"label","required"],["id","report","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appErrorMessage","",3,"errors","touched","dirty"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","evidence",3,"label","required"],["id","evidence","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appLabel","","for","detail",3,"label","required"],["pInputTextarea","","id","detail","formControlName","detail"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(r,s){if(r&1){let b=x();a(0,"p-toolbar")(1,"div",2)(2,"p-button",3),h("click",function(){return f(b),v(s.showFilesModal())}),c()(),u(3,"div",4),c(),a(4,"p-table",5,0),d(6,tn,3,1,"ng-template",6)(7,on,5,1,"ng-template",7)(8,gn,5,3,"ng-template",8)(9,Cn,3,2,"ng-template",9)(10,fn,0,0,"ng-template",10),c(),a(11,"app-button-action",11),h("isHide",function(E){return f(b),v(s.isButtonActions=!E)}),c(),a(12,"p-dialog",12),ne("visibleChange",function(E){return f(b),ie(s.isVisibleFilesModal,E)||(s.isVisibleFilesModal=E),v(E)}),d(13,En,17,28,"ng-template",13)(14,Tn,2,7,"ng-template",14),c(),u(15,"p-confirmDialog",15)}r&2&&(l(2),m("icon",s.IconButtonActionEnum.CREATE)("label",s.LabelButtonActionEnum.CREATE_ADDITIONAL_DOCUMENT)("loading",s.coreService.isLoading)("severity",s.SeverityButtonActionEnum.CREATE),l(2),m("value",s.items)("columns",s.columns)("paginator",!0)("rows",10)("loading",s.coreService.isLoading),l(7),m("buttonActions",s.buttonActions)("enabled",s.isButtonActions),l(),ae(ce(15,en)),te("visible",s.isVisibleFilesModal),m("modal",!0))},dependencies:[ye,Ie,he,V,Z,W,tt,Xe,Ze,et,Q,Y,X,J,it,nt,ve,De,fe,Ce,lt,ot,oe],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=n;return t})();var Ln=()=>({width:"50rem"}),Fn=()=>({width:"100%"});function An(t,n){if(t&1){let e=x();u(0,"p-divider"),a(1,"p-button",16),h("click",function(){f(e);let r=o(2);return v(r.createPeriod())}),c()}if(t&2){let e=o(2);l(),m("icon",e.IconButtonActionEnum.CREATE)("label",e.LabelButtonActionEnum.CREATE_PERIOD)("loading",e.coreService.isLoading)("severity",e.SeverityButtonActionEnum.CREATE)}}function yn(t,n){if(t&1){let e=x();a(0,"h2"),p(1),c(),a(2,"h3"),p(3,"Descargue aqu\xED el Formato de Informe de avance semestral del convenio:"),c(),a(4,"p-button",15),h("click",function(){f(e);let r=o();return v(r.downloadFormat(r.FormatsEnum.format_001))}),c(),d(5,An,2,4)}if(t&2){let e=o();l(),B(e.BreadcrumbEnum.PERIODS),l(3),m("icon",e.IconButtonActionEnum.DOWNLOAD)("label",e.LabelButtonActionEnum.DOWNLOAD)("severity",e.SeverityButtonActionEnum.DOWNLOAD),l(),g(5,-1)}}function In(t,n){if(t&1&&(a(0,"th",17),p(1),u(2,"p-sortIcon",19),c()),t&2){let e=n.$implicit;m("pSortableColumn",e.field),l(),C(" ",e.header," "),l(),m("field",e.field)}}function Dn(t,n){if(t&1&&(a(0,"tr"),S(1,In,3,3,"th",17,F),a(3,"th",18),p(4),c()()),t&2){let e=n.$implicit,i=o();l(),L(e),l(3),C(" ",i.TableEnum.ACTIONS," ")}}function wn(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field].unit.name," ")}}function Pn(t,n){if(t&1&&d(0,wn,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="administrator"?0:-1)}}function Bn(t,n){if(t&1){let e=x();a(0,"p-button",23),h("click",function(){f(e);let r=o(4).$implicit,s=o();return v(s.showFilesModal(r))}),c()}if(t&2){let e=o(5);m("icon",e.IconButtonActionEnum.ADD)("pTooltip",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}function Mn(t,n){if(t&1){let e=x();a(0,"span"),p(1),c(),a(2,"p-button",24),h("click",function(){let r=f(e).$implicit,s=o(6);return v(s.downloadFile(r))}),c(),u(3,"p-divider")}if(t&2){let e=n.$implicit,i=o(6);l(),C("",e.type.name,": "),l(),m("icon",i.IconButtonActionEnum.DOWNLOAD)("label",e.name)("text",!0)("severity",i.SeverityButtonActionEnum.DOWNLOAD)}}function kn(t,n){if(t&1&&S(0,Mn,4,5,null,null,F),t&2){let e=o(4).$implicit;L(e==null?null:e.trackingLogDocuments)}}function Nn(t,n){if(t&1&&d(0,Bn,1,3,"p-button",22)(1,kn,2,0),t&2){let e=o(3).$implicit,i=o();g(0,!(e!=null&&e.trackingLog)||e.trackingLog.state.code===i.CatalogueTrackingLogsStateEnum.REFUSED?0:1)}}function Vn(t,n){if(t&1&&u(0,"i",26),t&2){let e=o(6);P(e.PrimeIcons.CIRCLE_FILL)}}function Rn(t,n){if(t&1&&u(0,"i",27),t&2){let e=o(6);P(e.PrimeIcons.CIRCLE_FILL)}}function On(t,n){if(t&1&&d(0,Vn,1,2,"i",25)(1,Rn,1,2),t&2){let e=o(4).$implicit;g(0,e.trackingLog.state.code==="REPORTED"||e.trackingLog.state.code==="ACCEPTED"?0:1)}}function Hn(t,n){if(t&1&&u(0,"i",27),t&2){let e=o(5);P(e.PrimeIcons.CIRCLE_FILL)}}function $n(t,n){if(t&1&&d(0,On,2,1)(1,Hn,1,2),t&2){let e=o(3).$implicit;g(0,e.trackingLog?0:1)}}function Gn(t,n){if(t&1&&(p(0),u(1,"br"),p(2),y(3,"date"),u(4,"br"),p(5),y(6,"date")),t&2){let e=o(3).$implicit;C(" ",e.name," "),l(2),C(" ",k(3,3,e.startedAt,"d MMMM y")," - "),l(3),C(" ",k(6,6,e.endedAt,"d MMMM y")," ")}}function Un(t,n){if(t&1&&(p(0),y(1,"date")),t&2){let e=o(3).$implicit;C(" ",k(1,1,e.uploadedAt,"dd/MM/y - HH:mm")," ")}}function zn(t,n){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e.trackingLog==null||e.trackingLog.state==null?null:e.trackingLog.state.name," ")}}function qn(t,n){if(t&1&&p(0),t&2){let e=o(4).$implicit;ee(" ",e.trackingLog.user.name," ",e.trackingLog.user.lastname," ")}}function Wn(t,n){if(t&1&&d(0,qn,1,2),t&2){let e=o(3).$implicit;g(0,e.trackingLog!=null&&e.trackingLog.user?0:-1)}}function jn(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field]," ")}}function Kn(t,n){if(t&1&&d(0,Nn,2,1)(1,$n,2,1)(2,Gn,7,9)(3,Un,2,4)(4,zn,1,1)(5,Wn,1,1)(6,jn,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="files"?0:e==="trafficLight"?1:e==="name"?2:e==="uploadedAt"?3:e==="state"?4:e==="user"?5:6)}}function Qn(t,n){if(t&1&&(a(0,"td"),d(1,Pn,1,1)(2,Kn,7,1),c()),t&2){let e=n.$implicit,i=o().$implicit;l(),g(1,i[e.field]!=null&&i[e.field].id?1:-1),l(),g(2,i[e.field]!=null&&i[e.field].id?-1:2)}}function Yn(t,n){if(t&1){let e=x();a(0,"tr",20),S(1,Qn,3,2,"td",null,F),a(3,"td",18)(4,"p-button",21),h("click",function(){let r=f(e).$implicit,s=o();return v(s.selectItem(r))}),c()()()}if(t&2){let e=n.$implicit,i=n.columns,r=n.rowIndex,s=o();m("pSelectableRow",e)("pSelectableRowIndex",r),l(),L(i),l(3),m("icon",s.PrimeIcons.ELLIPSIS_V)}}function Jn(t,n){if(t&1&&(a(0,"tr")(1,"td"),p(2),c()()),t&2){let e=n.$implicit,i=o();l(),$("colspan",e.length),l(),C(" ",i.messageService.paginatorNoRecordsFound," ")}}function Xn(t,n){}function Zn(t,n){if(t&1&&(u(0,"i"),a(1,"div",38),p(2),c()),t&2){let e=o(3);P(e.PrimeIcons.FILE_PDF),l(2),B(e.reportFileField.value==null?null:e.reportFileField.value.name)}}function eo(t,n){t&1&&(a(0,"div",33)(1,"p-messages",36),d(2,Zn,3,3,"ng-template",37),c()())}function to(t,n){if(t&1&&(u(0,"i"),a(1,"div",38),p(2),c()),t&2){let e=o(3);P(e.PrimeIcons.FILE_PDF),l(2),B(e.evidenceFileField.value==null?null:e.evidenceFileField.value.name)}}function io(t,n){t&1&&(a(0,"div",33)(1,"p-messages",36),d(2,to,3,3,"ng-template",37),c()())}function no(t,n){if(t&1){let e=x();a(0,"div",28)(1,"div",29),u(2,"label",30),a(3,"p-fileUpload",31,1),h("uploadHandler",function(r){f(e);let s=se(4),b=o();return v(b.uploadReportFile(r,s))}),c(),u(5,"small",32),c(),d(6,eo,3,0,"div",33),a(7,"div",29),u(8,"label",34),a(9,"p-fileUpload",35,1),h("uploadHandler",function(r){f(e);let s=se(4),b=o();return v(b.uploadEvidenceFile(r,s))}),c(),u(11,"small",32),c(),d(12,io,3,0,"div",33),c()}if(t&2){let e=o();l(2),m("label",e.PeriodEnum.reportFile)("required",e.reportFileField),l(),m("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),l(2),m("errors",e.reportFileField.errors)("touched",e.reportFileField.touched)("dirty",e.reportFileField.dirty),l(),g(6,e.reportFileField.value?6:-1),l(2),m("label",e.PeriodEnum.evidenceFile)("required",e.evidenceFileField),l(),m("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),l(2),m("errors",e.evidenceFileField.errors)("touched",e.evidenceFileField.touched)("dirty",e.evidenceFileField.dirty),l(),g(12,e.evidenceFileField.value?12:-1)}}function oo(t,n){if(t&1){let e=x();a(0,"p-button",39),h("click",function(){f(e);let r=o();return v(r.closeModal())}),c(),a(1,"p-button",40),h("click",function(){f(e);let r=o();return v(r.onUpload())}),c()}if(t&2){let e=o();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),l(),m("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.SEND_REPORT)("severity",e.SeverityButtonActionEnum.UPLOAD)}}function lo(t,n){if(t&1&&u(0,"app-tracking-log-list",14),t&2){let e=o();m("period",e.selectedItem)}}var ri=(()=>{let n=class n{constructor(){this.activatedRoute=_(Me),this.authService=_(H),this.coreService=_(R),this.confirmationService=_(me),this.formBuilder=_(ge),this.cataloguesHttpService=_(pe),this.periodsHttpService=_(Ke),this.trackingLogsHttpService=_(re),this.agreementsHttpService=_(ue),this.filesHttpService=_(Ae),this.parametersHttpService=_(Ye),this.agreementsService=_(ke),this.router=_(Ee),this.breadcrumbService=_(le),this.PrimeIcons=w,this.IconButtonActionEnum=D,this.SeverityButtonActionEnum=z,this.LabelButtonActionEnum=I,this.BreadcrumbEnum=A,this.TableEnum=q,this.messageService=_(G),this.messageDialogService=_(O),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new K(""),this.items=[],this.formErrors=[],this.types=[],this.trackingLogType="execution",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Le,this.CatalogueTrackingLogsStateEnum=Te,this.PeriodEnum=T,this.FileEnum=Se,this.FormatsEnum=rt,this.breadcrumbService.setItems([{label:A.AGREEMENTS,routerLink:["/core/agreement-administrator/agreement-list"]},{label:A.PERIODS}]),this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(be(500)).subscribe(i=>{this.findPeriodsByAgreement()})}ngOnInit(){this.findPeriodsByAgreement(),this.findAgreement(this.agreementId),this.loadTypes(),this.activatedRoute.queryParams.subscribe(i=>{this.trackingLogType=i.type})}buildForm(){this.form=this.formBuilder.group({reportFile:[null,j.required],evidenceFile:[null]})}findAgreement(i){this.agreementsHttpService.findOne(i).subscribe(r=>{this.agreement=r})}findPeriodsByAgreement(){this.trackingLogsHttpService.findPeriodsByAgreement(this.agreementId,this.trackingLogType).subscribe(i=>{this.items=i})}loadTypes(){this.types=this.cataloguesHttpService.findByType(de.PERIODS_TRACKING_LOG)}createPeriod(){this.trackingLogsHttpService.createPeriod(this.agreementId,this.trackingLogType).subscribe(i=>{this.findPeriodsByAgreement()})}buildColumns(){this.columns=[{field:"name",header:T.reportPeriod},{field:"documentName",header:T.name},{field:"files",header:T.documentName},{field:"trafficLight",header:T.trafficLight},{field:"uploadedAt",header:T.uploadedAt},{field:"user",header:T.user},{field:"state",header:T.state}]}buildButtonActions(){this.buttonActions=[{id:U.TRACKING_LOG,label:I.TRACKING_LOG,icon:D.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}]}validateButtonActions(i){this.buildButtonActions(),i.agreement?.isFinishDate&&this.buttonActions.splice(this.buttonActions.findIndex(r=>r.id===U.DELETE),1)}remove(i){}paginate(i){}selectItem(i){this.isButtonActions=!0,this.selectedItem=i,this.validateButtonActions(i)}showFilesModal(i){this.selectedItem=i,this.isVisibleFilesModal=!0}downloadFile(i){this.filesHttpService.downloadFile(i)}downloadFormat(i){this.parametersHttpService.downloadFile(i)}onUpload(){this.validateFilesForm()?this.confirmationService.confirm({key:"confirmDialog",message:"\xBFEst\xE1 seguro de subir los archivos?",header:"",icon:w.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{let i=new FormData;i.append("report",this.reportFileField.value),i.append("evidence",this.evidenceFileField.value),this.trackingLogsHttpService.createTrackingLog(this.selectedItem.id,i,this.trackingLogType).subscribe(r=>{this.findPeriodsByAgreement(),this.isVisibleFilesModal=!1,this.reportFileField.setValue(null),this.evidenceFileField.setValue(null)})}}):this.messageDialogService.fieldErrors(this.formErrors)}validateFilesForm(){return this.formErrors=[],this.reportFileField.invalid&&this.formErrors.push(T.reportFile),this.evidenceFileField.invalid&&this.formErrors.push(T.evidenceFile),this.formErrors.length===0}uploadReportFile(i,r){this.reportFileField.patchValue(i.files[0]),r.clear()}uploadEvidenceFile(i,r){this.evidenceFileField.patchValue(i.files[0]),r.clear()}closeModal(){this.isVisibleFilesModal=!1,this.reportFileField.setValue(null),this.evidenceFileField.setValue(null)}deletePeriod(){if(this.selectedItem.trackingLog){this.messageDialogService.errorCustom("No es posible eliminar el per\xEDodo del reporte","Una vez iniciado el proceso de reporte de avance, no se puede eliminar el periodo creado.");return}this.periodsHttpService.delete(this.selectedItem.id).subscribe(()=>{this.findPeriodsByAgreement()})}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=N({type:n,selectors:[["app-period-list"]],inputs:{agreementId:"agreementId"},decls:14,vars:19,consts:[["dt",""],["uploadFiles",""],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"agreementId"],[3,"isHide","buttonActions","enabled"],["header","Subir Archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["header","Bit\xE1cora",3,"visibleChange","visible","modal"],["trackingLogType","execution",3,"period"],[1,"ml-2",3,"click","icon","label","severity"],[3,"click","icon","label","loading","severity"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[3,"click","icon"],[1,"ml-2",3,"icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[1,"p-fluid","grid"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","report",3,"label","required"],["id","report","mode","basic","chooseLabel","Cargar","invalidFileSizeMessageDetail","","name","files[]","accept",".pdf",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appErrorMessage","",3,"errors","touched","dirty"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","evidence",3,"label","required"],["id","evidence","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(r,s){if(r&1){let b=x();a(0,"p-table",2,0),d(2,yn,6,5,"ng-template",3)(3,Dn,5,1,"ng-template",4)(4,Yn,5,3,"ng-template",5)(5,Jn,3,2,"ng-template",6)(6,Xn,0,0,"ng-template",7),c(),u(7,"app-additional-document-list",8),a(8,"app-button-action",9),h("isHide",function(){return f(b),v(s.isButtonActions=!1)}),c(),a(9,"p-dialog",10),ne("visibleChange",function(E){return f(b),ie(s.isVisibleFilesModal,E)||(s.isVisibleFilesModal=E),v(E)}),d(10,no,13,22,"ng-template",11)(11,oo,2,7,"ng-template",12),c(),a(12,"p-dialog",13),ne("visibleChange",function(E){return f(b),ie(s.isVisibleTrackingLogModal,E)||(s.isVisibleTrackingLogModal=E),v(E)}),d(13,lo,1,1,"app-tracking-log-list",14),c()}r&2&&(m("value",s.items)("columns",s.columns)("paginator",!0)("rows",4)("loading",s.coreService.isLoading),l(7),m("agreementId",s.agreementId),l(),m("buttonActions",s.buttonActions)("enabled",s.isButtonActions),l(),ae(ce(17,Ln)),te("visible",s.isVisibleFilesModal),m("modal",!0),l(3),ae(ce(18,Fn)),te("visible",s.isVisibleTrackingLogModal),m("modal",!0),l(),g(13,s.isVisibleTrackingLogModal?13:-1))},dependencies:[ye,Ie,he,Re,V,W,Q,Y,X,J,ve,De,fe,Ce,Ue,oi,oe],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=n;return t})();var ro=()=>({width:"50rem"}),ao=()=>({width:"100%"});function so(t,n){if(t&1){let e=x();a(0,"p-button",17),h("click",function(){f(e);let r=o();return v(r.createPeriod())}),c()}if(t&2){let e=o();m("icon",e.IconButtonActionEnum.CREATE)("label",e.LabelButtonActionEnum.CREATE_PERIOD)("loading",e.coreService.isLoading)("severity",e.SeverityButtonActionEnum.CREATE)}}function co(t,n){if(t&1){let e=x();a(0,"h2"),p(1),c(),a(2,"h3"),p(3,"Descargue aqu\xED el Formato de Informe de avance de avance semestral de cierre del convenio:"),c(),a(4,"p-button",18),h("click",function(){f(e);let r=o();return v(r.downloadFormat(r.FormatsEnum.format_002))}),c()}if(t&2){let e=o();l(),B(e.BreadcrumbEnum.PERIODS_CLOSING_ADMINISTRATOR),l(3),m("icon",e.IconButtonActionEnum.DOWNLOAD)("label",e.LabelButtonActionEnum.DOWNLOAD)("severity",e.SeverityButtonActionEnum.DOWNLOAD)}}function mo(t,n){if(t&1&&(a(0,"th",19),p(1),u(2,"p-sortIcon",21),c()),t&2){let e=n.$implicit;m("pSortableColumn",e.field),l(),C(" ",e.header," "),l(),m("field",e.field)}}function po(t,n){if(t&1&&(a(0,"tr"),S(1,mo,3,3,"th",19,F),a(3,"th",20),p(4),c()()),t&2){let e=n.$implicit,i=o();l(),L(e),l(3),C(" ",i.TableEnum.ACTIONS," ")}}function _o(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field].unit.name," ")}}function uo(t,n){if(t&1&&d(0,_o,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="administrator"?0:-1)}}function go(t,n){if(t&1){let e=x();a(0,"p-button",25),h("click",function(){f(e);let r=o(4).$implicit,s=o();return v(s.showFilesModal(r))}),c()}if(t&2){let e=o(5);m("icon",e.IconButtonActionEnum.ADD)("pTooltip",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}function Co(t,n){if(t&1){let e=x();a(0,"span"),p(1),c(),a(2,"p-button",26),h("click",function(){let r=f(e).$implicit,s=o(6);return v(s.downloadFile(r))}),c(),u(3,"p-divider")}if(t&2){let e=n.$implicit,i=o(6);l(),C("",e.type.name,": "),l(),m("icon",i.IconButtonActionEnum.DOWNLOAD)("label",e.name)("text",!0)("severity",i.SeverityButtonActionEnum.DOWNLOAD)}}function fo(t,n){if(t&1&&S(0,Co,4,5,null,null,F),t&2){let e=o(4).$implicit;L(e==null?null:e.trackingLogDocuments)}}function vo(t,n){if(t&1&&d(0,go,1,3,"p-button",24)(1,fo,2,0),t&2){let e=o(3).$implicit,i=o();g(0,!(e!=null&&e.trackingLog)||e.trackingLog.state.code===i.CatalogueTrackingLogsStateEnum.REFUSED?0:1)}}function ho(t,n){if(t&1&&u(0,"i",28),t&2){let e=o(6);P(e.PrimeIcons.CIRCLE_FILL)}}function xo(t,n){if(t&1&&u(0,"i",29),t&2){let e=o(6);P(e.PrimeIcons.CIRCLE_FILL)}}function bo(t,n){if(t&1&&d(0,ho,1,2,"i",27)(1,xo,1,2),t&2){let e=o(4).$implicit;g(0,e.trackingLog.state.code==="REPORTED"||e.trackingLog.state.code==="ACCEPTED"?0:1)}}function Eo(t,n){if(t&1&&u(0,"i",29),t&2){let e=o(5);P(e.PrimeIcons.CIRCLE_FILL)}}function To(t,n){if(t&1&&d(0,bo,2,1)(1,Eo,1,2),t&2){let e=o(3).$implicit;g(0,e.trackingLog?0:1)}}function So(t,n){if(t&1&&(p(0),u(1,"br"),p(2),y(3,"date"),u(4,"br"),p(5),y(6,"date")),t&2){let e=o(3).$implicit;C(" ",e.name," "),l(2),C(" ",k(3,3,e.startedAt,"d MMMM y")," - "),l(3),C(" ",k(6,6,e.endedAt,"d MMMM y")," ")}}function Lo(t,n){if(t&1&&(p(0),y(1,"date")),t&2){let e=o(3).$implicit;C(" ",k(1,1,e.uploadedAt,"dd/MM/y - HH:mm")," ")}}function Fo(t,n){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e.trackingLog==null||e.trackingLog.state==null?null:e.trackingLog.state.name," ")}}function Ao(t,n){if(t&1&&p(0),t&2){let e=o(4).$implicit;ee(" ",e.trackingLog.user.name," ",e.trackingLog.user.lastname," ")}}function yo(t,n){if(t&1&&d(0,Ao,1,2),t&2){let e=o(3).$implicit;g(0,e.trackingLog!=null&&e.trackingLog.user?0:-1)}}function Io(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field]," ")}}function Do(t,n){if(t&1&&d(0,vo,2,1)(1,To,2,1)(2,So,7,9)(3,Lo,2,4)(4,Fo,1,1)(5,yo,1,1)(6,Io,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="files"?0:e==="trafficLight"?1:e==="name"?2:e==="uploadedAt"?3:e==="state"?4:e==="user"?5:6)}}function wo(t,n){if(t&1&&(a(0,"td"),d(1,uo,1,1)(2,Do,7,1),c()),t&2){let e=n.$implicit,i=o().$implicit;l(),g(1,i[e.field]!=null&&i[e.field].id?1:-1),l(),g(2,i[e.field]!=null&&i[e.field].id?-1:2)}}function Po(t,n){if(t&1){let e=x();a(0,"tr",22),S(1,wo,3,2,"td",null,F),a(3,"td",20)(4,"p-button",23),h("click",function(){let r=f(e).$implicit,s=o();return v(s.selectItem(r))}),c()()()}if(t&2){let e=n.$implicit,i=n.columns,r=n.rowIndex,s=o();m("pSelectableRow",e)("pSelectableRowIndex",r),l(),L(i),l(3),m("icon",s.PrimeIcons.ELLIPSIS_V)}}function Bo(t,n){if(t&1&&(a(0,"tr")(1,"td"),p(2),c()()),t&2){let e=n.$implicit,i=o();l(),$("colspan",e.length),l(),C(" ",i.messageService.paginatorNoRecordsFound," ")}}function Mo(t,n){}function ko(t,n){if(t&1&&(u(0,"i"),a(1,"div",40),p(2),c()),t&2){let e=o(3);P(e.PrimeIcons.FILE_PDF),l(2),B(e.reportFileField.value==null?null:e.reportFileField.value.name)}}function No(t,n){t&1&&(a(0,"div",35)(1,"p-messages",38),d(2,ko,3,3,"ng-template",39),c()())}function Vo(t,n){if(t&1&&(u(0,"i"),a(1,"div",40),p(2),c()),t&2){let e=o(3);P(e.PrimeIcons.FILE_PDF),l(2),B(e.evidenceFileField.value==null?null:e.evidenceFileField.value.name)}}function Ro(t,n){t&1&&(a(0,"div",35)(1,"p-messages",38),d(2,Vo,3,3,"ng-template",39),c()())}function Oo(t,n){if(t&1){let e=x();a(0,"div",30)(1,"div",31),u(2,"label",32),a(3,"p-fileUpload",33,1),h("uploadHandler",function(r){f(e);let s=se(4),b=o();return v(b.uploadReportFile(r,s))}),c(),u(5,"small",34),c(),d(6,No,3,0,"div",35),a(7,"div",31),u(8,"label",36),a(9,"p-fileUpload",37,1),h("uploadHandler",function(r){f(e);let s=se(4),b=o();return v(b.uploadEvidenceFile(r,s))}),c(),u(11,"small",34),c(),d(12,Ro,3,0,"div",35),c()}if(t&2){let e=o();l(2),m("label",e.PeriodEnum.reportClosingFile)("required",e.reportFileField),l(),m("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),l(2),m("errors",e.reportFileField.errors)("touched",e.reportFileField.touched)("dirty",e.reportFileField.dirty),l(),g(6,e.reportFileField.value?6:-1),l(2),m("label",e.PeriodEnum.evidenceClosingFile)("required",e.evidenceFileField),l(),m("chooseIcon",e.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",e.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",e.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),l(2),m("errors",e.evidenceFileField.errors)("touched",e.evidenceFileField.touched)("dirty",e.evidenceFileField.dirty),l(),g(12,e.evidenceFileField.value?12:-1)}}function Ho(t,n){if(t&1){let e=x();a(0,"p-button",41),h("click",function(){f(e);let r=o();return v(r.closeModal())}),c(),a(1,"p-button",42),h("click",function(){f(e);let r=o();return v(r.onUpload())}),c()}if(t&2){let e=o();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),l(),m("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.UPLOAD)("severity",e.SeverityButtonActionEnum.UPLOAD)}}function $o(t,n){if(t&1&&u(0,"app-tracking-log-list",16),t&2){let e=o();m("period",e.selectedItem)}}var ai=(()=>{let n=class n{constructor(){this.activatedRoute=_(Me),this.authService=_(H),this.coreService=_(R),this.confirmationService=_(me),this.formBuilder=_(ge),this.cataloguesHttpService=_(pe),this.trackingLogsHttpService=_(re),this.parametersHttpService=_(Ye),this.agreementsHttpService=_(ue),this.filesHttpService=_(Ae),this.agreementsService=_(ke),this.router=_(Ee),this.breadcrumbService=_(le),this.PrimeIcons=w,this.IconButtonActionEnum=D,this.SeverityButtonActionEnum=z,this.LabelButtonActionEnum=I,this.BreadcrumbEnum=A,this.TableEnum=q,this.messageService=_(G),this.messageDialogService=_(O),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new K(""),this.items=[],this.formErrors=[],this.types=[],this.trackingLogType="closing",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Le,this.CatalogueTrackingLogsStateEnum=Te,this.PeriodEnum=T,this.FileEnum=Se,this.FormatsEnum=rt,this.breadcrumbService.setItems([{label:A.AGREEMENTS,routerLink:["/core/agreement-administrator/agreement-list"]},{label:A.PERIODS_CLOSING_ADMINISTRATOR}]),this.buildForm(),this.buildButtonActions(),this.buildColumns(),this.search.valueChanges.pipe(be(500)).subscribe(i=>{this.findPeriodsByAgreement()})}ngOnInit(){this.findPeriodsByAgreement(),this.findAgreement(this.agreementId),this.loadTypes()}buildForm(){this.form=this.formBuilder.group({reportFile:[null,j.required],evidenceFile:[null]})}findAgreement(i){this.agreementsHttpService.findOne(i).subscribe(r=>{this.agreement=r})}findPeriodsByAgreement(){this.trackingLogsHttpService.findPeriodsByAgreement(this.agreementId,this.trackingLogType).subscribe(i=>{this.items=i})}loadTypes(){this.types=this.cataloguesHttpService.findByType(de.PERIODS_TRACKING_LOG)}createPeriod(){this.trackingLogsHttpService.createPeriod(this.agreementId,this.trackingLogType).subscribe(i=>{this.findPeriodsByAgreement()})}buildColumns(){this.columns=[{field:"name",header:T.reportPeriod},{field:"documentName",header:T.name},{field:"files",header:T.documentName},{field:"trafficLight",header:T.trafficLight},{field:"uploadedAt",header:T.uploadedAt},{field:"user",header:T.user},{field:"state",header:T.state}]}buildButtonActions(){this.buttonActions=[{id:U.TRACKING_LOG,label:I.TRACKING_LOG,icon:D.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}]}validateButtonActions(i){this.buildButtonActions()}remove(i){}paginate(i){}selectItem(i){this.isButtonActions=!0,this.selectedItem=i,this.validateButtonActions(i)}showFilesModal(i){this.selectedItem=i,this.isVisibleFilesModal=!0}downloadFile(i){this.filesHttpService.downloadFile(i)}onUpload(){this.validateFilesForm()?this.confirmationService.confirm({key:"confirmDialog",message:"\xBFEst\xE1 seguro de subir los archivos?",header:"",icon:w.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{let i=new FormData;i.append("report",this.reportFileField.value),i.append("evidence",this.evidenceFileField.value),this.trackingLogsHttpService.createTrackingLog(this.selectedItem.id,i,this.trackingLogType).subscribe(r=>{this.findPeriodsByAgreement(),this.isVisibleFilesModal=!1,this.reportFileField.setValue(null),this.evidenceFileField.setValue(null)})}}):this.messageDialogService.fieldErrors(this.formErrors)}validateFilesForm(){return this.formErrors=[],this.reportFileField.invalid&&this.formErrors.push(T.reportFile),this.evidenceFileField.invalid&&this.formErrors.push(T.evidenceFile),this.formErrors.length===0}uploadReportFile(i,r){this.reportFileField.patchValue(i.files[0]),r.clear()}uploadEvidenceFile(i,r){this.evidenceFileField.patchValue(i.files[0]),r.clear()}closeModal(){this.isVisibleFilesModal=!1,this.reportFileField.setValue(null),this.evidenceFileField.setValue(null)}downloadFormat(i){this.parametersHttpService.downloadFile(i)}get reportFileField(){return this.form.controls.reportFile}get evidenceFileField(){return this.form.controls.evidenceFile}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=N({type:n,selectors:[["app-period-closing-list"]],inputs:{agreementId:"agreementId"},decls:17,vars:19,consts:[["dt",""],["uploadFiles",""],[1,"p-toolbar-group-left"],[3,"icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Subir Archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["header","Bit\xE1cora",3,"visibleChange","visible","modal"],["trackingLogType","closing",3,"period"],[3,"click","icon","label","loading","severity"],[1,"ml-2",3,"click","icon","label","severity"],[3,"pSortableColumn"],[1,"text-center"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[3,"click","icon"],[1,"ml-2",3,"icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[1,"p-fluid","grid"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","report",3,"label","required"],["id","report","mode","basic","chooseLabel","Cargar","invalidFileSizeMessageDetail","","name","files[]","accept",".pdf",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["appErrorMessage","",3,"errors","touched","dirty"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","evidence",3,"label","required"],["id","evidence","mode","basic","chooseLabel","Cargar","name","files[]","accept",".pdf,.zip,.rar","invalidFileSizeMessageDetail","",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["severity","info"],["pTemplate",""],[1,"ml-2"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(r,s){if(r&1){let b=x();a(0,"p-toolbar")(1,"div",2),d(2,so,1,4,"p-button",3),c(),u(3,"div",4),c(),a(4,"p-table",5,0),d(6,co,5,4,"ng-template",6)(7,po,5,1,"ng-template",7)(8,Po,5,3,"ng-template",8)(9,Bo,3,2,"ng-template",9)(10,Mo,0,0,"ng-template",10),c(),a(11,"app-button-action",11),h("isHide",function(E){return f(b),v(s.isButtonActions=!E)}),c(),a(12,"p-dialog",12),ne("visibleChange",function(E){return f(b),ie(s.isVisibleFilesModal,E)||(s.isVisibleFilesModal=E),v(E)}),d(13,Oo,13,22,"ng-template",13)(14,Ho,2,7,"ng-template",14),c(),a(15,"p-dialog",15),ne("visibleChange",function(E){return f(b),ie(s.isVisibleTrackingLogModal,E)||(s.isVisibleTrackingLogModal=E),v(E)}),d(16,$o,1,1,"app-tracking-log-list",16),c()}r&2&&(l(2),g(2,s.agreement&&!s.agreement.isFinishDate?2:-1),l(2),m("value",s.items)("columns",s.columns)("paginator",!0)("rows",10)("loading",s.coreService.isLoading),l(7),m("buttonActions",s.buttonActions)("enabled",s.isButtonActions),l(),ae(ce(17,ro)),te("visible",s.isVisibleFilesModal),m("modal",!0),l(3),ae(ce(18,ao)),te("visible",s.isVisibleTrackingLogModal),m("modal",!0),l(),g(16,s.isVisibleTrackingLogModal?16:-1))},dependencies:[ye,Ie,he,Re,V,Z,W,Q,Y,X,J,ve,De,fe,Ce,Ue,oe],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=n;return t})();function Uo(t,n){t&1&&u(0,"div",10)}function zo(t,n){if(t&1&&(a(0,"th",11),p(1),u(2,"p-sortIcon",12),c()),t&2){let e=n.$implicit;m("pSortableColumn",e.field),l(),C(" ",e.header," "),l(),m("field",e.field)}}function qo(t,n){if(t&1&&(a(0,"tr"),S(1,zo,3,3,"th",11,F),c()),t&2){let e=n.$implicit;l(),L(e)}}function Wo(t,n){if(t&1&&(u(0,"br"),a(1,"b"),p(2,"Comentario: "),c(),p(3)),t&2){let e=o(4).$implicit;l(3),C("",e.observation," ")}}function jo(t,n){if(t&1&&(p(0),d(1,Wo,4,1)),t&2){let e=o(3).$implicit;ee(" ",e.user.name," ",e.user.lastname," "),l(),g(1,e.observation?1:-1)}}function Ko(t,n){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e.state.name," ")}}function Qo(t,n){if(t&1&&d(0,jo,2,3)(1,Ko,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="user"?0:e==="state"?1:-1)}}function Yo(t,n){if(t&1&&(p(0),y(1,"date")),t&2){let e=o(4).$implicit;C(" ",k(1,1,e.registeredAt,"dd/MM/yy - HH:mm")," ")}}function Jo(t,n){if(t&1&&d(0,Yo,2,4),t&2){let e=o(3).$implicit;g(0,e.registeredAt?0:-1)}}function Xo(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field]," ")}}function Zo(t,n){if(t&1&&d(0,Jo,1,1)(1,Xo,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="registeredAt"?0:1)}}function el(t,n){if(t&1&&(a(0,"td"),d(1,Qo,2,1)(2,Zo,2,1),c()),t&2){let e=n.$implicit,i=o().$implicit;l(),g(1,i[e.field]!=null&&i[e.field].id?1:-1),l(),g(2,i[e.field]!=null&&i[e.field].id?-1:2)}}function tl(t,n){if(t&1&&(a(0,"tr",13),S(1,el,3,2,"td",null,F),c()),t&2){let e=n.$implicit,i=n.columns,r=n.rowIndex;m("pSelectableRow",e)("pSelectableRowIndex",r),l(),L(i)}}function il(t,n){if(t&1&&(a(0,"tr")(1,"td"),p(2),c()()),t&2){let e=n.$implicit,i=o();l(),$("colspan",e.length),l(),C(" ",i.messageService.paginatorNoRecordsFound," ")}}function nl(t,n){}var si=(()=>{let n=class n{constructor(){this.authService=_(H),this.coreService=_(R),this.closingLogsHttpService=_(Qe),this.PrimeIcons=w,this.IconButtonActionEnum=D,this.SeverityButtonActionEnum=z,this.LabelButtonActionEnum=I,this.BreadcrumbEnum=A,this.TableEnum=q,this.messageService=_(G),this.messageDialogService=_(O),this.buttonActions=[],this.columns=[],this.search=new K(""),this.items=[],this.isVisibleAgreementView=!1,this.buildColumns()}ngOnInit(){this.findClosingLogsByAgreement()}buildColumns(){this.columns=[{field:"state",header:Fe.state},{field:"registeredAt",header:Fe.registeredAt},{field:"user",header:Fe.user}]}findClosingLogsByAgreement(){this.closingLogsHttpService.findClosingLogsByAgreement(this.agreementId).subscribe(i=>{i&&(this.items=i)})}downloadLog(){this.closingLogsHttpService.downloadLog(this.agreementId)}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=N({type:n,selectors:[["app-closing-log-list"]],inputs:{agreementId:"agreementId"},decls:11,vars:9,consts:[["dt",""],[1,"p-toolbar-group-left"],[1,"ml-2",3,"click","icon","label","loading","severity"],[1,"p-toolbar-group-right"],["dataKey","id","styleClass","p-datatable-striped","paginatorPosition","both",3,"value","columns","paginator","rows","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[1,"flex"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"]],template:function(r,s){if(r&1){let b=x();a(0,"p-toolbar")(1,"div",1)(2,"p-button",2),h("click",function(){return f(b),v(s.downloadLog())}),c()(),u(3,"div",3),c(),a(4,"p-table",4,0),d(6,Uo,1,0,"ng-template",5)(7,qo,3,0,"ng-template",6)(8,tl,3,2,"ng-template",7)(9,il,3,2,"ng-template",8)(10,nl,0,0,"ng-template",9),c()}r&2&&(l(2),m("icon",s.IconButtonActionEnum.DOWNLOAD)("label",s.LabelButtonActionEnum.DOWNLOAD)("loading",s.coreService.isLoading)("severity",s.SeverityButtonActionEnum.SYNC),l(2),m("value",s.items)("columns",s.columns)("paginator",!0)("rows",10)("loading",s.coreService.isLoading))},dependencies:[V,Z,W,Q,Y,X,J,oe],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=n;return t})();var ll=(t,n)=>n.id,rl=()=>({width:"50rem"}),al=()=>({width:"100%"});function sl(t,n){t&1&&(a(0,"div",19),p(1," Previo a reportar la documentaci\xF3n en la secciones GESTI\xD3N DE CIERRE DE CONVENIO \xE9stos (reportes de avence de cierre) deber\xE1 contar con todos los reportes en estado ACEPTADO. "),c())}function cl(t,n){t&1&&(a(0,"p-messages",14),d(1,sl,2,0,"ng-template",18),c())}function ml(t,n){if(t&1){let e=x();a(0,"p-button",20),h("click",function(){f(e);let r=o(2);return v(r.openFilesModal())}),c()}if(t&2){let e=o(2);m("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.CREATE_CLOSING_LOG)("loading",e.coreService.isLoading)("severity",e.SeverityButtonActionEnum.UPLOAD)}}function pl(t,n){if(t&1&&(a(0,"h2"),p(1),c(),d(2,cl,2,0,"p-messages",14),a(3,"p-toolbar")(4,"div",15),d(5,ml,1,4,"p-button",16),c(),u(6,"div",17),c()),t&2){let e=o();l(),B(e.BreadcrumbEnum.CLOSING_LOG_ADMINISTRATOR),l(),g(2,!e.validPeriodsClosing&&e.closingNotification&&(e.closingNotification.closeType==null?null:e.closingNotification.closeType.code)===e.CatalogueClosingNotificationsCloseTypesDocumentEnum.TERM?2:-1),l(3),g(5,e.items.length===0?5:-1)}}function dl(t,n){if(t&1&&(a(0,"th",22),p(1),u(2,"p-sortIcon",23),c()),t&2){let e=n.$implicit;m("pSortableColumn",e.field),l(),C(" ",e.header," "),l(),m("field",e.field)}}function _l(t,n){if(t&1&&(a(0,"tr"),u(1,"th",21),S(2,dl,3,3,"th",22,F),a(4,"th",21),p(5),c()()),t&2){let e=n.$implicit,i=o();l(2),L(e),l(3),C(" ",i.TableEnum.ACTIONS," ")}}function ul(t,n){if(t&1){let e=x();a(0,"p-button",27),h("click",function(){f(e);let r=o(2);return v(r.openFilesModal())}),c()}if(t&2){let e=o(2);m("icon",e.IconButtonActionEnum.ADD)("pTooltip",e.LabelButtonActionEnum.ADD)("severity",e.SeverityButtonActionEnum.ADD)}}function gl(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field].unit.name," ")}}function Cl(t,n){if(t&1&&p(0),t&2){let e=o(4).$implicit;ee(" ",e.user.name," ",e.user.lastname," ")}}function fl(t,n){if(t&1&&d(0,Cl,1,2),t&2){let e=o(3).$implicit;g(0,e!=null&&e.user?0:-1)}}function vl(t,n){if(t&1&&p(0),t&2){let e=o(3).$implicit;C(" ",e==null||e.state==null?null:e.state.name," ")}}function hl(t,n){if(t&1&&d(0,gl,1,1)(1,fl,1,1)(2,vl,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="administrator"?0:e==="user"?1:e==="state"?2:-1)}}function xl(t,n){if(t&1&&(a(0,"span"),p(1),c(),u(2,"p-divider")),t&2){let e=n.$implicit;l(),C("",e.type.name,": ")}}function bl(t,n){if(t&1&&S(0,xl,3,1,null,null,F),t&2){let e=o(4).$implicit;L(e==null?null:e.closingLogDocuments)}}function El(t,n){if(t&1&&d(0,bl,2,0),t&2){let e=o(3).$implicit;g(0,e!=null&&e.closingLogDocuments?0:-1)}}function Tl(t,n){if(t&1){let e=x();a(0,"p-button",28),h("click",function(){let r=f(e).$implicit,s=o(6);return v(s.downloadFile(r))}),c(),u(1,"p-divider")}if(t&2){let e=n.$implicit,i=o(6);m("icon",i.IconButtonActionEnum.DOWNLOAD)("label",e.name)("text",!0)("severity",i.SeverityButtonActionEnum.DOWNLOAD)}}function Sl(t,n){if(t&1&&S(0,Tl,2,4,null,null,F),t&2){let e=o(4).$implicit;L(e==null?null:e.closingLogDocuments)}}function Ll(t,n){if(t&1&&d(0,Sl,2,0),t&2){let e=o(3).$implicit;g(0,e!=null&&e.closingLogDocuments?0:-1)}}function Fl(t,n){if(t&1&&u(0,"i",30),t&2){let e=o(6);P(e.PrimeIcons.CIRCLE_FILL)}}function Al(t,n){if(t&1&&u(0,"i",31),t&2){let e=o(6);P(e.PrimeIcons.CIRCLE_FILL)}}function yl(t,n){if(t&1&&d(0,Fl,1,2,"i",29)(1,Al,1,2),t&2){let e=o(4).$implicit;g(0,e.state.code==="REPORTED"||e.state.code==="ACCEPTED"?0:1)}}function Il(t,n){if(t&1&&u(0,"i",31),t&2){let e=o(5);P(e.PrimeIcons.CIRCLE_FILL)}}function Dl(t,n){if(t&1&&d(0,yl,2,1)(1,Il,1,2),t&2){let e=o(3).$implicit;g(0,e.closingLogDocuments?0:1)}}function wl(t,n){if(t&1&&(p(0),u(1,"br"),p(2),y(3,"date"),u(4,"br"),p(5),y(6,"date")),t&2){let e=o(3).$implicit;C(" ",e.name," "),l(2),C(" ",k(3,3,e.startedAt,"d MMMM y")," - "),l(3),C(" ",k(6,6,e.endedAt,"d MMMM y")," ")}}function Pl(t,n){if(t&1&&(p(0),y(1,"date")),t&2){let e=o(3).$implicit;C(" ",k(1,1,e.uploadedAt,"dd/MM/y - HH:mm")," ")}}function Bl(t,n){if(t&1&&p(0),t&2){let e=o(2).$implicit,i=o().$implicit;C(" ",i[e.field]," ")}}function Ml(t,n){if(t&1&&d(0,El,1,1)(1,Ll,1,1)(2,Dl,2,1)(3,wl,7,9)(4,Pl,2,4)(5,Bl,1,1),t&2){let e,i=o().$implicit;g(0,(e=i.field)==="closingLogDocumentsUpload"?0:e==="closingLogDocuments"?1:e==="trafficLight"?2:e==="name"?3:e==="uploadedAt"?4:5)}}function kl(t,n){if(t&1&&(a(0,"td"),d(1,hl,3,1)(2,Ml,6,1),c()),t&2){let e=n.$implicit,i=o().$implicit;l(),g(1,i[e.field]!=null&&i[e.field].id?1:-1),l(),g(2,i[e.field]!=null&&i[e.field].id?-1:2)}}function Nl(t,n){if(t&1){let e=x();a(0,"tr",24)(1,"td"),d(2,ul,1,3,"p-button",25),c(),S(3,kl,3,2,"td",null,F),a(5,"td",21)(6,"p-button",26),h("click",function(){let r=f(e).$implicit,s=o();return v(s.selectItem(r))}),c()()()}if(t&2){let e=n.$implicit,i=n.columns,r=n.rowIndex,s=o();m("pSelectableRow",e)("pSelectableRowIndex",r),l(2),g(2,!(e!=null&&e.closingLogDocuments)||e.state.code===s.CatalogueTrackingLogsStateEnum.REFUSED?2:-1),l(),L(i),l(3),m("icon",s.PrimeIcons.ELLIPSIS_V)}}function Vl(t,n){if(t&1&&(a(0,"tr")(1,"td"),p(2),c()()),t&2){let e=n.$implicit,i=o();l(),$("colspan",e.length),l(),C(" ",i.messageService.paginatorNoRecordsFound," ")}}function Rl(t,n){}function Ol(t,n){if(t&1&&(u(0,"i"),a(1,"div",19),p(2),c()),t&2){let e=o(2).$index,i=o(2);P(i.PrimeIcons.FILE_PDF),l(2),B(i.files[e].file.name)}}function Hl(t,n){t&1&&(a(0,"div",33)(1,"p-messages",37),d(2,Ol,3,3,"ng-template",18),c()())}function $l(t,n){if(t&1){let e=x();a(0,"div",33)(1,"label",34),p(2),a(3,"b",35),p(4,"*"),c()(),a(5,"p-fileUpload",36,1),h("uploadHandler",function(r){let s=f(e).$implicit,b=se(6),M=o(2);return v(M.onUpload(r,b,s))}),c()(),d(7,Hl,3,0,"div",33)}if(t&2){let e=n.$implicit,i=n.$index,r=o(2);l(),m("for",e.id),l(),C(" ",e.name," "),l(3),m("chooseIcon",r.PrimeIcons.UPLOAD)("invalidFileSizeMessageSummary",r.FileEnum.invalidFileSizeMessageSummary)("maxFileSize",r.FileEnum.maxFileSize)("auto",!0)("customUpload",!0),l(2),g(7,r.files.length>i?7:-1)}}function Gl(t,n){if(t&1&&(a(0,"div",32),S(1,$l,8,8,null,null,ll),c()),t&2){let e=o();l(),L(e.closeTypes)}}function Ul(t,n){if(t&1){let e=x();a(0,"p-button",38),h("click",function(){f(e);let r=o();return v(r.closeModal())}),c(),a(1,"p-button",39),h("click",function(){f(e);let r=o();return v(r.onSubmit())}),c()}if(t&2){let e=o();m("label",e.LabelButtonActionEnum.CANCEL)("icon",e.IconButtonActionEnum.CANCEL)("text",!0)("severity",e.SeverityButtonActionEnum.CANCEL),l(),m("icon",e.IconButtonActionEnum.UPLOAD)("label",e.LabelButtonActionEnum.UPLOAD)("severity",e.SeverityButtonActionEnum.UPLOAD)}}function zl(t,n){if(t&1&&u(0,"app-closing-log-list",13),t&2){let e=o();m("agreementId",e.agreementId)}}var ci=(()=>{let n=class n{constructor(){this.activatedRoute=_(Me),this.authService=_(H),this.coreService=_(R),this.confirmationService=_(me),this.formBuilder=_(ge),this.cataloguesHttpService=_(pe),this.periodsHttpService=_(Ke),this.trackingLogsHttpService=_(re),this.closingLogsHttpService=_(Qe),this.agreementsHttpService=_(ue),this.filesHttpService=_(Ae),this.breadcrumbService=_(le),this.PrimeIcons=w,this.IconButtonActionEnum=D,this.SeverityButtonActionEnum=z,this.LabelButtonActionEnum=I,this.BreadcrumbEnum=A,this.TableEnum=q,this.messageService=_(G),this.messageDialogService=_(O),this.buttonActions=[],this.isButtonActions=!1,this.columns=[],this.search=new K(""),this.items=[],this.formErrors=[],this.files=[],this.types=[],this.closeTypes=[],this.trackingLogType="execution",this.isVisibleFilesModal=!1,this.isVisibleTrackingLogModal=!1,this.AddendumEnum=Le,this.CatalogueTrackingLogsStateEnum=Te,this.CatalogueClosingNotificationsCloseTypesDocumentEnum=Ve,this.FileEnum=Se,this.validPeriodsClosing=!1,this.validPeriodsExecution=!1,this.breadcrumbService.setItems([{label:A.AGREEMENTS,routerLink:["/core/agreement-administrator/agreement-list"]},{label:A.PERIODS}]),this.buildForm(),this.buildButtonActions(),this.buildColumns()}ngOnInit(){this.findClosingLogCurrentByAgreement(),this.findAgreement(this.agreementId),this.loadTypes(),this.loadTypesByCloseType(),setTimeout(()=>{this.validatePeriods()},500),this.activatedRoute.queryParams.subscribe(i=>{this.trackingLogType=i.type})}buildForm(){this.form=this.formBuilder.group({reportFile:[null,j.required],evidenceFile:[null]})}findAgreement(i){this.agreementsHttpService.findOne(i).subscribe(r=>{this.agreement=r})}findClosingLogCurrentByAgreement(){this.closingLogsHttpService.findClosingLogCurrentByAgreement(this.agreementId).subscribe(i=>{i&&(this.items=[i])})}loadTypes(){this.types=this.cataloguesHttpService.findByType(de.PERIODS_TRACKING_LOG)}loadTypesByCloseType(){this.closeTypes=this.cataloguesHttpService.findByParent(this.closingNotification?.closeType?.id)}createClosingLog(){let i=new FormData;for(let r of this.files)i.append("typeIds",r.type.id),i.append("files",r.file);this.closingLogsHttpService.createClosingLog(this.agreementId,i).subscribe(r=>{this.findClosingLogCurrentByAgreement(),this.isVisibleFilesModal=!1})}onUpload(i,r,s){let b=this.files.findIndex(M=>M.type?.id===s.id);b===-1?this.files.push({type:s,file:i.files[0]}):this.files[b]={type:s,file:i.files[0]},r.clear()}openFilesModal(){this.closingNotification?(this.loadTypesByCloseType(),pt(this.trackingLogsHttpService.validationPeriods(this.agreementId,"execution"),this.trackingLogsHttpService.validationPeriods(this.agreementId,"closing")).subscribe(i=>{if(i.length>0){if(this.validPeriodsExecution=i[0],this.validPeriodsClosing=i[1],!this.validPeriodsExecution){this.messageDialogService.errorCustom("Importante!","Verificar que todos los periodos de ejecuci\xF3n y seguimiento a la ejecuci\xF3n est\xE9n reportados y aceptados");return}if(this.closingNotification.closeType?.code===Ve.TERM&&!this.validPeriodsClosing){this.messageDialogService.errorCustom("Importante!","Verificar que todos los periodos de avance de cierre est\xE9n reportados y aceptados");return}this.isVisibleFilesModal=!0}})):this.messageDialogService.errorCustom("Importante!","Por favor debe notificar la fecha de Acta de Terminaci\xF3n y Cierre del Convenio")}onSubmit(){this.validateFilesForm()?this.createClosingLog():this.messageDialogService.fieldErrors(this.formErrors)}buildColumns(){this.columns=[{field:"closingLogDocumentsUpload",header:T.documentName},{field:"closingLogDocuments",header:T.fileName},{field:"trafficLight",header:T.trafficLight},{field:"uploadedAt",header:T.uploadedAt},{field:"user",header:T.user},{field:"state",header:T.state}]}buildButtonActions(){this.buttonActions=[{id:U.TRACKING_LOG,label:I.TRACKING_LOG,icon:D.TRACKING_LOG,command:()=>{this.isVisibleTrackingLogModal=!0}}]}validateButtonActions(i){this.buildButtonActions()}remove(i){}selectItem(i){this.isButtonActions=!0,this.selectedItem=i,this.validateButtonActions(i)}downloadFile(i){this.filesHttpService.downloadFile(i)}validateFilesForm(){return this.formErrors=[],this.closeTypes.forEach(i=>{this.files.find(s=>s.type?.id===i?.id)||this.formErrors.push(i.name)}),this.formErrors.length===0}closeModal(){this.isVisibleFilesModal=!1,this.files=[]}validatePeriods(){this.validPeriodsClosing=!1,this.validPeriodsExecution=!1,this.closingNotification&&this.closingNotification.closeType?.code===Ve.TERM&&pt(this.trackingLogsHttpService.validationPeriods(this.agreementId,"execution"),this.trackingLogsHttpService.validationPeriods(this.agreementId,"closing")).subscribe(i=>{i.length>0&&(this.validPeriodsExecution=i[0],this.validPeriodsClosing=i[1])})}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=N({type:n,selectors:[["app-closing-log-current"]],inputs:{agreementId:"agreementId",closingNotification:"closingNotification"},decls:13,vars:16,consts:[["dt",""],["uploadFiles",""],["dataKey","id","styleClass","p-datatable-striped",3,"value","columns","loading"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["pTemplate","summary"],[3,"isHide","buttonActions","enabled"],["header","Subir Archivos",3,"visibleChange","visible","modal"],["pTemplate","content"],["pTemplate","footer"],["header","Bit\xE1cora de seguimiento al cierre del Convenio",3,"visibleChange","visible","modal"],[3,"agreementId"],["severity","error"],[1,"p-toolbar-group-left"],[3,"icon","label","loading","severity"],[1,"p-toolbar-group-right"],["pTemplate",""],[1,"ml-2"],[3,"click","icon","label","loading","severity"],[1,"text-center"],[3,"pSortableColumn"],[3,"field"],[3,"pSelectableRow","pSelectableRowIndex"],[1,"ml-2",3,"icon","pTooltip","severity"],[3,"click","icon"],[1,"ml-2",3,"click","icon","pTooltip","severity"],[1,"ml-2",3,"click","icon","label","text","severity"],[2,"color","var(--green-400)","font-size","3rem",3,"class"],[2,"color","var(--green-400)","font-size","3rem"],[2,"color","var(--red-400)","font-size","3rem"],[1,"p-fluid","grid"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],[3,"for"],[1,"p-error"],["id","report","mode","basic","chooseLabel","Cargar","invalidFileSizeMessageDetail","","name","files[]","accept",".pdf,.rar,.zip",3,"uploadHandler","chooseIcon","invalidFileSizeMessageSummary","maxFileSize","auto","customUpload"],["severity","info"],[3,"click","label","icon","text","severity"],[3,"click","icon","label","severity"]],template:function(r,s){if(r&1){let b=x();a(0,"p-table",2,0),d(2,pl,7,3,"ng-template",3)(3,_l,6,1,"ng-template",4)(4,Nl,7,4,"ng-template",5)(5,Vl,3,2,"ng-template",6)(6,Rl,0,0,"ng-template",7),c(),a(7,"app-button-action",8),h("isHide",function(E){return f(b),v(s.isButtonActions=!E)}),c(),a(8,"p-dialog",9),ne("visibleChange",function(E){return f(b),ie(s.isVisibleFilesModal,E)||(s.isVisibleFilesModal=E),v(E)}),d(9,Gl,3,0,"ng-template",10)(10,Ul,2,7,"ng-template",11),c(),a(11,"p-dialog",12),ne("visibleChange",function(E){return f(b),ie(s.isVisibleTrackingLogModal,E)||(s.isVisibleTrackingLogModal=E),v(E)}),d(12,zl,1,1,"app-closing-log-list",13),c()}r&2&&(m("value",s.items)("columns",s.columns)("loading",s.coreService.isLoading),l(7),m("buttonActions",s.buttonActions)("enabled",s.isButtonActions),l(),ae(ce(14,rl)),te("visible",s.isVisibleFilesModal),m("modal",!0),l(3),ae(ce(15,al)),te("visible",s.isVisibleTrackingLogModal),m("modal",!0),l(),g(12,s.isVisibleTrackingLogModal?12:-1))},dependencies:[he,Re,V,Z,W,Q,Y,X,J,ve,De,fe,Ce,si,oe],styles:[".enabled[_ngcontent-%COMP%]{background-color:var(--red-200)}"]});let t=n;return t})();function Wl(t,n){t&1&&(a(0,"div",6),p(1," Previo a reportar la documentaci\xF3n en las secciones REPORTE AVANCE PROCESO DE CIERRE DEL CONVENIO y GESTI\xD3N DE CIERRE DE CONVENIO \xE9stos (reportes de ejecuci\xF3n) deber\xE1 contar con todos los reportes de ejecuci\xF3n en estado ACEPTADO. "),c())}function jl(t,n){t&1&&(a(0,"p-messages",4),d(1,Wl,2,0,"ng-template",5),c())}function Kl(t,n){if(t&1&&(d(0,jl,2,0,"p-messages",4),u(1,"app-period-closing-list",0)),t&2){let e=o();g(0,e.validPeriodsExecution?-1:0),l(),m("agreementId",e.agreementId)}}function Ql(t,n){if(t&1&&(a(0,"div",19)(1,"div"),p(2),c()()),t&2){let e=n.$implicit;l(2),B(e.name)}}function Yl(t,n){if(t&1&&(a(0,"div",19)(1,"div"),p(2),c()()),t&2){let e=n.$implicit;l(2),B(e.name)}}function Jl(t,n){t&1&&u(0,"input",15)}function Xl(t,n){t&1&&u(0,"p-calendar",20),t&2&&m("iconDisplay","input")("showIcon",!0)}function Zl(t,n){if(t&1){let e=x();a(0,"p-toolbar")(1,"div",21),u(2,"app-header-form",22),c(),a(3,"div",23)(4,"app-form-button-action",24),h("submit",function(){f(e);let r=o(2);return v(r.onSubmit())}),c()()()}if(t&2){let e=o(2);l(2),m("icon",e.PrimeIcons.PENCIL),l(2),m("iconSubmitButton",e.PrimeIcons.SEND)("isVisibleCancelButton",!1)}}function er(t,n){if(t&1&&(a(0,"p-panel",1)(1,"h3"),p(2,"Notificar fecha de Acta de Terminaci\xF3n y Cierre del Convenio"),c(),a(3,"form",7)(4,"div",8),u(5,"label",9),a(6,"p-dropdown",10),d(7,Ql,3,1,"ng-template",11)(8,Yl,3,1,"ng-template",12),c(),u(9,"small",13),c(),a(10,"div",8),u(11,"label",14),d(12,Jl,1,0,"input",15)(13,Xl,1,2),u(14,"small",13),a(15,"p")(16,"em"),p(17," Nota: Registre la fecha que consta en el documento suscrito entre las partes "),c()()(),a(18,"div",16),u(19,"label",17)(20,"textarea",18)(21,"small",13),c()(),u(22,"p-divider"),d(23,Zl,5,3,"p-toolbar"),c()),t&2){let e=o();l(3),m("formGroup",e.form),l(2),m("label",e.ClosingNotificationEnum.closeType)("required",e.closeTypeField),l(),m("options",e.closeTypes),l(3),m("errors",e.closeTypeField.errors)("touched",e.closeTypeField.touched)("dirty",e.closeTypeField.dirty),l(2),m("label",e.ClosingNotificationEnum.closedAt)("required",e.closedAtField),l(),g(12,e.idField.value?12:13),l(2),m("errors",e.closedAtField.errors)("touched",e.closedAtField.touched)("dirty",e.closedAtField.dirty),l(5),m("label",e.ClosingNotificationEnum.closeDetail)("required",e.closeDetailField),l(2),m("errors",e.closeDetailField.errors)("touched",e.closeDetailField.touched)("dirty",e.closeDetailField.dirty),l(2),g(23,e.idField.value?-1:23)}}function tr(t,n){t&1&&u(0,"input",15)}function ir(t,n){if(t&1&&u(0,"p-calendar",26),t&2){let e=o(3);m("iconDisplay","input")("showIcon",!0)("minDate",e.endedAt)}}function nr(t,n){if(t&1&&d(0,ir,1,3,"p-calendar",26),t&2){let e=o(2);g(0,e.closingNotification.agreement.endedAt?0:-1)}}function or(t,n){if(t&1){let e=x();a(0,"p-toolbar")(1,"div",21),u(2,"app-header-form",22),c(),a(3,"div",23)(4,"app-form-button-action",24),h("submit",function(){f(e);let r=o(2);return v(r.onSubmit())}),c()()()}if(t&2){let e=o(2);l(2),m("icon",e.PrimeIcons.PENCIL),l(2),m("iconSubmitButton",e.PrimeIcons.SEND)("isVisibleCancelButton",!1)}}function lr(t,n){if(t&1&&(a(0,"p-panel",1)(1,"h3"),p(2,"Notificar fecha de Acta de Terminaci\xF3n y Cierre del Convenio"),c(),a(3,"form",7)(4,"div",8),u(5,"label",25),a(6,"p"),p(7,"Nota: A continuaci\xF3n, registre la fecha que consta en el documento suscrito entre las partes"),c(),d(8,tr,1,0,"input",15)(9,nr,1,1),u(10,"small",13),c()(),u(11,"p-divider"),d(12,or,5,3,"p-toolbar"),c()),t&2){let e=o();l(3),m("formGroup",e.form),l(2),m("label",e.ClosingNotificationEnum.closedAt)("required",e.closedAtField),l(3),g(8,e.closingNotification.closedAt?8:9),l(2),m("errors",e.closedAtField.errors)("touched",e.closedAtField.touched)("dirty",e.closedAtField.dirty),l(2),g(12,e.closingNotification.closedAt?-1:12)}}var mi=(()=>{let n=class n{constructor(){this.authService=_(H),this.breadcrumbService=_(le),this.agreementsHttpService=_(ue),this.confirmationService=_(me),this.closingNotificationsHttpService=_(Lt),this.trackingLogsHttpService=_(re),this.cataloguesHttpService=_(pe),this.coreService=_(R),this.messageDialogService=_(O),this.formBuilder=_(ge),this.validPeriodsExecution=!1,this.Validators=j,this.formErrors=[],this.closeTypes=[],this.AgreementFormEnum=_e,this.AgreementStateEnum=je,this.SkeletonEnum=Et,this.ClosingNotificationEnum=ze,this.PrimeIcons=w,this.CatalogueAgreementsTypeEnum=bt,this.CatalogueClosingNotificationsCloseTypeEnum=Ne,this.breadcrumbService.setItems([{label:A.AGREEMENTS,routerLink:[`/core/${this.authService.role.code}/agreement-list`]},{label:A.CLOSING_NOTIFICATION}]),this.buildForm()}ngOnInit(){this.loadCloseTypes(),this.findClosingNotificationByAgreement(),this.validatePeriodsExecution()}buildForm(){this.form=this.formBuilder.group({id:[null],agreement:[null,j.required],closedAt:[null,j.required],closeDetail:[null,j.required],closeType:[null,j.required]})}createClosingNotification(){this.agreementField.patchValue({id:this.agreementId}),this.closingNotificationsHttpService.createClosingNotificationByAgreement(this.form.value).subscribe(i=>{this.findClosingNotificationByAgreement()})}updateClosedAt(){this.closingNotificationsHttpService.updateClosedAt(this.idField.value,this.closedAtField.value).subscribe(i=>{this.findClosingNotificationByAgreement()})}validatePeriodsExecution(){this.trackingLogsHttpService.validationPeriods(this.agreementId,"execution").subscribe(i=>{this.validPeriodsExecution=i})}findClosingNotificationByAgreement(){this.closingNotificationsHttpService.findClosingNotificationByAgreement(this.agreementId).subscribe(i=>{i&&(this.closingNotification=i,this.form.patchValue(i),(this.closingNotification.closeType?.code===Ne.MUTUAL||this.closingNotification.closeType?.code===Ne.OBJECT||this.closingNotification.closeType?.code===Ne.UNILATERAL)&&this.form.disable(),this.closingNotification.closeType?.code===Ne.TERM&&this.closeDetailField.clearValidators(),i.closedAt&&(this.closedAtField.setValue(Jt(i.closedAt)),this.form.disable()),this.endedAt=new Date(this.closingNotification.agreement.endedAt+"T05:00:00"))})}validateForm(){return this.formErrors=[],this.closedAtField.invalid&&this.formErrors.push(ze.closedAt),this.closeDetailField.invalid&&this.formErrors.push(ze.closeDetail),this.closeTypeField.invalid&&this.formErrors.push(ze.closeType),this.formErrors.length===0}onSubmit(){this.validateForm()?this.confirmationService.confirm({key:"confirmDialog",message:"\xBFEst\xE1 seguro de notificar la terminiaci\xF3n del convenio?",header:"",icon:w.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.closingNotification&&this.closingNotification.closeType?.code===Ve.TERM?this.updateClosedAt():this.createClosingNotification()}}):(this.form.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}onUpdate(){this.validateForm()?this.confirmationService.confirm({key:"confirmDialog",message:"\xBFEst\xE1 seguro de notificar la terminiaci\xF3n del convenio?",header:"",icon:w.QUESTION_CIRCLE,acceptLabel:"Si",rejectLabel:"No",rejectButtonStyleClass:"p-button-text",accept:()=>{this.createClosingNotification()}}):(this.form.markAllAsTouched(),this.messageDialogService.fieldErrors(this.formErrors))}loadCloseTypes(){this.closeTypes=this.cataloguesHttpService.findByType(de.CLOSING_NOTIFICATIONS_CLOSE_TYPE)}get idField(){return this.form.controls.id}get agreementField(){return this.form.controls.agreement}get closedAtField(){return this.form.controls.closedAt}get closeDetailField(){return this.form.controls.closeDetail}get closeTypeField(){return this.form.controls.closeType}};n.\u0275fac=function(r){return new(r||n)},n.\u0275cmp=N({type:n,selectors:[["app-agreement-termination-list"]],inputs:{agreementId:"agreementId"},decls:6,vars:5,consts:[[3,"agreementId"],["header","NOTIFICACI\xD3N INICIO DEL PROCESO DE CIERRE DEL CONVENIO"],[3,"agreementId","closingNotification"],["key","confirmDialog"],["severity","error"],["pTemplate",""],[1,"ml-2"],[1,"p-fluid","grid",3,"formGroup"],[1,"field","col-12","xl:col-6","lg:col-6","md:col-6","sm:col-12"],["appLabel","","for","closeType",3,"label","required"],["id","closeType","formControlName","closeType","dataKey","id","placeholder","Selecione",3,"options"],["pTemplate","selectedItem"],["pTemplate","item"],["appErrorMessage","",3,"errors","touched","dirty"],["appLabel","","for","closedAt",3,"label","required"],["pInputText","","formControlName","closedAt"],[1,"field","col-12","xl:col-12","lg:col-12","md:col-12","sm:col-12"],["appLabel","","for","closeDetail",3,"label","required"],["pInputTextarea","","id","closeDetail","formControlName","closeDetail"],[1,"flex","align-items-center","gap-2"],["id","closedAt","formControlName","closedAt","dateFormat","dd/mm/yy",3,"iconDisplay","showIcon"],[1,"p-toolbar-group-left"],["label","Registro",3,"icon"],[1,"p-toolbar-group-right"],["labelSubmitButton","Notificar",3,"submit","iconSubmitButton","isVisibleCancelButton"],["appLabel","","for","closedAt2",3,"label","required"],["id","closedAt2","formControlName","closedAt","dateFormat","dd/mm/yy",3,"iconDisplay","showIcon","minDate"]],template:function(r,s){r&1&&(d(0,Kl,2,2,"app-period-closing-list",0)(1,er,24,19,"p-panel",1)(2,lr,13,8,"p-panel",1),a(3,"p-panel"),u(4,"app-closing-log-current",2),c(),u(5,"p-confirmDialog",3)),r&2&&(g(0,s.closingNotification&&(s.closingNotification.closeType==null?null:s.closingNotification.closeType.code)===s.CatalogueClosingNotificationsCloseTypeEnum.TERM?0:-1),l(),g(1,!s.closingNotification||(s.closingNotification.closeType==null?null:s.closingNotification.closeType.code)===s.CatalogueClosingNotificationsCloseTypeEnum.MUTUAL||(s.closingNotification.closeType==null?null:s.closingNotification.closeType.code)===s.CatalogueClosingNotificationsCloseTypeEnum.OBJECT||(s.closingNotification.closeType==null?null:s.closingNotification.closeType.code)===s.CatalogueClosingNotificationsCloseTypeEnum.UNILATERAL?1:-1),l(),g(2,s.closingNotification&&(s.closingNotification.closeType==null?null:s.closingNotification.closeType.code)===s.CatalogueClosingNotificationsCloseTypeEnum.TERM?2:-1),l(2),m("agreementId",s.agreementId)("closingNotification",s.closingNotification))},dependencies:[ye,Ie,jt,V,Qt,Z,Mt,tt,Xe,Ze,et,it,nt,It,fe,Ce,lt,ot,Nt,wt,ai,ci]});let t=n;return t})();var rr=[{path:"agreement-list",component:ii},{path:"period-list/:agreementId",component:ri},{path:"agreement-termination-list/:agreementId",component:mi},{path:"tracking-log-list",component:Ue},{path:"closing-process",loadChildren:()=>import("./chunk-S2P57VRU.js").then(t=>t.ClosingProcessModule)}],pi=(()=>{let n=class n{};n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=We({type:n}),n.\u0275inj=qe({imports:[dt.forChild(rr),dt]});let t=n;return t})();var Rs=(()=>{let n=class n{};n.\u0275fac=function(r){return new(r||n)},n.\u0275mod=We({type:n}),n.\u0275inj=qe({imports:[xt,pi,Yt,Ht,At,Rt,Ot,Bt,qt,yt,Dt,Wt,Zt,ei,ti,Gt,$t,kt,Kt,Ut,Vt,Pt]});let t=n;return t})();export{Rs as AgreementAdministratorModule};
