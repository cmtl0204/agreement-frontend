<div class="grid">
  <div class="col-12">
    <form [formGroup]="obligationForm" class="p-fluid">
      <div>
        <p-dropdown
          id="type"
          formControlName="type"
          dataKey="id"
          [options]="obligationTypes"
          placeholder="Seleccione"
          [filter]="false">
          <ng-template pTemplate="selectedItem" let-selectedItem>
            <div class="flex align-items-center gap-2">
              <div>{{ selectedItem.name }}</div>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center gap-2">
              <div>{{ item.name }}</div>
            </div>
          </ng-template>
        </p-dropdown>
      </div>

      @if (obligationTypeField.value && (obligationTypeField.value.code === '1' || obligationTypeField.value.code === '2')) {
        <p-dropdown
          id="institutionName"
          formControlName="institutionName"
          dataKey="id"
          [options]="institutions"
          placeholder="Seleccione"
          optionValue="name"
          [filter]="false">
          <ng-template pTemplate="selectedItem" let-selectedItem>
            <div class="flex align-items-center gap-2">
              <div>{{ selectedItem.name }}</div>
            </div>
          </ng-template>
          <ng-template let-item pTemplate="item">
            <div class="flex align-items-center gap-2">
              <div>{{ item.name }}</div>
            </div>
          </ng-template>
        </p-dropdown>
      }

      @if (obligationTypeField.value && obligationTypeField.value.code === '3') {
        <p-multiSelect
          [options]="institutions"
          formControlName="institutionName"
          optionLabel="name"
          optionValue="name"
          placeholder="Select Institutions">
        </p-multiSelect>
      }

      <form [formGroup]="obligationDetailForm">
        <textarea pInputTextarea formControlName="description"></textarea>
      </form>

      <div>
        <p-button label="Agregar" (click)="addObligation()"></p-button>
      </div>

    </form>

    @if (agreement.obligations) {
      <p-table [value]="agreement.obligations" dataKey="id">
        <ng-template pTemplate="header">
          <tr>
            <th>Entidad</th>
            <th>Tipo de Obligación</th>
            <th>Descripción</th>
            <th>Acciones</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
          <tr>
            <td>{{ item.institutionName }}</td>
            <td>{{ item.type.name }}</td>
            <td>
              <p-button
                [icon]="IconButtonActionEnum.DELETE"
                [severity]="SeverityButtonActionEnum.DELETE"
                (click)="deleteObligation(rowIndex)"></p-button>

              <p-button
                [icon]="IconButtonActionEnum.ADD"
                [severity]="SeverityButtonActionEnum.ADD"
                (click)="showObligationDetailModal(rowIndex)"></p-button>
            </td>
          </tr>
        </ng-template>
      </p-table>
    }
  </div>
</div>

<p-dialog
  [(visible)]="isVisibleObligationDetailForm"
  [modal]="true"
  [style]="{width: '50%'}"
  header="Gestión de Archivos">
  <form [formGroup]="obligationDetailForm">
    <textarea pInputTextarea formControlName="description"></textarea>
    <p-button label="Agregar" (click)="addObligationDetail()"></p-button>
  </form>
</p-dialog>
