<!-- internalInstitutionsForm -->
<p-panel>
  <ng-template pTemplate="header">
    <h4>Ministerio de Turismo:</h4>

    <p-button
      class="ml-2"
      [icon]="IconButtonActionEnum.ADD"
      [pTooltip]="LabelButtonActionEnum.ADD"
      [severity]="SeverityButtonActionEnum.ADD"
      (click)="showInternalInstitutionModal()"/>
  </ng-template>

  <ng-template pTemplate="content">
    @if (formInput.internalInstitutions.length > 0) {
      <!-- table internal-->
      <p-table
        styleClass="p-datatable-striped"
        [value]="formInput.internalInstitutions"
        [columns]="internalInstitutionsColumns">
        <ng-template pTemplate="header">
          <tr>
            @for (col of internalInstitutionsColumns; track col.field) {
              <th [pSortableColumn]="col.field">
                {{ col.header }}
              </th>
            }
            <th>{{ TableEnum.ACTIONS }}</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-internalInstitution let-rowIndex="rowIndex">
          <tr>
            <td>{{ internalInstitution.personType.name }}</td>
            <td>{{ internalInstitution.name }}</td>
            <td>
              @for (internalInstitutionDetail of internalInstitution.internalInstitutionDetails; track internalInstitutionDetail; let index = $index) {
                <ul>
                  {{ internalInstitutionDetail.position.name }}
                </ul>
              }
            </td>
            <td>
              <div class="button-group">
                <p-button
                  [icon]="PrimeIcons.TRASH"
                  [severity]="SeverityButtonActionEnum.DELETE"
                  (click)="deleteInternalInstitution(rowIndex)">
                </p-button>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    }
  </ng-template>
</p-panel>

<!-- externalInstitutionsForm -->
<p-panel>
  <ng-template pTemplate="header">
    <h4>Contraparte:</h4>

    <p-button
      class="ml-2"
      [icon]="IconButtonActionEnum.ADD"
      [pTooltip]="LabelButtonActionEnum.ADD"
      [severity]="SeverityButtonActionEnum.ADD"
      (click)="showExternalInstitutionModal()"/>
  </ng-template>

  <ng-template pTemplate="content">
    @if (formInput.externalInstitutions.length > 0) {
      <!-- table external-->
      <p-table
        [value]="formInput.externalInstitutions"
        [columns]="externalInstitutionsColumns"
        styleClass="p-datatable-striped">
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th>{{ TableEnum.ACTIONS }}</th>

            @for (col of columns; track col.field) {
              <th [pSortableColumn]="col.field">
                {{ col.header }}
              </th>
            }

            <th>{{ TableEnum.ACTIONS }}</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
          <tr>
            <td>
              <div class="button-group">
                <p-button
                  [icon]="IconButtonActionEnum.DELETE"
                  [severity]="SeverityButtonActionEnum.DELETE"
                  [pTooltip]="LabelButtonActionEnum.DELETE"
                  (click)="deleteExternalInstitution(rowIndex)"/>
              </div>
            </td>
            <td>{{ item.personType.name }}</td>
            <td>{{ item.name }}</td>
            <td>
              <ul>
                @for (externalInstitutionDetail of item.externalInstitutionDetails; track externalInstitutionDetail; let index = $index) {
                  <li class="mt-1">
                    <p-button
                      class="ml-1"
                      [icon]="IconButtonActionEnum.DELETE"
                      [severity]="SeverityButtonActionEnum.DELETE"
                      [pTooltip]="LabelButtonActionEnum.DELETE"
                      (click)="deleteExternalInstitutionDetail(rowIndex,index)">
                    </p-button>

                    {{ externalInstitutionDetail.position }} /
                    {{ externalInstitutionDetail.unit }}
                  </li>
                }
              </ul>
            </td>
            <td>
              <p-button
                [icon]="IconButtonActionEnum.ADD"
                [severity]="SeverityButtonActionEnum.ADD"
                [pTooltip]="LabelButtonActionEnum.ADD"
                (click)="showExternalInstitutionDetailModal(rowIndex)"/>
            </td>
          </tr>
        </ng-template>
      </p-table>
    }
  </ng-template>
</p-panel>

<p-dialog
  [(visible)]="isVisibleInternalInstitutionForm"
  [modal]="true"
  [style]="{width: '50rem'}"
  [maximizable]="true"
  header="Agregar">
  <form [formGroup]="internalInstitutionDetailForm" class="p-fluid grid">
    <!-- internalInstitutions/positionId -->
    <div class="field col-12 xl:col-12 lg:col-12 md:col-12 sm:col-12">
      <label
        appLabel
        for="internalPosition"
        [label]="InternalInstitutionsFormEnum.position"
        [required]="internalInstitutionDetailPositionField">
      </label>

      <p-listbox
        id="internalPosition"
        [options]="positions"
        formControlName="position"
        optionLabel="name"
        [filter]="true"
        [listStyle]="{'max-height': '150px'}"/>

      <small
        appErrorMessage
        [errors]="internalInstitutionDetailPositionField.errors"
        [touched]="internalInstitutionDetailPositionField.touched"
        [dirty]="internalInstitutionDetailPositionField.dirty">
      </small>
    </div>
  </form>

<!--  <form [formGroup]="internalInstitutionForm" class="p-fluid grid">-->
<!--    &lt;!&ndash; internalInstitutions/personTypeId &ndash;&gt;-->
<!--    <div class="field col-12 xl:col-12 lg:col-12 md:col-12 sm:col-12">-->
<!--      <label appLabel-->
<!--             for="internalPersonType"-->
<!--             [label]="InternalInstitutionsFormEnum.personType"-->
<!--             [required]="internalInstitutionPersonTypeField">-->
<!--      </label>-->

<!--      <p-listbox-->
<!--        id="internalPersonType"-->
<!--        [options]="internalPersonTypes"-->
<!--        formControlName="personType"-->
<!--        optionLabel="name"-->
<!--        [filter]="true"-->
<!--        [listStyle]="{'max-height': '150px'}"/>-->

<!--      <small-->
<!--        appErrorMessage-->
<!--        [errors]="internalInstitutionPersonTypeField.errors"-->
<!--        [touched]="internalInstitutionPersonTypeField.touched"-->
<!--        [dirty]="internalInstitutionPersonTypeField.dirty">-->
<!--      </small>-->
<!--    </div>-->
<!--  </form>-->

  <ng-template pTemplate="footer">
    <p-button
      [label]="LabelButtonActionEnum.CANCEL"
      [icon]="IconButtonActionEnum.CANCEL"
      [text]="true"
      [severity]="SeverityButtonActionEnum.CANCEL"
      (click)="isVisibleInternalInstitutionForm=false"/>

    <p-button
      [icon]="IconButtonActionEnum.ADD"
      [severity]="SeverityButtonActionEnum.ADD"
      [label]="LabelButtonActionEnum.ADD"
      (click)="addInternalInstitution()"/>
  </ng-template>
</p-dialog>

<p-dialog
  [(visible)]="isVisibleExternalInstitutionForm"
  [modal]="true"
  [style]="{width: '50rem'}"
  header="Agregar">
  <ng-template pTemplate="content">
    <form [formGroup]="externalInstitutionForm" class="p-fluid grid">
      <!-- name -->
      <div class="field col-12 xl:col-12 lg:col-12 md:col-12 sm:col-12">
        <label appLabel for="name"
               [label]="ExternalInstitutionsFormEnum.name"
               [required]="externalInstitutionNameField">
        </label>

        <input
          pInputText
          id="name"
          formControlName="name"/>

        <small
          appErrorMessage
          [errors]="externalInstitutionNameField.errors"
          [touched]="externalInstitutionNameField.touched"
          [dirty]="externalInstitutionNameField.dirty">
        </small>
      </div>

      <!-- personType -->
      <div class="field col-12 xl:col-12 lg:col-12 md:col-12 sm:col-12">
        <label
          appLabel
          for="externalPersonType"
          [label]="ExternalInstitutionsFormEnum.personType"
          [required]="externalInstitutionPersonTypeField">
        </label>

        <p-listbox
          id="externalPersonType"
          [options]="externalPersonTypes"
          formControlName="personType"
          optionLabel="name"
          [listStyle]="{'max-height': '150px'}"/>

        <small
          appErrorMessage
          [errors]="externalInstitutionPersonTypeField.errors"
          [touched]="externalInstitutionPersonTypeField.touched"
          [dirty]="externalInstitutionPersonTypeField.dirty">
        </small>
      </div>
    </form>

    <form [formGroup]="externalInstitutionDetailForm" class="p-fluid grid">
      <!-- position -->
      <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
        <label
          appLabel
          for="externalPosition2"
          [label]="ExternalInstitutionsFormEnum.position"
          [required]="externalInstitutionDetailPositionField">
        </label>

        <input
          pInputText
          id="externalPosition2"
          formControlName="position"/>

        <small
          appErrorMessage
          [errors]="externalInstitutionDetailPositionField.errors"
          [touched]="externalInstitutionDetailPositionField.touched"
          [dirty]="externalInstitutionDetailPositionField.dirty">
        </small>
      </div>

      <!-- unit -->
      <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
        <label
          appLabel
          for="unit2"
          [label]="ExternalInstitutionsFormEnum.unit"
          [required]="externalInstitutionDetailUnitField">
        </label>

        <input
          pInputText
          id="unit2"
          formControlName="unit"/>

        <small
          appErrorMessage
          [errors]="externalInstitutionDetailUnitField.errors"
          [touched]="externalInstitutionDetailUnitField.touched"
          [dirty]="externalInstitutionDetailUnitField.dirty">
        </small>
      </div>
    </form>
  </ng-template>

  <ng-template pTemplate="footer">
    <p-button
      [label]="LabelButtonActionEnum.CANCEL"
      [icon]="IconButtonActionEnum.CANCEL"
      [text]="true"
      [severity]="SeverityButtonActionEnum.CANCEL"
      (click)="isVisibleExternalInstitutionForm=false"/>

    <p-button
      [icon]="IconButtonActionEnum.ADD"
      [severity]="SeverityButtonActionEnum.ADD"
      [label]="LabelButtonActionEnum.ADD"
      (click)="addExternalInstitution()"/>
  </ng-template>
</p-dialog>

<p-dialog
  [(visible)]="isVisibleExternalInstitutionDetailForm"
  [modal]="true"
  [style]="{width: '50rem'}"
  header="Contraparte">
  <ng-template pTemplate="content">
    <form [formGroup]="externalInstitutionDetailForm" class="p-fluid grid">
      <!-- position -->
      <div class="field col-12 xl:col-12 lg:col-12 md:col-12 sm:col-12">
        <label
          appLabel
          for="externalPosition1"
          [label]="ExternalInstitutionsFormEnum.position"
          [required]="externalInstitutionDetailPositionField">
        </label>

        <input
          pInputText
          id="externalPosition1"
          formControlName="position"/>

        <small
          appErrorMessage
          [errors]="externalInstitutionDetailPositionField.errors"
          [touched]="externalInstitutionDetailPositionField.touched"
          [dirty]="externalInstitutionDetailPositionField.dirty">
        </small>
      </div>

      <!-- unit -->
      <div class="field col-12 xl:col-12 lg:col-12 md:col-12 sm:col-12">
        <label
          appLabel
          for="unit1"
          [label]="ExternalInstitutionsFormEnum.unit"
          [required]="externalInstitutionDetailUnitField">
        </label>

        <input
          pInputText
          id="unit1"
          formControlName="unit"/>

        <small
          appErrorMessage
          [errors]="externalInstitutionDetailUnitField.errors"
          [touched]="externalInstitutionDetailUnitField.touched"
          [dirty]="externalInstitutionDetailUnitField.dirty">
        </small>
      </div>
    </form>
  </ng-template>
  <ng-template pTemplate="footer">
    <p-button
      [label]="LabelButtonActionEnum.CANCEL"
      [icon]="IconButtonActionEnum.CANCEL"
      [text]="true"
      [severity]="SeverityButtonActionEnum.CANCEL"
      (click)="isVisibleExternalInstitutionDetailForm=false"/>

    <p-button
      [label]="LabelButtonActionEnum.ADD"
      [icon]="IconButtonActionEnum.ADD"
      [severity]="SeverityButtonActionEnum.ADD"
      (click)="addExternalInstitutionDetail()"/>
  </ng-template>
</p-dialog>
