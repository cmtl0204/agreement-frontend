<form class="p-fluid grid">
  <!-- internalInstitutionsForm -->
  <div class="field col-12 xl:col-12 lg:col-12 md:col-12 sm:col-12">
    <p-panel header="Ministerio de Turismo">
      <form [formGroup]="internalInstitutionForm" class="p-fluid grid">
        <!-- internalInstitutions/personTypeId -->
        <div class="field col-12 xl:col-5 lg:col-5 md:col-5 sm:col-12">
          <label appLabel
                 for="internalPersonType"
                 [label]="InternalInstitutionsFormEnum.personType"
                 [required]="internalInstitutionPersonTypeField">
          </label>
          <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
          <p-dropdown
            id="internalPersonType"
            formControlName="personType"
            dataKey="id"
            [options]="internalPersonTypes"
            placeholder="Seleccione"
            [filter]="false">
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div class="flex align-items-center gap-2">
                <div>{{ selectedOption.name }}</div>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center gap-2">
                <div>{{ item.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
          <small
            appErrorMessage
            [errors]="internalInstitutionPersonTypeField.errors"
            [touched]="internalInstitutionPersonTypeField.touched"
            [dirty]="internalInstitutionPersonTypeField.dirty">
          </small>
        </div>
      </form>
      
      <form [formGroup]="internalInstitutionDetailForm" class="p-fluid grid">
        <!-- internalInstitutions/positionId -->
        <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel
                 for="internalPosition"
                 [label]="InternalInstitutionsFormEnum.position"
                 [required]="internalInstitutionDetailPositionField">
          </label>
          <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
          <p-dropdown
            id="internalPosition"
            formControlName="position"
            dataKey="id"
            [options]="positions"
            placeholder="Seleccione"
            [filter]="false">
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div class="flex align-items-center gap-2">
                <div>{{ selectedOption.name }}</div>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center gap-2">
                <div>{{ item.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
          <small
            appErrorMessage
            [errors]="internalInstitutionDetailPositionField.errors"
            [touched]="internalInstitutionDetailPositionField.touched"
            [dirty]="internalInstitutionDetailPositionField.dirty">
          </small>
        </div>

        <!-- button add internalInstitution -->
        @if (agreement.internalInstitutions && agreement.internalInstitutions.length < 1) {
          <div class="ml-2" style="display: flex; align-items: center;">
            <p-button
              label="Añadir"
              [icon]="PrimeIcons.PLUS"
              [severity]="SeverityButtonActionEnum.ADD"
              (click)="addInternalInstitution()"/>
          </div>
        }
      </form>
<<<<<<< HEAD
      
=======

      <form [formGroup]="internalInstitutionDetailForm" class="p-fluid grid">
        <!-- internalInstitutions/positionId -->
        <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel
                 for="internalPosition"
                 [label]="InternalInstitutionsFormEnum.position"
                 [required]="internalInstitutionDetailPositionField">
          </label>
          <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
          <p-dropdown
            id="internalPosition"
            formControlName="position"
            dataKey="id"
            [options]="positions"
            placeholder="Seleccione"
            [filter]="false">
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div class="flex align-items-center gap-2">
                <div>{{ selectedOption.name }}</div>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center gap-2">
                <div>{{ item.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
          <small
            appErrorMessage
            [errors]="internalInstitutionDetailPositionField.errors"
            [touched]="internalInstitutionDetailPositionField.touched"
            [dirty]="internalInstitutionDetailPositionField.dirty">
          </small>
        </div>

        <!-- button add internalInstitution -->
        @if (internalInstitutionsField.length < 1) {
          <div class="ml-2" style="display: flex; align-items: center;">
            <p-button
              label="Añadir"
              [icon]="PrimeIcons.PLUS"
              [severity]="SeverityButtonActionEnum.ADD"
              (click)="addInternalInstitution()"/>
          </div>
        }
      </form>
>>>>>>> main
      <!-- table internal-->
      @if (agreement.internalInstitutions && agreement.internalInstitutions.length > 0){
        <p-table 
            [value]="agreement.internalInstitutions"
            sortField="name" 
            sortMode="single" 
            dataKey="name" 
            rowGroupMode="subheader" 
            groupRowsBy="name" 
            [tableStyle]="{'min-width': '70rem'}">
        <ng-template pTemplate="header">
            <tr>
                <th style="width:20%">Entidad</th>
                <th style="width:20%">Posición</th>
                <th style="width:20%">Unidad</th>
                <th style="width:20%">Acciones</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="groupheader" let-institution let-rowIndex="rowIndex" let-expanded="expanded">
            <tr>
                <td colspan="5">
                    <button 
                        type="button" 
                        pButton 
                        pRipple 
                        [pRowToggler]="institution" 
                        class="p-button-text p-button-rounded p-button-plain mr-2" 
                        [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'">
                    </button>
                    <span class="font-bold ml-2">{{institution.name}}</span>
                </td>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="rowexpansion" let-institution>
            <tr *ngFor="let detail of institution.internalInstitutionDetails">
                <td>{{institution.personType.name}}</td>
                <td>{{detail.position.name}}</td>
                <td>{{detail.unit}}</td>
                <td>
                  <button pButton
                          [icon]="PrimeIcons.TRASH"
                          [severity]="SeverityButtonActionEnum.DELETE"
                          (click)="deleteInternalInstitution(institution)">
                  </button>
                </td>
            </tr>
        </ng-template>
    </p-table> 
}
    </p-panel>
  </div>

  <!-- externalInstitutionsForm -->
  <div class="field col-12 xl:col-12 lg:col-12 md:col-12 sm:col-12">
    <p-panel header="Contraparte">
      <form [formGroup]="externalInstitutionForm" class="p-fluid grid">
<<<<<<< HEAD
<<<<<<< HEAD
=======
        <!-- externalInstitutions/name -->
        <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel for="name"
                 [label]="ExternalInstitutionsFormEnum.name"
                 [required]="externalInstitutionNameField">
          </label>
          <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
          <input pInputText
                 type="text"
                 id="name"
                 formControlName="name"/>
          <small
            appErrorMessage
            [errors]="externalInstitutionNameField.errors"
            [touched]="externalInstitutionNameField.touched"
            [dirty]="externalInstitutionNameField.dirty">
          </small>
        </div>

>>>>>>> 0ebc4fc9a08c4f49ade26c2c1dafb87f371ac66c
=======
>>>>>>> main
        <!-- externalInstitutions/personTypeId -->
        <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel
                 for="externalPersonType"
                 [label]="ExternalInstitutionsFormEnum.personType"
                 [required]="externalInstitutionPersonTypeField">
          </label>
          <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
          <p-dropdown
            id="externalPersonType"
            formControlName="personType"
            dataKey="id"
            [options]="externalPersonTypes"
            placeholder="Seleccione"
            [filter]="false">
            <ng-template pTemplate="selectedItem" let-selectedOption>
              <div class="flex align-items-center gap-2">
                <div>{{ selectedOption.name }}</div>
              </div>
            </ng-template>
            <ng-template let-item pTemplate="item">
              <div class="flex align-items-center gap-2">
                <div>{{ item.name }}</div>
              </div>
            </ng-template>
          </p-dropdown>
          <small
            appErrorMessage
            [errors]="externalInstitutionPersonTypeField.errors"
            [touched]="externalInstitutionPersonTypeField.touched"
            [dirty]="externalInstitutionPersonTypeField.dirty">
          </small>
        </div>
        
        <form [formGroup]="externalInstitutionDetailForm" class="p-fluid grid">
        <!-- externalInstitutions/position -->
        <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
            <label appLabel
            for="externalPosition"
            [label]="ExternalInstitutionsFormEnum.position"
            [required]="externalInstitutionDetailPositionField">
          </label>
          <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
<<<<<<< HEAD
<<<<<<< HEAD
=======
>>>>>>> main
          <input
            pInputText
            id="name"
            formControlName="name"/>
<<<<<<< HEAD
=======
          <input pInputText
          type="text"
          id="externalPosition"
          formControlName="position"/>
>>>>>>> 0ebc4fc9a08c4f49ade26c2c1dafb87f371ac66c
=======
>>>>>>> main
          <small
          appErrorMessage
          [errors]="externalInstitutionDetailPositionField.errors"
          [touched]="externalInstitutionDetailPositionField.touched"
          [dirty]="externalInstitutionDetailPositionField.dirty">
        </small>
        </div>
<<<<<<< HEAD
<<<<<<< HEAD
=======
      
        <!-- externalInstitutions/unit -->
        <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
          <label appLabel for="unit"
          [label]="ExternalInstitutionsFormEnum.unit"
          [required]="externalInstitutionDetailUnitField">
        </label>
        <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
        <input pInputText
        type="text"
        id="unit"
        formControlName="unit"/>
        <small
        appErrorMessage
        [errors]="externalInstitutionDetailUnitField.errors"
        [touched]="externalInstitutionDetailUnitField.touched"
        [dirty]="externalInstitutionDetailUnitField.dirty">
      </small>
        </div>
        {{this.externalInstitutionForm.value |json}}
        <br>
        {{this.externalInstitutionDetailForm.value |json}}
        </form>
>>>>>>> 0ebc4fc9a08c4f49ade26c2c1dafb87f371ac66c
=======
>>>>>>> main
      </form>
      <!-- button add externalInstitution -->
      <div class="field col-12" style="display: flex; justify-content: right">
        <p-button
          label="Añadir"
          [icon]="PrimeIcons.PLUS"
          [severity]="SeverityButtonActionEnum.ADD"
          (click)="addExternalInstitution()"/>
      </div>

        <p-dialog header="Edit Profile" [modal]="true" [(visible)]="visible" [style]="{ width: '50rem' }">
          <form [formGroup]="externalInstitutionDetailForm" class="p-fluid grid">
          <div class="flex align-items-center gap-3 mb-3">
            <label appLabel for="name"
                  [label]="ExternalInstitutionsFormEnum.name"
                  [required]="externalInstitutionNameField">
            </label>
            <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
            <input pInputText
                    type="text"
                    id="name"
                    formControlName="name"/>
          </div>
          <div class="flex align-items-center gap-3 mb-5">
            <label appLabel
            for="externalPersonType"
            [label]="ExternalInstitutionsFormEnum.personType"
            [required]="externalInstitutionPersonTypeField">
            </label>
            <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
            <p-dropdown
              id="externalPersonType"
              formControlName="personType"
              dataKey="id"
              [options]="externalPersonTypes"
              placeholder="Seleccione"
              [filter]="false">
              <ng-template pTemplate="selectedItem" let-selectedOption>
                <div class="flex align-items-center gap-2">
                  <div>{{ selectedOption.name }}</div>
                </div>
              </ng-template>
              <ng-template let-item pTemplate="item">
                <div class="flex align-items-center gap-2">
                  <div>{{ item.name }}</div>
                </div>
              </ng-template>
            </p-dropdown>
            
              </div>
              <div class="flex justify-content-end gap-2">
                  <p-button label="Cancel" severity="secondary" (onClick)="visible = false" />
                  <p-button label="Save" (onClick)="visible = false" />
              </div>
            </form>
      </p-dialog>

      <!-- table external-->
<<<<<<< HEAD
      @if (agreement.externalInstitutions && agreement.externalInstitutions.length > 0){
        <p-table 
            [value]="agreement.externalInstitutions"
            sortField="name" 
            sortMode="single" 
            dataKey="name" 
            rowGroupMode="subheader" 
            groupRowsBy="name" 
            [tableStyle]="{'min-width': '70rem'}">
        <ng-template pTemplate="header">
            <tr>
                <th style="width:20%">Entidad</th>
                <th style="width:20%">Posición</th>
                <th style="width:20%">Unidad</th>
                <th style="width:20%">Acciones</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="groupheader" let-institution let-rowIndex="rowIndex" let-expanded="expanded">
            <tr>
                <td colspan="5">
                    <button 
                        type="button" 
                        pButton 
                        pRipple 
                        [pRowToggler]="institution" 
                        class="p-button-text p-button-rounded p-button-plain mr-2" 
                        [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'">
                    </button>
                    <span class="font-bold ml-2">{{institution.name}}</span>
                    <button pButton
                          [icon]="PrimeIcons.PLUS"
                          [severity]="SeverityButtonActionEnum.SAVE"
                          (click)="showExternalInstitutionDetailModal(rowIndex)">
                    </button>
                    <button pButton
                          [icon]="PrimeIcons.TRASH"
                          [severity]="SeverityButtonActionEnum.DELETE"
                          (click)="deleteExternalInstitution(institution)">
                  </button>
                </td>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="rowexpansion" let-institution>
            <tr *ngFor="let detail of institution.externalInstitutionDetails">
                <td>{{institution.personType.name}}</td>
                <td>{{detail.position}}</td>
                <td>{{detail.unit}}</td>
=======
      @if (agreement.externalInstitutions) {
        <p-card class="field col-12">
          <p-table
            [value]="agreement.externalInstitutions"
            styleClass="p-datatable-striped">
            <ng-template pTemplate="header">
              @for (col of externalInstitutionsColumns; track col.field) {
                <th [pSortableColumn]="col.field">
                  {{ col.header }}
                </th>
              }
              <th class="text-center">
                Acciones
              </th>
            </ng-template>
            <ng-template pTemplate="body" let-externalInstitution let-rowIndex="rowIndex">
              <tr>
                <td>{{ externalInstitution.personType.name }}</td>
                <td>{{ externalInstitution.name }}</td>
>>>>>>> main
                <td>
                  <button pButton
                          [icon]="PrimeIcons.TRASH"
                          [severity]="SeverityButtonActionEnum.DELETE"
<<<<<<< HEAD
                          (click)="deleteExternalInstitutionDetail(institution, detail)">
                  </button>
                  <button pButton
                          [icon]="PrimeIcons.PLUS"
                          [severity]="SeverityButtonActionEnum.SAVE"
                          (click)="showDialog()">
=======
                          (click)="deleteExternalInstitution(rowIndex)">
                  </button>
                  <button pButton
                          [icon]="PrimeIcons.TRASH"
                          [severity]="SeverityButtonActionEnum.DELETE"
                          (click)="showExternalInstitutionDetailModal(rowIndex)">
>>>>>>> main
                  </button>
                </td>
            </tr>
        </ng-template>
    </p-table> 
}
    </p-panel>
  </div>
</form>

<p-dialog
  [(visible)]="isVisibleExternalInstitutionDetailForm"
  [modal]="true"
  [style]="{width: '50%'}"
  header="Gestión de Archivos">
  <form [formGroup]="externalInstitutionDetailForm" class="p-fluid grid">
    <!-- externalInstitutions/position -->
    <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
      <label appLabel
             for="externalPosition"
             [label]="ExternalInstitutionsFormEnum.position"
             [required]="externalInstitutionDetailPositionField">
      </label>
      <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
      <input
        pInputText
        id="externalPosition"
        formControlName="position"/>
      <small
        appErrorMessage
        [errors]="externalInstitutionDetailPositionField.errors"
        [touched]="externalInstitutionDetailPositionField.touched"
        [dirty]="externalInstitutionDetailPositionField.dirty">
      </small>
    </div>

    <!-- externalInstitutions/unit -->
    <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
      <label appLabel for="unit"
             [label]="ExternalInstitutionsFormEnum.unit"
             [required]="externalInstitutionDetailUnitField">
      </label>
      <app-form-help-field content="Esto es un mensaje de prueba"></app-form-help-field>
      <input
        pInputText
        id="unit"
        formControlName="unit"/>
      <small
        appErrorMessage
        [errors]="externalInstitutionDetailUnitField.errors"
        [touched]="externalInstitutionDetailUnitField.touched"
        [dirty]="externalInstitutionDetailUnitField.dirty">
      </small>
    </div>
    <div class="field col-12 xl:col-6 lg:col-6 md:col-6 sm:col-12">
      <p-button
        label="Agregar"
        (click)="addExternalInstitutionDetail()">
      </p-button>
    </div>
  </form>
</p-dialog>
